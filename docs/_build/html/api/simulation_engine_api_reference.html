<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
.chartjs-container {
    margin: 1.5em auto;
    padding: 1em;
    background: #f8f9fa;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.chart-note {
    text-align: center;
    color: #6c757d;
    font-size: 0.9em;
    margin-top: 0.5em;
}
</style>
<link rel="index" title="Index" href="../genindex.html"><link rel="search" title="Search" href="../search.html">

    <!-- Generated with Sphinx 8.2.3 and Furo 2025.09.25 -->
        <title>Simulation Engine API Reference Project: Double-Inverted Pendulum SMC Control System - DIP_SMC_PSO Documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5349f25f" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=8dab3a3b" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=8a7e329d" />
    
    


<style>
  body {
    --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">DIP_SMC_PSO Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <span class="sidebar-brand-text">DIP_SMC_PSO Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">📚 Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../README.html">Optimal Sliding Mode Control for a Double-Inverted Pendulum via PSO  ## How to validate a ResearchPlan JSON Run the validator locally: ```bash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../theory_overview.html">Theory Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">3. System Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plant_model.html">1.x Plant Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hil_quickstart.html">Hardware-in-the-Loop (HIL) Quickstart Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../streamlit_dashboard_guide.html">Streamlit Dashboard User Guide</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="https://github.com/theSadeQ/DIP_SMC_PSO/blob/main/docs/api/simulation_engine_api_reference.md?plain=true" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div><div class="edit-this-page">
  <a class="muted-link" href="https://github.com/theSadeQ/DIP_SMC_PSO/edit/main/docs/api/simulation_engine_api_reference.md" rel="edit" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section class="tex2jax_ignore mathjax_ignore" id="simulation-engine-api-reference-project-double-inverted-pendulum-smc-control-system">
<h1>Simulation Engine API Reference <strong>Project:</strong> Double-Inverted Pendulum SMC Control System<a class="headerlink" href="#simulation-engine-api-reference-project-double-inverted-pendulum-smc-control-system" title="Link to this heading">¶</a></h1>
<p><strong>Module:</strong> <code class="docutils literal notranslate"><span class="pre">src.simulation</span></code>
<strong>Version:</strong> 1.0
<strong>Date:</strong> 2025-10-07
<strong>Status:</strong> Production-Ready</p>
<hr class="docutils" />
<section id="table-of-contents-1-overview-architecture">
<h2>Table of Contents 1. <a class="reference internal" href="#1-overview--architecture"><span class="xref myst">Overview &amp; Architecture</span></a><a class="headerlink" href="#table-of-contents-1-overview-architecture" title="Link to this heading">¶</a></h2>
<ol class="arabic simple" start="2">
<li><p><a class="reference internal" href="#2-core-simulation-engine-api"><span class="xref myst">Core Simulation Engine API</span></a></p></li>
<li><p><a class="reference internal" href="#3-dynamics-model-api"><span class="xref myst">Dynamics Model API</span></a></p></li>
<li><p><a class="reference internal" href="#4-orchestrator-system-api"><span class="xref myst">Orchestrator System API</span></a></p></li>
<li><p><a class="reference internal" href="#5-integrator-system-api"><span class="xref myst">Integrator System API</span></a></p></li>
<li><p><a class="reference internal" href="#6-result-container-api"><span class="xref myst">Result Container API</span></a></p></li>
<li><p><a class="reference internal" href="#7-safety--monitoring-api"><span class="xref myst">Safety &amp; Monitoring API</span></a></p></li>
<li><p><a class="reference internal" href="#8-complete-code-examples"><span class="xref myst">Complete Code Examples</span></a></p></li>
<li><p><a class="reference internal" href="#9-integration-patterns"><span class="xref myst">Integration Patterns</span></a></p></li>
<li><p><a class="reference internal" href="#10-theory-cross-references--performance"><span class="xref myst">Theory Cross-References &amp; Performance</span></a></p></li>
</ol>
</section>
<hr class="docutils" />
<section id="overview-architecture-1-1-introduction-the-simulation-engine-is-the-core-execution-framework-for-the-double-inverted-pendulum-control-system-it-provides-flexible-simulation-execution-strategies-sequential-batch-parallel-real-time">
<h2>1. Overview &amp; Architecture ### 1.1 Introduction The <strong>Simulation Engine</strong> is the core execution framework for the Double-Inverted Pendulum control system. It provides: - <strong>Flexible simulation execution</strong> strategies (sequential, batch, parallel, real-time)<a class="headerlink" href="#overview-architecture-1-1-introduction-the-simulation-engine-is-the-core-execution-framework-for-the-double-inverted-pendulum-control-system-it-provides-flexible-simulation-execution-strategies-sequential-batch-parallel-real-time" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><strong>Multiple numerical integration</strong> methods (Euler, RK4, adaptive Runge-Kutta)</p></li>
<li><p><strong>dynamics models</strong> (simplified, full nonlinear, linearized)</p></li>
<li><p><strong>Safety monitoring</strong> and constraint enforcement</p></li>
<li><p><strong>Professional result management</strong> with export features - <strong>PSO optimization integration</strong> through batch execution</p></li>
<li><p><strong>Hardware-in-loop (HIL)</strong> real-time simulation support <strong>Key Features:</strong></p></li>
<li><p>✅ 45 Python modules providing complete simulation framework</p></li>
<li><p>✅ Backward-compatible with legacy <code class="docutils literal notranslate"><span class="pre">simulation_runner.py</span></code> interface</p></li>
<li><p>✅ Extensible architecture for research and production use</p></li>
<li><p>✅ Type-safe interfaces with protocols</p></li>
<li><p>✅ Production-grade error handling and monitoring</p></li>
<li><p>✅ Memory-optimized for long-running simulations ### 1.2 System Architecture ```
┌────────────────────────────────────────────────────────────────────────┐
│ SIMULATION ENGINE SYSTEM │
├────────────────────────────────────────────────────────────────────────┤
│ │
│ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ │
│ │ Controller │────▶│ Simulation │────▶│ Dynamics │ │
│ │ Factory │ │ Runner │ │ Model │ │
│ └─────────────┘ └─────────────┘ └─────────────┘ │
│ │ │ │ │
│ │ ▼ │ │
│ │ ┌──────────────┐ │ │
│ │ │ Orchestrator │ │ │
│ │ │ Strategy │ │ │
│ │ └──────────────┘ │ │
│ │ │ │ │
│ │ ┌──────────┴──────────┐ │ │
│ │ ▼ ▼ │ │
│ │ ┌───────────┐ ┌───────────┐ │ │
│ │ │Sequential │ │ Batch │ │ │
│ │ │Orchestr. │ │Orchestr. │ │ │
│ │ └───────────┘ └───────────┘ │ │
│ │ │ │ │ │
│ │ └──────────┬──────────┘ │ │
│ │ ▼ │ │
│ │ ┌──────────────┐ │ │
│ │ │ Integrator │◀───────────┘ │
│ │ │ Factory │ │
│ │ └──────────────┘ │
│ │ │ │
│ │ ┌──────────┴──────────┐ │
│ │ ▼ ▼ │
│ │ ┌───────────┐ ┌───────────┐ │
│ │ │ Euler │ │ RK4 │ │
│ │ │ (1st ord) │ │ (4th ord) │ │
│ │ └───────────┘ └───────────┘ │
│ │ │ │ │
│ │ └──────────┬──────────┘ │
│ │ ▼ │
│ │ ┌──────────────┐ │
│ │ │ Safety │ │
│ │ │ Guards │ │
│ │ └──────────────┘ │
│ │ │
│ ▼ │
│ ┌─────────────┐ │
│ │ PSO │ │
│ │Optimization │ │
│ └─────────────┘ │
│ │ │
│ ▼ │
│ ┌─────────────┐ │
│ │ Results │ │
│ │ Container │ │
│ └─────────────┘ │
│ │
└──────────────────────────────────────────────────────────────────────┘</p></li>
</ul>
<div class="highlight-### notranslate"><div class="highlight"><pre><span></span>- **`simulation_runner.py`** - Main simulation loop and legacy compatibility
- **`simulation_context.py`** - Configuration management and orchestrator selection
- **`interfaces.py`** - Protocol definitions for extensibility **Execution Strategies (Orchestrators):**
- **`orchestrators/sequential.py`** - Single-threaded step-by-step execution
- **`orchestrators/batch.py`** - Vectorized multi-simulation execution
- **`orchestrators/parallel.py`** - Multi-threaded parallel execution
- **`orchestrators/real_time.py`** - Real-time constraint enforcement for HIL **Numerical Integration:**
- **`integrators/factory.py`** - Integrator creation and registry
- **`integrators/fixed_step/euler.py`** - 1st-order Euler method
- **`integrators/fixed_step/runge_kutta.py`** - 2nd and 4th-order Runge-Kutta
- **`integrators/adaptive/runge_kutta.py`** - Adaptive step size with error control
- **`integrators/discrete/zero_order_hold.py`** - Discrete-time control **Plant Dynamics:**
- **`plant/models/base/dynamics_interface.py`** - DynamicsModel protocol
- **`plant/models/lowrank/dynamics.py`** - Simplified DIP dynamics
- **`plant/models/full/dynamics.py`** - Full nonlinear DIP dynamics
- **`plant/models/simplified/dynamics.py`** - Educational simplified model **Results &amp; Safety:**
- **`results/containers.py`** - StandardResultContainer, BatchResultContainer
- **`results/exporters.py`** - CSV, HDF5 export functionality
- **`safety/guards.py`** - NaN/Inf detection, energy bounds, state validation
- **`safety/monitors.py`** - Performance monitoring and statistics ### 1.4 Data Flow Diagram #### Simulation Loop Execution Flow ```
START │ ├─▶ Initialize state (x0) │ ├─▶ Initialize controller (state_vars, history) │ ├─▶ FOR each timestep i = 0 to N-1: │ │ │ ├─▶ Measure control computation time (start timer) │ │ │ ├─▶ Compute control: u = controller(t, x) │ │ │ │ │ ├─▶ [Has compute_control] → u, state_vars, history │ │ └─▶ [Has __call__] → u = controller(t, x) │ │ │ ├─▶ Check latency (end timer) │ │ │ │ │ └─▶ [Exceeds dt AND fallback available] → use fallback_controller │ │ │ ├─▶ Apply control saturation: u = clip(u, -u_max, u_max) │ │ │ ├─▶ Apply safety guards (NaN/Inf/Bounds checks) │ │ │ │ │ └─▶ [FAIL] → Truncate trajectory and return │ │ │ ├─▶ Propagate dynamics: x_next = dynamics.step(x, u, dt) │ │ │ │ │ └─▶ [Exception or NaN/Inf] → Truncate and return │ │ │ ├─▶ Validate result: np.isfinite(x_next) │ │ │ │ │ ├─▶ [PASS] → Continue │ │ └─▶ [FAIL] → Truncate and return │ │ │ └─▶ Store trajectory: (t[i+1], x[i+1], u[i]) │ └─▶ Attach final history to controller (if available) │ └─▶ Return: (t_arr, x_arr, u_arr)
``` #### Batch Simulation for PSO ```

PSO Tuner │ ├─▶ Generate N particles (gain sets) │ ├─▶ Create controller factory: functools.partial(create_controller, ...) │ ├─▶ FOR each particle p: │ │ │ ├─▶ Instantiate controller: ctrl = factory(gains=particle_p) │ │ │ ├─▶ BatchOrchestrator.execute() │ │ │ │ │ ├─▶ Initialize batch_size trajectories │ │ │ │ │ ├─▶ FOR each step: │ │ │ │ │ │ │ ├─▶ Vectorized control computation (batch_size x) │ │ │ │ │ │ │ ├─▶ Safety guard check (each trajectory) │ │ │ │ │ │ │ ├─▶ Dynamics step (each trajectory) │ │ │ │ │ │ │ └─▶ Collect results │ │ │ │ │ └─▶ Return BatchResultContainer │ │ │ ├─▶ Compute fitness metrics: │ │ │ │ │ ├─▶ Settling time (2% threshold) │ │ ├─▶ Overshoot (peak deviation) │ │ ├─▶ ISE (Integral Squared Error) │ │ └─▶ Control effort (sum |u|) │ │ │ └─▶ Store fitness[p] = combined_cost │ └─▶ PSO iteration: Update velocities and positions │ ├─▶ Convergence check (EnhancedConvergenceAnalyzer) │ │ │ ├─▶ Population diversity &lt; threshold │ ├─▶ Fitness stagnation &gt; N iterations │ └─▶ Velocity convergence &lt; threshold │ └─▶ [Converged] → Return optimal gains [Not converged] → Continue PSO iteration
``` ### 1.5 Key Design Patterns #### 1.5.1 Protocol-Based Interfaces All major components define protocols for extensibility: ```python
# example-metadata:
# runnable: false from typing import Protocol class DynamicsModel(Protocol): &quot;&quot;&quot;Protocol for plant dynamics models.&quot;&quot;&quot; def compute_dynamics(self, state, control_input, time=0.0, **kwargs) -&gt; DynamicsResult: ... def get_physics_matrices(self, state) -&gt; Tuple[np.ndarray, np.ndarray, np.ndarray]: ... def validate_state(self, state) -&gt; bool: ...
``` This allows:

- ✅ Duck-typed dynamics models (no inheritance required)
- ✅ Easy integration of custom dynamics
- ✅ Type checker validation (mypy, pyright) #### 1.5.2 Factory Pattern Integrator and orchestrator creation uses factory pattern: ```python
from src.simulation.integrators import IntegratorFactory integrator = IntegratorFactory.create_integrator(&#39;rk4&#39;, dt=0.01)
``` Benefits:
- ✅ Centralized integrator registry
- ✅ Consistent initialization
- ✅ Easy addition of new integrators
- ✅ Type safety and validation #### 1.5.3 Strategy Pattern Execution strategies encapsulated in orchestrators: ```python
# Sequential execution
seq_orchestrator = SequentialOrchestrator(dynamics, integrator)
result = seq_orchestrator.execute(initial_state, controls, dt, horizon) # Batch execution
batch_orchestrator = BatchOrchestrator(dynamics, integrator)
result = batch_orchestrator.execute(batch_initial_states, controls, dt, horizon)
``` Advantages:

- ✅ Swappable execution strategies
- ✅ Common interface for all orchestrators
- ✅ Performance optimization per strategy ### 1.6 Backward Compatibility **Legacy Interface Support:** The simulation engine maintains 100% backward compatibility with the original `simulation_runner.py`: ```python
# example-metadata:

# runnable: false # Legacy imports work unchanged

from src.simulation import run_simulation, step, get_step_fn, simulate # Original function signatures preserved
t, x, u = run_simulation(controller=..., dynamics_model=..., sim_time=5.0, dt=0.01, ...) # Legacy step function
x_next = step(x_current, u_current, dt)
``` **Migration Path:** New code can use modern orchestrator interface: ```python
from src.simulation import SequentialOrchestrator, IntegratorFactory # Modern interface
orchestrator = SequentialOrchestrator(dynamics, integrator)
result = orchestrator.execute(initial_state, controls, dt, horizon)
``` Both interfaces coexist seamlessly for gradual migration. ### 1.7 Performance Characteristics | Execution Strategy | Single Sim | Batch (10x) | Batch (100x) | Use Case |

|-------------------|------------|-------------|--------------|----------|
| Sequential | Baseline | 9.8x slower | 98x slower | Single trajectory, debugging |
| Batch | N/A | Baseline | 9.5x faster | PSO optimization, Monte Carlo |
| Parallel (4 cores) | N/A | 3.2x faster | 24x faster | Large parameter sweeps |
| Real-Time | Baseline | N/A | N/A | Hardware-in-loop, real systems | **Memory Footprint:**
- Sequential: ~5 MB per 10s simulation (6 states, 1000 steps)
- Batch (10x): ~50 MB (scales linearly)
- Batch (100x): ~500 MB (requires sufficient RAM) **Optimization Notes:**
- Use `BatchOrchestrator` for PSO fitness evaluation (10-30x speedup)
- Use `ForwardEuler` for fast prototyping (5x faster than RK4)
- Use `DormandPrince45` for high-accuracy requirements (adaptive step size)
- use `ParallelOrchestrator` for large-scale parameter studies

---

## 2. Core Simulation Engine API ### 2.1 `run_simulation()` Function **File:** `src/simulation/engines/simulation_runner.py:109` The main simulation function providing backward-compatible interface for controller-dynamics integration. #### 2.1.1 Function Signature ```python

# example-metadata:

# runnable: false def run_simulation( *, controller: Any, dynamics_model: Any, sim_time: float, dt: float, initial_state: Any, u_max: Optional[float] = None, seed: Optional[int] = None, rng: Optional[np.random.Generator] = None, latency_margin: Optional[float] = None, fallback_controller: Optional[Callable[[float, np.ndarray], float]] = None, **_kwargs: Any,

) -&gt; Tuple[np.ndarray, np.ndarray, np.ndarray]: &quot;&quot;&quot;Simulate a single controller trajectory using explicit Euler method.&quot;&quot;&quot;
``` #### 2.1.2 Parameters | Parameter | Type | Required | Default | Description |
|-----------|------|----------|---------|-------------|
| `controller` | Any | ✅ Yes | - | Controller object with `__call__(t, x)` or `compute_control(x, state, hist)` |
| `dynamics_model` | Any | ✅ Yes | - | Dynamics object with `step(state, u, dt)` method |
| `sim_time` | float | ✅ Yes | - | Total simulation time horizon (seconds) |
| `dt` | float | ✅ Yes | - | Integration timestep (seconds), must be &gt; 0 |
| `initial_state` | array-like | ✅ Yes | - | Initial state vector (flattened to 1D) |
| `u_max` | float | ❌ No | None | Control saturation limit; if None, uses `controller.max_force` |
| `seed` | int | ❌ No | None | (Deprecated) Random seed; use `rng` instead |
| `rng` | np.random.Generator | ❌ No | None | Random number generator for stochastic controllers |
| `latency_margin` | float | ❌ No | None | (Unused) Reserved for future latency control |
| `fallback_controller` | Callable | ❌ No | None | Fallback controller invoked after deadline miss |
| `**_kwargs` | dict | ❌ No | - | Additional kwargs ignored (backward compatibility) | #### 2.1.3 Return Values ```python
Tuple[np.ndarray, np.ndarray, np.ndarray] t_arr : np.ndarray # Time vector (n_steps+1,) x_arr : np.ndarray # State trajectory (n_steps+1, state_dim) u_arr : np.ndarray # Control sequence (n_steps,)
``` **Notes:**

- If simulation fails or is truncated, arrays are trimmed to valid length
- `t_arr[0] = 0.0`, `t_arr[-1] = n_steps * dt` where `n_steps = int(round(sim_time / dt))`
- `x_arr[0]` contains `initial_state`, `x_arr[i+1]` contains state after step `i`
- `u_arr[i]` contains control applied at step `i` #### 2.1.4 Controller Interface Requirements Controllers must implement **one** of these interfaces: **Option 1: Callable Interface**
```python
class MyController: def __call__(self, t: float, x: np.ndarray) -&gt; float: &quot;&quot;&quot;Compute control given time and state.&quot;&quot;&quot; return control_value
``` **Option 2: compute_control Interface** (Preferred for stateful controllers)

```python
class StatefulController: def compute_control(self, x: np.ndarray, state_vars: Any, history: Any): &quot;&quot;&quot;Compute control with state tracking.&quot;&quot;&quot; return control_value, updated_state, updated_history
``` **Optional Hooks:**

```python
def initialize_state(self) -&gt; Any: &quot;&quot;&quot;Initialize internal state variables (called once at start).&quot;&quot;&quot; return initial_state_vars def initialize_history(self) -&gt; Any: &quot;&quot;&quot;Initialize history buffer (called once at start).&quot;&quot;&quot; return initial_history
``` #### 2.1.5 Dynamics Model Interface Requirements Dynamics models must provide: ```python

class MyDynamics: def step(self, state: np.ndarray, u: float, dt: float) -&gt; np.ndarray: &quot;&quot;&quot;Integrate dynamics forward one timestep.&quot;&quot;&quot; return next_state
``` **Contract:**
- Input: `state` (n-dimensional), `u` (scalar or 1D array), `dt` (float)
- Output: `next_state` (n-dimensional, same shape as input state)
- Must handle exceptions gracefully (return NaN/Inf triggers truncation) #### 2.1.6 Control Saturation Logic ```python
# example-metadata:
# runnable: false # Priority hierarchy:
# 1. Explicit u_max parameter
if u_max is not None: u_limit = float(u_max)
# 2. Controller&#39;s max_force attribute
elif hasattr(controller, &#39;max_force&#39;): u_limit = float(controller.max_force)
# 3. No saturation
else: u_limit = None # Apply saturation
if u_limit is not None: u = np.clip(u, -u_limit, u_limit)
``` #### 2.1.7 Latency Monitoring and Fallback **Behavior:**

- Measures control computation time using `time.perf_counter()`
- If computation time exceeds `dt` on any step: - Engages `fallback_controller` for all subsequent steps - Logs latency violation (if logging enabled) **Example Use Case:**
```python
# example-metadata:
# runnable: false # Simple PD fallback controller
def pd_fallback(t, x): return -10 * x[0] - 5 * x[3] # -Kp*x - Kd*x_dot t, x, u = run_simulation( controller=complex_mpc_controller, dynamics_model=dynamics, sim_time=5.0, dt=0.01, initial_state=x0, fallback_controller=pd_fallback # Engage if MPC exceeds 10ms
)
``` #### 2.1.8 Early Termination Conditions Simulation terminates early if: 1. **Control computation fails:** ```python try: u = controller(t, x) except Exception: # Truncate and return ``` 2. **Dynamics propagation fails:** ```python try: x_next = dynamics.step(x, u, dt) except Exception: # Truncate and return ``` 3. **Invalid state detected:** ```python if not np.all(np.isfinite(x_next)): # Truncate and return (NaN or Inf detected) ``` **Truncated Return Behavior:**

- Arrays trimmed to last valid step
- `t_arr` length: `i+1` (0 to current step)
- `x_arr` length: `i+1` (includes current state)
- `u_arr` length: `i` (excludes failed control) #### 2.1.9 Memory Optimization **Key Optimization (Line 202, 249, 309):**
```python
# MEMORY OPTIMIZATION: asarray creates view when input is already ndarray
x0 = np.asarray(initial_state, dtype=float).reshape(-1) # View, not copy
x_curr = x0 # View, immediately overwritten at line 323
x_next = np.asarray(x_next, dtype=float).reshape(-1) # View when possible
``` **Impact:**

- Eliminates ~423 unnecessary array copies in typical 5s simulation
- Reduces memory allocations by 30-40%
- No performance degradation (validated by benchmarks) **Safety:**
- Guaranteed safe because: - `x_curr` immediately overwritten before first use - `x_next` from dynamics is copied into `x_arr` before view reassignment #### 2.1.10 Complete Usage Example ```python
from src.simulation import run_simulation
from src.controllers import create_controller
from src.plant.models import LowRankDIPDynamics
from src.config import load_config # Load configuration
config = load_config(&#39;config.yaml&#39;) # Create controller
controller = create_controller( &#39;classical_smc&#39;, config=config, gains=[10.0, 8.0, 15.0, 12.0, 50.0, 5.0]
) # Create dynamics model
dynamics = LowRankDIPDynamics(config.plant) # Run simulation
t, x, u = run_simulation( controller=controller, dynamics_model=dynamics, sim_time=5.0, dt=0.01, initial_state=[0, 0.1, 0.1, 0, 0, 0], # Small perturbation u_max=100.0, # Saturation limit seed=42 # Reproducibility
) # Analyze results
print(f&quot;Simulation steps: {len(t)-1}&quot;)
print(f&quot;Final state: {x[-1]}&quot;)
print(f&quot;Max control: {np.max(np.abs(u)):.2f} N&quot;)
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="simulationrunner-class-file-src-simulation-engines-simulation-runner-py-333-object-oriented-wrapper-around-run-simulation-providing-state-tracking-and-compatibility-with-test-cases-2-2-1-class-definition-python">
<h2>2.2 <code class="docutils literal notranslate"><span class="pre">SimulationRunner</span></code> Class <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/simulation/engines/simulation_runner.py:333</span></code> Object-oriented wrapper around <code class="docutils literal notranslate"><span class="pre">run_simulation()</span></code> providing state tracking and compatibility with test cases. #### 2.2.1 Class Definition ```python<a class="headerlink" href="#simulationrunner-class-file-src-simulation-engines-simulation-runner-py-333-object-oriented-wrapper-around-run-simulation-providing-state-tracking-and-compatibility-with-test-cases-2-2-1-class-definition-python" title="Link to this heading">¶</a></h2>
<p>class SimulationRunner: “””Object-oriented wrapper around run_simulation function.””” def <strong>init</strong>(self, dynamics_model: Any, dt: float = 0.01, max_time: float = 10.0): “””Initialize simulation runner.”””</p>
<div class="highlight-#### notranslate"><div class="highlight"><pre><span></span>
|-----------|------|---------|-------------|
| `dynamics_model` | Any | required | Object with `step(state, u, dt)` method |
| `dt` | float | 0.01 | Integration timestep (seconds) |
| `max_time` | float | 10.0 | Maximum simulation time (seconds) | #### 2.2.3 Attributes ```python
self.dynamics_model: Any # Dynamics model instance
self.dt: float # Integration timestep
self.max_time: float # Maximum simulation time
self.current_time: float # Current simulation time (updated after run)
self.step_count: int # Number of steps executed (updated after run)
self.simulation_history: List[dict] # History of all simulation runs
``` #### 2.2.4 `run_simulation()` Method ```python
def run_simulation( self, initial_state: np.ndarray, controller: Optional[Any] = None, reference: Optional[np.ndarray] = None, **kwargs: Any
) -&gt; dict[str, Any]: &quot;&quot;&quot;Run simulation using functional API.&quot;&quot;&quot;
``` **Returns:**

```python
{ &#39;success&#39;: bool, # Whether simulation completed without error &#39;states&#39;: np.ndarray, # State trajectory (n_steps+1, state_dim) &#39;controls&#39;: np.ndarray, # Control sequence (n_steps,) &#39;time&#39;: np.ndarray, # Time vector (n_steps+1,) &#39;final_state&#39;: np.ndarray, # Final state (state_dim,) &#39;step_count&#39;: int, # Number of steps executed &#39;error&#39;: str # Error message (only if success=False)
}
``` #### 2.2.5 Usage Example ```python

from src.simulation import SimulationRunner
from src.plant.models import LowRankDIPDynamics # Create runner
dynamics = LowRankDIPDynamics(config.plant)
runner = SimulationRunner(dynamics, dt=0.01, max_time=10.0) # Run simulation
result = runner.run_simulation( initial_state=np.array([0, 0.1, 0.1, 0, 0, 0]), controller=controller, sim_time=5.0
) # Check result
if result[&#39;success&#39;]: print(f&quot;Simulation completed: {result[&#39;step_count&#39;]} steps&quot;) print(f&quot;Final state: {result[&#39;final_state&#39;]}&quot;)
else: print(f&quot;Simulation failed: {result[&#39;error&#39;]}&quot;) # Access history
for i, run in enumerate(runner.simulation_history): print(f&quot;Run {i}: {run[&#39;time&#39;].shape[0]} steps&quot;)
</pre></div>
</div>
<hr class="docutils" />
<section id="legacy-compatibility-functions-2-3-1-step-function-file-src-simulation-engines-simulation-runner-py-87-python">
<h3>2.3 Legacy Compatibility Functions #### 2.3.1 <code class="docutils literal notranslate"><span class="pre">step()</span></code> Function <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/simulation/engines/simulation_runner.py:87</span></code> ```python<a class="headerlink" href="#legacy-compatibility-functions-2-3-1-step-function-file-src-simulation-engines-simulation-runner-py-87-python" title="Link to this heading">¶</a></h3>
<p>def step(x, u, dt): “””Unified simulation step entry point.”””</p>
<div class="highlight-Dispatches notranslate"><div class="highlight"><pre><span></span>
```python
from src.simulation import step # Single dynamics step
x_next = step(x_current, u_current, dt=0.01)
``` #### 2.3.2 `get_step_fn()` Function **File:** `src/simulation/engines/simulation_runner.py:75` ```python

def get_step_fn(): &quot;&quot;&quot;Return appropriate step function based on configuration.&quot;&quot;&quot;
``` Returns either `src.plant.models.dip_full.step` or `src.plant.models.dip_lowrank.step` based on `config.simulation.use_full_dynamics`. **Usage:**
```python

from src.simulation import get_step_fn # Get configured step function
step_fn = get_step_fn()
x_next = step_fn(x, u, dt)
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="dynamics-model-api-3-1-dynamicsmodel-protocol-file-src-plant-models-base-dynamics-interface-py-65-protocol-defining-the-interface-all-dynamics-models-must-implement-3-1-1-protocol-definition-python">
<h2>3. Dynamics Model API ### 3.1 <code class="docutils literal notranslate"><span class="pre">DynamicsModel</span></code> Protocol <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/plant/models/base/dynamics_interface.py:65</span></code> Protocol defining the interface all dynamics models must implement. #### 3.1.1 Protocol Definition ```python<a class="headerlink" href="#dynamics-model-api-3-1-dynamicsmodel-protocol-file-src-plant-models-base-dynamics-interface-py-65-protocol-defining-the-interface-all-dynamics-models-must-implement-3-1-1-protocol-definition-python" title="Link to this heading">¶</a></h2>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="example-metadata">
<h1>example-metadata:<a class="headerlink" href="#example-metadata" title="Link to this heading">¶</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="runnable-false-class-dynamicsmodel-protocol-protocol-for-plant-dynamics-models-def-compute-dynamics-self-state-np-ndarray-control-input-np-ndarray-time-float-0-0-kwargs-any-dynamicsresult-compute-system-dynamics-at-given-state-and-input-def-get-physics-matrices-self-state-np-ndarray-tuple-np-ndarray-np-ndarray-np-ndarray-get-physics-matrices-m-c-g-at-current-state-def-validate-state-self-state-np-ndarray-bool-validate-state-vector-format-and-bounds-def-get-state-dimension-self-int-get-dimension-of-state-vector-def-get-control-dimension-self-int-get-dimension-of-control-input-vector">
<h1>runnable: false class DynamicsModel(Protocol): “””Protocol for plant dynamics models.””” def compute_dynamics( self, state: np.ndarray, control_input: np.ndarray, time: float = 0.0, **kwargs: Any ) -&gt; DynamicsResult: “””Compute system dynamics at given state and input.””” … def get_physics_matrices( self, state: np.ndarray ) -&gt; Tuple[np.ndarray, np.ndarray, np.ndarray]: “””Get physics matrices M, C, G at current state.””” … def validate_state(self, state: np.ndarray) -&gt; bool: “””Validate state vector format and bounds.””” … def get_state_dimension(self) -&gt; int: “””Get dimension of state vector.””” … def get_control_dimension(self) -&gt; int: “””Get dimension of control input vector.””” …<a class="headerlink" href="#runnable-false-class-dynamicsmodel-protocol-protocol-for-plant-dynamics-models-def-compute-dynamics-self-state-np-ndarray-control-input-np-ndarray-time-float-0-0-kwargs-any-dynamicsresult-compute-system-dynamics-at-given-state-and-input-def-get-physics-matrices-self-state-np-ndarray-tuple-np-ndarray-np-ndarray-np-ndarray-get-physics-matrices-m-c-g-at-current-state-def-validate-state-self-state-np-ndarray-bool-validate-state-vector-format-and-bounds-def-get-state-dimension-self-int-get-dimension-of-state-vector-def-get-control-dimension-self-int-get-dimension-of-control-input-vector" title="Link to this heading">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">####</span> <span class="pre">3.1.2</span> <span class="pre">`DynamicsResult`</span> <span class="pre">NamedTuple</span></code>python</p>
<p>class DynamicsResult(NamedTuple): “””Result of dynamics computation.””” state_derivative: np.ndarray # dx/dt vector success: bool # Whether computation succeeded info: Dict[str, Any] # Additional diagnostic information</p>
<div class="highlight-**Factory notranslate"><div class="highlight"><pre><span></span>```python
# example-metadata:

# runnable: false # Create successful result

result = DynamicsResult.success_result( state_derivative=dx_dt, time=t, energy=total_energy
) # Create failure result
result = DynamicsResult.failure_result( reason=&quot;Singular matrix detected&quot;, condition_number=1e15
)
</pre></div>
</div>
<hr class="docutils" />
<section id="basedynamicsmodel-abstract-class-file-src-plant-models-base-dynamics-interface-py-130-abstract-base-class-providing-common-functionality-for-concrete-dynamics-implementations-3-2-1-class-definition-python">
<h2>3.2 <code class="docutils literal notranslate"><span class="pre">BaseDynamicsModel</span></code> Abstract Class <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/plant/models/base/dynamics_interface.py:130</span></code> Abstract base class providing common functionality for concrete dynamics implementations. #### 3.2.1 Class Definition ```python<a class="headerlink" href="#basedynamicsmodel-abstract-class-file-src-plant-models-base-dynamics-interface-py-130-abstract-base-class-providing-common-functionality-for-concrete-dynamics-implementations-3-2-1-class-definition-python" title="Link to this heading">¶</a></h2>
<p>class BaseDynamicsModel(ABC): “””Abstract base class for dynamics models.””” def <strong>init</strong>(self, parameters: Any): “””Initialize dynamics model.””” self.parameters = parameters self._setup_validation() self._setup_monitoring()
<code class="docutils literal notranslate"><span class="pre">####</span> <span class="pre">3.2.2</span> <span class="pre">Abstract</span> <span class="pre">Methods</span> <span class="pre">(Must</span> <span class="pre">Implement)</span></code>python</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1>example-metadata:<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="runnable-false-abstractmethod">
<h1>runnable: false &#64;abstractmethod<a class="headerlink" href="#runnable-false-abstractmethod" title="Link to this heading">¶</a></h1>
<p>def compute_dynamics( self, state: np.ndarray, control_input: np.ndarray, time: float = 0.0, **kwargs: Any
) -&gt; DynamicsResult: “””Compute system dynamics (must be implemented by subclasses).””” pass &#64;abstractmethod
def get_physics_matrices( self, state: np.ndarray
) -&gt; Tuple[np.ndarray, np.ndarray, np.ndarray]: “””Get physics matrices (must be implemented by subclasses).””” pass &#64;abstractmethod
def _setup_validation(self) -&gt; None: “””Setup state validation (must be implemented by subclasses).””” pass</p>
<div class="highlight-#### notranslate"><div class="highlight"><pre><span></span>```python
# example-metadata:

# runnable: false def validate_state(self, state: np.ndarray) -&gt; bool: &quot;&quot;&quot;Validate state vector using configured validator.&quot;&quot;&quot; if hasattr(self, &#39;_state_validator&#39;): return self._state_validator.validate_state(state) return self._basic_state_validation(state) def sanitize_state(self, state: np.ndarray) -&gt; np.ndarray: &quot;&quot;&quot;Sanitize state vector if validator supports it.&quot;&quot;&quot; if hasattr(self, &#39;_state_validator&#39;): return self._state_validator.sanitize_state(state) return state

``` **Dimension Accessors:**
```python

def get_state_dimension(self) -&gt; int: &quot;&quot;&quot;Get state vector dimension (default: 6 for DIP).&quot;&quot;&quot; return 6 def get_control_dimension(self) -&gt; int: &quot;&quot;&quot;Get control input dimension (default: 1 for DIP).&quot;&quot;&quot; return 1
``` **Monitoring:**
```python
# example-metadata:

# runnable: false def reset_monitoring(self) -&gt; None: &quot;&quot;&quot;Reset monitoring statistics.&quot;&quot;&quot; if hasattr(self, &#39;_stability_monitor&#39;): self._stability_monitor.reset_statistics() def get_monitoring_stats(self) -&gt; Dict[str, Any]: &quot;&quot;&quot;Get monitoring statistics.&quot;&quot;&quot; stats = {} if hasattr(self, &#39;_stability_monitor&#39;): stats[&#39;numerical_stability&#39;] = self._stability_monitor.get_statistics() return stats

</pre></div>
</div>
<hr class="docutils" />
<section id="lowrankdipdynamics-implementation-file-src-plant-models-lowrank-dynamics-py-27-simplified-double-inverted-pendulum-dynamics-optimized-for-computational-efficiency-3-3-1-class-definition-python">
<h2>3.3 <code class="docutils literal notranslate"><span class="pre">LowRankDIPDynamics</span></code> Implementation <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/plant/models/lowrank/dynamics.py:27</span></code> Simplified double-inverted pendulum dynamics optimized for computational efficiency. #### 3.3.1 Class Definition ```python<a class="headerlink" href="#lowrankdipdynamics-implementation-file-src-plant-models-lowrank-dynamics-py-27-simplified-double-inverted-pendulum-dynamics-optimized-for-computational-efficiency-3-3-1-class-definition-python" title="Link to this heading">¶</a></h2>
<p>class LowRankDIPDynamics(BaseDynamicsModel): “””Low-rank Double Inverted Pendulum Dynamics Model.””” def <strong>init</strong>( self, config: Union[LowRankDIPConfig, Dict[str, Any]], enable_monitoring: bool = False, enable_validation: bool = True ): “””Initialize low-rank DIP dynamics.”””</p>
<div class="highlight-#### notranslate"><div class="highlight"><pre><span></span>
- ✅ **Essential dynamics preservation** (qualitatively similar to full model)
- ✅ **Optional linearization** for stability analysis
- ✅ **Small-angle approximations** for efficiency
- ✅ **Educational clarity** with simplified physics #### 3.3.3 Configuration ```python
from src.plant.models.lowrank import LowRankDIPConfig, LowRankDIPDynamics # Create default configuration
config = LowRankDIPConfig.create_default() # Or load from dictionary
config = LowRankDIPConfig.from_dict({ &#39;cart_mass&#39;: 1.0, &#39;pole1_mass&#39;: 0.1, &#39;pole2_mass&#39;: 0.1, &#39;pole1_length&#39;: 0.5, &#39;pole2_length&#39;: 0.5, &#39;gravity&#39;: 9.81, &#39;damping_cart&#39;: 0.01, &#39;damping_pole1&#39;: 0.001, &#39;damping_pole2&#39;: 0.001
}) # Initialize dynamics
dynamics = LowRankDIPDynamics( config=config, enable_monitoring=True, # Track performance statistics enable_validation=True # state validation
)
``` #### 3.3.4 Physics Computation **State Vector:**
</pre></div>
</div>
<p>x = [x, θ₁, θ₂, ẋ, θ̇₁, θ̇₂]ᵀ where: x - cart position θ₁ - pole 1 angle (from vertical) θ₂ - pole 2 angle (from vertical) ẋ - cart velocity θ̇₁ - pole 1 angular velocity θ̇₂ - pole 2 angular velocity
<code class="docutils literal notranslate"><span class="pre">**Dynamics</span> <span class="pre">Equations</span> <span class="pre">(Low-Rank</span> <span class="pre">Approximation):**</span> <span class="pre">The</span> <span class="pre">low-rank</span> <span class="pre">model</span> <span class="pre">simplifies</span> <span class="pre">the</span> <span class="pre">full</span> <span class="pre">nonlinear</span> <span class="pre">dynamics</span> <span class="pre">using</span> <span class="pre">small-angle</span> <span class="pre">approximations:</span></code>
sin(θᵢ) ≈ θᵢ
cos(θᵢ) ≈ 1
<code class="docutils literal notranslate"><span class="pre">This</span> <span class="pre">yields</span> <span class="pre">linearized</span> <span class="pre">equations</span> <span class="pre">of</span> <span class="pre">motion</span> <span class="pre">suitable</span> <span class="pre">for</span> <span class="pre">fast</span> <span class="pre">computation:</span></code></p>
<p>M(x) q̈ = -C(x, ẋ) ẋ - G(x) + Bu where: M = Simplified mass matrix (3x3) C = Simplified Coriolis/damping matrix G = Simplified gravity vector B = Input matrix [1, 0, 0]ᵀ u = Control force
<code class="docutils literal notranslate"><span class="pre">####</span> <span class="pre">3.3.5</span> <span class="pre">Method:</span> <span class="pre">`compute_dynamics()`</span></code>python
def compute_dynamics( self, state: np.ndarray, control_input: np.ndarray, time: float = 0.0, **kwargs: Any
) -&gt; DynamicsResult: “””Compute low-rank DIP dynamics.”””</p>
<div class="highlight-**Returns notranslate"><div class="highlight"><pre><span></span>
- `state_derivative`: 6-dimensional dx/dt vector
- `success`: True if computation succeeded
- `info`: Dictionary with diagnostics (energy, conditioning, etc.) #### 3.3.6 Method: `get_physics_matrices()` ```python
def get_physics_matrices( self, state: np.ndarray
) -&gt; Tuple[np.ndarray, np.ndarray, np.ndarray]: &quot;&quot;&quot;Get simplified physics matrices M, C, G.&quot;&quot;&quot;
``` **Returns:**
- `M`: Mass/inertia matrix (3x3)
- `C`: Coriolis/damping matrix (3x3)
- `G`: Gravity vector (3,)

---

### 3.4 `LinearDynamicsModel` Base Class **File:** `src/plant/models/base/dynamics_interface.py:252` Base class for linear system dynamics: `ẋ = Ax + Bu + f(t)` #### 3.4.1 Class Definition ```python
class LinearDynamicsModel(BaseDynamicsModel): &quot;&quot;&quot;Base class for linear dynamics models.&quot;&quot;&quot; def __init__(self, A: np.ndarray, B: np.ndarray, parameters: Any): &quot;&quot;&quot;Initialize linear dynamics model.&quot;&quot;&quot; super().__init__(parameters) self.A = A # System matrix self.B = B # Input matrix self._validate_matrices()
``` #### 3.4.2 Linear Dynamics Computation ```python
# example-metadata:

# runnable: false def compute_dynamics( self, state: np.ndarray, control_input: np.ndarray, time: float = 0.0, **kwargs: Any

) -&gt; DynamicsResult: &quot;&quot;&quot;Compute linear dynamics: ẋ = Ax + Bu&quot;&quot;&quot; state_derivative = self.A @ state + self.B @ control_input # Optional time-varying disturbance if hasattr(self, &#39;_compute_time_varying_terms&#39;): disturbance = self._compute_time_varying_terms(time, state) state_derivative += disturbance return DynamicsResult.success_result(state_derivative, time=time)
``` #### 3.4.3 Usage Example ```python
import numpy as np
from src.plant.models.base import LinearDynamicsModel # Define linearized DIP system
A = np.array([ [0, 0, 0, 1, 0, 0], [0, 0, 0, 0, 1, 0], [0, 0, 0, 0, 0, 1], [0, 14.7, 14.7, -0.1, 0, 0], [0, -29.4, 14.7, 0, -0.01, 0], [0, 14.7, -44.1, 0, 0, -0.01]
]) B = np.array([[0], [0], [0], [1], [0], [0]]) # Create linear dynamics
linear_dynamics = LinearDynamicsModel(A, B, parameters=config.plant) # Use with simulation
t, x, u = run_simulation( controller=linear_controller, dynamics_model=linear_dynamics, sim_time=5.0, dt=0.01, initial_state=[0, 0.1, 0.1, 0, 0, 0]
)
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="orchestrator-system-api-4-1-orchestrator-base-interface-file-src-simulation-core-interfaces-py-85-base-interface-defining-execution-strategy-protocol-python">
<h2>4. Orchestrator System API ### 4.1 <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> Base Interface <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/simulation/core/interfaces.py:85</span></code> Base interface defining execution strategy protocol. ```python<a class="headerlink" href="#orchestrator-system-api-4-1-orchestrator-base-interface-file-src-simulation-core-interfaces-py-85-base-interface-defining-execution-strategy-protocol-python" title="Link to this heading">¶</a></h2>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id2">
<h1>example-metadata:<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="runnable-false-class-orchestrator-abc-base-interface-for-simulation-execution-strategies-abstractmethod-def-execute-self-initial-state-np-ndarray-control-inputs-np-ndarray-dt-float-horizon-int-kwargs-resultcontainer-execute-simulation-with-specified-strategy-pass">
<h1>runnable: false class Orchestrator(ABC): “””Base interface for simulation execution strategies.””” &#64;abstractmethod def execute( self, initial_state: np.ndarray, control_inputs: np.ndarray, dt: float, horizon: int, **kwargs ) -&gt; ResultContainer: “””Execute simulation with specified strategy.””” pass<a class="headerlink" href="#runnable-false-class-orchestrator-abc-base-interface-for-simulation-execution-strategies-abstractmethod-def-execute-self-initial-state-np-ndarray-control-inputs-np-ndarray-dt-float-horizon-int-kwargs-resultcontainer-execute-simulation-with-specified-strategy-pass" title="Link to this heading">¶</a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="o">---</span>

<span class="c1">## 4.2 `SequentialOrchestrator` **File:** `src/simulation/orchestrators/sequential.py:18` Single-threaded step-by-step execution for standard simulations. #### 4.2.1 Class Definition ```python</span>
<span class="c1"># example-metadata:</span>
<span class="c1"># runnable: false class SequentialOrchestrator(BaseOrchestrator): &quot;&quot;&quot;Sequential simulation orchestrator for single-threaded execution.&quot;&quot;&quot; def execute( self, initial_state: np.ndarray, control_inputs: np.ndarray, dt: float, horizon: int, **kwargs ) -&gt; ResultContainer: &quot;&quot;&quot;Execute sequential simulation.&quot;&quot;&quot;</span>
<span class="err">```</span> <span class="c1">#### 4.2.2 Parameters | Parameter | Type | Shape | Description |</span>

<span class="o">|-----------|------|-------|-------------|</span>
<span class="o">|</span> <span class="err">`</span><span class="n">initial_state</span><span class="err">`</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="p">(</span><span class="n">n</span><span class="p">,)</span> <span class="o">|</span> <span class="n">Initial</span> <span class="n">state</span> <span class="n">vector</span> <span class="o">|</span>
<span class="o">|</span> <span class="err">`</span><span class="n">control_inputs</span><span class="err">`</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="p">(</span><span class="n">horizon</span><span class="p">,)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">horizon</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="o">|</span> <span class="n">Control</span> <span class="n">sequence</span> <span class="o">|</span>
<span class="o">|</span> <span class="err">`</span><span class="n">dt</span><span class="err">`</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">scalar</span> <span class="o">|</span> <span class="n">Time</span> <span class="n">step</span> <span class="o">|</span>
<span class="o">|</span> <span class="err">`</span><span class="n">horizon</span><span class="err">`</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">scalar</span> <span class="o">|</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">simulation</span> <span class="n">steps</span> <span class="o">|</span>
<span class="o">|</span> <span class="err">`</span><span class="o">**</span><span class="n">kwargs</span><span class="err">`</span> <span class="o">|</span> <span class="nb">dict</span> <span class="o">|</span> <span class="o">-</span> <span class="o">|</span> <span class="n">Additional</span> <span class="n">options</span> <span class="o">|</span> <span class="o">**</span><span class="n">Optional</span> <span class="n">Kwargs</span><span class="p">:</span><span class="o">**</span>
<span class="o">-</span> <span class="err">`</span><span class="n">safety_guards</span><span class="err">`</span> <span class="p">(</span><span class="nb">bool</span><span class="p">):</span> <span class="n">safety</span> <span class="n">checking</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span>
<span class="o">-</span> <span class="err">`</span><span class="n">stop_fn</span><span class="err">`</span> <span class="p">(</span><span class="n">Callable</span><span class="p">):</span> <span class="n">Custom</span> <span class="n">stop</span> <span class="n">condition</span> <span class="n">function</span>
<span class="o">-</span> <span class="err">`</span><span class="n">t0</span><span class="err">`</span> <span class="p">(</span><span class="nb">float</span><span class="p">):</span> <span class="n">Initial</span> <span class="n">time</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">)</span> <span class="c1">#### 4.2.3 Features - ✅ **Step-by-step execution** with full state tracking</span>
<span class="o">-</span> <span class="err">✅</span> <span class="o">**</span><span class="n">Safety</span> <span class="n">guard</span> <span class="n">integration</span><span class="o">**</span> <span class="p">(</span><span class="n">NaN</span><span class="o">/</span><span class="n">Inf</span> <span class="n">detection</span><span class="p">)</span>
<span class="o">-</span> <span class="err">✅</span> <span class="o">**</span><span class="n">Early</span> <span class="n">termination</span><span class="o">**</span> <span class="n">on</span> <span class="n">stop</span> <span class="n">condition</span>
<span class="o">-</span> <span class="err">✅</span> <span class="o">**</span><span class="n">Trajectory</span> <span class="n">truncation</span><span class="o">**</span> <span class="n">on</span> <span class="n">failure</span>
<span class="o">-</span> <span class="err">✅</span> <span class="o">**</span><span class="n">Compatible</span> <span class="k">with</span> <span class="nb">all</span> <span class="n">integrators</span><span class="o">**</span> <span class="c1">#### 4.2.4 Usage Example ```python</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.simulation.orchestrators</span><span class="w"> </span><span class="kn">import</span> <span class="n">SequentialOrchestrator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.simulation.integrators</span><span class="w"> </span><span class="kn">import</span> <span class="n">IntegratorFactory</span> <span class="c1"># Create orchestrator</span>
<span class="n">integrator</span> <span class="o">=</span> <span class="n">IntegratorFactory</span><span class="o">.</span><span class="n">create_integrator</span><span class="p">(</span><span class="s1">&#39;rk4&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">orchestrator</span> <span class="o">=</span> <span class="n">SequentialOrchestrator</span><span class="p">(</span><span class="n">dynamics</span><span class="p">,</span> <span class="n">integrator</span><span class="p">)</span> <span class="c1"># Execute simulation</span>
<span class="n">initial_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">controls</span> <span class="o">=</span> <span class="n">controller_sequence</span> <span class="c1"># (horizon,) array</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">orchestrator</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span> <span class="n">initial_state</span><span class="o">=</span><span class="n">initial_state</span><span class="p">,</span> <span class="n">control_inputs</span><span class="o">=</span><span class="n">controls</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">safety_guards</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span> <span class="c1"># Access results</span>
<span class="n">states</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get_states</span><span class="p">()</span> <span class="c1"># (horizon+1, 6)</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get_times</span><span class="p">()</span> <span class="c1"># (horizon+1,)</span>
</pre></div>
</div>
<hr class="docutils" />
<section id="batchorchestrator-file-src-simulation-orchestrators-batch-py-18-vectorized-execution-for-multiple-simultaneous-simulations-pso-optimization-monte-carlo-4-3-1-class-definition-python">
<h2>4.3 <code class="docutils literal notranslate"><span class="pre">BatchOrchestrator</span></code> <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/simulation/orchestrators/batch.py:18</span></code> Vectorized execution for multiple simultaneous simulations (PSO optimization, Monte Carlo). #### 4.3.1 Class Definition ```python<a class="headerlink" href="#batchorchestrator-file-src-simulation-orchestrators-batch-py-18-vectorized-execution-for-multiple-simultaneous-simulations-pso-optimization-monte-carlo-4-3-1-class-definition-python" title="Link to this heading">¶</a></h2>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id3">
<h1>example-metadata:<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="runnable-false-class-batchorchestrator-baseorchestrator-batch-simulation-orchestrator-for-vectorized-execution-def-execute-self-initial-state-np-ndarray-control-inputs-np-ndarray-dt-float-horizon-int-kwargs-resultcontainer-execute-batch-simulation">
<h1>runnable: false class BatchOrchestrator(BaseOrchestrator): “””Batch simulation orchestrator for vectorized execution.””” def execute( self, initial_state: np.ndarray, control_inputs: np.ndarray, dt: float, horizon: int, **kwargs ) -&gt; ResultContainer: “””Execute batch simulation.”””<a class="headerlink" href="#runnable-false-class-batchorchestrator-baseorchestrator-batch-simulation-orchestrator-for-vectorized-execution-def-execute-self-initial-state-np-ndarray-control-inputs-np-ndarray-dt-float-horizon-int-kwargs-resultcontainer-execute-batch-simulation" title="Link to this heading">¶</a></h1>
<div class="highlight-#### notranslate"><div class="highlight"><pre><span></span>
|-----------|------|-------|-------------|
| `initial_state` | np.ndarray | (n,) or (batch_size, n) | Initial states |
| `control_inputs` | np.ndarray | (horizon,) or (batch_size, horizon, m) | Control sequences |
| `dt` | float | scalar | Time step |
| `horizon` | int | scalar | Number of simulation steps |
| `**kwargs` | dict | - | Additional options | **Batch Size Handling:**
- If `initial_state.shape == (n,)`: Single simulation (batch_size=1)
- If `initial_state.shape == (B, n)`: Batch of B simulations #### 4.3.3 Features - ✅ **Vectorized execution** for multiple trajectories
- ✅ **Active mask management** (track which sims are active)
- ✅ **Per-trajectory safety guards**
- ✅ **Independent truncation** (failures don&#39;t affect other trajectories)
- ✅ **Batch result aggregation** in BatchResultContainer #### 4.3.4 Performance Characteristics | Batch Size | Speedup vs Sequential | Memory Overhead |
|------------|----------------------|-----------------|
| 10x | 9.5x faster | 10x memory |
| 100x | 95x faster | 100x memory |
| 1000x | 850x faster | 1000x memory (may require RAM upgrade) | **Optimal Batch Sizes:**
- PSO optimization: 20-50 particles
- Monte Carlo: 100-1000 trials
- Parameter sweeps: 100-500 combinations #### 4.3.5 Usage Example: PSO Optimization ```python
from src.simulation.orchestrators import BatchOrchestrator
from src.optimization import PSOTuner
import functools # Create batch orchestrator
orchestrator = BatchOrchestrator(dynamics, integrator) # Define fitness function using batch execution
def fitness_function(gains): # Create controller with candidate gains controller = create_controller(&#39;classical_smc&#39;, config, gains=gains) # Batch initial conditions (10 perturbations) batch_initial = np.random.randn(10, 6) * 0.1 # Generate control inputs controls = np.zeros((10, 500)) # (batch_size, horizon) for i in range(10): for t in range(500): controls[i, t] = controller(t * 0.01, batch_initial[i]) # Batch execution result = orchestrator.execute( initial_state=batch_initial, control_inputs=controls, dt=0.01, horizon=500 ) # Compute fitness (aggregate over 10 trials) all_states = result.get_states() # (10, 501, 6) settling_times = compute_settling_times(all_states) return np.mean(settling_times) # Use with PSO
tuner = PSOTuner(fitness_fn=fitness_function, bounds=[(1,50)]*6)
result = tuner.optimise()
</pre></div>
</div>
<hr class="docutils" />
<section id="parallelorchestrator-file-src-simulation-orchestrators-parallel-py-multi-threaded-execution-for-large-scale-parameter-studies-4-4-1-features-thread-pool-management-configurable-pool-size">
<h2>4.4 <code class="docutils literal notranslate"><span class="pre">ParallelOrchestrator</span></code> <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/simulation/orchestrators/parallel.py</span></code> Multi-threaded execution for large-scale parameter studies. #### 4.4.1 Features - ✅ <strong>Thread pool management</strong> (configurable pool size)<a class="headerlink" href="#parallelorchestrator-file-src-simulation-orchestrators-parallel-py-multi-threaded-execution-for-large-scale-parameter-studies-4-4-1-features-thread-pool-management-configurable-pool-size" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>✅ <strong>Result synchronization</strong> across threads</p></li>
<li><p>✅ <strong>Load balancing</strong> for uneven workloads</p></li>
<li><p>✅ <strong>Exception handling</strong> per thread #### 4.4.2 Usage Example ```python
from src.simulation.orchestrators import ParallelOrchestrator # Create parallel orchestrator (4 worker threads)
orchestrator = ParallelOrchestrator( dynamics=dynamics, integrator=integrator, num_workers=4
) # Execute parameter sweep
param_grid = generate_parameter_combinations() # (1000, n_params)
results = orchestrator.execute_parameter_sweep(param_grid)</p></li>
</ul>
<div class="highlight-**Note:** notranslate"><div class="highlight"><pre><span></span>
---

### 4.5 `RealTimeOrchestrator` **File:** `src/simulation/orchestrators/real_time.py` Real-time constraint enforcement for hardware-in-loop (HIL) applications. #### 4.5.1 Features - ✅ **Real-time timing** synchronized with wall clock

- ✅ **Deadline monitoring** with configurable tolerance
- ✅ **Late execution detection** and logging
- ✅ **Compatible with HIL interfaces** #### 4.5.2 Usage Example ```python
from src.simulation.orchestrators import RealTimeOrchestrator
from src.interfaces.hil import PlantServer # Create real-time orchestrator
orchestrator = RealTimeOrchestrator( dynamics=hardware_interface, integrator=integrator, real_time_factor=1.0, # Real-time (use 0.5 for slow-motion, 2.0 for fast) deadline_tolerance=0.001 # 1ms tolerance
) # Execute HIL simulation
result = orchestrator.execute( initial_state=x0, control_inputs=None, # Generated dynamically dt=0.01, horizon=1000, controller=controller
) # Check timing statistics
stats = orchestrator.get_timing_stats()
print(f&quot;Deadline misses: {stats[&#39;deadline_misses&#39;]}&quot;)
print(f&quot;Average execution time: {stats[&#39;mean_exec_time&#39;]:.3f}ms&quot;)
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="integrator-system-api-5-1-integratorfactory-file-src-simulation-integrators-factory-py-22-factory-pattern-for-creating-numerical-integrator-instances-with-validation-and-consistency-checking-5-1-1-integrator-registry-the-factory-maintains-a-registry-of-7-integrator-types-type-class-order-adaptive-description">
<h2>5. Integrator System API ### 5.1 <code class="docutils literal notranslate"><span class="pre">IntegratorFactory</span></code> <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/simulation/integrators/factory.py:22</span></code> Factory pattern for creating numerical integrator instances with validation and consistency checking. #### 5.1.1 Integrator Registry The factory maintains a registry of 7 integrator types: | Type | Class | Order | Adaptive | Description |<a class="headerlink" href="#integrator-system-api-5-1-integratorfactory-file-src-simulation-integrators-factory-py-22-factory-pattern-for-creating-numerical-integrator-instances-with-validation-and-consistency-checking-5-1-1-integrator-registry-the-factory-maintains-a-registry-of-7-integrator-types-type-class-order-adaptive-description" title="Link to this heading">¶</a></h2>
<p>|——|——-|——-|———-|————-|
| <code class="docutils literal notranslate"><span class="pre">'euler'</span></code> | ForwardEuler | 1st | No | Simple forward Euler |
| <code class="docutils literal notranslate"><span class="pre">'forward_euler'</span></code> | ForwardEuler | 1st | No | Alias for euler |
| <code class="docutils literal notranslate"><span class="pre">'backward_euler'</span></code> | BackwardEuler | 1st | No | Implicit backward Euler |
| <code class="docutils literal notranslate"><span class="pre">'rk2'</span></code> | RungeKutta2 | 2nd | No | Midpoint method |
| <code class="docutils literal notranslate"><span class="pre">'rk4'</span></code> | RungeKutta4 | 4th | No | Classic 4th-order RK |
| <code class="docutils literal notranslate"><span class="pre">'runge_kutta_4'</span></code> | RungeKutta4 | 4th | No | Alias for rk4 |
| <code class="docutils literal notranslate"><span class="pre">'adaptive_rk'</span></code> | AdaptiveRungeKutta | 4th/5th | Yes | Variable step size |
| <code class="docutils literal notranslate"><span class="pre">'dormand_prince'</span></code> | DormandPrince45 | 4th/5th | Yes | DP45 adaptive method |
| <code class="docutils literal notranslate"><span class="pre">'dp45'</span></code> | DormandPrince45 | 4th/5th | Yes | Alias for dormand_prince |
| <code class="docutils literal notranslate"><span class="pre">'zoh'</span></code> | ZeroOrderHold | 1st | No | Discrete-time control |
| <code class="docutils literal notranslate"><span class="pre">'zero_order_hold'</span></code> | ZeroOrderHold | 1st | No | Alias for zoh | #### 5.1.2 <code class="docutils literal notranslate"><span class="pre">create_integrator()</span></code> Method ```python
&#64;classmethod
def create_integrator( cls, integrator_type: str, dt: float = 0.01, **kwargs: Any
) -&gt; BaseIntegrator: “””Create integrator instance of specified type.”””</p>
<div class="highlight-**Parameters:** notranslate"><div class="highlight"><pre><span></span>
- `integrator_type` (str): Type identifier (case-insensitive, dash/space normalized)
- `dt` (float): Default integration timestep (stored as `integrator.default_dt`)
- `**kwargs`: Integrator-specific parameters **Returns:** Configured BaseIntegrator instance **Raises:** ValueError if integrator_type not recognized **Example:**
```python
from src.simulation.integrators import IntegratorFactory # Create RK4 integrator
rk4 = IntegratorFactory.create_integrator(&#39;rk4&#39;, dt=0.01) # Create adaptive integrator with error tolerances
dp45 = IntegratorFactory.create_integrator( &#39;dormand_prince&#39;, dt=0.01, atol=1e-6, rtol=1e-3
) # Use with orchestrator
from src.simulation.orchestrators import SequentialOrchestrator
orchestrator = SequentialOrchestrator(dynamics, rk4)
``` #### 5.1.3 Utility Methods **list_available_integrators()**

```python
# example-metadata:
# runnable: false IntegratorFactory.list_available_integrators()
# Returns: [&#39;euler&#39;, &#39;forward_euler&#39;, &#39;backward_euler&#39;, &#39;rk2&#39;, &#39;rk4&#39;, ...]
``` **get_integrator_info()**

```python
info = IntegratorFactory.get_integrator_info(&#39;rk4&#39;)
# Returns:
# {
# &#39;class_name&#39;: &#39;RungeKutta4&#39;,
# &#39;module&#39;: &#39;src.simulation.integrators.fixed_step.runge_kutta&#39;,
# &#39;order&#39;: 4,
# &#39;adaptive&#39;: False,
# &#39;description&#39;: &#39;Classic 4th-order Runge-Kutta method&#39;
# }
``` **register_integrator()** (Advanced)

```python
# example-metadata:
# runnable: false from src.simulation.integrators.base import BaseIntegrator class MyCustomIntegrator(BaseIntegrator): &quot;&quot;&quot;Custom integration method.&quot;&quot;&quot; ORDER = 3 ADAPTIVE = False # ... implement integrate() method ... # Register custom integrator
IntegratorFactory.register_integrator(&#39;my_custom&#39;, MyCustomIntegrator)
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="fixed-step-integrators-5-2-1-forwardeuler-file-src-simulation-integrators-fixed-step-euler-py-first-order-explicit-euler-method-x-n-1-x-n-dt-f-x-n-u-n-t-n-properties">
<h2>5.2 Fixed-Step Integrators #### 5.2.1 <code class="docutils literal notranslate"><span class="pre">ForwardEuler</span></code> <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/simulation/integrators/fixed_step/euler.py</span></code> First-order explicit Euler method: <code class="docutils literal notranslate"><span class="pre">x_{n+1}</span> <span class="pre">=</span> <span class="pre">x_n</span> <span class="pre">+</span> <span class="pre">dt</span> <span class="pre">*</span> <span class="pre">f(x_n,</span> <span class="pre">u_n,</span> <span class="pre">t_n)</span></code> <strong>Properties:</strong><a class="headerlink" href="#fixed-step-integrators-5-2-1-forwardeuler-file-src-simulation-integrators-fixed-step-euler-py-first-order-explicit-euler-method-x-n-1-x-n-dt-f-x-n-u-n-t-n-properties" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Order: 1</p></li>
<li><p>Stability: Conditionally stable (small dt required)</p></li>
<li><p>Performance: Fastest (5x faster than RK4)</p></li>
<li><p>Accuracy: Low (O(dt²) global error) <strong>Use Cases:</strong></p></li>
<li><p>Fast prototyping</p></li>
<li><p>Non-stiff systems with small dt</p></li>
<li><p>Real-time applications with tight timing constraints <strong>Example:</strong></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">euler</span> <span class="o">=</span> <span class="n">IntegratorFactory</span><span class="o">.</span><span class="n">create_integrator</span><span class="p">(</span><span class="s1">&#39;euler&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span> <span class="c1"># Small dt for stability</span>
<span class="err">```</span> <span class="c1">#### 5.2.2 `RungeKutta2` **File:** `src/simulation/integrators/fixed_step/runge_kutta.py` Second-order midpoint method (improved Euler). **Properties:**</span>

<span class="o">-</span> <span class="n">Order</span><span class="p">:</span> <span class="mi">2</span>
<span class="o">-</span> <span class="n">Stability</span><span class="p">:</span> <span class="n">Better</span> <span class="n">than</span> <span class="n">Euler</span>
<span class="o">-</span> <span class="n">Performance</span><span class="p">:</span> <span class="mi">2</span><span class="n">x</span> <span class="n">slower</span> <span class="n">than</span> <span class="n">Euler</span>
<span class="o">-</span> <span class="n">Accuracy</span><span class="p">:</span> <span class="n">Moderate</span> <span class="p">(</span><span class="n">O</span><span class="p">(</span><span class="n">dt</span><span class="err">³</span><span class="p">)</span> <span class="k">global</span> <span class="n">error</span><span class="p">)</span> <span class="o">**</span><span class="n">Use</span> <span class="n">Cases</span><span class="p">:</span><span class="o">**</span>
<span class="o">-</span> <span class="n">Balance</span> <span class="n">between</span> <span class="n">speed</span> <span class="ow">and</span> <span class="n">accuracy</span>
<span class="o">-</span> <span class="n">Educational</span> <span class="n">demonstrations</span> <span class="c1">#### 5.2.3 `RungeKutta4` **File:** `src/simulation/integrators/fixed_step/runge_kutta.py` Classic 4th-order Runge-Kutta method (RK4) - **Recommended default**. **Properties:**</span>
<span class="o">-</span> <span class="n">Order</span><span class="p">:</span> <span class="mi">4</span>
<span class="o">-</span> <span class="n">Stability</span><span class="p">:</span> <span class="k">for</span> <span class="n">non</span><span class="o">-</span><span class="n">stiff</span> <span class="n">systems</span>
<span class="o">-</span> <span class="n">Performance</span><span class="p">:</span> <span class="n">Baseline</span> <span class="n">reference</span>
<span class="o">-</span> <span class="n">Accuracy</span><span class="p">:</span> <span class="n">High</span> <span class="p">(</span><span class="n">O</span><span class="p">(</span><span class="n">dt</span><span class="err">⁵</span><span class="p">)</span> <span class="k">global</span> <span class="n">error</span><span class="p">)</span> <span class="o">**</span><span class="n">Algorithm</span><span class="p">:</span><span class="o">**</span>
<span class="err">```</span><span class="n">python</span>
<span class="n">k1</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x_n</span><span class="p">,</span> <span class="n">u_n</span><span class="p">,</span> <span class="n">t_n</span><span class="p">)</span>
<span class="n">k2</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x_n</span> <span class="o">+</span> <span class="n">dt</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">k1</span><span class="p">,</span> <span class="n">u_n</span><span class="p">,</span> <span class="n">t_n</span> <span class="o">+</span> <span class="n">dt</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="n">k3</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x_n</span> <span class="o">+</span> <span class="n">dt</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">k2</span><span class="p">,</span> <span class="n">u_n</span><span class="p">,</span> <span class="n">t_n</span> <span class="o">+</span> <span class="n">dt</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="n">k4</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x_n</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">k3</span><span class="p">,</span> <span class="n">u_n</span><span class="p">,</span> <span class="n">t_n</span> <span class="o">+</span> <span class="n">dt</span><span class="p">)</span>
<span class="n">x_</span><span class="p">{</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">}</span> <span class="o">=</span> <span class="n">x_n</span> <span class="o">+</span> <span class="n">dt</span><span class="o">/</span><span class="mi">6</span> <span class="o">*</span> <span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k3</span> <span class="o">+</span> <span class="n">k4</span><span class="p">)</span>
<span class="err">```</span> <span class="o">**</span><span class="n">Use</span> <span class="n">Cases</span><span class="p">:</span><span class="o">**</span>

<span class="o">-</span> <span class="n">Standard</span> <span class="n">choice</span> <span class="k">for</span> <span class="n">most</span> <span class="n">simulations</span>
<span class="o">-</span> <span class="n">Good</span> <span class="n">accuracy</span> <span class="k">with</span> <span class="n">reasonable</span> <span class="n">performance</span>
<span class="o">-</span> <span class="n">DIP</span> <span class="n">control</span> <span class="n">system</span> <span class="n">simulations</span> <span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="n">s</span> <span class="n">typical</span><span class="p">)</span> <span class="o">**</span><span class="n">Example</span><span class="p">:</span><span class="o">**</span>
<span class="err">```</span><span class="n">python</span>
<span class="n">rk4</span> <span class="o">=</span> <span class="n">IntegratorFactory</span><span class="o">.</span><span class="n">create_integrator</span><span class="p">(</span><span class="s1">&#39;rk4&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
</pre></div>
</div>
<hr class="docutils" />
<section id="adaptive-integrators-5-3-1-dormandprince45-file-src-simulation-integrators-adaptive-runge-kutta-py-dormand-prince-4th-5th-order-adaptive-runge-kutta-method-dp45-recommended-for-high-accuracy-requirements-properties">
<h3>5.3 Adaptive Integrators #### 5.3.1 <code class="docutils literal notranslate"><span class="pre">DormandPrince45</span></code> <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/simulation/integrators/adaptive/runge_kutta.py</span></code> Dormand-Prince 4th/5th order adaptive Runge-Kutta method (DP45) - <strong>Recommended for high-accuracy requirements</strong>. <strong>Properties:</strong><a class="headerlink" href="#adaptive-integrators-5-3-1-dormandprince45-file-src-simulation-integrators-adaptive-runge-kutta-py-dormand-prince-4th-5th-order-adaptive-runge-kutta-method-dp45-recommended-for-high-accuracy-requirements-properties" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>Order: 4th-order accurate, 5th-order error estimate</p></li>
<li><p>Adaptive: Yes (automatic step size adjustment)</p></li>
<li><p>Performance: 2-5x slower than RK4 (depending on error tolerance)</p></li>
<li><p>Accuracy: (user-controlled via tolerances) <strong>Configuration:</strong></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dp45</span> <span class="o">=</span> <span class="n">IntegratorFactory</span><span class="o">.</span><span class="n">create_integrator</span><span class="p">(</span> <span class="s1">&#39;dormand_prince&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="c1"># Initial step size atol=1e-6, # Absolute error tolerance rtol=1e-3, # Relative error tolerance min_step=1e-6, # Minimum allowed step size max_step=0.1, # Maximum allowed step size safety_factor=0.9 # Step size adjustment factor</span>
<span class="p">)</span>
<span class="err">```</span> <span class="o">**</span><span class="n">Error</span> <span class="n">Control</span><span class="p">:</span><span class="o">**</span>

<span class="o">-</span> <span class="n">Computes</span> <span class="n">error</span> <span class="n">estimate</span><span class="p">:</span> <span class="err">`</span><span class="n">err</span> <span class="o">=</span> <span class="o">||</span><span class="n">x_5</span> <span class="o">-</span> <span class="n">x_4</span><span class="o">||</span> <span class="o">/</span> <span class="p">(</span><span class="n">atol</span> <span class="o">+</span> <span class="n">rtol</span> <span class="o">*</span> <span class="o">||</span><span class="n">x</span><span class="o">||</span><span class="p">)</span><span class="err">`</span>
<span class="o">-</span> <span class="n">Accepts</span> <span class="n">step</span> <span class="k">if</span> <span class="err">`</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="err">`</span>
<span class="o">-</span> <span class="n">Adjusts</span> <span class="nb">next</span> <span class="n">step</span><span class="p">:</span> <span class="err">`</span><span class="n">dt_next</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">safety_factor</span> <span class="o">*</span> <span class="n">err</span><span class="o">^</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span><span class="err">`</span> <span class="o">**</span><span class="n">Use</span> <span class="n">Cases</span><span class="p">:</span><span class="o">**</span>
<span class="o">-</span> <span class="n">High</span><span class="o">-</span><span class="n">accuracy</span> <span class="n">simulations</span>
<span class="o">-</span> <span class="n">Stiff</span> <span class="n">dynamics</span> <span class="p">(</span><span class="k">with</span> <span class="n">small</span> <span class="n">initial</span> <span class="n">dt</span><span class="p">)</span>
<span class="o">-</span> <span class="n">Variable</span> <span class="n">dynamics</span> <span class="p">(</span><span class="n">rapidly</span> <span class="n">changing</span> <span class="n">time</span> <span class="n">constants</span><span class="p">)</span>
<span class="o">-</span> <span class="n">Scientific</span> <span class="n">validation</span> <span class="ow">and</span> <span class="n">benchmarking</span> <span class="o">**</span><span class="n">Example</span><span class="p">:</span><span class="o">**</span>
<span class="err">```</span><span class="n">python</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.simulation.integrators</span><span class="w"> </span><span class="kn">import</span> <span class="n">IntegratorFactory</span> <span class="c1"># High-accuracy integration</span>
<span class="n">dp45</span> <span class="o">=</span> <span class="n">IntegratorFactory</span><span class="o">.</span><span class="n">create_integrator</span><span class="p">(</span> <span class="s1">&#39;dp45&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span> <span class="c1"># Tight tolerance rtol=1e-6</span>
<span class="p">)</span> <span class="c1"># Use with orchestrator</span>
<span class="n">orchestrator</span> <span class="o">=</span> <span class="n">SequentialOrchestrator</span><span class="p">(</span><span class="n">dynamics</span><span class="p">,</span> <span class="n">dp45</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">orchestrator</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span> <span class="n">initial_state</span><span class="o">=</span><span class="n">x0</span><span class="p">,</span> <span class="n">control_inputs</span><span class="o">=</span><span class="n">controls</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="c1"># Initial dt (will adapt) horizon=1000</span>
<span class="p">)</span> <span class="c1"># Check integration statistics</span>
<span class="n">stats</span> <span class="o">=</span> <span class="n">dp45</span><span class="o">.</span><span class="n">get_statistics</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accepted steps: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;accepted_steps&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rejected steps: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;rejected_steps&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average step size: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;mean_step_size&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
<span class="err">```</span> <span class="c1">#### 5.3.2 `AdaptiveRungeKutta` **File:** `src/simulation/integrators/adaptive/runge_kutta.py` Generic adaptive RK integrator with configurable Butcher tableau. **Use Cases:**</span>

<span class="o">-</span> <span class="n">Research</span> <span class="ow">and</span> <span class="n">experimentation</span> <span class="k">with</span> <span class="n">custom</span> <span class="n">RK</span> <span class="n">methods</span>
<span class="o">-</span> <span class="n">Implementing</span> <span class="n">specialized</span> <span class="n">adaptive</span> <span class="n">methods</span>

<span class="o">---</span>

<span class="c1">### 5.4 Discrete Integrators #### 5.4.1 `ZeroOrderHold` **File:** `src/simulation/integrators/discrete/zero_order_hold.py` Zero-order hold (ZOH) for discrete-time control systems. **Properties:**</span>

<span class="o">-</span> <span class="n">Order</span><span class="p">:</span> <span class="mi">1</span> <span class="p">(</span><span class="n">equivalent</span> <span class="n">to</span> <span class="n">Euler</span> <span class="k">with</span> <span class="n">ZOH</span> <span class="n">control</span><span class="p">)</span>
<span class="o">-</span> <span class="n">Discrete</span><span class="p">:</span> <span class="n">Control</span> <span class="n">held</span> <span class="n">constant</span> <span class="n">over</span> <span class="n">interval</span>
<span class="o">-</span> <span class="n">Performance</span><span class="p">:</span> <span class="n">Fast</span> <span class="p">(</span><span class="n">similar</span> <span class="n">to</span> <span class="n">Euler</span><span class="p">)</span> <span class="o">**</span><span class="n">Behavior</span><span class="p">:</span><span class="o">**</span>
<span class="err">```</span><span class="n">python</span>
<span class="n">u_held</span> <span class="o">=</span> <span class="n">u_n</span> <span class="c1"># Control held constant</span>
<span class="n">x_</span><span class="p">{</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">}</span> <span class="o">=</span> <span class="n">x_n</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">f</span><span class="p">(</span><span class="n">x_n</span><span class="p">,</span> <span class="n">u_held</span><span class="p">,</span> <span class="n">t_n</span><span class="p">)</span> <span class="c1"># Euler step with held control</span>
<span class="err">```</span> <span class="o">**</span><span class="n">Use</span> <span class="n">Cases</span><span class="p">:</span><span class="o">**</span>

<span class="o">-</span> <span class="n">Discrete</span><span class="o">-</span><span class="n">time</span> <span class="n">controller</span> <span class="n">testing</span>
<span class="o">-</span> <span class="n">Sampled</span><span class="o">-</span><span class="n">data</span> <span class="n">systems</span>
<span class="o">-</span> <span class="n">Hardware</span><span class="o">-</span><span class="ow">in</span><span class="o">-</span><span class="n">loop</span> <span class="k">with</span> <span class="n">discrete</span> <span class="n">actuators</span> <span class="o">**</span><span class="n">Example</span><span class="p">:</span><span class="o">**</span>
<span class="err">```</span><span class="n">python</span>
<span class="n">zoh</span> <span class="o">=</span> <span class="n">IntegratorFactory</span><span class="o">.</span><span class="n">create_integrator</span><span class="p">(</span><span class="s1">&#39;zoh&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span> <span class="c1"># Typical use with discrete controller</span>
<span class="n">orchestrator</span> <span class="o">=</span> <span class="n">SequentialOrchestrator</span><span class="p">(</span><span class="n">dynamics</span><span class="p">,</span> <span class="n">zoh</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">orchestrator</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span> <span class="n">initial_state</span><span class="o">=</span><span class="n">x0</span><span class="p">,</span> <span class="n">control_inputs</span><span class="o">=</span><span class="n">discrete_controls</span><span class="p">,</span> <span class="c1"># Piecewise constant dt=0.01, horizon=500</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="integrator-selection-guide-5-5-1-decision-tree">
<h3>5.5 Integrator Selection Guide #### 5.5.1 Decision Tree ```<a class="headerlink" href="#integrator-selection-guide-5-5-1-decision-tree" title="Link to this heading">¶</a></h3>
<p>Need adaptive step size?
├─ YES → DormandPrince45 (atol=1e-6, rtol=1e-3)
│ Use for: High accuracy, stiff systems, variable dynamics
│
└─ NO → Need high accuracy? ├─ YES → RungeKutta4 (dt=0.001-0.01) │ Use for: Standard simulations, balance speed/accuracy │ └─ NO → Need maximum speed? ├─ YES → ForwardEuler (dt=0.0001-0.001) │ Use for: Fast prototyping, real-time constraints │ └─ Discrete control? → ZeroOrderHold (dt=sampling period) Use for: Discrete-time, HIL, sampled-data</p>
<div class="highlight-#### notranslate"><div class="highlight"><pre><span></span>|------------|---------------|----------|--------|---------------|----------|
| ForwardEuler | 5.0x | ★☆☆☆☆ | 1x | 0.0001s | Fast prototyping |
| RungeKutta2 | 2.5x | ★★☆☆☆ | 1x | 0.001s | Educational |
| RungeKutta4 | 1.0x (baseline) | ★★★★☆ | 1x | 0.01s | **Standard choice** |
| DormandPrince45 | 0.2-0.5x | ★★★★★ | 2x | Adaptive | High-accuracy |
| ZeroOrderHold | 4.5x | ★☆☆☆☆ | 1x | Variable | Discrete control | **Benchmark:** 1000-step DIP simulation on Intel i7-9700K #### 5.5.3 Accuracy vs. Performance Trade-off ```
High Accuracy (atol &lt; 1e-6) ↑ │ DP45 (adaptive) │ ★ │ │ RK4 (dt=0.001) │ ★ │ │ RK4 (dt=0.01) │ ★ │ │ Euler (dt=0.0001) │ ★ │
Low Accuracy Euler (dt=0.01) └───────────────────────────────────────────★───────────▶ Slow Fast Performance
``` #### 5.5.4 Recommendation by Application | Application | Recommended Integrator | Configuration |

|-------------|----------------------|---------------|
| **Standard DIP simulation** | RungeKutta4 | `dt=0.01` |
| **PSO optimization** | RungeKutta4 | `dt=0.01` (speed matters) |
| **Scientific validation** | DormandPrince45 | `atol=1e-8, rtol=1e-6` |
| **Real-time HIL** | ForwardEuler or ZOH | `dt=0.001` (timing critical) |
| **Parameter studies** | RungeKutta4 | `dt=0.01` (batch execution) |
| **Educational demos** | RungeKutta2 or RK4 | `dt=0.01` |

---

## 6. Result Container API ### 6.1 `ResultContainer` Base Interface **File:** `src/simulation/core/interfaces.py:174` Abstract base class defining result storage protocol. ```python

# example-metadata:

# runnable: false class ResultContainer(ABC): &quot;&quot;&quot;Base interface for simulation result containers.&quot;&quot;&quot; @abstractmethod def add_trajectory(self, states: np.ndarray, times: np.ndarray, **metadata) -&gt; None: &quot;&quot;&quot;Add a simulation trajectory to results.&quot;&quot;&quot; @abstractmethod def get_states(self) -&gt; np.ndarray: &quot;&quot;&quot;Get state trajectories.&quot;&quot;&quot; @abstractmethod def get_times(self) -&gt; np.ndarray: &quot;&quot;&quot;Get time vectors.&quot;&quot;&quot; @abstractmethod def export(self, format_type: str, filepath: str) -&gt; None: &quot;&quot;&quot;Export results to specified format.&quot;&quot;&quot;

</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="standardresultcontainer-file-src-simulation-results-containers-py-15-container-for-single-simulation-results-6-2-1-attributes-python">
<h2>6.2 <code class="docutils literal notranslate"><span class="pre">StandardResultContainer</span></code> <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/simulation/results/containers.py:15</span></code> Container for single simulation results. #### 6.2.1 Attributes ```python<a class="headerlink" href="#standardresultcontainer-file-src-simulation-results-containers-py-15-container-for-single-simulation-results-6-2-1-attributes-python" title="Link to this heading">¶</a></h2>
<p>self.states: Optional[np.ndarray] # State trajectory (n_steps+1, state_dim)
self.times: Optional[np.ndarray] # Time vector (n_steps+1,)
self.controls: Optional[np.ndarray] # Control sequence (n_steps,)
self.metadata: Dict[str, Any] # Additional data</p>
<div class="highlight-#### notranslate"><div class="highlight"><pre><span></span>
```python
def add_trajectory(self, states: np.ndarray, times: np.ndarray, **metadata) -&gt; None: &quot;&quot;&quot;Add trajectory data to container.&quot;&quot;&quot;
``` Stores states, times, and optional controls/metadata. **get_states()**

```python
def get_states(self) -&gt; np.ndarray: &quot;&quot;&quot;Get state trajectories.&quot;&quot;&quot;
``` Returns: State array (n_steps+1, state_dim) or empty array if no data. **get_times()**

```python
def get_times(self) -&gt; np.ndarray: &quot;&quot;&quot;Get time vectors.&quot;&quot;&quot;
``` Returns: Time array (n_steps+1,) or empty array if no data. **export()**

```python
def export(self, format_type: str, filepath: str) -&gt; None: &quot;&quot;&quot;Export results to specified format.&quot;&quot;&quot;
``` Supported formats: `&#39;csv&#39;`, `&#39;hdf5&#39;` #### 6.2.3 Usage Example ```python

from src.simulation.results import StandardResultContainer # Create container
result = StandardResultContainer() # Add simulation data
result.add_trajectory( states=x_arr, times=t_arr, controls=u_arr, controller_type=&#39;classical_smc&#39;, initial_state=x0
) # Access data
states = result.get_states() # (n_steps+1, 6)
times = result.get_times() # (n_steps+1,) # Export
result.export(&#39;csv&#39;, &#39;results/simulation_001.csv&#39;)
result.export(&#39;hdf5&#39;, &#39;results/simulation_001.h5&#39;)
</pre></div>
</div>
<hr class="docutils" />
<section id="batchresultcontainer-file-src-simulation-results-containers-py-59-container-for-multiple-simulation-results-batch-execution-6-3-1-attributes-python">
<h3>6.3 <code class="docutils literal notranslate"><span class="pre">BatchResultContainer</span></code> <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/simulation/results/containers.py:59</span></code> Container for multiple simulation results (batch execution). #### 6.3.1 Attributes ```python<a class="headerlink" href="#batchresultcontainer-file-src-simulation-results-containers-py-59-container-for-multiple-simulation-results-batch-execution-6-3-1-attributes-python" title="Link to this heading">¶</a></h3>
<p>self.batch_data: Dict[int, Dict[str, Any]] # Indexed simulation data
self.metadata: Dict[str, Any] # Global metadata</p>
<div class="highlight-**Structure:** notranslate"><div class="highlight"><pre><span></span>
```python
# example-metadata:
# runnable: false { 0: { &#39;states&#39;: np.ndarray (n_steps+1, state_dim), &#39;times&#39;: np.ndarray (n_steps+1,), &#39;controls&#39;: np.ndarray (n_steps,), &#39;metadata&#39;: {...} }, 1: {...}, ...
}
``` #### 6.3.2 Methods **add_trajectory()**

```python
def add_trajectory(self, states: np.ndarray, times: np.ndarray, **metadata) -&gt; None: &quot;&quot;&quot;Add trajectory data to batch container.&quot;&quot;&quot;
``` Automatically assigns `batch_index` if not provided in metadata. **get_states()**

```python
def get_states(self, batch_index: Optional[int] = None) -&gt; np.ndarray: &quot;&quot;&quot;Get state trajectories for specific batch or all batches.&quot;&quot;&quot;
``` Returns:

- If `batch_index` specified: (n_steps+1, state_dim)
- If `batch_index=None`: (batch_size, n_steps+1, state_dim) **get_times()**
```python
def get_times(self, batch_index: Optional[int] = None) -&gt; np.ndarray: &quot;&quot;&quot;Get time vectors for specific batch or all batches.&quot;&quot;&quot;
``` Returns:

- If `batch_index` specified: (n_steps+1,)
- If `batch_index=None`: (n_steps+1,) (assumes all batches have same times) #### 6.3.3 Usage Example ```python
from src.simulation.results import BatchResultContainer # Create batch container
batch_result = BatchResultContainer() # Add multiple trajectories
for i in range(10): batch_result.add_trajectory( states=x_arr_list[i], times=t_arr, controls=u_arr_list[i], batch_index=i, initial_condition=ic_list[i] ) # Access specific trajectory
states_3 = batch_result.get_states(batch_index=3) # (n_steps+1, 6) # Access all trajectories
all_states = batch_result.get_states() # (10, n_steps+1, 6) # Compute aggregate statistics
settling_times = []
for i in range(10): states_i = batch_result.get_states(batch_index=i) settling_times.append(compute_settling_time(states_i)) mean_settling = np.mean(settling_times)
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="result-exporters-6-4-1-csv-exporter-file-src-simulation-results-exporters-py-exports-results-to-csv-format-human-readable-spreadsheet-compatible-format">
<h2>6.4 Result Exporters #### 6.4.1 CSV Exporter <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/simulation/results/exporters.py</span></code> Exports results to CSV format (human-readable, spreadsheet-compatible). <strong>Format:</strong><a class="headerlink" href="#result-exporters-6-4-1-csv-exporter-file-src-simulation-results-exporters-py-exports-results-to-csv-format-human-readable-spreadsheet-compatible-format" title="Link to this heading">¶</a></h2>
<div class="highlight-csv notranslate"><div class="highlight"><pre><span></span>
time,x,theta1,theta2,x_dot,theta1_dot,theta2_dot,control
0.00,0.000,0.100,0.100,0.000,0.000,0.000,
0.01,0.000,0.099,0.098,0.001,0.012,0.015,12.5
0.02,0.000,0.096,0.094,0.002,0.024,0.030,15.2
...
``` **Usage:**
```python

result.export(&#39;csv&#39;, &#39;results/sim_001.csv&#39;)
``` #### 6.4.2 HDF5 Exporter **File:** `src/simulation/results/exporters.py` Exports results to HDF5 format (binary, efficient, hierarchical). **Structure:**
</pre></div>
</div>
<p>simulation_001.h5
├── /states (dataset: n_steps+1 x 6)
├── /times (dataset: n_steps+1)
├── /controls (dataset: n_steps)
└── /metadata (attributes)</p>
<div class="highlight-**Usage:** notranslate"><div class="highlight"><pre><span></span>```python

result.export(&#39;hdf5&#39;, &#39;results/sim_001.h5&#39;) # Load with h5py
import h5py
with h5py.File(&#39;results/sim_001.h5&#39;, &#39;r&#39;) as f: states = f[&#39;states&#39;][:] times = f[&#39;times&#39;][:] metadata = dict(f.attrs)
``` **Advantages:**
- ✅ Fast read/write (10-100x faster than CSV for large datasets)
- ✅ Compression support (50-90% size reduction)
- ✅ Hierarchical structure (organize multiple simulations)
- ✅ Metadata storage (preserve all simulation parameters)

---

## 7. Safety &amp; Monitoring API ### 7.1 Safety Guards **File:** `src/simulation/safety/guards.py` #### 7.1.1 `apply_safety_guards()` ```python
def apply_safety_guards(state: np.ndarray, step_idx: int, config: Any) -&gt; None: &quot;&quot;&quot;Apply safety constraints to simulation state.&quot;&quot;&quot;
``` Performs three checks:

1. **NaN/Inf Detection** - `_guard_no_nan(state)`
2. **Energy Bounds** - `_guard_energy(state, config)`
3. **State Bounds** - `_guard_bounds(state, config)` **Raises:** `SafetyViolationError` if any guard fails **Example:**
```python
from src.simulation.safety import apply_safety_guards, SafetyViolationError try: apply_safety_guards(x_current, step_idx, config)
except SafetyViolationError as e: print(f&quot;Safety violation at step {step_idx}: {e}&quot;) # Truncate simulation
``` #### 7.1.2 Individual Guards **_guard_no_nan()**

```python
def _guard_no_nan(state: np.ndarray) -&gt; None: &quot;&quot;&quot;Check for NaN or Inf values.&quot;&quot;&quot; if not np.all(np.isfinite(state)): raise SafetyViolationError(&quot;State contains NaN or Inf&quot;)
``` **_guard_energy()**

```python
def _guard_energy(state: np.ndarray, config: Any) -&gt; None: &quot;&quot;&quot;Check total energy within bounds.&quot;&quot;&quot; E_kinetic = 0.5 * m * (x_dot**2 + theta1_dot**2 + theta2_dot**2) E_potential = m * g * (L1 * cos(theta1) + L2 * cos(theta2)) E_total = E_kinetic + E_potential if E_total &gt; config.safety.max_energy: raise SafetyViolationError(f&quot;Energy {E_total:.2f}J exceeds {config.safety.max_energy}J&quot;)
``` **_guard_bounds()**

```python
# example-metadata:
# runnable: false def _guard_bounds(state: np.ndarray, config: Any) -&gt; None: &quot;&quot;&quot;Check state within configured bounds.&quot;&quot;&quot; bounds = config.safety.state_bounds # [x_min, x_max, theta_min, theta_max, ...] for i, (val, (min_val, max_val)) in enumerate(zip(state, bounds)): if not (min_val &lt;= val &lt;= max_val): raise SafetyViolationError( f&quot;State[{i}] = {val:.3f} outside bounds [{min_val}, {max_val}]&quot; )
``` #### 7.1.3 Configuration ```yaml
# config.yaml

safety: max_energy: 100.0 # Joules state_bounds: x: [-2.0, 2.0] # Cart position (m) theta1: [-1.57, 1.57] # Pole 1 angle (rad, ±π/2) theta2: [-1.57, 1.57] # Pole 2 angle (rad, ±π/2) x_dot: [-10.0, 10.0] # Cart velocity (m/s) theta1_dot: [-20.0, 20.0] # Pole 1 angular velocity (rad/s) theta2_dot: [-20.0, 20.0] # Pole 2 angular velocity (rad/s)
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="performance-monitoring-file-src-simulation-safety-monitors-py-7-2-1-performancemonitor-tracks-execution-time-and-throughput-for-orchestrators-and-integrators-methods">
<h2>7.2 Performance Monitoring <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/simulation/safety/monitors.py</span></code> #### 7.2.1 <code class="docutils literal notranslate"><span class="pre">PerformanceMonitor</span></code> Tracks execution time and throughput for orchestrators and integrators. <strong>Methods:</strong><a class="headerlink" href="#performance-monitoring-file-src-simulation-safety-monitors-py-7-2-1-performancemonitor-tracks-execution-time-and-throughput-for-orchestrators-and-integrators-methods" title="Link to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># example-metadata:</span>

<span class="c1"># runnable: false monitor = PerformanceMonitor() monitor.start_timing(&#39;simulation&#39;)</span>

<span class="c1"># ... run simulation ...</span>

<span class="n">elapsed</span> <span class="o">=</span> <span class="n">monitor</span><span class="o">.</span><span class="n">end_timing</span><span class="p">(</span><span class="s1">&#39;simulation&#39;</span><span class="p">)</span> <span class="n">stats</span> <span class="o">=</span> <span class="n">monitor</span><span class="o">.</span><span class="n">get_statistics</span><span class="p">()</span>
<span class="c1"># Returns:</span>

<span class="c1"># {</span>

<span class="c1"># &#39;simulation&#39;: {</span>

<span class="c1"># &#39;count&#39;: 100,</span>

<span class="c1"># &#39;total_time&#39;: 12.5,</span>

<span class="c1"># &#39;mean_time&#39;: 0.125,</span>

<span class="c1"># &#39;std_time&#39;: 0.015,</span>

<span class="c1"># &#39;min_time&#39;: 0.110,</span>

<span class="c1"># &#39;max_time&#39;: 0.180</span>

<span class="c1"># }</span>

<span class="c1"># }</span>

<span class="err">```</span> <span class="o">**</span><span class="n">Usage</span> <span class="ow">in</span> <span class="n">Orchestrator</span><span class="p">:</span><span class="o">**</span>
<span class="err">```</span><span class="n">python</span>
<span class="c1"># example-metadata:</span>

<span class="c1"># runnable: false class SequentialOrchestrator(BaseOrchestrator): def execute(self, ...): self.monitor.start_timing(&#39;orchestrator_execute&#39;) # ... simulation loop ... elapsed = self.monitor.end_timing(&#39;orchestrator_execute&#39;) return result</span>

</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="complete-code-examples-8-1-example-1-basic-simulation-objective-run-a-single-simulation-with-classical-smc-controller-and-plot-results-python">
<h2>8. Complete Code Examples ### 8.1 Example 1: Basic Simulation <strong>Objective:</strong> Run a single simulation with classical SMC controller and plot results. ```python<a class="headerlink" href="#complete-code-examples-8-1-example-1-basic-simulation-objective-run-a-single-simulation-with-classical-smc-controller-and-plot-results-python" title="Link to this heading">¶</a></h2>
<p>“””
Example 1: Basic DIP Simulation
Demonstrates standard workflow: load config → create controller → create dynamics → simulate → plot
“”” import numpy as np
import matplotlib.pyplot as plt
from src.config import load_config
from src.controllers import create_controller
from src.plant.models import LowRankDIPDynamics
from src.simulation import run_simulation # ============================================================================</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="step-1-load-configuration">
<h1>STEP 1: Load Configuration<a class="headerlink" href="#step-1-load-configuration" title="Link to this heading">¶</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id4">
<h1>============================================================================<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h1>
<p>config = load_config(‘config.yaml’) # ============================================================================</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="step-2-create-controller">
<h1>STEP 2: Create Controller<a class="headerlink" href="#step-2-create-controller" title="Link to this heading">¶</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id5">
<h1>============================================================================<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h1>
<p>controller = create_controller( ‘classical_smc’, config=config, gains=[10.0, 8.0, 15.0, 12.0, 50.0, 5.0] # [k1, k2, λ1, λ2, K, kd]
) # ============================================================================</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="step-3-create-dynamics-model">
<h1>STEP 3: Create Dynamics Model<a class="headerlink" href="#step-3-create-dynamics-model" title="Link to this heading">¶</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id6">
<h1>============================================================================<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h1>
<p>dynamics = LowRankDIPDynamics( config=config.plant, enable_monitoring=True, enable_validation=True
) # ============================================================================</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="step-4-run-simulation">
<h1>STEP 4: Run Simulation<a class="headerlink" href="#step-4-run-simulation" title="Link to this heading">¶</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id7">
<h1>============================================================================<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h1>
<p>initial_state = np.array([ 0.0, # x: cart position 0.1, # theta1: pole 1 angle (small perturbation) 0.1, # theta2: pole 2 angle (small perturbation) 0.0, # x_dot: cart velocity 0.0, # theta1_dot: pole 1 angular velocity 0.0 # theta2_dot: pole 2 angular velocity
]) t, x, u = run_simulation( controller=controller, dynamics_model=dynamics, sim_time=5.0, # 5 seconds dt=0.01, # 10ms timestep initial_state=initial_state, u_max=100.0, # 100N force limit seed=42 # Reproducibility
) # ============================================================================</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="step-5-analyze-results">
<h1>STEP 5: Analyze Results<a class="headerlink" href="#step-5-analyze-results" title="Link to this heading">¶</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id8">
<h1>============================================================================<a class="headerlink" href="#id8" title="Link to this heading">¶</a></h1>
<p>print(“=” * 70)
print(“SIMULATION RESULTS”)
print(“=” * 70)
print(f”Simulation steps: {len(t)-1}”)
print(f”Final time: {t[-1]:.2f}s”)
print(f”Final state: {x[-1]}”)
print(f”Max control: {np.max(np.abs(u)):.2f}N”)
print(f”Mean |control|: {np.mean(np.abs(u)):.2f}N”) # Compute performance metrics
settling_time_idx = np.where(np.all(np.abs(x[:, :3]) &lt; 0.02, axis=1))[0]
if len(settling_time_idx) &gt; 0: settling_time = t[settling_time_idx[0]] print(f”Settling time (2% threshold): {settling_time:.3f}s”) # ============================================================================</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="step-6-plot-results">
<h1>STEP 6: Plot Results<a class="headerlink" href="#step-6-plot-results" title="Link to this heading">¶</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id9">
<h1>============================================================================<a class="headerlink" href="#id9" title="Link to this heading">¶</a></h1>
<p>fig, axes = plt.subplots(4, 1, figsize=(10, 10)) # Cart position
axes[0].plot(t, x[:, 0], ‘b-’, linewidth=2)
axes[0].set_ylabel(‘Cart Position (m)’, fontsize=12)
axes[0].grid(True, alpha=0.3)
axes[0].axhline(0, color=’r’, linestyle=’–’, alpha=0.5) # Pole angles
axes[1].plot(t, x[:, 1] * 180/np.pi, ‘r-’, linewidth=2, label=’Pole 1’)
axes[1].plot(t, x[:, 2] * 180/np.pi, ‘g-’, linewidth=2, label=’Pole 2’)
axes[1].set_ylabel(‘Angles (deg)’, fontsize=12)
axes[1].grid(True, alpha=0.3)
axes[1].legend(loc=’upper right’)
axes[1].axhline(0, color=’k’, linestyle=’–’, alpha=0.5) # Velocities
axes[2].plot(t, x[:, 3], ‘b-’, linewidth=2, label=’Cart’)
axes[2].plot(t, x[:, 4], ‘r-’, linewidth=2, label=’Pole 1’)
axes[2].plot(t, x[:, 5], ‘g-’, linewidth=2, label=’Pole 2’)
axes[2].set_ylabel(‘Velocities’, fontsize=12)
axes[2].grid(True, alpha=0.3)
axes[2].legend(loc=’upper right’) # Control input
axes[3].plot(t[:-1], u, ‘m-’, linewidth=2)
axes[3].set_xlabel(‘Time (s)’, fontsize=12)
axes[3].set_ylabel(‘Control Force (N)’, fontsize=12)
axes[3].grid(True, alpha=0.3)
axes[3].axhline(100, color=’r’, linestyle=’–’, alpha=0.5, label=’Limit’)
axes[3].axhline(-100, color=’r’, linestyle=’–’, alpha=0.5)
axes[3].legend(loc=’upper right’) plt.tight_layout()
plt.savefig(‘results/basic_simulation.png’, dpi=150)
plt.show() print(“\nPlot saved to: results/basic_simulation.png”)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="o">---</span>

<span class="c1">## 8.2 Example 2: Batch Simulation for PSO **Objective:** Use batch orchestrator for PSO fitness evaluation with vectorized execution. ```python</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Example 2: Batch Simulation for PSO Optimization</span>
<span class="sd">Demonstrates vectorized batch execution for parameter optimization</span>
<span class="sd">&quot;&quot;&quot;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_config</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.controllers</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_controller</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.plant.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">LowRankDIPDynamics</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.simulation.orchestrators</span><span class="w"> </span><span class="kn">import</span> <span class="n">BatchOrchestrator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.simulation.integrators</span><span class="w"> </span><span class="kn">import</span> <span class="n">IntegratorFactory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.optimization</span><span class="w"> </span><span class="kn">import</span> <span class="n">PSOTuner</span> <span class="c1"># ============================================================================</span>
<span class="c1"># STEP 1: Configuration and Setup</span>

<span class="c1"># ============================================================================</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">load_config</span><span class="p">(</span><span class="s1">&#39;config.yaml&#39;</span><span class="p">)</span>
<span class="n">dynamics</span> <span class="o">=</span> <span class="n">LowRankDIPDynamics</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">plant</span><span class="p">)</span>
<span class="n">integrator</span> <span class="o">=</span> <span class="n">IntegratorFactory</span><span class="o">.</span><span class="n">create_integrator</span><span class="p">(</span><span class="s1">&#39;rk4&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span> <span class="c1"># ============================================================================</span>
<span class="c1"># STEP 2: Define Controller Factory for PSO</span>

<span class="c1"># ============================================================================</span>

<span class="k">def</span><span class="w"> </span><span class="nf">controller_factory</span><span class="p">(</span><span class="n">gains</span><span class="p">):</span> <span class="s2">&quot;&quot;&quot;Create controller instance with candidate gains.&quot;&quot;&quot;</span> <span class="k">return</span> <span class="n">create_controller</span><span class="p">(</span> <span class="s1">&#39;classical_smc&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">gains</span><span class="o">=</span><span class="n">gains</span> <span class="c1"># [k1, k2, λ1, λ2, K, kd] ) # ============================================================================</span>
<span class="c1"># STEP 3: Define Fitness Function with Batch Execution</span>

<span class="c1"># ============================================================================</span>

<span class="k">def</span><span class="w"> </span><span class="nf">fitness_function</span><span class="p">(</span><span class="n">gains</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span> <span class="s2">&quot;&quot;&quot; Evaluate controller gains using batch simulation. Args: gains: Controller gains to evaluate n_trials: Number of Monte Carlo trials (different ICs) Returns: Fitness value (lower is better) &quot;&quot;&quot;</span> <span class="c1"># Create controller controller = controller_factory(gains) # Generate batch of initial conditions (small perturbations) np.random.seed(42) # Reproducibility batch_initial = np.zeros((n_trials, 6)) batch_initial[:, 1] = np.random.uniform(0.05, 0.15, n_trials) # theta1 batch_initial[:, 2] = np.random.uniform(0.05, 0.15, n_trials) # theta2 # Precompute control sequence for all trials horizon = 500 dt = 0.01 controls = np.zeros((n_trials, horizon)) # Temporary: compute control for each initial condition # (In practice, use controller in orchestrator loop) for i in range(n_trials): x_temp = batch_initial[i] for j in range(horizon): controls[i, j] = controller(j * dt, x_temp) # Simple Euler prediction for next control (approximation) x_temp = x_temp + dt * np.array([ x_temp[3], x_temp[4], x_temp[5], 0, 0, 0 ]) # Execute batch simulation orchestrator = BatchOrchestrator(dynamics, integrator) result = orchestrator.execute( initial_state=batch_initial, control_inputs=controls, dt=dt, horizon=horizon, safety_guards=True ) # Compute fitness metrics all_states = result.get_states() # (n_trials, horizon+1, 6) fitness_values = [] for i in range(n_trials): states_i = all_states[i] # (horizon+1, 6) # Metric 1: Settling time (2% threshold) settled_mask = np.all(np.abs(states_i[:, :3]) &lt; 0.02, axis=1) if np.any(settled_mask): settling_idx = np.where(settled_mask)[0][0] settling_time = settling_idx * dt else: settling_time = 5.0 # Penalty if never settled # Metric 2: Peak overshoot peak_overshoot = np.max(np.abs(states_i[:, :3])) # Metric 3: Integral squared error ise = np.sum(np.sum(states_i[:, :3]**2, axis=1)) * dt # Combined fitness (weighted sum) fitness_i = ( 2.0 * settling_time + # Weight settling time heavily 5.0 * peak_overshoot + # Penalize overshoot 0.1 * ise # Penalize tracking error ) fitness_values.append(fitness_i) # Return mean fitness over all trials return np.mean(fitness_values) # ============================================================================</span>
<span class="c1"># STEP 4: Configure and Run PSO Optimization</span>

<span class="c1"># ============================================================================</span>

<span class="c1"># Define gain bounds for classical SMC</span>

<span class="c1"># [k1, k2, λ1, λ2, K, kd]</span>

<span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">),</span> <span class="c1"># k1: position gain (1.0, 40.0), # k2: position damping (1.0, 50.0), # λ1: angle gain 1 (1.0, 40.0), # λ2: angle gain 2 (10.0, 100.0), # K: switching gain (0.1, 10.0) # kd: derivative gain</span>
<span class="p">]</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PSO OPTIMIZATION WITH BATCH SIMULATION&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span> <span class="c1"># Create PSO tuner</span>
<span class="n">tuner</span> <span class="o">=</span> <span class="n">PSOTuner</span><span class="p">(</span> <span class="n">fitness_fn</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">fitness_function</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">swarm_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span> <span class="c1"># Run optimization</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">tuner</span><span class="o">.</span><span class="n">optimise</span><span class="p">()</span> <span class="c1"># ============================================================================</span>
<span class="c1"># STEP 5: Display Results</span>

<span class="c1"># ============================================================================</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OPTIMIZATION RESULTS&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best fitness: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;best_fitness&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best gains: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;best_gains&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Convergence iteration: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;convergence_iter&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># ============================================================================</span>
<span class="c1"># STEP 6: Validate Optimal Gains</span>

<span class="c1"># ============================================================================</span>

<span class="n">optimal_controller</span> <span class="o">=</span> <span class="n">controller_factory</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;best_gains&#39;</span><span class="p">])</span> <span class="kn">from</span><span class="w"> </span><span class="nn">src.simulation</span><span class="w"> </span><span class="kn">import</span> <span class="n">run_simulation</span> <span class="n">t_val</span><span class="p">,</span> <span class="n">x_val</span><span class="p">,</span> <span class="n">u_val</span> <span class="o">=</span> <span class="n">run_simulation</span><span class="p">(</span> <span class="n">controller</span><span class="o">=</span><span class="n">optimal_controller</span><span class="p">,</span> <span class="n">dynamics_model</span><span class="o">=</span><span class="n">dynamics</span><span class="p">,</span> <span class="n">sim_time</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">initial_state</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">u_max</span><span class="o">=</span><span class="mf">100.0</span>
<span class="p">)</span> <span class="c1"># Plot validation</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">x_val</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Pole 1&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_val</span><span class="p">,</span> <span class="n">x_val</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Pole 2&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Angles (deg)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Optimal Controller Performance&#39;</span><span class="p">)</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_val</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">u_val</span><span class="p">,</span> <span class="s1">&#39;m-&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Control (N)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span> <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;results/pso_batch_simulation.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Validation plot saved to: results/pso_batch_simulation.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
<hr class="docutils" />
<p>(Continuing with Examples 3-5, Sections 9-10, and completion report…)</p>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Research Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on Oct 10, 2025</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Simulation Engine API Reference <strong>Project:</strong> Double-Inverted Pendulum SMC Control System</a><ul>
<li><a class="reference internal" href="#table-of-contents-1-overview-architecture">Table of Contents 1. <span class="xref myst">Overview &amp; Architecture</span></a></li>
<li><a class="reference internal" href="#overview-architecture-1-1-introduction-the-simulation-engine-is-the-core-execution-framework-for-the-double-inverted-pendulum-control-system-it-provides-flexible-simulation-execution-strategies-sequential-batch-parallel-real-time">1. Overview &amp; Architecture ### 1.1 Introduction The <strong>Simulation Engine</strong> is the core execution framework for the Double-Inverted Pendulum control system. It provides: - <strong>Flexible simulation execution</strong> strategies (sequential, batch, parallel, real-time)</a></li>
<li><a class="reference internal" href="#simulationrunner-class-file-src-simulation-engines-simulation-runner-py-333-object-oriented-wrapper-around-run-simulation-providing-state-tracking-and-compatibility-with-test-cases-2-2-1-class-definition-python">2.2 <code class="docutils literal notranslate"><span class="pre">SimulationRunner</span></code> Class <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/simulation/engines/simulation_runner.py:333</span></code> Object-oriented wrapper around <code class="docutils literal notranslate"><span class="pre">run_simulation()</span></code> providing state tracking and compatibility with test cases. #### 2.2.1 Class Definition ```python</a><ul>
<li><a class="reference internal" href="#legacy-compatibility-functions-2-3-1-step-function-file-src-simulation-engines-simulation-runner-py-87-python">2.3 Legacy Compatibility Functions #### 2.3.1 <code class="docutils literal notranslate"><span class="pre">step()</span></code> Function <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/simulation/engines/simulation_runner.py:87</span></code> ```python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dynamics-model-api-3-1-dynamicsmodel-protocol-file-src-plant-models-base-dynamics-interface-py-65-protocol-defining-the-interface-all-dynamics-models-must-implement-3-1-1-protocol-definition-python">3. Dynamics Model API ### 3.1 <code class="docutils literal notranslate"><span class="pre">DynamicsModel</span></code> Protocol <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/plant/models/base/dynamics_interface.py:65</span></code> Protocol defining the interface all dynamics models must implement. #### 3.1.1 Protocol Definition ```python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#example-metadata">example-metadata:</a></li>
<li><a class="reference internal" href="#runnable-false-class-dynamicsmodel-protocol-protocol-for-plant-dynamics-models-def-compute-dynamics-self-state-np-ndarray-control-input-np-ndarray-time-float-0-0-kwargs-any-dynamicsresult-compute-system-dynamics-at-given-state-and-input-def-get-physics-matrices-self-state-np-ndarray-tuple-np-ndarray-np-ndarray-np-ndarray-get-physics-matrices-m-c-g-at-current-state-def-validate-state-self-state-np-ndarray-bool-validate-state-vector-format-and-bounds-def-get-state-dimension-self-int-get-dimension-of-state-vector-def-get-control-dimension-self-int-get-dimension-of-control-input-vector">runnable: false class DynamicsModel(Protocol): “””Protocol for plant dynamics models.””” def compute_dynamics( self, state: np.ndarray, control_input: np.ndarray, time: float = 0.0, **kwargs: Any ) -&gt; DynamicsResult: “””Compute system dynamics at given state and input.””” … def get_physics_matrices( self, state: np.ndarray ) -&gt; Tuple[np.ndarray, np.ndarray, np.ndarray]: “””Get physics matrices M, C, G at current state.””” … def validate_state(self, state: np.ndarray) -&gt; bool: “””Validate state vector format and bounds.””” … def get_state_dimension(self) -&gt; int: “””Get dimension of state vector.””” … def get_control_dimension(self) -&gt; int: “””Get dimension of control input vector.””” …</a><ul>
<li><a class="reference internal" href="#basedynamicsmodel-abstract-class-file-src-plant-models-base-dynamics-interface-py-130-abstract-base-class-providing-common-functionality-for-concrete-dynamics-implementations-3-2-1-class-definition-python">3.2 <code class="docutils literal notranslate"><span class="pre">BaseDynamicsModel</span></code> Abstract Class <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/plant/models/base/dynamics_interface.py:130</span></code> Abstract base class providing common functionality for concrete dynamics implementations. #### 3.2.1 Class Definition ```python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id1">example-metadata:</a></li>
<li><a class="reference internal" href="#runnable-false-abstractmethod">runnable: false &#64;abstractmethod</a><ul>
<li><a class="reference internal" href="#lowrankdipdynamics-implementation-file-src-plant-models-lowrank-dynamics-py-27-simplified-double-inverted-pendulum-dynamics-optimized-for-computational-efficiency-3-3-1-class-definition-python">3.3 <code class="docutils literal notranslate"><span class="pre">LowRankDIPDynamics</span></code> Implementation <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/plant/models/lowrank/dynamics.py:27</span></code> Simplified double-inverted pendulum dynamics optimized for computational efficiency. #### 3.3.1 Class Definition ```python</a></li>
<li><a class="reference internal" href="#orchestrator-system-api-4-1-orchestrator-base-interface-file-src-simulation-core-interfaces-py-85-base-interface-defining-execution-strategy-protocol-python">4. Orchestrator System API ### 4.1 <code class="docutils literal notranslate"><span class="pre">Orchestrator</span></code> Base Interface <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/simulation/core/interfaces.py:85</span></code> Base interface defining execution strategy protocol. ```python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id2">example-metadata:</a></li>
<li><a class="reference internal" href="#runnable-false-class-orchestrator-abc-base-interface-for-simulation-execution-strategies-abstractmethod-def-execute-self-initial-state-np-ndarray-control-inputs-np-ndarray-dt-float-horizon-int-kwargs-resultcontainer-execute-simulation-with-specified-strategy-pass">runnable: false class Orchestrator(ABC): “””Base interface for simulation execution strategies.””” &#64;abstractmethod def execute( self, initial_state: np.ndarray, control_inputs: np.ndarray, dt: float, horizon: int, **kwargs ) -&gt; ResultContainer: “””Execute simulation with specified strategy.””” pass</a><ul>
<li><a class="reference internal" href="#batchorchestrator-file-src-simulation-orchestrators-batch-py-18-vectorized-execution-for-multiple-simultaneous-simulations-pso-optimization-monte-carlo-4-3-1-class-definition-python">4.3 <code class="docutils literal notranslate"><span class="pre">BatchOrchestrator</span></code> <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/simulation/orchestrators/batch.py:18</span></code> Vectorized execution for multiple simultaneous simulations (PSO optimization, Monte Carlo). #### 4.3.1 Class Definition ```python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id3">example-metadata:</a></li>
<li><a class="reference internal" href="#runnable-false-class-batchorchestrator-baseorchestrator-batch-simulation-orchestrator-for-vectorized-execution-def-execute-self-initial-state-np-ndarray-control-inputs-np-ndarray-dt-float-horizon-int-kwargs-resultcontainer-execute-batch-simulation">runnable: false class BatchOrchestrator(BaseOrchestrator): “””Batch simulation orchestrator for vectorized execution.””” def execute( self, initial_state: np.ndarray, control_inputs: np.ndarray, dt: float, horizon: int, **kwargs ) -&gt; ResultContainer: “””Execute batch simulation.”””</a><ul>
<li><a class="reference internal" href="#parallelorchestrator-file-src-simulation-orchestrators-parallel-py-multi-threaded-execution-for-large-scale-parameter-studies-4-4-1-features-thread-pool-management-configurable-pool-size">4.4 <code class="docutils literal notranslate"><span class="pre">ParallelOrchestrator</span></code> <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/simulation/orchestrators/parallel.py</span></code> Multi-threaded execution for large-scale parameter studies. #### 4.4.1 Features - ✅ <strong>Thread pool management</strong> (configurable pool size)</a></li>
<li><a class="reference internal" href="#integrator-system-api-5-1-integratorfactory-file-src-simulation-integrators-factory-py-22-factory-pattern-for-creating-numerical-integrator-instances-with-validation-and-consistency-checking-5-1-1-integrator-registry-the-factory-maintains-a-registry-of-7-integrator-types-type-class-order-adaptive-description">5. Integrator System API ### 5.1 <code class="docutils literal notranslate"><span class="pre">IntegratorFactory</span></code> <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/simulation/integrators/factory.py:22</span></code> Factory pattern for creating numerical integrator instances with validation and consistency checking. #### 5.1.1 Integrator Registry The factory maintains a registry of 7 integrator types: | Type | Class | Order | Adaptive | Description |</a></li>
<li><a class="reference internal" href="#fixed-step-integrators-5-2-1-forwardeuler-file-src-simulation-integrators-fixed-step-euler-py-first-order-explicit-euler-method-x-n-1-x-n-dt-f-x-n-u-n-t-n-properties">5.2 Fixed-Step Integrators #### 5.2.1 <code class="docutils literal notranslate"><span class="pre">ForwardEuler</span></code> <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/simulation/integrators/fixed_step/euler.py</span></code> First-order explicit Euler method: <code class="docutils literal notranslate"><span class="pre">x_{n+1}</span> <span class="pre">=</span> <span class="pre">x_n</span> <span class="pre">+</span> <span class="pre">dt</span> <span class="pre">*</span> <span class="pre">f(x_n,</span> <span class="pre">u_n,</span> <span class="pre">t_n)</span></code> <strong>Properties:</strong></a><ul>
<li><a class="reference internal" href="#adaptive-integrators-5-3-1-dormandprince45-file-src-simulation-integrators-adaptive-runge-kutta-py-dormand-prince-4th-5th-order-adaptive-runge-kutta-method-dp45-recommended-for-high-accuracy-requirements-properties">5.3 Adaptive Integrators #### 5.3.1 <code class="docutils literal notranslate"><span class="pre">DormandPrince45</span></code> <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/simulation/integrators/adaptive/runge_kutta.py</span></code> Dormand-Prince 4th/5th order adaptive Runge-Kutta method (DP45) - <strong>Recommended for high-accuracy requirements</strong>. <strong>Properties:</strong></a></li>
<li><a class="reference internal" href="#integrator-selection-guide-5-5-1-decision-tree">5.5 Integrator Selection Guide #### 5.5.1 Decision Tree ```</a></li>
</ul>
</li>
<li><a class="reference internal" href="#standardresultcontainer-file-src-simulation-results-containers-py-15-container-for-single-simulation-results-6-2-1-attributes-python">6.2 <code class="docutils literal notranslate"><span class="pre">StandardResultContainer</span></code> <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/simulation/results/containers.py:15</span></code> Container for single simulation results. #### 6.2.1 Attributes ```python</a><ul>
<li><a class="reference internal" href="#batchresultcontainer-file-src-simulation-results-containers-py-59-container-for-multiple-simulation-results-batch-execution-6-3-1-attributes-python">6.3 <code class="docutils literal notranslate"><span class="pre">BatchResultContainer</span></code> <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/simulation/results/containers.py:59</span></code> Container for multiple simulation results (batch execution). #### 6.3.1 Attributes ```python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#result-exporters-6-4-1-csv-exporter-file-src-simulation-results-exporters-py-exports-results-to-csv-format-human-readable-spreadsheet-compatible-format">6.4 Result Exporters #### 6.4.1 CSV Exporter <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/simulation/results/exporters.py</span></code> Exports results to CSV format (human-readable, spreadsheet-compatible). <strong>Format:</strong></a></li>
<li><a class="reference internal" href="#performance-monitoring-file-src-simulation-safety-monitors-py-7-2-1-performancemonitor-tracks-execution-time-and-throughput-for-orchestrators-and-integrators-methods">7.2 Performance Monitoring <strong>File:</strong> <code class="docutils literal notranslate"><span class="pre">src/simulation/safety/monitors.py</span></code> #### 7.2.1 <code class="docutils literal notranslate"><span class="pre">PerformanceMonitor</span></code> Tracks execution time and throughput for orchestrators and integrators. <strong>Methods:</strong></a></li>
<li><a class="reference internal" href="#complete-code-examples-8-1-example-1-basic-simulation-objective-run-a-single-simulation-with-classical-smc-controller-and-plot-results-python">8. Complete Code Examples ### 8.1 Example 1: Basic Simulation <strong>Objective:</strong> Run a single simulation with classical SMC controller and plot results. ```python</a></li>
</ul>
</li>
<li><a class="reference internal" href="#step-1-load-configuration">STEP 1: Load Configuration</a></li>
<li><a class="reference internal" href="#id4">============================================================================</a></li>
<li><a class="reference internal" href="#step-2-create-controller">STEP 2: Create Controller</a></li>
<li><a class="reference internal" href="#id5">============================================================================</a></li>
<li><a class="reference internal" href="#step-3-create-dynamics-model">STEP 3: Create Dynamics Model</a></li>
<li><a class="reference internal" href="#id6">============================================================================</a></li>
<li><a class="reference internal" href="#step-4-run-simulation">STEP 4: Run Simulation</a></li>
<li><a class="reference internal" href="#id7">============================================================================</a></li>
<li><a class="reference internal" href="#step-5-analyze-results">STEP 5: Analyze Results</a></li>
<li><a class="reference internal" href="#id8">============================================================================</a></li>
<li><a class="reference internal" href="#step-6-plot-results">STEP 6: Plot Results</a></li>
<li><a class="reference internal" href="#id9">============================================================================</a></li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=4ebf8126"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=46bd48cc"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=08e7b316"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../_static/back-to-top.js?v=840797bb"></script>
    <script src="../_static/lazy-load.js?v=dc25293c"></script>
    <script src="../_static/dark-mode.js?v=bf328970"></script>
    </body>
</html>