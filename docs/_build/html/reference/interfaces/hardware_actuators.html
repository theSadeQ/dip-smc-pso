<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
.chartjs-container {
    margin: 1.5em auto;
    padding: 1em;
    background: #f8f9fa;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.chart-note {
    text-align: center;
    color: #6c757d;
    font-size: 0.9em;
    margin-top: 0.5em;
}
</style>
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <!-- Generated with Sphinx 7.4.7 and Furo 2024.08.06 -->
        <title>interfaces.hardware.actuators - DIP_SMC_PSO Documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=5349f25f" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=f5a89ef9" />
    
    


<style>
  body {
    --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">DIP_SMC_PSO Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">DIP_SMC_PSO Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">📚 Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../README.html">Optimal Sliding Mode Control for a Double-Inverted Pendulum via PSO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../theory_overview.html">1. Theoretical Background â€” Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture.html">3. System Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plant_model.html">1.x Plant Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hil_quickstart.html">Hardware-in-the-Loop (HIL) Quickstart Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../streamlit_dashboard_guide.html">Streamlit Dashboard User Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">🎮 Control Systems &amp; Optimization</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../controllers/index.html">Controllers Module Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Controllers Module Documentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../controllers/classical_smc_technical_guide.html">Classical Sliding Mode Control Technical Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../controllers/adaptive_smc_technical_guide.html">Adaptive Sliding Mode Control Technical Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../controllers/sta_smc_technical_guide.html">Super-Twisting Sliding Mode Control Technical Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../controllers/hybrid_smc_technical_guide.html">Hybrid Adaptive Super-Twisting SMC Technical Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../controllers/mpc_technical_guide.html">Model Predictive Control Technical Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../controllers/swing_up_smc_technical_guide.html">Swing-Up SMC Technical Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../controllers/swing_up_smc_technical_guide.html#example-metadata">example-metadata:</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../controllers/swing_up_smc_technical_guide.html#runnable-false">runnable: false</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../controllers/factory_system_guide.html">SMC Controller Factory System Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../controllers/control_primitives_reference.html">Control Primitives Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mathematical_foundations/smc_complete_theory.html">Complete Sliding Mode Control Mathematical Theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mathematical_foundations/controller_comparison_theory.html">SMC Controller Comparison Theory</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../controllers/index.html">Controllers Module</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Controllers Module</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../controllers/adaptive_smc.html">controllers.adaptive_smc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/classic_smc.html">controllers.classic_smc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/factory.html">controllers.factory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/mpc_controller.html">controllers.mpc_controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/sta_smc.html">controllers.sta_smc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/swing_up_smc.html">controllers.swing_up_smc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/__init__.html">controllers.<strong>init</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/base_controller_interface.html">controllers.base.controller_interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/base_control_primitives.html">controllers.base.control_primitives</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/base___init__.html">controllers.base.<strong>init</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/factory_deprecation.html">controllers.factory.deprecation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/factory_fallback_configs.html">controllers.factory.fallback_configs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/factory_legacy_factory.html">controllers.factory.legacy_factory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/factory_optimization.html">controllers.factory.optimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/factory_pso_integration.html">controllers.factory.pso_integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/factory_smc_factory.html">controllers.factory.smc_factory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/factory_thread_safety.html">controllers.factory.thread_safety</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/factory___init__.html">controllers.factory.<strong>init</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/mpc_mpc_controller.html">controllers.mpc.mpc_controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/mpc___init__.html">controllers.mpc.<strong>init</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc_adaptive_smc.html">controllers.smc.adaptive_smc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc_classic_smc.html">controllers.smc.classic_smc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc_hybrid_adaptive_sta_smc.html">controllers.smc.hybrid_adaptive_sta_smc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc_sta_smc.html">controllers.smc.sta_smc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc___init__.html">controllers.smc.<strong>init</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/specialized_swing_up_smc.html">controllers.specialized.swing_up_smc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/specialized___init__.html">controllers.specialized.<strong>init</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/factory_core_protocols.html">controllers.factory.core.protocols</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/factory_core_registry.html">controllers.factory.core.registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/factory_core_threading.html">controllers.factory.core.threading</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/factory_core_validation.html">controllers.factory.core.validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/factory_core___init__.html">controllers.factory.core.<strong>init</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc_algorithms___init__.html">controllers.smc.algorithms.<strong>init</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc_core_equivalent_control.html">controllers.smc.core.equivalent_control</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc_core_gain_validation.html">controllers.smc.core.gain_validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc_core_sliding_surface.html">controllers.smc.core.sliding_surface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc_core_switching_functions.html">controllers.smc.core.switching_functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc_core___init__.html">controllers.smc.core.<strong>init</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc_algorithms_adaptive_adaptation_law.html">controllers.smc.algorithms.adaptive.adaptation_law</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc_algorithms_adaptive_config.html">controllers.smc.algorithms.adaptive.config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc_algorithms_adaptive_controller.html">controllers.smc.algorithms.adaptive.controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc_algorithms_adaptive_parameter_estimation.html">controllers.smc.algorithms.adaptive.parameter_estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc_algorithms_adaptive___init__.html">controllers.smc.algorithms.adaptive.<strong>init</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc_algorithms_classical_boundary_layer.html">controllers.smc.algorithms.classical.boundary_layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc_algorithms_classical_config.html">controllers.smc.algorithms.classical.config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc_algorithms_classical_controller.html">controllers.smc.algorithms.classical.controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc_algorithms_classical___init__.html">controllers.smc.algorithms.classical.<strong>init</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc_algorithms_hybrid_config.html">controllers.smc.algorithms.hybrid.config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc_algorithms_hybrid_controller.html">controllers.smc.algorithms.hybrid.controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc_algorithms_hybrid_switching_logic.html">controllers.smc.algorithms.hybrid.switching_logic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc_algorithms_hybrid___init__.html">controllers.smc.algorithms.hybrid.<strong>init</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc_algorithms_super_twisting_config.html">controllers.smc.algorithms.super_twisting.config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc_algorithms_super_twisting_controller.html">controllers.smc.algorithms.super_twisting.controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc_algorithms_super_twisting_twisting_algorithm.html">controllers.smc.algorithms.super_twisting.twisting_algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../controllers/smc_algorithms_super_twisting___init__.html">controllers.smc.algorithms.super_twisting.<strong>init</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../mathematical_foundations/index.html">Mathematical Foundations</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Mathematical Foundations</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../mathematical_foundations/smc_complete_theory.html">Complete Sliding Mode Control Mathematical Theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mathematical_foundations/controller_comparison_theory.html">SMC Controller Comparison Theory</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../plant/models_guide.html">Plant Models Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../optimization_simulation/guide.html">Optimization &amp; Simulation Guide</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../controllers/index.html">Controllers Module</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Controllers Module</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../controllers/adaptive_smc.html">controllers.adaptive_smc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/classic_smc.html">controllers.classic_smc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/factory.html">controllers.factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/mpc_controller.html">controllers.mpc_controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/sta_smc.html">controllers.sta_smc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/swing_up_smc.html">controllers.swing_up_smc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/__init__.html">controllers.<strong>init</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/base_controller_interface.html">controllers.base.controller_interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/base_control_primitives.html">controllers.base.control_primitives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/base___init__.html">controllers.base.<strong>init</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/factory_deprecation.html">controllers.factory.deprecation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/factory_fallback_configs.html">controllers.factory.fallback_configs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/factory_legacy_factory.html">controllers.factory.legacy_factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/factory_optimization.html">controllers.factory.optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/factory_pso_integration.html">controllers.factory.pso_integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/factory_smc_factory.html">controllers.factory.smc_factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/factory_thread_safety.html">controllers.factory.thread_safety</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/factory___init__.html">controllers.factory.<strong>init</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/mpc_mpc_controller.html">controllers.mpc.mpc_controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/mpc___init__.html">controllers.mpc.<strong>init</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc_adaptive_smc.html">controllers.smc.adaptive_smc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc_classic_smc.html">controllers.smc.classic_smc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc_hybrid_adaptive_sta_smc.html">controllers.smc.hybrid_adaptive_sta_smc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc_sta_smc.html">controllers.smc.sta_smc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc___init__.html">controllers.smc.<strong>init</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/specialized_swing_up_smc.html">controllers.specialized.swing_up_smc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/specialized___init__.html">controllers.specialized.<strong>init</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/factory_core_protocols.html">controllers.factory.core.protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/factory_core_registry.html">controllers.factory.core.registry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/factory_core_threading.html">controllers.factory.core.threading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/factory_core_validation.html">controllers.factory.core.validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/factory_core___init__.html">controllers.factory.core.<strong>init</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc_algorithms___init__.html">controllers.smc.algorithms.<strong>init</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc_core_equivalent_control.html">controllers.smc.core.equivalent_control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc_core_gain_validation.html">controllers.smc.core.gain_validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc_core_sliding_surface.html">controllers.smc.core.sliding_surface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc_core_switching_functions.html">controllers.smc.core.switching_functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc_core___init__.html">controllers.smc.core.<strong>init</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc_algorithms_adaptive_adaptation_law.html">controllers.smc.algorithms.adaptive.adaptation_law</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc_algorithms_adaptive_config.html">controllers.smc.algorithms.adaptive.config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc_algorithms_adaptive_controller.html">controllers.smc.algorithms.adaptive.controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc_algorithms_adaptive_parameter_estimation.html">controllers.smc.algorithms.adaptive.parameter_estimation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc_algorithms_adaptive___init__.html">controllers.smc.algorithms.adaptive.<strong>init</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc_algorithms_classical_boundary_layer.html">controllers.smc.algorithms.classical.boundary_layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc_algorithms_classical_config.html">controllers.smc.algorithms.classical.config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc_algorithms_classical_controller.html">controllers.smc.algorithms.classical.controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc_algorithms_classical___init__.html">controllers.smc.algorithms.classical.<strong>init</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc_algorithms_hybrid_config.html">controllers.smc.algorithms.hybrid.config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc_algorithms_hybrid_controller.html">controllers.smc.algorithms.hybrid.controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc_algorithms_hybrid_switching_logic.html">controllers.smc.algorithms.hybrid.switching_logic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc_algorithms_hybrid___init__.html">controllers.smc.algorithms.hybrid.<strong>init</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc_algorithms_super_twisting_config.html">controllers.smc.algorithms.super_twisting.config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc_algorithms_super_twisting_controller.html">controllers.smc.algorithms.super_twisting.controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc_algorithms_super_twisting_twisting_algorithm.html">controllers.smc.algorithms.super_twisting.twisting_algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../controllers/smc_algorithms_super_twisting___init__.html">controllers.smc.algorithms.super_twisting.<strong>init</strong></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../optimizer/index.html">Optimizer Module</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Optimizer Module</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../optimizer/pso_optimizer.html">optimizer.pso_optimizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimizer/__init__.html">optimizer.<strong>init</strong></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../analysis_plan.html">5. Analysis &amp; Verification Plan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../benchmarks_methodology.html">Benchmarks &amp; Methodology</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">🧪 Development &amp; Testing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../TESTING.html">Testing Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../test_protocols.html">5.x Test Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../use_cases.html">4. Use Cases &amp; Operating Modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../context.html">2. Application Context</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault_detection_guide.html">Fault Detection &amp; Isolation (FDI) Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">📊 Research &amp; Theory</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../presentation/index.html">Research Presentation Materials</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Research Presentation Materials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/introduction.html">Abstract</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/introduction.html#introduction-and-motivation">Introduction and Motivation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/introduction.html#the-double-inverted-pendulum-as-a-canonical-control-problem">The Double Inverted Pendulum as a Canonical Control Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/introduction.html#the-primary-control-objectives-and-challenges">The Primary Control Objectives and Challenges</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/introduction.html#sliding-mode-control-as-a-robust-solution">Sliding Mode Control as a Robust Solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/introduction.html#the-gain-tuning-dilemma-and-the-need-for-optimization">The Gain Tuning Dilemma and the Need for Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/introduction.html#particle-swarm-optimization-for-automated-design">Particle Swarm Optimization for Automated Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/introduction.html#synthesis-and-motivation">Synthesis and Motivation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/introduction.html#references">References</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/problem-statement.html">Problem Statement for Double‑Inverted Pendulum (DIP) Control with SMC and PSO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/previous-works.html">Previous Work Before the Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/system-modeling.html"><strong>A Comprehensive Technical Report on the Modeling and Configuration of a Cart‑Based Double Inverted Pendulum System</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/smc-theory.html">Sliding Mode Control for a Double‑Inverted Pendulum: Bridging Theory and Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/chattering-mitigation.html">Abstract</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/chattering-mitigation.html#introduction">1 Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/chattering-mitigation.html#system-modelling-and-problem-formulation">2 System Modelling and Problem Formulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/chattering-mitigation.html#simulation-methodology">3 Simulation Methodology</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/chattering-mitigation.html#classic-sliding-mode-control">4 Classic Sliding Mode Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/chattering-mitigation.html#chattering-mitigation-strategy-i-boundary-layer-method">5 Chattering Mitigation Strategy I: Boundary Layer Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/chattering-mitigation.html#chattering-mitigation-strategy-ii-supertwisting-algorithm">6 Chattering Mitigation Strategy II: Super‑Twisting Algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/chattering-mitigation.html#chattering-mitigation-strategy-iii-adaptive-sliding-mode-control">7 Chattering Mitigation Strategy III: Adaptive Sliding Mode Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/chattering-mitigation.html#chattering-mitigation-strategy-iv-hybrid-adaptivesta">8 Chattering Mitigation Strategy IV: Hybrid Adaptive–STA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/chattering-mitigation.html#synthesis-and-comparative-analysis">9 Synthesis and Comparative Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/chattering-mitigation.html#references">References</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/pso-optimization.html"><strong>Comprehensive Simulation Analysis and Enhancements for the Double Inverted Pendulum Control System</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/simulation-setup.html">Particle Swarm Optimization for Sliding‑Mode Controller Tuning of a Double Inverted Pendulum</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/results-discussion.html">8 – Results and Discussion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../presentation/results-discussion.html#references">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/introduction.html">Abstract</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/introduction.html#introduction-and-motivation">Introduction and Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/introduction.html#the-double-inverted-pendulum-as-a-canonical-control-problem">The Double Inverted Pendulum as a Canonical Control Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/introduction.html#the-primary-control-objectives-and-challenges">The Primary Control Objectives and Challenges</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/introduction.html#sliding-mode-control-as-a-robust-solution">Sliding Mode Control as a Robust Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/introduction.html#the-gain-tuning-dilemma-and-the-need-for-optimization">The Gain Tuning Dilemma and the Need for Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/introduction.html#particle-swarm-optimization-for-automated-design">Particle Swarm Optimization for Automated Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/introduction.html#synthesis-and-motivation">Synthesis and Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/introduction.html#references">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/problem-statement.html">Problem Statement for Double‑Inverted Pendulum (DIP) Control with SMC and PSO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/previous-works.html">Previous Work Before the Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/system-modeling.html"><strong>A Comprehensive Technical Report on the Modeling and Configuration of a Cart‑Based Double Inverted Pendulum System</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/smc-theory.html">Sliding Mode Control for a Double‑Inverted Pendulum: Bridging Theory and Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/chattering-mitigation.html">Abstract</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/chattering-mitigation.html#introduction">1 Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/chattering-mitigation.html#system-modelling-and-problem-formulation">2 System Modelling and Problem Formulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/chattering-mitigation.html#simulation-methodology">3 Simulation Methodology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/chattering-mitigation.html#classic-sliding-mode-control">4 Classic Sliding Mode Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/chattering-mitigation.html#chattering-mitigation-strategy-i-boundary-layer-method">5 Chattering Mitigation Strategy I: Boundary Layer Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/chattering-mitigation.html#chattering-mitigation-strategy-ii-supertwisting-algorithm">6 Chattering Mitigation Strategy II: Super‑Twisting Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/chattering-mitigation.html#chattering-mitigation-strategy-iii-adaptive-sliding-mode-control">7 Chattering Mitigation Strategy III: Adaptive Sliding Mode Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/chattering-mitigation.html#chattering-mitigation-strategy-iv-hybrid-adaptivesta">8 Chattering Mitigation Strategy IV: Hybrid Adaptive–STA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/chattering-mitigation.html#synthesis-and-comparative-analysis">9 Synthesis and Comparative Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/chattering-mitigation.html#references">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/pso-optimization.html"><strong>Comprehensive Simulation Analysis and Enhancements for the Double Inverted Pendulum Control System</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/simulation-setup.html">Particle Swarm Optimization for Sliding‑Mode Controller Tuning of a Double Inverted Pendulum</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/results-discussion.html">8 – Results and Discussion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../presentation/results-discussion.html#references">References</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">📖 API Reference &amp; Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Reference Documentation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../examples/index.html">Examples</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Examples</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../bibliography.html">Bibliography &amp; Academic References</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">🔧 Project Management</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../CONTRIBUTING.html">Contributing – ResearchPlanSpec Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../RELEASE_CHECKLIST.html">Release Checklist</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CHANGELOG.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../symbols.html">Symbols &amp; Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../results_readme.html">Results &amp; Plots</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">📚 Citations &amp; Attribution</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../CITATIONS.html">Citations &amp; Academic Attribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CITATIONS_ACADEMIC.html">Academic Theory Citations &amp; References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DEPENDENCIES.html">Software Dependencies &amp; Citations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PATTERNS.html">Software Design Patterns &amp; Architecture Attribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../LICENSES.html">License Compliance &amp; Attribution</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="https://github.com/theSadeQ/DIP_SMC_PSO/blob/main/docs/reference/interfaces/hardware_actuators.md?plain=true" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div><div class="edit-this-page">
  <a class="muted-link" href="https://github.com/theSadeQ/DIP_SMC_PSO/edit/main/docs/reference/interfaces/hardware_actuators.md" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section class="tex2jax_ignore mathjax_ignore" id="interfaces-hardware-actuators">
<h1>interfaces.hardware.actuators<a class="headerlink" href="#interfaces-hardware-actuators" title="Link to this heading">¶</a></h1>
<p><strong>Source:</strong> <code class="docutils literal notranslate"><span class="pre">src\interfaces\hardware\actuators.py</span></code></p>
<section id="module-overview">
<h2>Module Overview<a class="headerlink" href="#module-overview" title="Link to this heading">¶</a></h2>
<p>Actuator interface framework for control systems.
This module provides standardized interfaces for various actuator types
commonly used in control systems, including servo motors, stepper motors,
pneumatic actuators, and other motion control devices.</p>
</section>
<section id="complete-source-code">
<h2>Complete Source Code<a class="headerlink" href="#complete-source-code" title="Link to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="c1">#======================================================================================\\\</span>
<span class="linenos">  2</span><span class="c1">#======================== src/interfaces/hardware/actuators.py ========================\\\</span>
<span class="linenos">  3</span><span class="c1">#======================================================================================\\\</span>
<span class="linenos">  4</span>
<span class="linenos">  5</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  6</span><span class="sd">Actuator interface framework for control systems.</span>
<span class="linenos">  7</span><span class="sd">This module provides standardized interfaces for various actuator types</span>
<span class="linenos">  8</span><span class="sd">commonly used in control systems, including servo motors, stepper motors,</span>
<span class="linenos">  9</span><span class="sd">pneumatic actuators, and other motion control devices.</span>
<span class="linenos"> 10</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 11</span>
<span class="linenos"> 12</span><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="linenos"> 13</span><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="linenos"> 14</span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="linenos"> 15</span><span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="linenos"> 16</span><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="linenos"> 17</span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">List</span>
<span class="linenos"> 18</span><span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="linenos"> 19</span>
<span class="linenos"> 20</span><span class="kn">from</span><span class="w"> </span><span class="nn">.device_drivers</span><span class="w"> </span><span class="kn">import</span> <span class="n">DeviceDriver</span><span class="p">,</span> <span class="n">DeviceConfig</span><span class="p">,</span> <span class="n">DeviceCapability</span>
<span class="linenos"> 21</span>
<span class="linenos"> 22</span>
<span class="linenos"> 23</span><span class="k">class</span><span class="w"> </span><span class="nc">ActuatorType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="linenos"> 24</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Actuator type enumeration.&quot;&quot;&quot;</span>
<span class="linenos"> 25</span>    <span class="n">SERVO</span> <span class="o">=</span> <span class="s2">&quot;servo&quot;</span>
<span class="linenos"> 26</span>    <span class="n">STEPPER</span> <span class="o">=</span> <span class="s2">&quot;stepper&quot;</span>
<span class="linenos"> 27</span>    <span class="n">DC_MOTOR</span> <span class="o">=</span> <span class="s2">&quot;dc_motor&quot;</span>
<span class="linenos"> 28</span>    <span class="n">PNEUMATIC</span> <span class="o">=</span> <span class="s2">&quot;pneumatic&quot;</span>
<span class="linenos"> 29</span>    <span class="n">HYDRAULIC</span> <span class="o">=</span> <span class="s2">&quot;hydraulic&quot;</span>
<span class="linenos"> 30</span>    <span class="n">LINEAR</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span>
<span class="linenos"> 31</span>    <span class="n">ROTARY</span> <span class="o">=</span> <span class="s2">&quot;rotary&quot;</span>
<span class="linenos"> 32</span>    <span class="n">VALVE</span> <span class="o">=</span> <span class="s2">&quot;valve&quot;</span>
<span class="linenos"> 33</span>
<span class="linenos"> 34</span>
<span class="linenos"> 35</span><span class="k">class</span><span class="w"> </span><span class="nc">ActuatorMode</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="linenos"> 36</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Actuator control mode enumeration.&quot;&quot;&quot;</span>
<span class="linenos"> 37</span>    <span class="n">POSITION</span> <span class="o">=</span> <span class="s2">&quot;position&quot;</span>
<span class="linenos"> 38</span>    <span class="n">VELOCITY</span> <span class="o">=</span> <span class="s2">&quot;velocity&quot;</span>
<span class="linenos"> 39</span>    <span class="n">TORQUE</span> <span class="o">=</span> <span class="s2">&quot;torque&quot;</span>
<span class="linenos"> 40</span>    <span class="n">FORCE</span> <span class="o">=</span> <span class="s2">&quot;force&quot;</span>
<span class="linenos"> 41</span>    <span class="n">PRESSURE</span> <span class="o">=</span> <span class="s2">&quot;pressure&quot;</span>
<span class="linenos"> 42</span>    <span class="n">OPEN_LOOP</span> <span class="o">=</span> <span class="s2">&quot;open_loop&quot;</span>
<span class="linenos"> 43</span>
<span class="linenos"> 44</span>
<span class="linenos"> 45</span><span class="nd">@dataclass</span>
<span class="linenos"> 46</span><span class="k">class</span><span class="w"> </span><span class="nc">ActuatorCommand</span><span class="p">:</span>
<span class="linenos"> 47</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Actuator command data structure.&quot;&quot;&quot;</span>
<span class="linenos"> 48</span>    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">float</span>
<span class="linenos"> 49</span>    <span class="n">actuator_id</span><span class="p">:</span> <span class="nb">str</span>
<span class="linenos"> 50</span>    <span class="n">command_type</span><span class="p">:</span> <span class="n">ActuatorMode</span>
<span class="linenos"> 51</span>    <span class="n">target_value</span><span class="p">:</span> <span class="nb">float</span>
<span class="linenos"> 52</span>    <span class="n">unit</span><span class="p">:</span> <span class="nb">str</span>
<span class="linenos"> 53</span>    <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 54</span>    <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 55</span>    <span class="n">safety_checks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos"> 56</span>
<span class="linenos"> 57</span>
<span class="linenos"> 58</span><span class="nd">@dataclass</span>
<span class="linenos"> 59</span><span class="k">class</span><span class="w"> </span><span class="nc">ActuatorStatus</span><span class="p">:</span>
<span class="linenos"> 60</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Actuator status data structure.&quot;&quot;&quot;</span>
<span class="linenos"> 61</span>    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">float</span>
<span class="linenos"> 62</span>    <span class="n">actuator_id</span><span class="p">:</span> <span class="nb">str</span>
<span class="linenos"> 63</span>    <span class="n">current_position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 64</span>    <span class="n">current_velocity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 65</span>    <span class="n">current_force</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 66</span>    <span class="n">target_position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 67</span>    <span class="n">target_velocity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 68</span>    <span class="n">target_force</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 69</span>    <span class="n">error</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 70</span>    <span class="n">is_moving</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos"> 71</span>    <span class="n">at_target</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos"> 72</span>    <span class="n">fault_status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 73</span>
<span class="linenos"> 74</span>
<span class="linenos"> 75</span><span class="nd">@dataclass</span>
<span class="linenos"> 76</span><span class="k">class</span><span class="w"> </span><span class="nc">ActuatorLimits</span><span class="p">:</span>
<span class="linenos"> 77</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Actuator operational limits.&quot;&quot;&quot;</span>
<span class="linenos"> 78</span>    <span class="n">min_position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 79</span>    <span class="n">max_position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 80</span>    <span class="n">max_velocity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 81</span>    <span class="n">max_acceleration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 82</span>    <span class="n">max_force</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 83</span>    <span class="n">max_current</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 84</span>    <span class="n">emergency_stop_enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos"> 85</span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span><span class="k">class</span><span class="w"> </span><span class="nc">ActuatorInterface</span><span class="p">(</span><span class="n">DeviceDriver</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<span class="linenos"> 88</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 89</span><span class="sd">    Abstract base class for actuator interfaces.</span>
<span class="linenos"> 90</span>
<span class="linenos"> 91</span><span class="sd">    This class defines the standard interface for all actuator types,</span>
<span class="linenos"> 92</span><span class="sd">    providing common functionality for motion control, safety limits,</span>
<span class="linenos"> 93</span><span class="sd">    and position feedback.</span>
<span class="linenos"> 94</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 95</span>
<span class="linenos"> 96</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">DeviceConfig</span><span class="p">):</span>
<span class="linenos"> 97</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize actuator interface.&quot;&quot;&quot;</span>
<span class="linenos"> 98</span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="linenos"> 99</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_actuator_type</span> <span class="o">=</span> <span class="n">ActuatorType</span><span class="o">.</span><span class="n">SERVO</span>
<span class="linenos">100</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_control_mode</span> <span class="o">=</span> <span class="n">ActuatorMode</span><span class="o">.</span><span class="n">POSITION</span>
<span class="linenos">101</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_limits</span> <span class="o">=</span> <span class="n">ActuatorLimits</span><span class="p">()</span>
<span class="linenos">102</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span> <span class="o">=</span> <span class="n">ActuatorStatus</span><span class="p">(</span>
<span class="linenos">103</span>            <span class="n">timestamp</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
<span class="linenos">104</span>            <span class="n">actuator_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span>
<span class="linenos">105</span>        <span class="p">)</span>
<span class="linenos">106</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_command_queue</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ActuatorCommand</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">107</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_max_queue_size</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_queue_size&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="linenos">108</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_position_tolerance</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;position_tolerance&#39;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
<span class="linenos">109</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_safety_enabled</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;safety_enabled&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="linenos">110</span>
<span class="linenos">111</span>    <span class="nd">@property</span>
<span class="linenos">112</span>    <span class="k">def</span><span class="w"> </span><span class="nf">actuator_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ActuatorType</span><span class="p">:</span>
<span class="linenos">113</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get actuator type.&quot;&quot;&quot;</span>
<span class="linenos">114</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actuator_type</span>
<span class="linenos">115</span>
<span class="linenos">116</span>    <span class="nd">@property</span>
<span class="linenos">117</span>    <span class="k">def</span><span class="w"> </span><span class="nf">control_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ActuatorMode</span><span class="p">:</span>
<span class="linenos">118</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get current control mode.&quot;&quot;&quot;</span>
<span class="linenos">119</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_control_mode</span>
<span class="linenos">120</span>
<span class="linenos">121</span>    <span class="nd">@property</span>
<span class="linenos">122</span>    <span class="k">def</span><span class="w"> </span><span class="nf">current_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ActuatorStatus</span><span class="p">:</span>
<span class="linenos">123</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get current actuator status.&quot;&quot;&quot;</span>
<span class="linenos">124</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span>
<span class="linenos">125</span>
<span class="linenos">126</span>    <span class="nd">@property</span>
<span class="linenos">127</span>    <span class="k">def</span><span class="w"> </span><span class="nf">limits</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ActuatorLimits</span><span class="p">:</span>
<span class="linenos">128</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get actuator limits.&quot;&quot;&quot;</span>
<span class="linenos">129</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limits</span>
<span class="linenos">130</span>
<span class="linenos">131</span>    <span class="nd">@abstractmethod</span>
<span class="linenos">132</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">move_to_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">velocity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">133</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">134</span><span class="sd">        Move actuator to specific position.</span>
<span class="linenos">135</span>
<span class="linenos">136</span><span class="sd">        Parameters</span>
<span class="linenos">137</span><span class="sd">        ----------</span>
<span class="linenos">138</span><span class="sd">        position : float</span>
<span class="linenos">139</span><span class="sd">            Target position</span>
<span class="linenos">140</span><span class="sd">        velocity : float, optional</span>
<span class="linenos">141</span><span class="sd">            Movement velocity</span>
<span class="linenos">142</span>
<span class="linenos">143</span><span class="sd">        Returns</span>
<span class="linenos">144</span><span class="sd">        -------</span>
<span class="linenos">145</span><span class="sd">        bool</span>
<span class="linenos">146</span><span class="sd">            True if command accepted, False otherwise</span>
<span class="linenos">147</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">148</span>        <span class="k">pass</span>
<span class="linenos">149</span>
<span class="linenos">150</span>    <span class="nd">@abstractmethod</span>
<span class="linenos">151</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">velocity</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">152</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">153</span><span class="sd">        Set actuator velocity.</span>
<span class="linenos">154</span>
<span class="linenos">155</span><span class="sd">        Parameters</span>
<span class="linenos">156</span><span class="sd">        ----------</span>
<span class="linenos">157</span><span class="sd">        velocity : float</span>
<span class="linenos">158</span><span class="sd">            Target velocity</span>
<span class="linenos">159</span>
<span class="linenos">160</span><span class="sd">        Returns</span>
<span class="linenos">161</span><span class="sd">        -------</span>
<span class="linenos">162</span><span class="sd">        bool</span>
<span class="linenos">163</span><span class="sd">            True if command accepted, False otherwise</span>
<span class="linenos">164</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">165</span>        <span class="k">pass</span>
<span class="linenos">166</span>
<span class="linenos">167</span>    <span class="nd">@abstractmethod</span>
<span class="linenos">168</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">169</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">170</span><span class="sd">        Set actuator force/torque.</span>
<span class="linenos">171</span>
<span class="linenos">172</span><span class="sd">        Parameters</span>
<span class="linenos">173</span><span class="sd">        ----------</span>
<span class="linenos">174</span><span class="sd">        force : float</span>
<span class="linenos">175</span><span class="sd">            Target force or torque</span>
<span class="linenos">176</span>
<span class="linenos">177</span><span class="sd">        Returns</span>
<span class="linenos">178</span><span class="sd">        -------</span>
<span class="linenos">179</span><span class="sd">        bool</span>
<span class="linenos">180</span><span class="sd">            True if command accepted, False otherwise</span>
<span class="linenos">181</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">182</span>        <span class="k">pass</span>
<span class="linenos">183</span>
<span class="linenos">184</span>    <span class="nd">@abstractmethod</span>
<span class="linenos">185</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">186</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">187</span><span class="sd">        Stop actuator motion.</span>
<span class="linenos">188</span>
<span class="linenos">189</span><span class="sd">        Returns</span>
<span class="linenos">190</span><span class="sd">        -------</span>
<span class="linenos">191</span><span class="sd">        bool</span>
<span class="linenos">192</span><span class="sd">            True if stop successful, False otherwise</span>
<span class="linenos">193</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">194</span>        <span class="k">pass</span>
<span class="linenos">195</span>
<span class="linenos">196</span>    <span class="nd">@abstractmethod</span>
<span class="linenos">197</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">home</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">198</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">199</span><span class="sd">        Move actuator to home position.</span>
<span class="linenos">200</span>
<span class="linenos">201</span><span class="sd">        Returns</span>
<span class="linenos">202</span><span class="sd">        -------</span>
<span class="linenos">203</span><span class="sd">        bool</span>
<span class="linenos">204</span><span class="sd">            True if homing successful, False otherwise</span>
<span class="linenos">205</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">206</span>        <span class="k">pass</span>
<span class="linenos">207</span>
<span class="linenos">208</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_control_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="n">ActuatorMode</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">209</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set actuator control mode.&quot;&quot;&quot;</span>
<span class="linenos">210</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">211</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_control_mode</span> <span class="o">=</span> <span class="n">mode</span>
<span class="linenos">212</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Set control mode to </span><span class="si">{</span><span class="n">mode</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> for actuator </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">213</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">214</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">215</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to set control mode: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">216</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">217</span>
<span class="linenos">218</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limits</span><span class="p">:</span> <span class="n">ActuatorLimits</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">219</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set actuator operational limits.&quot;&quot;&quot;</span>
<span class="linenos">220</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">221</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_limits</span> <span class="o">=</span> <span class="n">limits</span>
<span class="linenos">222</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated limits for actuator </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">223</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">224</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">225</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to set limits: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">226</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">227</span>
<span class="linenos">228</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">is_at_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">229</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if actuator is at target position.&quot;&quot;&quot;</span>
<span class="linenos">230</span>        <span class="k">if</span> <span class="n">tolerance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">231</span>            <span class="n">tolerance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_position_tolerance</span>
<span class="linenos">232</span>
<span class="linenos">233</span>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span>
<span class="linenos">234</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">target_position</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
<span class="linenos">235</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">236</span>
<span class="linenos">237</span>        <span class="n">error</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">target_position</span><span class="p">)</span>
<span class="linenos">238</span>        <span class="k">return</span> <span class="n">error</span> <span class="o">&lt;=</span> <span class="n">tolerance</span>
<span class="linenos">239</span>
<span class="linenos">240</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">wait_for_motion_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">241</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Wait for actuator to reach target position.&quot;&quot;&quot;</span>
<span class="linenos">242</span>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="linenos">243</span>
<span class="linenos">244</span>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">245</span>            <span class="k">if</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_at_target</span><span class="p">():</span>
<span class="linenos">246</span>                <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">247</span>
<span class="linenos">248</span>            <span class="k">if</span> <span class="n">timeout</span> <span class="ow">and</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
<span class="linenos">249</span>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Motion timeout for actuator </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">250</span>                <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">251</span>
<span class="linenos">252</span>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>  <span class="c1"># 10ms polling</span>
<span class="linenos">253</span>
<span class="linenos">254</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">emergency_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">255</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform emergency stop.&quot;&quot;&quot;</span>
<span class="linenos">256</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">257</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Emergency stop triggered for actuator </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">258</span>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
<span class="linenos">259</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">fault_status</span> <span class="o">=</span> <span class="s2">&quot;emergency_stop&quot;</span>
<span class="linenos">260</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">261</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">262</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Emergency stop failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">263</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">264</span>
<span class="linenos">265</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">clear_faults</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">266</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear actuator fault conditions.&quot;&quot;&quot;</span>
<span class="linenos">267</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">268</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">fault_status</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos">269</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cleared faults for actuator </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">270</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">271</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">272</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to clear faults: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">273</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">274</span>
<span class="linenos">275</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_safety_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">ActuatorCommand</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">276</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if command violates safety limits.&quot;&quot;&quot;</span>
<span class="linenos">277</span>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safety_enabled</span><span class="p">:</span>
<span class="linenos">278</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">279</span>
<span class="linenos">280</span>        <span class="k">if</span> <span class="n">command</span><span class="o">.</span><span class="n">command_type</span> <span class="o">==</span> <span class="n">ActuatorMode</span><span class="o">.</span><span class="n">POSITION</span><span class="p">:</span>
<span class="linenos">281</span>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">min_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
<span class="linenos">282</span>                <span class="n">command</span><span class="o">.</span><span class="n">target_value</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">min_position</span><span class="p">):</span>
<span class="linenos">283</span>                <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">284</span>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">max_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
<span class="linenos">285</span>                <span class="n">command</span><span class="o">.</span><span class="n">target_value</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">max_position</span><span class="p">):</span>
<span class="linenos">286</span>                <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">287</span>
<span class="linenos">288</span>        <span class="k">elif</span> <span class="n">command</span><span class="o">.</span><span class="n">command_type</span> <span class="o">==</span> <span class="n">ActuatorMode</span><span class="o">.</span><span class="n">VELOCITY</span><span class="p">:</span>
<span class="linenos">289</span>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">max_velocity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
<span class="linenos">290</span>                <span class="nb">abs</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">target_value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">max_velocity</span><span class="p">):</span>
<span class="linenos">291</span>                <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">292</span>
<span class="linenos">293</span>        <span class="k">elif</span> <span class="n">command</span><span class="o">.</span><span class="n">command_type</span> <span class="o">==</span> <span class="n">ActuatorMode</span><span class="o">.</span><span class="n">FORCE</span><span class="p">:</span>
<span class="linenos">294</span>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">max_force</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
<span class="linenos">295</span>                <span class="nb">abs</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">target_value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">max_force</span><span class="p">):</span>
<span class="linenos">296</span>                <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">297</span>
<span class="linenos">298</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">299</span>
<span class="linenos">300</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_add_command_to_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">ActuatorCommand</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">301</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add command to execution queue.&quot;&quot;&quot;</span>
<span class="linenos">302</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">command</span><span class="o">.</span><span class="n">safety_checks</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_safety_limits</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
<span class="linenos">303</span>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_queue</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_queue_size</span><span class="p">:</span>
<span class="linenos">304</span>                <span class="bp">self</span><span class="o">.</span><span class="n">_command_queue</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Remove oldest command</span>
<span class="linenos">305</span>
<span class="linenos">306</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_command_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="linenos">307</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">308</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">309</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Command rejected due to safety limits: </span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">310</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">311</span>
<span class="linenos">312</span>
<span class="linenos">313</span><span class="k">class</span><span class="w"> </span><span class="nc">ServoActuator</span><span class="p">(</span><span class="n">ActuatorInterface</span><span class="p">):</span>
<span class="linenos">314</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">315</span><span class="sd">    Servo motor actuator implementation.</span>
<span class="linenos">316</span>
<span class="linenos">317</span><span class="sd">    Provides position control with encoder feedback, velocity control,</span>
<span class="linenos">318</span><span class="sd">    and PID control loop functionality.</span>
<span class="linenos">319</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">320</span>
<span class="linenos">321</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">DeviceConfig</span><span class="p">):</span>
<span class="linenos">322</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize servo actuator.&quot;&quot;&quot;</span>
<span class="linenos">323</span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="linenos">324</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_actuator_type</span> <span class="o">=</span> <span class="n">ActuatorType</span><span class="o">.</span><span class="n">SERVO</span>
<span class="linenos">325</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_encoder_resolution</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;encoder_resolution&#39;</span><span class="p">,</span> <span class="mi">4096</span><span class="p">)</span>
<span class="linenos">326</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_gear_ratio</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;gear_ratio&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="linenos">327</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_max_rpm</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_rpm&#39;</span><span class="p">,</span> <span class="mi">3000</span><span class="p">)</span>
<span class="linenos">328</span>
<span class="linenos">329</span>        <span class="c1"># PID parameters</span>
<span class="linenos">330</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_pid_gains</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pid_gains&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;kp&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;ki&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;kd&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">})</span>
<span class="linenos">331</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_pid_error_sum</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="linenos">332</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_pid_last_error</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="linenos">333</span>
<span class="linenos">334</span>        <span class="c1"># Initialize servo capabilities</span>
<span class="linenos">335</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_servo_capabilities</span><span class="p">()</span>
<span class="linenos">336</span>
<span class="linenos">337</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">338</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize servo actuator.&quot;&quot;&quot;</span>
<span class="linenos">339</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initializing servo actuator </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">340</span>
<span class="linenos">341</span>        <span class="c1"># Initialize servo controller (simulated)</span>
<span class="linenos">342</span>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
<span class="linenos">343</span>
<span class="linenos">344</span>        <span class="c1"># Set initial position</span>
<span class="linenos">345</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="linenos">346</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">target_position</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="linenos">347</span>
<span class="linenos">348</span>        <span class="c1"># Configure limits from config</span>
<span class="linenos">349</span>        <span class="n">limits_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;limits&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="linenos">350</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_limits</span> <span class="o">=</span> <span class="n">ActuatorLimits</span><span class="p">(</span>
<span class="linenos">351</span>            <span class="n">min_position</span><span class="o">=</span><span class="n">limits_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;min_position&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">360.0</span><span class="p">),</span>
<span class="linenos">352</span>            <span class="n">max_position</span><span class="o">=</span><span class="n">limits_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_position&#39;</span><span class="p">,</span> <span class="mf">360.0</span><span class="p">),</span>
<span class="linenos">353</span>            <span class="n">max_velocity</span><span class="o">=</span><span class="n">limits_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_velocity&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_rpm</span> <span class="o">*</span> <span class="mf">6.0</span><span class="p">),</span>  <span class="c1"># deg/s</span>
<span class="linenos">354</span>            <span class="n">max_acceleration</span><span class="o">=</span><span class="n">limits_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_acceleration&#39;</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">),</span>
<span class="linenos">355</span>            <span class="n">max_force</span><span class="o">=</span><span class="n">limits_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_force&#39;</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
<span class="linenos">356</span>        <span class="p">)</span>
<span class="linenos">357</span>
<span class="linenos">358</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">359</span>
<span class="linenos">360</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">361</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Shutdown servo actuator.&quot;&quot;&quot;</span>
<span class="linenos">362</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shutting down servo actuator </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">363</span>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
<span class="linenos">364</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">365</span>
<span class="linenos">366</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">read_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos">367</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read servo actuator data.&quot;&quot;&quot;</span>
<span class="linenos">368</span>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_status</span><span class="p">()</span>
<span class="linenos">369</span>
<span class="linenos">370</span>        <span class="k">if</span> <span class="n">channel</span><span class="p">:</span>
<span class="linenos">371</span>            <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;position&quot;</span><span class="p">:</span>
<span class="linenos">372</span>                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span><span class="p">}</span>
<span class="linenos">373</span>            <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;velocity&quot;</span><span class="p">:</span>
<span class="linenos">374</span>                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;velocity&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_velocity</span><span class="p">}</span>
<span class="linenos">375</span>            <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span>
<span class="linenos">376</span>                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">error</span><span class="p">}</span>
<span class="linenos">377</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">378</span>                <span class="k">return</span> <span class="p">{}</span>
<span class="linenos">379</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">380</span>            <span class="k">return</span> <span class="p">{</span>
<span class="linenos">381</span>                <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span><span class="p">,</span>
<span class="linenos">382</span>                <span class="s2">&quot;velocity&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_velocity</span><span class="p">,</span>
<span class="linenos">383</span>                <span class="s2">&quot;target_position&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">target_position</span><span class="p">,</span>
<span class="linenos">384</span>                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">error</span><span class="p">,</span>
<span class="linenos">385</span>                <span class="s2">&quot;is_moving&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">is_moving</span><span class="p">,</span>
<span class="linenos">386</span>                <span class="s2">&quot;at_target&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">at_target</span>
<span class="linenos">387</span>            <span class="p">}</span>
<span class="linenos">388</span>
<span class="linenos">389</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">write_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">390</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write data to servo actuator.&quot;&quot;&quot;</span>
<span class="linenos">391</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">392</span>            <span class="k">if</span> <span class="s2">&quot;position&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
<span class="linenos">393</span>                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_position</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">])</span>
<span class="linenos">394</span>            <span class="k">elif</span> <span class="s2">&quot;velocity&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
<span class="linenos">395</span>                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_velocity</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;velocity&quot;</span><span class="p">])</span>
<span class="linenos">396</span>            <span class="k">elif</span> <span class="s2">&quot;force&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
<span class="linenos">397</span>                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_force</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;force&quot;</span><span class="p">])</span>
<span class="linenos">398</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">399</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">400</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write data to servo: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">401</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">402</span>
<span class="linenos">403</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">self_test</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos">404</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform servo actuator self-test.&quot;&quot;&quot;</span>
<span class="linenos">405</span>        <span class="n">test_results</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">self_test</span><span class="p">()</span>
<span class="linenos">406</span>
<span class="linenos">407</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">408</span>            <span class="c1"># Test position control</span>
<span class="linenos">409</span>            <span class="n">initial_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span>
<span class="linenos">410</span>            <span class="n">test_position</span> <span class="o">=</span> <span class="n">initial_position</span> <span class="o">+</span> <span class="mf">10.0</span>  <span class="c1"># Move 10 degrees</span>
<span class="linenos">411</span>
<span class="linenos">412</span>            <span class="c1"># Check if position is within limits</span>
<span class="linenos">413</span>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">min_position</span> <span class="o">&lt;=</span> <span class="n">test_position</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">max_position</span><span class="p">):</span>
<span class="linenos">414</span>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_position</span><span class="p">(</span><span class="n">test_position</span><span class="p">)</span>
<span class="linenos">415</span>                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># Wait for movement</span>
<span class="linenos">416</span>
<span class="linenos">417</span>                <span class="n">position_error</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="o">-</span> <span class="n">test_position</span><span class="p">)</span>
<span class="linenos">418</span>                <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;position_control&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">position_error</span> <span class="o">&lt;</span> <span class="mf">1.0</span>
<span class="linenos">419</span>
<span class="linenos">420</span>                <span class="c1"># Return to initial position</span>
<span class="linenos">421</span>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_position</span><span class="p">(</span><span class="n">initial_position</span><span class="p">)</span>
<span class="linenos">422</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">423</span>                <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;position_control&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Skip if can&#39;t test safely</span>
<span class="linenos">424</span>
<span class="linenos">425</span>            <span class="c1"># Test velocity control</span>
<span class="linenos">426</span>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_velocity</span><span class="p">(</span><span class="mf">100.0</span><span class="p">)</span>  <span class="c1"># 100 deg/s</span>
<span class="linenos">427</span>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
<span class="linenos">428</span>            <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;velocity_control&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_velocity</span> <span class="o">-</span> <span class="mf">100.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">10.0</span>
<span class="linenos">429</span>
<span class="linenos">430</span>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
<span class="linenos">431</span>
<span class="linenos">432</span>            <span class="c1"># Test encoder feedback</span>
<span class="linenos">433</span>            <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;encoder_functional&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="linenos">434</span>
<span class="linenos">435</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">436</span>            <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;servo_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="linenos">437</span>            <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;overall_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;FAIL&#39;</span>
<span class="linenos">438</span>
<span class="linenos">439</span>        <span class="k">return</span> <span class="n">test_results</span>
<span class="linenos">440</span>
<span class="linenos">441</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">move_to_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">velocity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">442</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Move servo to specific position.&quot;&quot;&quot;</span>
<span class="linenos">443</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">444</span>            <span class="n">command</span> <span class="o">=</span> <span class="n">ActuatorCommand</span><span class="p">(</span>
<span class="linenos">445</span>                <span class="n">timestamp</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
<span class="linenos">446</span>                <span class="n">actuator_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="p">,</span>
<span class="linenos">447</span>                <span class="n">command_type</span><span class="o">=</span><span class="n">ActuatorMode</span><span class="o">.</span><span class="n">POSITION</span><span class="p">,</span>
<span class="linenos">448</span>                <span class="n">target_value</span><span class="o">=</span><span class="n">position</span><span class="p">,</span>
<span class="linenos">449</span>                <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span>
<span class="linenos">450</span>            <span class="p">)</span>
<span class="linenos">451</span>
<span class="linenos">452</span>            <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_command_to_queue</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
<span class="linenos">453</span>                <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">454</span>
<span class="linenos">455</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">target_position</span> <span class="o">=</span> <span class="n">position</span>
<span class="linenos">456</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">is_moving</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos">457</span>
<span class="linenos">458</span>            <span class="c1"># Start position control task</span>
<span class="linenos">459</span>            <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_position_control_loop</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">velocity</span><span class="p">))</span>
<span class="linenos">460</span>
<span class="linenos">461</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">462</span>
<span class="linenos">463</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">464</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to move to position </span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">465</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">466</span>
<span class="linenos">467</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">velocity</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">468</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set servo velocity.&quot;&quot;&quot;</span>
<span class="linenos">469</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">470</span>            <span class="n">command</span> <span class="o">=</span> <span class="n">ActuatorCommand</span><span class="p">(</span>
<span class="linenos">471</span>                <span class="n">timestamp</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
<span class="linenos">472</span>                <span class="n">actuator_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="p">,</span>
<span class="linenos">473</span>                <span class="n">command_type</span><span class="o">=</span><span class="n">ActuatorMode</span><span class="o">.</span><span class="n">VELOCITY</span><span class="p">,</span>
<span class="linenos">474</span>                <span class="n">target_value</span><span class="o">=</span><span class="n">velocity</span><span class="p">,</span>
<span class="linenos">475</span>                <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg/s&quot;</span>
<span class="linenos">476</span>            <span class="p">)</span>
<span class="linenos">477</span>
<span class="linenos">478</span>            <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_command_to_queue</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
<span class="linenos">479</span>                <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">480</span>
<span class="linenos">481</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">target_velocity</span> <span class="o">=</span> <span class="n">velocity</span>
<span class="linenos">482</span>
<span class="linenos">483</span>            <span class="c1"># Start velocity control</span>
<span class="linenos">484</span>            <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_velocity_control_loop</span><span class="p">(</span><span class="n">velocity</span><span class="p">))</span>
<span class="linenos">485</span>
<span class="linenos">486</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">487</span>
<span class="linenos">488</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">489</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to set velocity </span><span class="si">{</span><span class="n">velocity</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">490</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">491</span>
<span class="linenos">492</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">493</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set servo force/torque.&quot;&quot;&quot;</span>
<span class="linenos">494</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">495</span>            <span class="n">command</span> <span class="o">=</span> <span class="n">ActuatorCommand</span><span class="p">(</span>
<span class="linenos">496</span>                <span class="n">timestamp</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
<span class="linenos">497</span>                <span class="n">actuator_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="p">,</span>
<span class="linenos">498</span>                <span class="n">command_type</span><span class="o">=</span><span class="n">ActuatorMode</span><span class="o">.</span><span class="n">FORCE</span><span class="p">,</span>
<span class="linenos">499</span>                <span class="n">target_value</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
<span class="linenos">500</span>                <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;Nm&quot;</span>
<span class="linenos">501</span>            <span class="p">)</span>
<span class="linenos">502</span>
<span class="linenos">503</span>            <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_command_to_queue</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
<span class="linenos">504</span>                <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">505</span>
<span class="linenos">506</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">target_force</span> <span class="o">=</span> <span class="n">force</span>
<span class="linenos">507</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">508</span>
<span class="linenos">509</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">510</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to set force </span><span class="si">{</span><span class="n">force</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">511</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">512</span>
<span class="linenos">513</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">514</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop servo motion.&quot;&quot;&quot;</span>
<span class="linenos">515</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">516</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">target_velocity</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="linenos">517</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">is_moving</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">518</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stopped servo actuator </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">519</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">520</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">521</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to stop servo: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">522</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">523</span>
<span class="linenos">524</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">home</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">525</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Move servo to home position.&quot;&quot;&quot;</span>
<span class="linenos">526</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">527</span>            <span class="n">home_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;home_position&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="linenos">528</span>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_position</span><span class="p">(</span><span class="n">home_position</span><span class="p">)</span>
<span class="linenos">529</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">530</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to home servo: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">531</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">532</span>
<span class="linenos">533</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_position_control_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_position</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">max_velocity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">534</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Position control loop with PID controller.&quot;&quot;&quot;</span>
<span class="linenos">535</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">536</span>            <span class="k">if</span> <span class="n">max_velocity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">537</span>                <span class="n">max_velocity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">max_velocity</span> <span class="ow">or</span> <span class="mf">360.0</span>
<span class="linenos">538</span>
<span class="linenos">539</span>            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">is_moving</span><span class="p">:</span>
<span class="linenos">540</span>                <span class="n">current_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span>
<span class="linenos">541</span>                <span class="n">error</span> <span class="o">=</span> <span class="n">target_position</span> <span class="o">-</span> <span class="n">current_pos</span>
<span class="linenos">542</span>
<span class="linenos">543</span>                <span class="c1"># PID calculation</span>
<span class="linenos">544</span>                <span class="bp">self</span><span class="o">.</span><span class="n">_pid_error_sum</span> <span class="o">+=</span> <span class="n">error</span> <span class="o">*</span> <span class="mf">0.01</span>  <span class="c1"># Assuming 100Hz control loop</span>
<span class="linenos">545</span>                <span class="n">derivative</span> <span class="o">=</span> <span class="p">(</span><span class="n">error</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pid_last_error</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.01</span>
<span class="linenos">546</span>
<span class="linenos">547</span>                <span class="n">pid_output</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pid_gains</span><span class="p">[</span><span class="s1">&#39;kp&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">error</span> <span class="o">+</span>
<span class="linenos">548</span>                             <span class="bp">self</span><span class="o">.</span><span class="n">_pid_gains</span><span class="p">[</span><span class="s1">&#39;ki&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pid_error_sum</span> <span class="o">+</span>
<span class="linenos">549</span>                             <span class="bp">self</span><span class="o">.</span><span class="n">_pid_gains</span><span class="p">[</span><span class="s1">&#39;kd&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">derivative</span><span class="p">)</span>
<span class="linenos">550</span>
<span class="linenos">551</span>                <span class="c1"># Limit velocity</span>
<span class="linenos">552</span>                <span class="n">velocity</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">max_velocity</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_velocity</span><span class="p">,</span> <span class="n">pid_output</span><span class="p">))</span>
<span class="linenos">553</span>
<span class="linenos">554</span>                <span class="c1"># Update position (simplified integration)</span>
<span class="linenos">555</span>                <span class="n">new_position</span> <span class="o">=</span> <span class="n">current_pos</span> <span class="o">+</span> <span class="n">velocity</span> <span class="o">*</span> <span class="mf">0.01</span>
<span class="linenos">556</span>                <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="o">=</span> <span class="n">new_position</span>
<span class="linenos">557</span>                <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_velocity</span> <span class="o">=</span> <span class="n">velocity</span>
<span class="linenos">558</span>                <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">error</span>
<span class="linenos">559</span>
<span class="linenos">560</span>                <span class="c1"># Check if at target</span>
<span class="linenos">561</span>                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_position_tolerance</span><span class="p">:</span>
<span class="linenos">562</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">is_moving</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">563</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">at_target</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos">564</span>
<span class="linenos">565</span>                <span class="bp">self</span><span class="o">.</span><span class="n">_pid_last_error</span> <span class="o">=</span> <span class="n">error</span>
<span class="linenos">566</span>                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>  <span class="c1"># 100Hz control loop</span>
<span class="linenos">567</span>
<span class="linenos">568</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">569</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Position control loop error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">570</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">is_moving</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">571</span>
<span class="linenos">572</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_velocity_control_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_velocity</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">573</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Velocity control loop.&quot;&quot;&quot;</span>
<span class="linenos">574</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">575</span>            <span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="n">target_velocity</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>  <span class="c1"># Stop when velocity is near zero</span>
<span class="linenos">576</span>                <span class="c1"># Simple velocity control (in practice, use more sophisticated control)</span>
<span class="linenos">577</span>                <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_velocity</span> <span class="o">=</span> <span class="n">target_velocity</span>
<span class="linenos">578</span>
<span class="linenos">579</span>                <span class="c1"># Update position based on velocity</span>
<span class="linenos">580</span>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">581</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="o">+=</span> <span class="n">target_velocity</span> <span class="o">*</span> <span class="mf">0.01</span>
<span class="linenos">582</span>
<span class="linenos">583</span>                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>  <span class="c1"># 100Hz control loop</span>
<span class="linenos">584</span>
<span class="linenos">585</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">586</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Velocity control loop error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">587</span>
<span class="linenos">588</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_update_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">589</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update servo status.&quot;&quot;&quot;</span>
<span class="linenos">590</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="linenos">591</span>
<span class="linenos">592</span>        <span class="c1"># Simulate encoder feedback (in practice, read from actual encoder)</span>
<span class="linenos">593</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">594</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="linenos">595</span>
<span class="linenos">596</span>        <span class="c1"># Check if at target</span>
<span class="linenos">597</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">target_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">598</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">at_target</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_at_target</span><span class="p">()</span>
<span class="linenos">599</span>
<span class="linenos">600</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_add_servo_capabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">601</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add servo actuator capabilities.&quot;&quot;&quot;</span>
<span class="linenos">602</span>        <span class="bp">self</span><span class="o">.</span><span class="n">add_capability</span><span class="p">(</span><span class="n">DeviceCapability</span><span class="p">(</span>
<span class="linenos">603</span>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;position&quot;</span><span class="p">,</span>
<span class="linenos">604</span>            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Servo position&quot;</span><span class="p">,</span>
<span class="linenos">605</span>            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
<span class="linenos">606</span>            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">,</span>
<span class="linenos">607</span>            <span class="n">range_min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">min_position</span><span class="p">,</span>
<span class="linenos">608</span>            <span class="n">range_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">max_position</span><span class="p">,</span>
<span class="linenos">609</span>            <span class="n">read_only</span><span class="o">=</span><span class="kc">False</span>
<span class="linenos">610</span>        <span class="p">))</span>
<span class="linenos">611</span>
<span class="linenos">612</span>        <span class="bp">self</span><span class="o">.</span><span class="n">add_capability</span><span class="p">(</span><span class="n">DeviceCapability</span><span class="p">(</span>
<span class="linenos">613</span>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;velocity&quot;</span><span class="p">,</span>
<span class="linenos">614</span>            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Servo velocity&quot;</span><span class="p">,</span>
<span class="linenos">615</span>            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
<span class="linenos">616</span>            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg/s&quot;</span><span class="p">,</span>
<span class="linenos">617</span>            <span class="n">range_min</span><span class="o">=-</span><span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">max_velocity</span><span class="p">,</span>
<span class="linenos">618</span>            <span class="n">range_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">max_velocity</span><span class="p">,</span>
<span class="linenos">619</span>            <span class="n">read_only</span><span class="o">=</span><span class="kc">False</span>
<span class="linenos">620</span>        <span class="p">))</span>
<span class="linenos">621</span>
<span class="linenos">622</span>        <span class="bp">self</span><span class="o">.</span><span class="n">add_capability</span><span class="p">(</span><span class="n">DeviceCapability</span><span class="p">(</span>
<span class="linenos">623</span>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;force&quot;</span><span class="p">,</span>
<span class="linenos">624</span>            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Servo torque&quot;</span><span class="p">,</span>
<span class="linenos">625</span>            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
<span class="linenos">626</span>            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;Nm&quot;</span><span class="p">,</span>
<span class="linenos">627</span>            <span class="n">range_min</span><span class="o">=-</span><span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">max_force</span><span class="p">,</span>
<span class="linenos">628</span>            <span class="n">range_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">max_force</span><span class="p">,</span>
<span class="linenos">629</span>            <span class="n">read_only</span><span class="o">=</span><span class="kc">False</span>
<span class="linenos">630</span>        <span class="p">))</span>
<span class="linenos">631</span>
<span class="linenos">632</span>
<span class="linenos">633</span><span class="k">class</span><span class="w"> </span><span class="nc">StepperMotor</span><span class="p">(</span><span class="n">ActuatorInterface</span><span class="p">):</span>
<span class="linenos">634</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">635</span><span class="sd">    Stepper motor actuator implementation.</span>
<span class="linenos">636</span>
<span class="linenos">637</span><span class="sd">    Provides precise position control through step counting,</span>
<span class="linenos">638</span><span class="sd">    with configurable step size and acceleration profiles.</span>
<span class="linenos">639</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">640</span>
<span class="linenos">641</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">DeviceConfig</span><span class="p">):</span>
<span class="linenos">642</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize stepper motor.&quot;&quot;&quot;</span>
<span class="linenos">643</span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="linenos">644</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_actuator_type</span> <span class="o">=</span> <span class="n">ActuatorType</span><span class="o">.</span><span class="n">STEPPER</span>
<span class="linenos">645</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_steps_per_revolution</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;steps_per_revolution&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="linenos">646</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_microstep_resolution</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;microstep_resolution&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
<span class="linenos">647</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_step</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">648</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_target_step</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">649</span>
<span class="linenos">650</span>        <span class="c1"># Initialize stepper capabilities</span>
<span class="linenos">651</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_stepper_capabilities</span><span class="p">()</span>
<span class="linenos">652</span>
<span class="linenos">653</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">654</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize stepper motor.&quot;&quot;&quot;</span>
<span class="linenos">655</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initializing stepper motor </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">656</span>
<span class="linenos">657</span>        <span class="c1"># Initialize stepper driver (simulated)</span>
<span class="linenos">658</span>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
<span class="linenos">659</span>
<span class="linenos">660</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="linenos">661</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">662</span>
<span class="linenos">663</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">664</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Shutdown stepper motor.&quot;&quot;&quot;</span>
<span class="linenos">665</span>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
<span class="linenos">666</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">667</span>
<span class="linenos">668</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">read_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos">669</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read stepper motor data.&quot;&quot;&quot;</span>
<span class="linenos">670</span>        <span class="n">position_deg</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_step</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_steps_per_revolution</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_microstep_resolution</span><span class="p">))</span> <span class="o">*</span> <span class="mf">360.0</span>
<span class="linenos">671</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="o">=</span> <span class="n">position_deg</span>
<span class="linenos">672</span>
<span class="linenos">673</span>        <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;position&quot;</span><span class="p">:</span>
<span class="linenos">674</span>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position_deg</span><span class="p">}</span>
<span class="linenos">675</span>        <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;steps&quot;</span><span class="p">:</span>
<span class="linenos">676</span>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;steps&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_step</span><span class="p">}</span>
<span class="linenos">677</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">678</span>            <span class="k">return</span> <span class="p">{</span>
<span class="linenos">679</span>                <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position_deg</span><span class="p">,</span>
<span class="linenos">680</span>                <span class="s2">&quot;steps&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_step</span><span class="p">,</span>
<span class="linenos">681</span>                <span class="s2">&quot;target_steps&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_step</span><span class="p">,</span>
<span class="linenos">682</span>                <span class="s2">&quot;is_moving&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">is_moving</span>
<span class="linenos">683</span>            <span class="p">}</span>
<span class="linenos">684</span>
<span class="linenos">685</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">write_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">686</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write data to stepper motor.&quot;&quot;&quot;</span>
<span class="linenos">687</span>        <span class="k">if</span> <span class="s2">&quot;position&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
<span class="linenos">688</span>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_position</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">])</span>
<span class="linenos">689</span>        <span class="k">elif</span> <span class="s2">&quot;steps&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
<span class="linenos">690</span>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_step</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;steps&quot;</span><span class="p">])</span>
<span class="linenos">691</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">692</span>
<span class="linenos">693</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">self_test</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos">694</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform stepper motor self-test.&quot;&quot;&quot;</span>
<span class="linenos">695</span>        <span class="n">test_results</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">self_test</span><span class="p">()</span>
<span class="linenos">696</span>
<span class="linenos">697</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">698</span>            <span class="c1"># Test step movement</span>
<span class="linenos">699</span>            <span class="n">initial_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_step</span>
<span class="linenos">700</span>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_steps</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>  <span class="c1"># Move 100 steps</span>
<span class="linenos">701</span>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
<span class="linenos">702</span>
<span class="linenos">703</span>            <span class="n">step_error</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_step</span> <span class="o">-</span> <span class="p">(</span><span class="n">initial_step</span> <span class="o">+</span> <span class="mi">100</span><span class="p">))</span>
<span class="linenos">704</span>            <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;step_accuracy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">step_error</span> <span class="o">&lt;</span> <span class="mi">2</span>
<span class="linenos">705</span>
<span class="linenos">706</span>            <span class="c1"># Return to initial position</span>
<span class="linenos">707</span>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_step</span><span class="p">(</span><span class="n">initial_step</span><span class="p">)</span>
<span class="linenos">708</span>
<span class="linenos">709</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">710</span>            <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;stepper_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="linenos">711</span>            <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;overall_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;FAIL&#39;</span>
<span class="linenos">712</span>
<span class="linenos">713</span>        <span class="k">return</span> <span class="n">test_results</span>
<span class="linenos">714</span>
<span class="linenos">715</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">move_to_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">velocity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">716</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Move stepper to specific position.&quot;&quot;&quot;</span>
<span class="linenos">717</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">718</span>            <span class="c1"># Convert position to steps</span>
<span class="linenos">719</span>            <span class="n">target_step</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">position</span> <span class="o">/</span> <span class="mf">360.0</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_steps_per_revolution</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_microstep_resolution</span><span class="p">)</span>
<span class="linenos">720</span>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_step</span><span class="p">(</span><span class="n">target_step</span><span class="p">)</span>
<span class="linenos">721</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">722</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to move to position </span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">723</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">724</span>
<span class="linenos">725</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">move_to_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_step</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">726</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Move stepper to specific step.&quot;&quot;&quot;</span>
<span class="linenos">727</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">728</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_target_step</span> <span class="o">=</span> <span class="n">target_step</span>
<span class="linenos">729</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">is_moving</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos">730</span>
<span class="linenos">731</span>            <span class="c1"># Start stepping</span>
<span class="linenos">732</span>            <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_step_control_loop</span><span class="p">(</span><span class="n">target_step</span><span class="p">))</span>
<span class="linenos">733</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">734</span>
<span class="linenos">735</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">736</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to move to step </span><span class="si">{</span><span class="n">target_step</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">737</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">738</span>
<span class="linenos">739</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">move_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">740</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Move stepper by relative step count.&quot;&quot;&quot;</span>
<span class="linenos">741</span>        <span class="n">target_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_step</span> <span class="o">+</span> <span class="n">step_count</span>
<span class="linenos">742</span>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_step</span><span class="p">(</span><span class="n">target_step</span><span class="p">)</span>
<span class="linenos">743</span>
<span class="linenos">744</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">velocity</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">745</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set stepper velocity (not directly applicable).&quot;&quot;&quot;</span>
<span class="linenos">746</span>        <span class="c1"># Stepper motors use step rate rather than continuous velocity</span>
<span class="linenos">747</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Velocity control not directly applicable to stepper motors&quot;</span><span class="p">)</span>
<span class="linenos">748</span>        <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">749</span>
<span class="linenos">750</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">751</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set stepper force (holding torque).&quot;&quot;&quot;</span>
<span class="linenos">752</span>        <span class="c1"># Stepper motors have fixed holding torque</span>
<span class="linenos">753</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Force control not applicable to stepper motors&quot;</span><span class="p">)</span>
<span class="linenos">754</span>        <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">755</span>
<span class="linenos">756</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">757</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop stepper motion.&quot;&quot;&quot;</span>
<span class="linenos">758</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">is_moving</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">759</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">760</span>
<span class="linenos">761</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">home</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">762</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Home stepper motor.&quot;&quot;&quot;</span>
<span class="linenos">763</span>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_step</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">764</span>
<span class="linenos">765</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_step_control_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_step</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">766</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Step control loop.&quot;&quot;&quot;</span>
<span class="linenos">767</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">768</span>            <span class="n">step_direction</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">target_step</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_step</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
<span class="linenos">769</span>            <span class="n">step_rate</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># Steps per second</span>
<span class="linenos">770</span>
<span class="linenos">771</span>            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_step</span> <span class="o">!=</span> <span class="n">target_step</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">is_moving</span><span class="p">:</span>
<span class="linenos">772</span>                <span class="bp">self</span><span class="o">.</span><span class="n">_current_step</span> <span class="o">+=</span> <span class="n">step_direction</span>
<span class="linenos">773</span>                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">step_rate</span><span class="p">)</span>
<span class="linenos">774</span>
<span class="linenos">775</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">is_moving</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">776</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">at_target</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos">777</span>
<span class="linenos">778</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">779</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Step control loop error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">780</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">is_moving</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">781</span>
<span class="linenos">782</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_add_stepper_capabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">783</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add stepper motor capabilities.&quot;&quot;&quot;</span>
<span class="linenos">784</span>        <span class="n">max_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_steps_per_revolution</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_microstep_resolution</span> <span class="o">*</span> <span class="mi">10</span>  <span class="c1"># 10 revolutions</span>
<span class="linenos">785</span>
<span class="linenos">786</span>        <span class="bp">self</span><span class="o">.</span><span class="n">add_capability</span><span class="p">(</span><span class="n">DeviceCapability</span><span class="p">(</span>
<span class="linenos">787</span>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;position&quot;</span><span class="p">,</span>
<span class="linenos">788</span>            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Stepper position&quot;</span><span class="p">,</span>
<span class="linenos">789</span>            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
<span class="linenos">790</span>            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">,</span>
<span class="linenos">791</span>            <span class="n">range_min</span><span class="o">=-</span><span class="mf">3600.0</span><span class="p">,</span>  <span class="c1"># -10 revolutions</span>
<span class="linenos">792</span>            <span class="n">range_max</span><span class="o">=</span><span class="mf">3600.0</span><span class="p">,</span>   <span class="c1"># +10 revolutions</span>
<span class="linenos">793</span>            <span class="n">read_only</span><span class="o">=</span><span class="kc">False</span>
<span class="linenos">794</span>        <span class="p">))</span>
<span class="linenos">795</span>
<span class="linenos">796</span>        <span class="bp">self</span><span class="o">.</span><span class="n">add_capability</span><span class="p">(</span><span class="n">DeviceCapability</span><span class="p">(</span>
<span class="linenos">797</span>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;steps&quot;</span><span class="p">,</span>
<span class="linenos">798</span>            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Step count&quot;</span><span class="p">,</span>
<span class="linenos">799</span>            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">,</span>
<span class="linenos">800</span>            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;steps&quot;</span><span class="p">,</span>
<span class="linenos">801</span>            <span class="n">range_min</span><span class="o">=-</span><span class="n">max_steps</span><span class="p">,</span>
<span class="linenos">802</span>            <span class="n">range_max</span><span class="o">=</span><span class="n">max_steps</span><span class="p">,</span>
<span class="linenos">803</span>            <span class="n">read_only</span><span class="o">=</span><span class="kc">False</span>
<span class="linenos">804</span>        <span class="p">))</span>
<span class="linenos">805</span>
<span class="linenos">806</span>
<span class="linenos">807</span><span class="k">class</span><span class="w"> </span><span class="nc">PneumaticActuator</span><span class="p">(</span><span class="n">ActuatorInterface</span><span class="p">):</span>
<span class="linenos">808</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">809</span><span class="sd">    Pneumatic actuator implementation.</span>
<span class="linenos">810</span>
<span class="linenos">811</span><span class="sd">    Provides pressure-based control for linear and rotary</span>
<span class="linenos">812</span><span class="sd">    pneumatic actuators with pressure feedback.</span>
<span class="linenos">813</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">814</span>
<span class="linenos">815</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">DeviceConfig</span><span class="p">):</span>
<span class="linenos">816</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize pneumatic actuator.&quot;&quot;&quot;</span>
<span class="linenos">817</span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="linenos">818</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_actuator_type</span> <span class="o">=</span> <span class="n">ActuatorType</span><span class="o">.</span><span class="n">PNEUMATIC</span>
<span class="linenos">819</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_max_pressure</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_pressure&#39;</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">)</span>  <span class="c1"># bar</span>
<span class="linenos">820</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_cylinder_diameter</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cylinder_diameter&#39;</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">)</span>  <span class="c1"># mm</span>
<span class="linenos">821</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_stroke_length</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stroke_length&#39;</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">)</span>  <span class="c1"># mm</span>
<span class="linenos">822</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_pressure</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="linenos">823</span>
<span class="linenos">824</span>        <span class="c1"># Initialize pneumatic capabilities</span>
<span class="linenos">825</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pneumatic_capabilities</span><span class="p">()</span>
<span class="linenos">826</span>
<span class="linenos">827</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">828</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize pneumatic actuator.&quot;&quot;&quot;</span>
<span class="linenos">829</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initializing pneumatic actuator </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">830</span>
<span class="linenos">831</span>        <span class="c1"># Initialize pneumatic valves and pressure sensors (simulated)</span>
<span class="linenos">832</span>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
<span class="linenos">833</span>
<span class="linenos">834</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="linenos">835</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">836</span>
<span class="linenos">837</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">838</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Shutdown pneumatic actuator.&quot;&quot;&quot;</span>
<span class="linenos">839</span>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_pressure</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>  <span class="c1"># Release pressure</span>
<span class="linenos">840</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">841</span>
<span class="linenos">842</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">read_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos">843</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read pneumatic actuator data.&quot;&quot;&quot;</span>
<span class="linenos">844</span>        <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;position&quot;</span><span class="p">:</span>
<span class="linenos">845</span>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span><span class="p">}</span>
<span class="linenos">846</span>        <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;pressure&quot;</span><span class="p">:</span>
<span class="linenos">847</span>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;pressure&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_pressure</span><span class="p">}</span>
<span class="linenos">848</span>        <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;force&quot;</span><span class="p">:</span>
<span class="linenos">849</span>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;force&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_force</span><span class="p">}</span>
<span class="linenos">850</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">851</span>            <span class="k">return</span> <span class="p">{</span>
<span class="linenos">852</span>                <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span><span class="p">,</span>
<span class="linenos">853</span>                <span class="s2">&quot;pressure&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_pressure</span><span class="p">,</span>
<span class="linenos">854</span>                <span class="s2">&quot;force&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_force</span><span class="p">,</span>
<span class="linenos">855</span>                <span class="s2">&quot;is_moving&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">is_moving</span>
<span class="linenos">856</span>            <span class="p">}</span>
<span class="linenos">857</span>
<span class="linenos">858</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">write_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">859</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write data to pneumatic actuator.&quot;&quot;&quot;</span>
<span class="linenos">860</span>        <span class="k">if</span> <span class="s2">&quot;pressure&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
<span class="linenos">861</span>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_pressure</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;pressure&quot;</span><span class="p">])</span>
<span class="linenos">862</span>        <span class="k">elif</span> <span class="s2">&quot;position&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
<span class="linenos">863</span>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_position</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">])</span>
<span class="linenos">864</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">865</span>
<span class="linenos">866</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">self_test</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos">867</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform pneumatic actuator self-test.&quot;&quot;&quot;</span>
<span class="linenos">868</span>        <span class="n">test_results</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">self_test</span><span class="p">()</span>
<span class="linenos">869</span>
<span class="linenos">870</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">871</span>            <span class="c1"># Test pressure control</span>
<span class="linenos">872</span>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_pressure</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>  <span class="c1"># 2 bar</span>
<span class="linenos">873</span>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="linenos">874</span>            <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;pressure_control&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_pressure</span> <span class="o">-</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.2</span>
<span class="linenos">875</span>
<span class="linenos">876</span>            <span class="c1"># Test position control</span>
<span class="linenos">877</span>            <span class="n">initial_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span>
<span class="linenos">878</span>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_position</span><span class="p">(</span><span class="mf">50.0</span><span class="p">)</span>  <span class="c1"># Move to middle</span>
<span class="linenos">879</span>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
<span class="linenos">880</span>            <span class="n">position_error</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="o">-</span> <span class="mf">50.0</span><span class="p">)</span>
<span class="linenos">881</span>            <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;position_control&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">position_error</span> <span class="o">&lt;</span> <span class="mf">5.0</span>
<span class="linenos">882</span>
<span class="linenos">883</span>            <span class="c1"># Return to initial state</span>
<span class="linenos">884</span>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_position</span><span class="p">(</span><span class="n">initial_position</span><span class="p">)</span>
<span class="linenos">885</span>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_pressure</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
<span class="linenos">886</span>
<span class="linenos">887</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">888</span>            <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;pneumatic_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="linenos">889</span>            <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;overall_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;FAIL&#39;</span>
<span class="linenos">890</span>
<span class="linenos">891</span>        <span class="k">return</span> <span class="n">test_results</span>
<span class="linenos">892</span>
<span class="linenos">893</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">move_to_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">velocity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">894</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Move pneumatic actuator to position.&quot;&quot;&quot;</span>
<span class="linenos">895</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">896</span>            <span class="c1"># Calculate required pressure for position</span>
<span class="linenos">897</span>            <span class="n">pressure_ratio</span> <span class="o">=</span> <span class="n">position</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stroke_length</span>
<span class="linenos">898</span>            <span class="n">required_pressure</span> <span class="o">=</span> <span class="n">pressure_ratio</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_pressure</span>
<span class="linenos">899</span>
<span class="linenos">900</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">target_position</span> <span class="o">=</span> <span class="n">position</span>
<span class="linenos">901</span>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_pressure</span><span class="p">(</span><span class="n">required_pressure</span><span class="p">)</span>
<span class="linenos">902</span>
<span class="linenos">903</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">904</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to move to position </span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">905</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">906</span>
<span class="linenos">907</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pressure</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">908</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set pneumatic pressure.&quot;&quot;&quot;</span>
<span class="linenos">909</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">910</span>            <span class="k">if</span> <span class="n">pressure</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_pressure</span><span class="p">:</span>
<span class="linenos">911</span>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pressure </span><span class="si">{</span><span class="n">pressure</span><span class="si">}</span><span class="s2"> exceeds maximum </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_pressure</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">912</span>                <span class="n">pressure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_pressure</span>
<span class="linenos">913</span>
<span class="linenos">914</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_pressure</span> <span class="o">=</span> <span class="n">pressure</span>
<span class="linenos">915</span>
<span class="linenos">916</span>            <span class="c1"># Calculate position based on pressure</span>
<span class="linenos">917</span>            <span class="n">position_ratio</span> <span class="o">=</span> <span class="n">pressure</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_pressure</span>
<span class="linenos">918</span>            <span class="n">new_position</span> <span class="o">=</span> <span class="n">position_ratio</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stroke_length</span>
<span class="linenos">919</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="o">=</span> <span class="n">new_position</span>
<span class="linenos">920</span>
<span class="linenos">921</span>            <span class="c1"># Calculate force</span>
<span class="linenos">922</span>            <span class="n">cylinder_area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cylinder_diameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>  <span class="c1"># mm²</span>
<span class="linenos">923</span>            <span class="n">force</span> <span class="o">=</span> <span class="n">pressure</span> <span class="o">*</span> <span class="mi">100000</span> <span class="o">*</span> <span class="p">(</span><span class="n">cylinder_area</span> <span class="o">/</span> <span class="mi">1000000</span><span class="p">)</span>  <span class="c1"># Convert to Newtons</span>
<span class="linenos">924</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_force</span> <span class="o">=</span> <span class="n">force</span>
<span class="linenos">925</span>
<span class="linenos">926</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">927</span>
<span class="linenos">928</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">929</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to set pressure </span><span class="si">{</span><span class="n">pressure</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">930</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">931</span>
<span class="linenos">932</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">velocity</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">933</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set pneumatic velocity (flow rate control).&quot;&quot;&quot;</span>
<span class="linenos">934</span>        <span class="c1"># Pneumatic velocity control typically done through flow restrictors</span>
<span class="linenos">935</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Velocity control requires flow rate control valves&quot;</span><span class="p">)</span>
<span class="linenos">936</span>        <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">937</span>
<span class="linenos">938</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">939</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set pneumatic force.&quot;&quot;&quot;</span>
<span class="linenos">940</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">941</span>            <span class="c1"># Calculate required pressure for force</span>
<span class="linenos">942</span>            <span class="n">cylinder_area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cylinder_diameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>  <span class="c1"># mm²</span>
<span class="linenos">943</span>            <span class="n">required_pressure</span> <span class="o">=</span> <span class="n">force</span> <span class="o">/</span> <span class="p">(</span><span class="mi">100000</span> <span class="o">*</span> <span class="p">(</span><span class="n">cylinder_area</span> <span class="o">/</span> <span class="mi">1000000</span><span class="p">))</span>  <span class="c1"># bar</span>
<span class="linenos">944</span>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_pressure</span><span class="p">(</span><span class="n">required_pressure</span><span class="p">)</span>
<span class="linenos">945</span>
<span class="linenos">946</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">947</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to set force </span><span class="si">{</span><span class="n">force</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">948</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">949</span>
<span class="linenos">950</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">951</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop pneumatic motion.&quot;&quot;&quot;</span>
<span class="linenos">952</span>        <span class="c1"># For pneumatic actuators, &quot;stop&quot; typically means hold current position</span>
<span class="linenos">953</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">954</span>
<span class="linenos">955</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">home</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">956</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Move pneumatic actuator to home position.&quot;&quot;&quot;</span>
<span class="linenos">957</span>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_position</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
<span class="linenos">958</span>
<span class="linenos">959</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_add_pneumatic_capabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">960</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add pneumatic actuator capabilities.&quot;&quot;&quot;</span>
<span class="linenos">961</span>        <span class="bp">self</span><span class="o">.</span><span class="n">add_capability</span><span class="p">(</span><span class="n">DeviceCapability</span><span class="p">(</span>
<span class="linenos">962</span>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;position&quot;</span><span class="p">,</span>
<span class="linenos">963</span>            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Pneumatic actuator position&quot;</span><span class="p">,</span>
<span class="linenos">964</span>            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
<span class="linenos">965</span>            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;mm&quot;</span><span class="p">,</span>
<span class="linenos">966</span>            <span class="n">range_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<span class="linenos">967</span>            <span class="n">range_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_stroke_length</span><span class="p">,</span>
<span class="linenos">968</span>            <span class="n">read_only</span><span class="o">=</span><span class="kc">False</span>
<span class="linenos">969</span>        <span class="p">))</span>
<span class="linenos">970</span>
<span class="linenos">971</span>        <span class="bp">self</span><span class="o">.</span><span class="n">add_capability</span><span class="p">(</span><span class="n">DeviceCapability</span><span class="p">(</span>
<span class="linenos">972</span>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pressure&quot;</span><span class="p">,</span>
<span class="linenos">973</span>            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Pneumatic pressure&quot;</span><span class="p">,</span>
<span class="linenos">974</span>            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
<span class="linenos">975</span>            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span>
<span class="linenos">976</span>            <span class="n">range_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<span class="linenos">977</span>            <span class="n">range_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_pressure</span><span class="p">,</span>
<span class="linenos">978</span>            <span class="n">read_only</span><span class="o">=</span><span class="kc">False</span>
<span class="linenos">979</span>        <span class="p">))</span>
<span class="linenos">980</span>
<span class="linenos">981</span>        <span class="c1"># Calculate maximum force</span>
<span class="linenos">982</span>        <span class="n">cylinder_area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cylinder_diameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>  <span class="c1"># mm²</span>
<span class="linenos">983</span>        <span class="n">max_force</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_pressure</span> <span class="o">*</span> <span class="mi">100000</span> <span class="o">*</span> <span class="p">(</span><span class="n">cylinder_area</span> <span class="o">/</span> <span class="mi">1000000</span><span class="p">)</span>  <span class="c1"># Newtons</span>
<span class="linenos">984</span>
<span class="linenos">985</span>        <span class="bp">self</span><span class="o">.</span><span class="n">add_capability</span><span class="p">(</span><span class="n">DeviceCapability</span><span class="p">(</span>
<span class="linenos">986</span>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;force&quot;</span><span class="p">,</span>
<span class="linenos">987</span>            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Pneumatic force&quot;</span><span class="p">,</span>
<span class="linenos">988</span>            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
<span class="linenos">989</span>            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;N&quot;</span><span class="p">,</span>
<span class="linenos">990</span>            <span class="n">range_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<span class="linenos">991</span>            <span class="n">range_max</span><span class="o">=</span><span class="n">max_force</span><span class="p">,</span>
<span class="linenos">992</span>            <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span>
<span class="linenos">993</span>        <span class="p">))</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="classes">
<h2>Classes<a class="headerlink" href="#classes" title="Link to this heading">¶</a></h2>
<section id="actuatortype">
<h3><code class="docutils literal notranslate"><span class="pre">ActuatorType</span></code><a class="headerlink" href="#actuatortype" title="Link to this heading">¶</a></h3>
<p><strong>Inherits from:</strong> <code class="docutils literal notranslate"><span class="pre">Enum</span></code></p>
<p>Actuator type enumeration.</p>
<section id="source-code">
<h4>Source Code<a class="headerlink" href="#source-code" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">class</span><span class="w"> </span><span class="nc">ActuatorType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="linenos"> 2</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Actuator type enumeration.&quot;&quot;&quot;</span>
<span class="linenos"> 3</span>    <span class="n">SERVO</span> <span class="o">=</span> <span class="s2">&quot;servo&quot;</span>
<span class="linenos"> 4</span>    <span class="n">STEPPER</span> <span class="o">=</span> <span class="s2">&quot;stepper&quot;</span>
<span class="linenos"> 5</span>    <span class="n">DC_MOTOR</span> <span class="o">=</span> <span class="s2">&quot;dc_motor&quot;</span>
<span class="linenos"> 6</span>    <span class="n">PNEUMATIC</span> <span class="o">=</span> <span class="s2">&quot;pneumatic&quot;</span>
<span class="linenos"> 7</span>    <span class="n">HYDRAULIC</span> <span class="o">=</span> <span class="s2">&quot;hydraulic&quot;</span>
<span class="linenos"> 8</span>    <span class="n">LINEAR</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span>
<span class="linenos"> 9</span>    <span class="n">ROTARY</span> <span class="o">=</span> <span class="s2">&quot;rotary&quot;</span>
<span class="linenos">10</span>    <span class="n">VALVE</span> <span class="o">=</span> <span class="s2">&quot;valve&quot;</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="actuatormode">
<h3><code class="docutils literal notranslate"><span class="pre">ActuatorMode</span></code><a class="headerlink" href="#actuatormode" title="Link to this heading">¶</a></h3>
<p><strong>Inherits from:</strong> <code class="docutils literal notranslate"><span class="pre">Enum</span></code></p>
<p>Actuator control mode enumeration.</p>
<section id="id1">
<h4>Source Code<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">class</span><span class="w"> </span><span class="nc">ActuatorMode</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="linenos">2</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Actuator control mode enumeration.&quot;&quot;&quot;</span>
<span class="linenos">3</span>    <span class="n">POSITION</span> <span class="o">=</span> <span class="s2">&quot;position&quot;</span>
<span class="linenos">4</span>    <span class="n">VELOCITY</span> <span class="o">=</span> <span class="s2">&quot;velocity&quot;</span>
<span class="linenos">5</span>    <span class="n">TORQUE</span> <span class="o">=</span> <span class="s2">&quot;torque&quot;</span>
<span class="linenos">6</span>    <span class="n">FORCE</span> <span class="o">=</span> <span class="s2">&quot;force&quot;</span>
<span class="linenos">7</span>    <span class="n">PRESSURE</span> <span class="o">=</span> <span class="s2">&quot;pressure&quot;</span>
<span class="linenos">8</span>    <span class="n">OPEN_LOOP</span> <span class="o">=</span> <span class="s2">&quot;open_loop&quot;</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="actuatorcommand">
<h3><code class="docutils literal notranslate"><span class="pre">ActuatorCommand</span></code><a class="headerlink" href="#actuatorcommand" title="Link to this heading">¶</a></h3>
<p>Actuator command data structure.</p>
<section id="id2">
<h4>Source Code<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nd">@dataclass</span>
<span class="linenos"> 2</span><span class="k">class</span><span class="w"> </span><span class="nc">ActuatorCommand</span><span class="p">:</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Actuator command data structure.&quot;&quot;&quot;</span>
<span class="linenos"> 4</span>    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">float</span>
<span class="linenos"> 5</span>    <span class="n">actuator_id</span><span class="p">:</span> <span class="nb">str</span>
<span class="linenos"> 6</span>    <span class="n">command_type</span><span class="p">:</span> <span class="n">ActuatorMode</span>
<span class="linenos"> 7</span>    <span class="n">target_value</span><span class="p">:</span> <span class="nb">float</span>
<span class="linenos"> 8</span>    <span class="n">unit</span><span class="p">:</span> <span class="nb">str</span>
<span class="linenos"> 9</span>    <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">10</span>    <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos">11</span>    <span class="n">safety_checks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="actuatorstatus">
<h3><code class="docutils literal notranslate"><span class="pre">ActuatorStatus</span></code><a class="headerlink" href="#actuatorstatus" title="Link to this heading">¶</a></h3>
<p>Actuator status data structure.</p>
<section id="id3">
<h4>Source Code<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nd">@dataclass</span>
<span class="linenos"> 2</span><span class="k">class</span><span class="w"> </span><span class="nc">ActuatorStatus</span><span class="p">:</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Actuator status data structure.&quot;&quot;&quot;</span>
<span class="linenos"> 4</span>    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">float</span>
<span class="linenos"> 5</span>    <span class="n">actuator_id</span><span class="p">:</span> <span class="nb">str</span>
<span class="linenos"> 6</span>    <span class="n">current_position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 7</span>    <span class="n">current_velocity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 8</span>    <span class="n">current_force</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 9</span>    <span class="n">target_position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos">10</span>    <span class="n">target_velocity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos">11</span>    <span class="n">target_force</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos">12</span>    <span class="n">error</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos">13</span>    <span class="n">is_moving</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">14</span>    <span class="n">at_target</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">15</span>    <span class="n">fault_status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="actuatorlimits">
<h3><code class="docutils literal notranslate"><span class="pre">ActuatorLimits</span></code><a class="headerlink" href="#actuatorlimits" title="Link to this heading">¶</a></h3>
<p>Actuator operational limits.</p>
<section id="id4">
<h4>Source Code<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nd">@dataclass</span>
<span class="linenos"> 2</span><span class="k">class</span><span class="w"> </span><span class="nc">ActuatorLimits</span><span class="p">:</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Actuator operational limits.&quot;&quot;&quot;</span>
<span class="linenos"> 4</span>    <span class="n">min_position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 5</span>    <span class="n">max_position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 6</span>    <span class="n">max_velocity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 7</span>    <span class="n">max_acceleration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 8</span>    <span class="n">max_force</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos"> 9</span>    <span class="n">max_current</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos">10</span>    <span class="n">emergency_stop_enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="actuatorinterface">
<h3><code class="docutils literal notranslate"><span class="pre">ActuatorInterface</span></code><a class="headerlink" href="#actuatorinterface" title="Link to this heading">¶</a></h3>
<p><strong>Inherits from:</strong> <code class="docutils literal notranslate"><span class="pre">DeviceDriver</span></code>, <code class="docutils literal notranslate"><span class="pre">ABC</span></code></p>
<p>Abstract base class for actuator interfaces.</p>
<p>This class defines the standard interface for all actuator types,
providing common functionality for motion control, safety limits,
and position feedback.</p>
<section id="id5">
<h4>Source Code<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="k">class</span><span class="w"> </span><span class="nc">ActuatorInterface</span><span class="p">(</span><span class="n">DeviceDriver</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<span class="linenos">  2</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  3</span><span class="sd">    Abstract base class for actuator interfaces.</span>
<span class="linenos">  4</span>
<span class="linenos">  5</span><span class="sd">    This class defines the standard interface for all actuator types,</span>
<span class="linenos">  6</span><span class="sd">    providing common functionality for motion control, safety limits,</span>
<span class="linenos">  7</span><span class="sd">    and position feedback.</span>
<span class="linenos">  8</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">  9</span>
<span class="linenos"> 10</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">DeviceConfig</span><span class="p">):</span>
<span class="linenos"> 11</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize actuator interface.&quot;&quot;&quot;</span>
<span class="linenos"> 12</span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="linenos"> 13</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_actuator_type</span> <span class="o">=</span> <span class="n">ActuatorType</span><span class="o">.</span><span class="n">SERVO</span>
<span class="linenos"> 14</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_control_mode</span> <span class="o">=</span> <span class="n">ActuatorMode</span><span class="o">.</span><span class="n">POSITION</span>
<span class="linenos"> 15</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_limits</span> <span class="o">=</span> <span class="n">ActuatorLimits</span><span class="p">()</span>
<span class="linenos"> 16</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span> <span class="o">=</span> <span class="n">ActuatorStatus</span><span class="p">(</span>
<span class="linenos"> 17</span>            <span class="n">timestamp</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
<span class="linenos"> 18</span>            <span class="n">actuator_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span>
<span class="linenos"> 19</span>        <span class="p">)</span>
<span class="linenos"> 20</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_command_queue</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ActuatorCommand</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 21</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_max_queue_size</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_queue_size&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="linenos"> 22</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_position_tolerance</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;position_tolerance&#39;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
<span class="linenos"> 23</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_safety_enabled</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;safety_enabled&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 24</span>
<span class="linenos"> 25</span>    <span class="nd">@property</span>
<span class="linenos"> 26</span>    <span class="k">def</span><span class="w"> </span><span class="nf">actuator_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ActuatorType</span><span class="p">:</span>
<span class="linenos"> 27</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get actuator type.&quot;&quot;&quot;</span>
<span class="linenos"> 28</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actuator_type</span>
<span class="linenos"> 29</span>
<span class="linenos"> 30</span>    <span class="nd">@property</span>
<span class="linenos"> 31</span>    <span class="k">def</span><span class="w"> </span><span class="nf">control_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ActuatorMode</span><span class="p">:</span>
<span class="linenos"> 32</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get current control mode.&quot;&quot;&quot;</span>
<span class="linenos"> 33</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_control_mode</span>
<span class="linenos"> 34</span>
<span class="linenos"> 35</span>    <span class="nd">@property</span>
<span class="linenos"> 36</span>    <span class="k">def</span><span class="w"> </span><span class="nf">current_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ActuatorStatus</span><span class="p">:</span>
<span class="linenos"> 37</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get current actuator status.&quot;&quot;&quot;</span>
<span class="linenos"> 38</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span>
<span class="linenos"> 39</span>
<span class="linenos"> 40</span>    <span class="nd">@property</span>
<span class="linenos"> 41</span>    <span class="k">def</span><span class="w"> </span><span class="nf">limits</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ActuatorLimits</span><span class="p">:</span>
<span class="linenos"> 42</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get actuator limits.&quot;&quot;&quot;</span>
<span class="linenos"> 43</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limits</span>
<span class="linenos"> 44</span>
<span class="linenos"> 45</span>    <span class="nd">@abstractmethod</span>
<span class="linenos"> 46</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">move_to_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">velocity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 47</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 48</span><span class="sd">        Move actuator to specific position.</span>
<span class="linenos"> 49</span>
<span class="linenos"> 50</span><span class="sd">        Parameters</span>
<span class="linenos"> 51</span><span class="sd">        ----------</span>
<span class="linenos"> 52</span><span class="sd">        position : float</span>
<span class="linenos"> 53</span><span class="sd">            Target position</span>
<span class="linenos"> 54</span><span class="sd">        velocity : float, optional</span>
<span class="linenos"> 55</span><span class="sd">            Movement velocity</span>
<span class="linenos"> 56</span>
<span class="linenos"> 57</span><span class="sd">        Returns</span>
<span class="linenos"> 58</span><span class="sd">        -------</span>
<span class="linenos"> 59</span><span class="sd">        bool</span>
<span class="linenos"> 60</span><span class="sd">            True if command accepted, False otherwise</span>
<span class="linenos"> 61</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 62</span>        <span class="k">pass</span>
<span class="linenos"> 63</span>
<span class="linenos"> 64</span>    <span class="nd">@abstractmethod</span>
<span class="linenos"> 65</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">velocity</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 66</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 67</span><span class="sd">        Set actuator velocity.</span>
<span class="linenos"> 68</span>
<span class="linenos"> 69</span><span class="sd">        Parameters</span>
<span class="linenos"> 70</span><span class="sd">        ----------</span>
<span class="linenos"> 71</span><span class="sd">        velocity : float</span>
<span class="linenos"> 72</span><span class="sd">            Target velocity</span>
<span class="linenos"> 73</span>
<span class="linenos"> 74</span><span class="sd">        Returns</span>
<span class="linenos"> 75</span><span class="sd">        -------</span>
<span class="linenos"> 76</span><span class="sd">        bool</span>
<span class="linenos"> 77</span><span class="sd">            True if command accepted, False otherwise</span>
<span class="linenos"> 78</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 79</span>        <span class="k">pass</span>
<span class="linenos"> 80</span>
<span class="linenos"> 81</span>    <span class="nd">@abstractmethod</span>
<span class="linenos"> 82</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 83</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 84</span><span class="sd">        Set actuator force/torque.</span>
<span class="linenos"> 85</span>
<span class="linenos"> 86</span><span class="sd">        Parameters</span>
<span class="linenos"> 87</span><span class="sd">        ----------</span>
<span class="linenos"> 88</span><span class="sd">        force : float</span>
<span class="linenos"> 89</span><span class="sd">            Target force or torque</span>
<span class="linenos"> 90</span>
<span class="linenos"> 91</span><span class="sd">        Returns</span>
<span class="linenos"> 92</span><span class="sd">        -------</span>
<span class="linenos"> 93</span><span class="sd">        bool</span>
<span class="linenos"> 94</span><span class="sd">            True if command accepted, False otherwise</span>
<span class="linenos"> 95</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos"> 96</span>        <span class="k">pass</span>
<span class="linenos"> 97</span>
<span class="linenos"> 98</span>    <span class="nd">@abstractmethod</span>
<span class="linenos"> 99</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">100</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">101</span><span class="sd">        Stop actuator motion.</span>
<span class="linenos">102</span>
<span class="linenos">103</span><span class="sd">        Returns</span>
<span class="linenos">104</span><span class="sd">        -------</span>
<span class="linenos">105</span><span class="sd">        bool</span>
<span class="linenos">106</span><span class="sd">            True if stop successful, False otherwise</span>
<span class="linenos">107</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">108</span>        <span class="k">pass</span>
<span class="linenos">109</span>
<span class="linenos">110</span>    <span class="nd">@abstractmethod</span>
<span class="linenos">111</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">home</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">112</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">113</span><span class="sd">        Move actuator to home position.</span>
<span class="linenos">114</span>
<span class="linenos">115</span><span class="sd">        Returns</span>
<span class="linenos">116</span><span class="sd">        -------</span>
<span class="linenos">117</span><span class="sd">        bool</span>
<span class="linenos">118</span><span class="sd">            True if homing successful, False otherwise</span>
<span class="linenos">119</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">120</span>        <span class="k">pass</span>
<span class="linenos">121</span>
<span class="linenos">122</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_control_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="n">ActuatorMode</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">123</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set actuator control mode.&quot;&quot;&quot;</span>
<span class="linenos">124</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">125</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_control_mode</span> <span class="o">=</span> <span class="n">mode</span>
<span class="linenos">126</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Set control mode to </span><span class="si">{</span><span class="n">mode</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> for actuator </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">127</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">128</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">129</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to set control mode: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">130</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">131</span>
<span class="linenos">132</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limits</span><span class="p">:</span> <span class="n">ActuatorLimits</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">133</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set actuator operational limits.&quot;&quot;&quot;</span>
<span class="linenos">134</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">135</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_limits</span> <span class="o">=</span> <span class="n">limits</span>
<span class="linenos">136</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated limits for actuator </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">137</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">138</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">139</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to set limits: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">140</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">141</span>
<span class="linenos">142</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">is_at_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tolerance</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">143</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if actuator is at target position.&quot;&quot;&quot;</span>
<span class="linenos">144</span>        <span class="k">if</span> <span class="n">tolerance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">145</span>            <span class="n">tolerance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_position_tolerance</span>
<span class="linenos">146</span>
<span class="linenos">147</span>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span>
<span class="linenos">148</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">target_position</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
<span class="linenos">149</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">150</span>
<span class="linenos">151</span>        <span class="n">error</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">target_position</span><span class="p">)</span>
<span class="linenos">152</span>        <span class="k">return</span> <span class="n">error</span> <span class="o">&lt;=</span> <span class="n">tolerance</span>
<span class="linenos">153</span>
<span class="linenos">154</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">wait_for_motion_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">155</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Wait for actuator to reach target position.&quot;&quot;&quot;</span>
<span class="linenos">156</span>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="linenos">157</span>
<span class="linenos">158</span>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">159</span>            <span class="k">if</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_at_target</span><span class="p">():</span>
<span class="linenos">160</span>                <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">161</span>
<span class="linenos">162</span>            <span class="k">if</span> <span class="n">timeout</span> <span class="ow">and</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
<span class="linenos">163</span>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Motion timeout for actuator </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">164</span>                <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">165</span>
<span class="linenos">166</span>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>  <span class="c1"># 10ms polling</span>
<span class="linenos">167</span>
<span class="linenos">168</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">emergency_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">169</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform emergency stop.&quot;&quot;&quot;</span>
<span class="linenos">170</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">171</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Emergency stop triggered for actuator </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">172</span>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
<span class="linenos">173</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">fault_status</span> <span class="o">=</span> <span class="s2">&quot;emergency_stop&quot;</span>
<span class="linenos">174</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">175</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">176</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Emergency stop failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">177</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">178</span>
<span class="linenos">179</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">clear_faults</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">180</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear actuator fault conditions.&quot;&quot;&quot;</span>
<span class="linenos">181</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">182</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">fault_status</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos">183</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cleared faults for actuator </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">184</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">185</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">186</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to clear faults: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">187</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">188</span>
<span class="linenos">189</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_safety_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">ActuatorCommand</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">190</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if command violates safety limits.&quot;&quot;&quot;</span>
<span class="linenos">191</span>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safety_enabled</span><span class="p">:</span>
<span class="linenos">192</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">193</span>
<span class="linenos">194</span>        <span class="k">if</span> <span class="n">command</span><span class="o">.</span><span class="n">command_type</span> <span class="o">==</span> <span class="n">ActuatorMode</span><span class="o">.</span><span class="n">POSITION</span><span class="p">:</span>
<span class="linenos">195</span>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">min_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
<span class="linenos">196</span>                <span class="n">command</span><span class="o">.</span><span class="n">target_value</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">min_position</span><span class="p">):</span>
<span class="linenos">197</span>                <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">198</span>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">max_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
<span class="linenos">199</span>                <span class="n">command</span><span class="o">.</span><span class="n">target_value</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">max_position</span><span class="p">):</span>
<span class="linenos">200</span>                <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">201</span>
<span class="linenos">202</span>        <span class="k">elif</span> <span class="n">command</span><span class="o">.</span><span class="n">command_type</span> <span class="o">==</span> <span class="n">ActuatorMode</span><span class="o">.</span><span class="n">VELOCITY</span><span class="p">:</span>
<span class="linenos">203</span>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">max_velocity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
<span class="linenos">204</span>                <span class="nb">abs</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">target_value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">max_velocity</span><span class="p">):</span>
<span class="linenos">205</span>                <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">206</span>
<span class="linenos">207</span>        <span class="k">elif</span> <span class="n">command</span><span class="o">.</span><span class="n">command_type</span> <span class="o">==</span> <span class="n">ActuatorMode</span><span class="o">.</span><span class="n">FORCE</span><span class="p">:</span>
<span class="linenos">208</span>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">max_force</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
<span class="linenos">209</span>                <span class="nb">abs</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">target_value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">max_force</span><span class="p">):</span>
<span class="linenos">210</span>                <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">211</span>
<span class="linenos">212</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">213</span>
<span class="linenos">214</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_add_command_to_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">ActuatorCommand</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">215</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add command to execution queue.&quot;&quot;&quot;</span>
<span class="linenos">216</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">command</span><span class="o">.</span><span class="n">safety_checks</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_safety_limits</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
<span class="linenos">217</span>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_queue</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_queue_size</span><span class="p">:</span>
<span class="linenos">218</span>                <span class="bp">self</span><span class="o">.</span><span class="n">_command_queue</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Remove oldest command</span>
<span class="linenos">219</span>
<span class="linenos">220</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_command_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<span class="linenos">221</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">222</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">223</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Command rejected due to safety limits: </span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">224</span>            <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
</section>
<section id="methods-18">
<h4>Methods (18)<a class="headerlink" href="#methods-18" title="Link to this heading">¶</a></h4>
<section id="init-self-config">
<h5><code class="docutils literal notranslate"><span class="pre">__init__(self,</span> <span class="pre">config)</span></code><a class="headerlink" href="#init-self-config" title="Link to this heading">¶</a></h5>
<p>Initialize actuator interface.</p>
<p><a class="reference internal" href="#method-actuatorinterface-__init__"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="actuator-type-self">
<h5><code class="docutils literal notranslate"><span class="pre">actuator_type(self)</span></code><a class="headerlink" href="#actuator-type-self" title="Link to this heading">¶</a></h5>
<p>Get actuator type.</p>
<p><a class="reference internal" href="#method-actuatorinterface-actuator_type"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="control-mode-self">
<h5><code class="docutils literal notranslate"><span class="pre">control_mode(self)</span></code><a class="headerlink" href="#control-mode-self" title="Link to this heading">¶</a></h5>
<p>Get current control mode.</p>
<p><a class="reference internal" href="#method-actuatorinterface-control_mode"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="current-status-self">
<h5><code class="docutils literal notranslate"><span class="pre">current_status(self)</span></code><a class="headerlink" href="#current-status-self" title="Link to this heading">¶</a></h5>
<p>Get current actuator status.</p>
<p><a class="reference internal" href="#method-actuatorinterface-current_status"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="limits-self">
<h5><code class="docutils literal notranslate"><span class="pre">limits(self)</span></code><a class="headerlink" href="#limits-self" title="Link to this heading">¶</a></h5>
<p>Get actuator limits.</p>
<p><a class="reference internal" href="#method-actuatorinterface-limits"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="move-to-position-self-position-velocity">
<h5><code class="docutils literal notranslate"><span class="pre">move_to_position(self,</span> <span class="pre">position,</span> <span class="pre">velocity)</span></code><a class="headerlink" href="#move-to-position-self-position-velocity" title="Link to this heading">¶</a></h5>
<p>Move actuator to specific position.</p>
<p><a class="reference internal" href="#method-actuatorinterface-move_to_position"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="set-velocity-self-velocity">
<h5><code class="docutils literal notranslate"><span class="pre">set_velocity(self,</span> <span class="pre">velocity)</span></code><a class="headerlink" href="#set-velocity-self-velocity" title="Link to this heading">¶</a></h5>
<p>Set actuator velocity.</p>
<p><a class="reference internal" href="#method-actuatorinterface-set_velocity"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="set-force-self-force">
<h5><code class="docutils literal notranslate"><span class="pre">set_force(self,</span> <span class="pre">force)</span></code><a class="headerlink" href="#set-force-self-force" title="Link to this heading">¶</a></h5>
<p>Set actuator force/torque.</p>
<p><a class="reference internal" href="#method-actuatorinterface-set_force"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="stop-self">
<h5><code class="docutils literal notranslate"><span class="pre">stop(self)</span></code><a class="headerlink" href="#stop-self" title="Link to this heading">¶</a></h5>
<p>Stop actuator motion.</p>
<p><a class="reference internal" href="#method-actuatorinterface-stop"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="home-self">
<h5><code class="docutils literal notranslate"><span class="pre">home(self)</span></code><a class="headerlink" href="#home-self" title="Link to this heading">¶</a></h5>
<p>Move actuator to home position.</p>
<p><a class="reference internal" href="#method-actuatorinterface-home"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="set-control-mode-self-mode">
<h5><code class="docutils literal notranslate"><span class="pre">set_control_mode(self,</span> <span class="pre">mode)</span></code><a class="headerlink" href="#set-control-mode-self-mode" title="Link to this heading">¶</a></h5>
<p>Set actuator control mode.</p>
<p><a class="reference internal" href="#method-actuatorinterface-set_control_mode"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="set-limits-self-limits">
<h5><code class="docutils literal notranslate"><span class="pre">set_limits(self,</span> <span class="pre">limits)</span></code><a class="headerlink" href="#set-limits-self-limits" title="Link to this heading">¶</a></h5>
<p>Set actuator operational limits.</p>
<p><a class="reference internal" href="#method-actuatorinterface-set_limits"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="is-at-target-self-tolerance">
<h5><code class="docutils literal notranslate"><span class="pre">is_at_target(self,</span> <span class="pre">tolerance)</span></code><a class="headerlink" href="#is-at-target-self-tolerance" title="Link to this heading">¶</a></h5>
<p>Check if actuator is at target position.</p>
<p><a class="reference internal" href="#method-actuatorinterface-is_at_target"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="wait-for-motion-complete-self-timeout">
<h5><code class="docutils literal notranslate"><span class="pre">wait_for_motion_complete(self,</span> <span class="pre">timeout)</span></code><a class="headerlink" href="#wait-for-motion-complete-self-timeout" title="Link to this heading">¶</a></h5>
<p>Wait for actuator to reach target position.</p>
<p><a class="reference internal" href="#method-actuatorinterface-wait_for_motion_complete"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="emergency-stop-self">
<h5><code class="docutils literal notranslate"><span class="pre">emergency_stop(self)</span></code><a class="headerlink" href="#emergency-stop-self" title="Link to this heading">¶</a></h5>
<p>Perform emergency stop.</p>
<p><a class="reference internal" href="#method-actuatorinterface-emergency_stop"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="clear-faults-self">
<h5><code class="docutils literal notranslate"><span class="pre">clear_faults(self)</span></code><a class="headerlink" href="#clear-faults-self" title="Link to this heading">¶</a></h5>
<p>Clear actuator fault conditions.</p>
<p><a class="reference internal" href="#method-actuatorinterface-clear_faults"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="check-safety-limits-self-command">
<h5><code class="docutils literal notranslate"><span class="pre">_check_safety_limits(self,</span> <span class="pre">command)</span></code><a class="headerlink" href="#check-safety-limits-self-command" title="Link to this heading">¶</a></h5>
<p>Check if command violates safety limits.</p>
<p><a class="reference internal" href="#method-actuatorinterface-_check_safety_limits"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="add-command-to-queue-self-command">
<h5><code class="docutils literal notranslate"><span class="pre">_add_command_to_queue(self,</span> <span class="pre">command)</span></code><a class="headerlink" href="#add-command-to-queue-self-command" title="Link to this heading">¶</a></h5>
<p>Add command to execution queue.</p>
<p><a class="reference internal" href="#method-actuatorinterface-_add_command_to_queue"><span class="xref myst">View full source →</span></a></p>
</section>
</section>
</section>
<hr class="docutils" />
<section id="servoactuator">
<h3><code class="docutils literal notranslate"><span class="pre">ServoActuator</span></code><a class="headerlink" href="#servoactuator" title="Link to this heading">¶</a></h3>
<p><strong>Inherits from:</strong> <code class="docutils literal notranslate"><span class="pre">ActuatorInterface</span></code></p>
<p>Servo motor actuator implementation.</p>
<p>Provides position control with encoder feedback, velocity control,
and PID control loop functionality.</p>
<section id="id6">
<h4>Source Code<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="k">class</span><span class="w"> </span><span class="nc">ServoActuator</span><span class="p">(</span><span class="n">ActuatorInterface</span><span class="p">):</span>
<span class="linenos">  2</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  3</span><span class="sd">    Servo motor actuator implementation.</span>
<span class="linenos">  4</span>
<span class="linenos">  5</span><span class="sd">    Provides position control with encoder feedback, velocity control,</span>
<span class="linenos">  6</span><span class="sd">    and PID control loop functionality.</span>
<span class="linenos">  7</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">  8</span>
<span class="linenos">  9</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">DeviceConfig</span><span class="p">):</span>
<span class="linenos"> 10</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize servo actuator.&quot;&quot;&quot;</span>
<span class="linenos"> 11</span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="linenos"> 12</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_actuator_type</span> <span class="o">=</span> <span class="n">ActuatorType</span><span class="o">.</span><span class="n">SERVO</span>
<span class="linenos"> 13</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_encoder_resolution</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;encoder_resolution&#39;</span><span class="p">,</span> <span class="mi">4096</span><span class="p">)</span>
<span class="linenos"> 14</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_gear_ratio</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;gear_ratio&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="linenos"> 15</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_max_rpm</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_rpm&#39;</span><span class="p">,</span> <span class="mi">3000</span><span class="p">)</span>
<span class="linenos"> 16</span>
<span class="linenos"> 17</span>        <span class="c1"># PID parameters</span>
<span class="linenos"> 18</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_pid_gains</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pid_gains&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;kp&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;ki&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;kd&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">})</span>
<span class="linenos"> 19</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_pid_error_sum</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="linenos"> 20</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_pid_last_error</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="linenos"> 21</span>
<span class="linenos"> 22</span>        <span class="c1"># Initialize servo capabilities</span>
<span class="linenos"> 23</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_servo_capabilities</span><span class="p">()</span>
<span class="linenos"> 24</span>
<span class="linenos"> 25</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 26</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize servo actuator.&quot;&quot;&quot;</span>
<span class="linenos"> 27</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initializing servo actuator </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos"> 28</span>
<span class="linenos"> 29</span>        <span class="c1"># Initialize servo controller (simulated)</span>
<span class="linenos"> 30</span>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
<span class="linenos"> 31</span>
<span class="linenos"> 32</span>        <span class="c1"># Set initial position</span>
<span class="linenos"> 33</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="linenos"> 34</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">target_position</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="linenos"> 35</span>
<span class="linenos"> 36</span>        <span class="c1"># Configure limits from config</span>
<span class="linenos"> 37</span>        <span class="n">limits_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;limits&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="linenos"> 38</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_limits</span> <span class="o">=</span> <span class="n">ActuatorLimits</span><span class="p">(</span>
<span class="linenos"> 39</span>            <span class="n">min_position</span><span class="o">=</span><span class="n">limits_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;min_position&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mf">360.0</span><span class="p">),</span>
<span class="linenos"> 40</span>            <span class="n">max_position</span><span class="o">=</span><span class="n">limits_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_position&#39;</span><span class="p">,</span> <span class="mf">360.0</span><span class="p">),</span>
<span class="linenos"> 41</span>            <span class="n">max_velocity</span><span class="o">=</span><span class="n">limits_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_velocity&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_rpm</span> <span class="o">*</span> <span class="mf">6.0</span><span class="p">),</span>  <span class="c1"># deg/s</span>
<span class="linenos"> 42</span>            <span class="n">max_acceleration</span><span class="o">=</span><span class="n">limits_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_acceleration&#39;</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">),</span>
<span class="linenos"> 43</span>            <span class="n">max_force</span><span class="o">=</span><span class="n">limits_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_force&#39;</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
<span class="linenos"> 44</span>        <span class="p">)</span>
<span class="linenos"> 45</span>
<span class="linenos"> 46</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos"> 47</span>
<span class="linenos"> 48</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 49</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Shutdown servo actuator.&quot;&quot;&quot;</span>
<span class="linenos"> 50</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shutting down servo actuator </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos"> 51</span>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
<span class="linenos"> 52</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos"> 53</span>
<span class="linenos"> 54</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">read_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos"> 55</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read servo actuator data.&quot;&quot;&quot;</span>
<span class="linenos"> 56</span>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_status</span><span class="p">()</span>
<span class="linenos"> 57</span>
<span class="linenos"> 58</span>        <span class="k">if</span> <span class="n">channel</span><span class="p">:</span>
<span class="linenos"> 59</span>            <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;position&quot;</span><span class="p">:</span>
<span class="linenos"> 60</span>                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span><span class="p">}</span>
<span class="linenos"> 61</span>            <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;velocity&quot;</span><span class="p">:</span>
<span class="linenos"> 62</span>                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;velocity&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_velocity</span><span class="p">}</span>
<span class="linenos"> 63</span>            <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span>
<span class="linenos"> 64</span>                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">error</span><span class="p">}</span>
<span class="linenos"> 65</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 66</span>                <span class="k">return</span> <span class="p">{}</span>
<span class="linenos"> 67</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 68</span>            <span class="k">return</span> <span class="p">{</span>
<span class="linenos"> 69</span>                <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span><span class="p">,</span>
<span class="linenos"> 70</span>                <span class="s2">&quot;velocity&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_velocity</span><span class="p">,</span>
<span class="linenos"> 71</span>                <span class="s2">&quot;target_position&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">target_position</span><span class="p">,</span>
<span class="linenos"> 72</span>                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">error</span><span class="p">,</span>
<span class="linenos"> 73</span>                <span class="s2">&quot;is_moving&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">is_moving</span><span class="p">,</span>
<span class="linenos"> 74</span>                <span class="s2">&quot;at_target&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">at_target</span>
<span class="linenos"> 75</span>            <span class="p">}</span>
<span class="linenos"> 76</span>
<span class="linenos"> 77</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">write_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 78</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write data to servo actuator.&quot;&quot;&quot;</span>
<span class="linenos"> 79</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 80</span>            <span class="k">if</span> <span class="s2">&quot;position&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
<span class="linenos"> 81</span>                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_position</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">])</span>
<span class="linenos"> 82</span>            <span class="k">elif</span> <span class="s2">&quot;velocity&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
<span class="linenos"> 83</span>                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_velocity</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;velocity&quot;</span><span class="p">])</span>
<span class="linenos"> 84</span>            <span class="k">elif</span> <span class="s2">&quot;force&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
<span class="linenos"> 85</span>                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_force</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;force&quot;</span><span class="p">])</span>
<span class="linenos"> 86</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos"> 87</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos"> 88</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write data to servo: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos"> 89</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos"> 90</span>
<span class="linenos"> 91</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">self_test</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos"> 92</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform servo actuator self-test.&quot;&quot;&quot;</span>
<span class="linenos"> 93</span>        <span class="n">test_results</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">self_test</span><span class="p">()</span>
<span class="linenos"> 94</span>
<span class="linenos"> 95</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 96</span>            <span class="c1"># Test position control</span>
<span class="linenos"> 97</span>            <span class="n">initial_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span>
<span class="linenos"> 98</span>            <span class="n">test_position</span> <span class="o">=</span> <span class="n">initial_position</span> <span class="o">+</span> <span class="mf">10.0</span>  <span class="c1"># Move 10 degrees</span>
<span class="linenos"> 99</span>
<span class="linenos">100</span>            <span class="c1"># Check if position is within limits</span>
<span class="linenos">101</span>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">min_position</span> <span class="o">&lt;=</span> <span class="n">test_position</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">max_position</span><span class="p">):</span>
<span class="linenos">102</span>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_position</span><span class="p">(</span><span class="n">test_position</span><span class="p">)</span>
<span class="linenos">103</span>                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># Wait for movement</span>
<span class="linenos">104</span>
<span class="linenos">105</span>                <span class="n">position_error</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="o">-</span> <span class="n">test_position</span><span class="p">)</span>
<span class="linenos">106</span>                <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;position_control&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">position_error</span> <span class="o">&lt;</span> <span class="mf">1.0</span>
<span class="linenos">107</span>
<span class="linenos">108</span>                <span class="c1"># Return to initial position</span>
<span class="linenos">109</span>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_position</span><span class="p">(</span><span class="n">initial_position</span><span class="p">)</span>
<span class="linenos">110</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">111</span>                <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;position_control&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Skip if can&#39;t test safely</span>
<span class="linenos">112</span>
<span class="linenos">113</span>            <span class="c1"># Test velocity control</span>
<span class="linenos">114</span>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_velocity</span><span class="p">(</span><span class="mf">100.0</span><span class="p">)</span>  <span class="c1"># 100 deg/s</span>
<span class="linenos">115</span>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
<span class="linenos">116</span>            <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;velocity_control&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_velocity</span> <span class="o">-</span> <span class="mf">100.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">10.0</span>
<span class="linenos">117</span>
<span class="linenos">118</span>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
<span class="linenos">119</span>
<span class="linenos">120</span>            <span class="c1"># Test encoder feedback</span>
<span class="linenos">121</span>            <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;encoder_functional&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="linenos">122</span>
<span class="linenos">123</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">124</span>            <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;servo_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="linenos">125</span>            <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;overall_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;FAIL&#39;</span>
<span class="linenos">126</span>
<span class="linenos">127</span>        <span class="k">return</span> <span class="n">test_results</span>
<span class="linenos">128</span>
<span class="linenos">129</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">move_to_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">velocity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">130</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Move servo to specific position.&quot;&quot;&quot;</span>
<span class="linenos">131</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">132</span>            <span class="n">command</span> <span class="o">=</span> <span class="n">ActuatorCommand</span><span class="p">(</span>
<span class="linenos">133</span>                <span class="n">timestamp</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
<span class="linenos">134</span>                <span class="n">actuator_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="p">,</span>
<span class="linenos">135</span>                <span class="n">command_type</span><span class="o">=</span><span class="n">ActuatorMode</span><span class="o">.</span><span class="n">POSITION</span><span class="p">,</span>
<span class="linenos">136</span>                <span class="n">target_value</span><span class="o">=</span><span class="n">position</span><span class="p">,</span>
<span class="linenos">137</span>                <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span>
<span class="linenos">138</span>            <span class="p">)</span>
<span class="linenos">139</span>
<span class="linenos">140</span>            <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_command_to_queue</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
<span class="linenos">141</span>                <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">142</span>
<span class="linenos">143</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">target_position</span> <span class="o">=</span> <span class="n">position</span>
<span class="linenos">144</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">is_moving</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos">145</span>
<span class="linenos">146</span>            <span class="c1"># Start position control task</span>
<span class="linenos">147</span>            <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_position_control_loop</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">velocity</span><span class="p">))</span>
<span class="linenos">148</span>
<span class="linenos">149</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">150</span>
<span class="linenos">151</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">152</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to move to position </span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">153</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">154</span>
<span class="linenos">155</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">velocity</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">156</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set servo velocity.&quot;&quot;&quot;</span>
<span class="linenos">157</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">158</span>            <span class="n">command</span> <span class="o">=</span> <span class="n">ActuatorCommand</span><span class="p">(</span>
<span class="linenos">159</span>                <span class="n">timestamp</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
<span class="linenos">160</span>                <span class="n">actuator_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="p">,</span>
<span class="linenos">161</span>                <span class="n">command_type</span><span class="o">=</span><span class="n">ActuatorMode</span><span class="o">.</span><span class="n">VELOCITY</span><span class="p">,</span>
<span class="linenos">162</span>                <span class="n">target_value</span><span class="o">=</span><span class="n">velocity</span><span class="p">,</span>
<span class="linenos">163</span>                <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg/s&quot;</span>
<span class="linenos">164</span>            <span class="p">)</span>
<span class="linenos">165</span>
<span class="linenos">166</span>            <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_command_to_queue</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
<span class="linenos">167</span>                <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">168</span>
<span class="linenos">169</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">target_velocity</span> <span class="o">=</span> <span class="n">velocity</span>
<span class="linenos">170</span>
<span class="linenos">171</span>            <span class="c1"># Start velocity control</span>
<span class="linenos">172</span>            <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_velocity_control_loop</span><span class="p">(</span><span class="n">velocity</span><span class="p">))</span>
<span class="linenos">173</span>
<span class="linenos">174</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">175</span>
<span class="linenos">176</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">177</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to set velocity </span><span class="si">{</span><span class="n">velocity</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">178</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">179</span>
<span class="linenos">180</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">181</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set servo force/torque.&quot;&quot;&quot;</span>
<span class="linenos">182</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">183</span>            <span class="n">command</span> <span class="o">=</span> <span class="n">ActuatorCommand</span><span class="p">(</span>
<span class="linenos">184</span>                <span class="n">timestamp</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
<span class="linenos">185</span>                <span class="n">actuator_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="p">,</span>
<span class="linenos">186</span>                <span class="n">command_type</span><span class="o">=</span><span class="n">ActuatorMode</span><span class="o">.</span><span class="n">FORCE</span><span class="p">,</span>
<span class="linenos">187</span>                <span class="n">target_value</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
<span class="linenos">188</span>                <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;Nm&quot;</span>
<span class="linenos">189</span>            <span class="p">)</span>
<span class="linenos">190</span>
<span class="linenos">191</span>            <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_command_to_queue</span><span class="p">(</span><span class="n">command</span><span class="p">):</span>
<span class="linenos">192</span>                <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">193</span>
<span class="linenos">194</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">target_force</span> <span class="o">=</span> <span class="n">force</span>
<span class="linenos">195</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">196</span>
<span class="linenos">197</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">198</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to set force </span><span class="si">{</span><span class="n">force</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">199</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">200</span>
<span class="linenos">201</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">202</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop servo motion.&quot;&quot;&quot;</span>
<span class="linenos">203</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">204</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">target_velocity</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="linenos">205</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">is_moving</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">206</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stopped servo actuator </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">207</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">208</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">209</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to stop servo: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">210</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">211</span>
<span class="linenos">212</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">home</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">213</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Move servo to home position.&quot;&quot;&quot;</span>
<span class="linenos">214</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">215</span>            <span class="n">home_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;home_position&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="linenos">216</span>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_position</span><span class="p">(</span><span class="n">home_position</span><span class="p">)</span>
<span class="linenos">217</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">218</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to home servo: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">219</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">220</span>
<span class="linenos">221</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_position_control_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_position</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">max_velocity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">222</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Position control loop with PID controller.&quot;&quot;&quot;</span>
<span class="linenos">223</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">224</span>            <span class="k">if</span> <span class="n">max_velocity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">225</span>                <span class="n">max_velocity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">max_velocity</span> <span class="ow">or</span> <span class="mf">360.0</span>
<span class="linenos">226</span>
<span class="linenos">227</span>            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">is_moving</span><span class="p">:</span>
<span class="linenos">228</span>                <span class="n">current_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span>
<span class="linenos">229</span>                <span class="n">error</span> <span class="o">=</span> <span class="n">target_position</span> <span class="o">-</span> <span class="n">current_pos</span>
<span class="linenos">230</span>
<span class="linenos">231</span>                <span class="c1"># PID calculation</span>
<span class="linenos">232</span>                <span class="bp">self</span><span class="o">.</span><span class="n">_pid_error_sum</span> <span class="o">+=</span> <span class="n">error</span> <span class="o">*</span> <span class="mf">0.01</span>  <span class="c1"># Assuming 100Hz control loop</span>
<span class="linenos">233</span>                <span class="n">derivative</span> <span class="o">=</span> <span class="p">(</span><span class="n">error</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pid_last_error</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.01</span>
<span class="linenos">234</span>
<span class="linenos">235</span>                <span class="n">pid_output</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pid_gains</span><span class="p">[</span><span class="s1">&#39;kp&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">error</span> <span class="o">+</span>
<span class="linenos">236</span>                             <span class="bp">self</span><span class="o">.</span><span class="n">_pid_gains</span><span class="p">[</span><span class="s1">&#39;ki&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pid_error_sum</span> <span class="o">+</span>
<span class="linenos">237</span>                             <span class="bp">self</span><span class="o">.</span><span class="n">_pid_gains</span><span class="p">[</span><span class="s1">&#39;kd&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">derivative</span><span class="p">)</span>
<span class="linenos">238</span>
<span class="linenos">239</span>                <span class="c1"># Limit velocity</span>
<span class="linenos">240</span>                <span class="n">velocity</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">max_velocity</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_velocity</span><span class="p">,</span> <span class="n">pid_output</span><span class="p">))</span>
<span class="linenos">241</span>
<span class="linenos">242</span>                <span class="c1"># Update position (simplified integration)</span>
<span class="linenos">243</span>                <span class="n">new_position</span> <span class="o">=</span> <span class="n">current_pos</span> <span class="o">+</span> <span class="n">velocity</span> <span class="o">*</span> <span class="mf">0.01</span>
<span class="linenos">244</span>                <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="o">=</span> <span class="n">new_position</span>
<span class="linenos">245</span>                <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_velocity</span> <span class="o">=</span> <span class="n">velocity</span>
<span class="linenos">246</span>                <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">error</span>
<span class="linenos">247</span>
<span class="linenos">248</span>                <span class="c1"># Check if at target</span>
<span class="linenos">249</span>                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_position_tolerance</span><span class="p">:</span>
<span class="linenos">250</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">is_moving</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">251</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">at_target</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos">252</span>
<span class="linenos">253</span>                <span class="bp">self</span><span class="o">.</span><span class="n">_pid_last_error</span> <span class="o">=</span> <span class="n">error</span>
<span class="linenos">254</span>                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>  <span class="c1"># 100Hz control loop</span>
<span class="linenos">255</span>
<span class="linenos">256</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">257</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Position control loop error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">258</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">is_moving</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">259</span>
<span class="linenos">260</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_velocity_control_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_velocity</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">261</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Velocity control loop.&quot;&quot;&quot;</span>
<span class="linenos">262</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">263</span>            <span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="n">target_velocity</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>  <span class="c1"># Stop when velocity is near zero</span>
<span class="linenos">264</span>                <span class="c1"># Simple velocity control (in practice, use more sophisticated control)</span>
<span class="linenos">265</span>                <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_velocity</span> <span class="o">=</span> <span class="n">target_velocity</span>
<span class="linenos">266</span>
<span class="linenos">267</span>                <span class="c1"># Update position based on velocity</span>
<span class="linenos">268</span>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">269</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="o">+=</span> <span class="n">target_velocity</span> <span class="o">*</span> <span class="mf">0.01</span>
<span class="linenos">270</span>
<span class="linenos">271</span>                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>  <span class="c1"># 100Hz control loop</span>
<span class="linenos">272</span>
<span class="linenos">273</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">274</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Velocity control loop error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">275</span>
<span class="linenos">276</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_update_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">277</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update servo status.&quot;&quot;&quot;</span>
<span class="linenos">278</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="linenos">279</span>
<span class="linenos">280</span>        <span class="c1"># Simulate encoder feedback (in practice, read from actual encoder)</span>
<span class="linenos">281</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">282</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="linenos">283</span>
<span class="linenos">284</span>        <span class="c1"># Check if at target</span>
<span class="linenos">285</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">target_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">286</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">at_target</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_at_target</span><span class="p">()</span>
<span class="linenos">287</span>
<span class="linenos">288</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_add_servo_capabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">289</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add servo actuator capabilities.&quot;&quot;&quot;</span>
<span class="linenos">290</span>        <span class="bp">self</span><span class="o">.</span><span class="n">add_capability</span><span class="p">(</span><span class="n">DeviceCapability</span><span class="p">(</span>
<span class="linenos">291</span>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;position&quot;</span><span class="p">,</span>
<span class="linenos">292</span>            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Servo position&quot;</span><span class="p">,</span>
<span class="linenos">293</span>            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
<span class="linenos">294</span>            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">,</span>
<span class="linenos">295</span>            <span class="n">range_min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">min_position</span><span class="p">,</span>
<span class="linenos">296</span>            <span class="n">range_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">max_position</span><span class="p">,</span>
<span class="linenos">297</span>            <span class="n">read_only</span><span class="o">=</span><span class="kc">False</span>
<span class="linenos">298</span>        <span class="p">))</span>
<span class="linenos">299</span>
<span class="linenos">300</span>        <span class="bp">self</span><span class="o">.</span><span class="n">add_capability</span><span class="p">(</span><span class="n">DeviceCapability</span><span class="p">(</span>
<span class="linenos">301</span>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;velocity&quot;</span><span class="p">,</span>
<span class="linenos">302</span>            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Servo velocity&quot;</span><span class="p">,</span>
<span class="linenos">303</span>            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
<span class="linenos">304</span>            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg/s&quot;</span><span class="p">,</span>
<span class="linenos">305</span>            <span class="n">range_min</span><span class="o">=-</span><span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">max_velocity</span><span class="p">,</span>
<span class="linenos">306</span>            <span class="n">range_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">max_velocity</span><span class="p">,</span>
<span class="linenos">307</span>            <span class="n">read_only</span><span class="o">=</span><span class="kc">False</span>
<span class="linenos">308</span>        <span class="p">))</span>
<span class="linenos">309</span>
<span class="linenos">310</span>        <span class="bp">self</span><span class="o">.</span><span class="n">add_capability</span><span class="p">(</span><span class="n">DeviceCapability</span><span class="p">(</span>
<span class="linenos">311</span>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;force&quot;</span><span class="p">,</span>
<span class="linenos">312</span>            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Servo torque&quot;</span><span class="p">,</span>
<span class="linenos">313</span>            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
<span class="linenos">314</span>            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;Nm&quot;</span><span class="p">,</span>
<span class="linenos">315</span>            <span class="n">range_min</span><span class="o">=-</span><span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">max_force</span><span class="p">,</span>
<span class="linenos">316</span>            <span class="n">range_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_limits</span><span class="o">.</span><span class="n">max_force</span><span class="p">,</span>
<span class="linenos">317</span>            <span class="n">read_only</span><span class="o">=</span><span class="kc">False</span>
<span class="linenos">318</span>        <span class="p">))</span>
</pre></div>
</div>
</section>
<section id="methods-15">
<h4>Methods (15)<a class="headerlink" href="#methods-15" title="Link to this heading">¶</a></h4>
<section id="id7">
<h5><code class="docutils literal notranslate"><span class="pre">__init__(self,</span> <span class="pre">config)</span></code><a class="headerlink" href="#id7" title="Link to this heading">¶</a></h5>
<p>Initialize servo actuator.</p>
<p><a class="reference internal" href="#method-servoactuator-__init__"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="initialize-self">
<h5><code class="docutils literal notranslate"><span class="pre">initialize(self)</span></code><a class="headerlink" href="#initialize-self" title="Link to this heading">¶</a></h5>
<p>Initialize servo actuator.</p>
<p><a class="reference internal" href="#method-servoactuator-initialize"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="shutdown-self">
<h5><code class="docutils literal notranslate"><span class="pre">shutdown(self)</span></code><a class="headerlink" href="#shutdown-self" title="Link to this heading">¶</a></h5>
<p>Shutdown servo actuator.</p>
<p><a class="reference internal" href="#method-servoactuator-shutdown"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="read-data-self-channel">
<h5><code class="docutils literal notranslate"><span class="pre">read_data(self,</span> <span class="pre">channel)</span></code><a class="headerlink" href="#read-data-self-channel" title="Link to this heading">¶</a></h5>
<p>Read servo actuator data.</p>
<p><a class="reference internal" href="#method-servoactuator-read_data"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="write-data-self-data">
<h5><code class="docutils literal notranslate"><span class="pre">write_data(self,</span> <span class="pre">data)</span></code><a class="headerlink" href="#write-data-self-data" title="Link to this heading">¶</a></h5>
<p>Write data to servo actuator.</p>
<p><a class="reference internal" href="#method-servoactuator-write_data"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="self-test-self">
<h5><code class="docutils literal notranslate"><span class="pre">self_test(self)</span></code><a class="headerlink" href="#self-test-self" title="Link to this heading">¶</a></h5>
<p>Perform servo actuator self-test.</p>
<p><a class="reference internal" href="#method-servoactuator-self_test"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="id8">
<h5><code class="docutils literal notranslate"><span class="pre">move_to_position(self,</span> <span class="pre">position,</span> <span class="pre">velocity)</span></code><a class="headerlink" href="#id8" title="Link to this heading">¶</a></h5>
<p>Move servo to specific position.</p>
<p><a class="reference internal" href="#method-servoactuator-move_to_position"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="id9">
<h5><code class="docutils literal notranslate"><span class="pre">set_velocity(self,</span> <span class="pre">velocity)</span></code><a class="headerlink" href="#id9" title="Link to this heading">¶</a></h5>
<p>Set servo velocity.</p>
<p><a class="reference internal" href="#method-servoactuator-set_velocity"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="id10">
<h5><code class="docutils literal notranslate"><span class="pre">set_force(self,</span> <span class="pre">force)</span></code><a class="headerlink" href="#id10" title="Link to this heading">¶</a></h5>
<p>Set servo force/torque.</p>
<p><a class="reference internal" href="#method-servoactuator-set_force"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="id11">
<h5><code class="docutils literal notranslate"><span class="pre">stop(self)</span></code><a class="headerlink" href="#id11" title="Link to this heading">¶</a></h5>
<p>Stop servo motion.</p>
<p><a class="reference internal" href="#method-servoactuator-stop"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="id12">
<h5><code class="docutils literal notranslate"><span class="pre">home(self)</span></code><a class="headerlink" href="#id12" title="Link to this heading">¶</a></h5>
<p>Move servo to home position.</p>
<p><a class="reference internal" href="#method-servoactuator-home"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="position-control-loop-self-target-position-max-velocity">
<h5><code class="docutils literal notranslate"><span class="pre">_position_control_loop(self,</span> <span class="pre">target_position,</span> <span class="pre">max_velocity)</span></code><a class="headerlink" href="#position-control-loop-self-target-position-max-velocity" title="Link to this heading">¶</a></h5>
<p>Position control loop with PID controller.</p>
<p><a class="reference internal" href="#method-servoactuator-_position_control_loop"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="velocity-control-loop-self-target-velocity">
<h5><code class="docutils literal notranslate"><span class="pre">_velocity_control_loop(self,</span> <span class="pre">target_velocity)</span></code><a class="headerlink" href="#velocity-control-loop-self-target-velocity" title="Link to this heading">¶</a></h5>
<p>Velocity control loop.</p>
<p><a class="reference internal" href="#method-servoactuator-_velocity_control_loop"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="update-status-self">
<h5><code class="docutils literal notranslate"><span class="pre">_update_status(self)</span></code><a class="headerlink" href="#update-status-self" title="Link to this heading">¶</a></h5>
<p>Update servo status.</p>
<p><a class="reference internal" href="#method-servoactuator-_update_status"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="add-servo-capabilities-self">
<h5><code class="docutils literal notranslate"><span class="pre">_add_servo_capabilities(self)</span></code><a class="headerlink" href="#add-servo-capabilities-self" title="Link to this heading">¶</a></h5>
<p>Add servo actuator capabilities.</p>
<p><a class="reference internal" href="#method-servoactuator-_add_servo_capabilities"><span class="xref myst">View full source →</span></a></p>
</section>
</section>
</section>
<hr class="docutils" />
<section id="steppermotor">
<h3><code class="docutils literal notranslate"><span class="pre">StepperMotor</span></code><a class="headerlink" href="#steppermotor" title="Link to this heading">¶</a></h3>
<p><strong>Inherits from:</strong> <code class="docutils literal notranslate"><span class="pre">ActuatorInterface</span></code></p>
<p>Stepper motor actuator implementation.</p>
<p>Provides precise position control through step counting,
with configurable step size and acceleration profiles.</p>
<section id="id13">
<h4>Source Code<a class="headerlink" href="#id13" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="k">class</span><span class="w"> </span><span class="nc">StepperMotor</span><span class="p">(</span><span class="n">ActuatorInterface</span><span class="p">):</span>
<span class="linenos">  2</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  3</span><span class="sd">    Stepper motor actuator implementation.</span>
<span class="linenos">  4</span>
<span class="linenos">  5</span><span class="sd">    Provides precise position control through step counting,</span>
<span class="linenos">  6</span><span class="sd">    with configurable step size and acceleration profiles.</span>
<span class="linenos">  7</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">  8</span>
<span class="linenos">  9</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">DeviceConfig</span><span class="p">):</span>
<span class="linenos"> 10</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize stepper motor.&quot;&quot;&quot;</span>
<span class="linenos"> 11</span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="linenos"> 12</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_actuator_type</span> <span class="o">=</span> <span class="n">ActuatorType</span><span class="o">.</span><span class="n">STEPPER</span>
<span class="linenos"> 13</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_steps_per_revolution</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;steps_per_revolution&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="linenos"> 14</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_microstep_resolution</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;microstep_resolution&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
<span class="linenos"> 15</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_step</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 16</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_target_step</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span>        <span class="c1"># Initialize stepper capabilities</span>
<span class="linenos"> 19</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_stepper_capabilities</span><span class="p">()</span>
<span class="linenos"> 20</span>
<span class="linenos"> 21</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 22</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize stepper motor.&quot;&quot;&quot;</span>
<span class="linenos"> 23</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initializing stepper motor </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos"> 24</span>
<span class="linenos"> 25</span>        <span class="c1"># Initialize stepper driver (simulated)</span>
<span class="linenos"> 26</span>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
<span class="linenos"> 27</span>
<span class="linenos"> 28</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="linenos"> 29</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos"> 30</span>
<span class="linenos"> 31</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 32</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Shutdown stepper motor.&quot;&quot;&quot;</span>
<span class="linenos"> 33</span>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
<span class="linenos"> 34</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos"> 35</span>
<span class="linenos"> 36</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">read_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos"> 37</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read stepper motor data.&quot;&quot;&quot;</span>
<span class="linenos"> 38</span>        <span class="n">position_deg</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_step</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_steps_per_revolution</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_microstep_resolution</span><span class="p">))</span> <span class="o">*</span> <span class="mf">360.0</span>
<span class="linenos"> 39</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="o">=</span> <span class="n">position_deg</span>
<span class="linenos"> 40</span>
<span class="linenos"> 41</span>        <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;position&quot;</span><span class="p">:</span>
<span class="linenos"> 42</span>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position_deg</span><span class="p">}</span>
<span class="linenos"> 43</span>        <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;steps&quot;</span><span class="p">:</span>
<span class="linenos"> 44</span>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;steps&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_step</span><span class="p">}</span>
<span class="linenos"> 45</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 46</span>            <span class="k">return</span> <span class="p">{</span>
<span class="linenos"> 47</span>                <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="n">position_deg</span><span class="p">,</span>
<span class="linenos"> 48</span>                <span class="s2">&quot;steps&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_step</span><span class="p">,</span>
<span class="linenos"> 49</span>                <span class="s2">&quot;target_steps&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_step</span><span class="p">,</span>
<span class="linenos"> 50</span>                <span class="s2">&quot;is_moving&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">is_moving</span>
<span class="linenos"> 51</span>            <span class="p">}</span>
<span class="linenos"> 52</span>
<span class="linenos"> 53</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">write_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 54</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write data to stepper motor.&quot;&quot;&quot;</span>
<span class="linenos"> 55</span>        <span class="k">if</span> <span class="s2">&quot;position&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
<span class="linenos"> 56</span>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_position</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">])</span>
<span class="linenos"> 57</span>        <span class="k">elif</span> <span class="s2">&quot;steps&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
<span class="linenos"> 58</span>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_step</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;steps&quot;</span><span class="p">])</span>
<span class="linenos"> 59</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos"> 60</span>
<span class="linenos"> 61</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">self_test</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos"> 62</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform stepper motor self-test.&quot;&quot;&quot;</span>
<span class="linenos"> 63</span>        <span class="n">test_results</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">self_test</span><span class="p">()</span>
<span class="linenos"> 64</span>
<span class="linenos"> 65</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 66</span>            <span class="c1"># Test step movement</span>
<span class="linenos"> 67</span>            <span class="n">initial_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_step</span>
<span class="linenos"> 68</span>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_steps</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>  <span class="c1"># Move 100 steps</span>
<span class="linenos"> 69</span>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
<span class="linenos"> 70</span>
<span class="linenos"> 71</span>            <span class="n">step_error</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_step</span> <span class="o">-</span> <span class="p">(</span><span class="n">initial_step</span> <span class="o">+</span> <span class="mi">100</span><span class="p">))</span>
<span class="linenos"> 72</span>            <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;step_accuracy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">step_error</span> <span class="o">&lt;</span> <span class="mi">2</span>
<span class="linenos"> 73</span>
<span class="linenos"> 74</span>            <span class="c1"># Return to initial position</span>
<span class="linenos"> 75</span>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_step</span><span class="p">(</span><span class="n">initial_step</span><span class="p">)</span>
<span class="linenos"> 76</span>
<span class="linenos"> 77</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos"> 78</span>            <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;stepper_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="linenos"> 79</span>            <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;overall_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;FAIL&#39;</span>
<span class="linenos"> 80</span>
<span class="linenos"> 81</span>        <span class="k">return</span> <span class="n">test_results</span>
<span class="linenos"> 82</span>
<span class="linenos"> 83</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">move_to_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">velocity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 84</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Move stepper to specific position.&quot;&quot;&quot;</span>
<span class="linenos"> 85</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 86</span>            <span class="c1"># Convert position to steps</span>
<span class="linenos"> 87</span>            <span class="n">target_step</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">position</span> <span class="o">/</span> <span class="mf">360.0</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_steps_per_revolution</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_microstep_resolution</span><span class="p">)</span>
<span class="linenos"> 88</span>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_step</span><span class="p">(</span><span class="n">target_step</span><span class="p">)</span>
<span class="linenos"> 89</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos"> 90</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to move to position </span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos"> 91</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos"> 92</span>
<span class="linenos"> 93</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">move_to_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_step</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 94</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Move stepper to specific step.&quot;&quot;&quot;</span>
<span class="linenos"> 95</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 96</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_target_step</span> <span class="o">=</span> <span class="n">target_step</span>
<span class="linenos"> 97</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">is_moving</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos"> 98</span>
<span class="linenos"> 99</span>            <span class="c1"># Start stepping</span>
<span class="linenos">100</span>            <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_step_control_loop</span><span class="p">(</span><span class="n">target_step</span><span class="p">))</span>
<span class="linenos">101</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">102</span>
<span class="linenos">103</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">104</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to move to step </span><span class="si">{</span><span class="n">target_step</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">105</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">106</span>
<span class="linenos">107</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">move_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">108</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Move stepper by relative step count.&quot;&quot;&quot;</span>
<span class="linenos">109</span>        <span class="n">target_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_step</span> <span class="o">+</span> <span class="n">step_count</span>
<span class="linenos">110</span>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_step</span><span class="p">(</span><span class="n">target_step</span><span class="p">)</span>
<span class="linenos">111</span>
<span class="linenos">112</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">velocity</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">113</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set stepper velocity (not directly applicable).&quot;&quot;&quot;</span>
<span class="linenos">114</span>        <span class="c1"># Stepper motors use step rate rather than continuous velocity</span>
<span class="linenos">115</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Velocity control not directly applicable to stepper motors&quot;</span><span class="p">)</span>
<span class="linenos">116</span>        <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">117</span>
<span class="linenos">118</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">119</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set stepper force (holding torque).&quot;&quot;&quot;</span>
<span class="linenos">120</span>        <span class="c1"># Stepper motors have fixed holding torque</span>
<span class="linenos">121</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Force control not applicable to stepper motors&quot;</span><span class="p">)</span>
<span class="linenos">122</span>        <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">123</span>
<span class="linenos">124</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">125</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop stepper motion.&quot;&quot;&quot;</span>
<span class="linenos">126</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">is_moving</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">127</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">128</span>
<span class="linenos">129</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">home</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">130</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Home stepper motor.&quot;&quot;&quot;</span>
<span class="linenos">131</span>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_step</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">132</span>
<span class="linenos">133</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_step_control_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_step</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">134</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Step control loop.&quot;&quot;&quot;</span>
<span class="linenos">135</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">136</span>            <span class="n">step_direction</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">target_step</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_step</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
<span class="linenos">137</span>            <span class="n">step_rate</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># Steps per second</span>
<span class="linenos">138</span>
<span class="linenos">139</span>            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_step</span> <span class="o">!=</span> <span class="n">target_step</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">is_moving</span><span class="p">:</span>
<span class="linenos">140</span>                <span class="bp">self</span><span class="o">.</span><span class="n">_current_step</span> <span class="o">+=</span> <span class="n">step_direction</span>
<span class="linenos">141</span>                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">step_rate</span><span class="p">)</span>
<span class="linenos">142</span>
<span class="linenos">143</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">is_moving</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">144</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">at_target</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos">145</span>
<span class="linenos">146</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">147</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Step control loop error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">148</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">is_moving</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">149</span>
<span class="linenos">150</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_add_stepper_capabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">151</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add stepper motor capabilities.&quot;&quot;&quot;</span>
<span class="linenos">152</span>        <span class="n">max_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_steps_per_revolution</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_microstep_resolution</span> <span class="o">*</span> <span class="mi">10</span>  <span class="c1"># 10 revolutions</span>
<span class="linenos">153</span>
<span class="linenos">154</span>        <span class="bp">self</span><span class="o">.</span><span class="n">add_capability</span><span class="p">(</span><span class="n">DeviceCapability</span><span class="p">(</span>
<span class="linenos">155</span>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;position&quot;</span><span class="p">,</span>
<span class="linenos">156</span>            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Stepper position&quot;</span><span class="p">,</span>
<span class="linenos">157</span>            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
<span class="linenos">158</span>            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">,</span>
<span class="linenos">159</span>            <span class="n">range_min</span><span class="o">=-</span><span class="mf">3600.0</span><span class="p">,</span>  <span class="c1"># -10 revolutions</span>
<span class="linenos">160</span>            <span class="n">range_max</span><span class="o">=</span><span class="mf">3600.0</span><span class="p">,</span>   <span class="c1"># +10 revolutions</span>
<span class="linenos">161</span>            <span class="n">read_only</span><span class="o">=</span><span class="kc">False</span>
<span class="linenos">162</span>        <span class="p">))</span>
<span class="linenos">163</span>
<span class="linenos">164</span>        <span class="bp">self</span><span class="o">.</span><span class="n">add_capability</span><span class="p">(</span><span class="n">DeviceCapability</span><span class="p">(</span>
<span class="linenos">165</span>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;steps&quot;</span><span class="p">,</span>
<span class="linenos">166</span>            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Step count&quot;</span><span class="p">,</span>
<span class="linenos">167</span>            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">,</span>
<span class="linenos">168</span>            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;steps&quot;</span><span class="p">,</span>
<span class="linenos">169</span>            <span class="n">range_min</span><span class="o">=-</span><span class="n">max_steps</span><span class="p">,</span>
<span class="linenos">170</span>            <span class="n">range_max</span><span class="o">=</span><span class="n">max_steps</span><span class="p">,</span>
<span class="linenos">171</span>            <span class="n">read_only</span><span class="o">=</span><span class="kc">False</span>
<span class="linenos">172</span>        <span class="p">))</span>
</pre></div>
</div>
</section>
<section id="id14">
<h4>Methods (15)<a class="headerlink" href="#id14" title="Link to this heading">¶</a></h4>
<section id="id15">
<h5><code class="docutils literal notranslate"><span class="pre">__init__(self,</span> <span class="pre">config)</span></code><a class="headerlink" href="#id15" title="Link to this heading">¶</a></h5>
<p>Initialize stepper motor.</p>
<p><a class="reference internal" href="#method-steppermotor-__init__"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="id16">
<h5><code class="docutils literal notranslate"><span class="pre">initialize(self)</span></code><a class="headerlink" href="#id16" title="Link to this heading">¶</a></h5>
<p>Initialize stepper motor.</p>
<p><a class="reference internal" href="#method-steppermotor-initialize"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="id17">
<h5><code class="docutils literal notranslate"><span class="pre">shutdown(self)</span></code><a class="headerlink" href="#id17" title="Link to this heading">¶</a></h5>
<p>Shutdown stepper motor.</p>
<p><a class="reference internal" href="#method-steppermotor-shutdown"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="id18">
<h5><code class="docutils literal notranslate"><span class="pre">read_data(self,</span> <span class="pre">channel)</span></code><a class="headerlink" href="#id18" title="Link to this heading">¶</a></h5>
<p>Read stepper motor data.</p>
<p><a class="reference internal" href="#method-steppermotor-read_data"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="id19">
<h5><code class="docutils literal notranslate"><span class="pre">write_data(self,</span> <span class="pre">data)</span></code><a class="headerlink" href="#id19" title="Link to this heading">¶</a></h5>
<p>Write data to stepper motor.</p>
<p><a class="reference internal" href="#method-steppermotor-write_data"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="id20">
<h5><code class="docutils literal notranslate"><span class="pre">self_test(self)</span></code><a class="headerlink" href="#id20" title="Link to this heading">¶</a></h5>
<p>Perform stepper motor self-test.</p>
<p><a class="reference internal" href="#method-steppermotor-self_test"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="id21">
<h5><code class="docutils literal notranslate"><span class="pre">move_to_position(self,</span> <span class="pre">position,</span> <span class="pre">velocity)</span></code><a class="headerlink" href="#id21" title="Link to this heading">¶</a></h5>
<p>Move stepper to specific position.</p>
<p><a class="reference internal" href="#method-steppermotor-move_to_position"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="move-to-step-self-target-step">
<h5><code class="docutils literal notranslate"><span class="pre">move_to_step(self,</span> <span class="pre">target_step)</span></code><a class="headerlink" href="#move-to-step-self-target-step" title="Link to this heading">¶</a></h5>
<p>Move stepper to specific step.</p>
<p><a class="reference internal" href="#method-steppermotor-move_to_step"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="move-steps-self-step-count">
<h5><code class="docutils literal notranslate"><span class="pre">move_steps(self,</span> <span class="pre">step_count)</span></code><a class="headerlink" href="#move-steps-self-step-count" title="Link to this heading">¶</a></h5>
<p>Move stepper by relative step count.</p>
<p><a class="reference internal" href="#method-steppermotor-move_steps"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="id22">
<h5><code class="docutils literal notranslate"><span class="pre">set_velocity(self,</span> <span class="pre">velocity)</span></code><a class="headerlink" href="#id22" title="Link to this heading">¶</a></h5>
<p>Set stepper velocity (not directly applicable).</p>
<p><a class="reference internal" href="#method-steppermotor-set_velocity"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="id23">
<h5><code class="docutils literal notranslate"><span class="pre">set_force(self,</span> <span class="pre">force)</span></code><a class="headerlink" href="#id23" title="Link to this heading">¶</a></h5>
<p>Set stepper force (holding torque).</p>
<p><a class="reference internal" href="#method-steppermotor-set_force"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="id24">
<h5><code class="docutils literal notranslate"><span class="pre">stop(self)</span></code><a class="headerlink" href="#id24" title="Link to this heading">¶</a></h5>
<p>Stop stepper motion.</p>
<p><a class="reference internal" href="#method-steppermotor-stop"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="id25">
<h5><code class="docutils literal notranslate"><span class="pre">home(self)</span></code><a class="headerlink" href="#id25" title="Link to this heading">¶</a></h5>
<p>Home stepper motor.</p>
<p><a class="reference internal" href="#method-steppermotor-home"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="step-control-loop-self-target-step">
<h5><code class="docutils literal notranslate"><span class="pre">_step_control_loop(self,</span> <span class="pre">target_step)</span></code><a class="headerlink" href="#step-control-loop-self-target-step" title="Link to this heading">¶</a></h5>
<p>Step control loop.</p>
<p><a class="reference internal" href="#method-steppermotor-_step_control_loop"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="add-stepper-capabilities-self">
<h5><code class="docutils literal notranslate"><span class="pre">_add_stepper_capabilities(self)</span></code><a class="headerlink" href="#add-stepper-capabilities-self" title="Link to this heading">¶</a></h5>
<p>Add stepper motor capabilities.</p>
<p><a class="reference internal" href="#method-steppermotor-_add_stepper_capabilities"><span class="xref myst">View full source →</span></a></p>
</section>
</section>
</section>
<hr class="docutils" />
<section id="pneumaticactuator">
<h3><code class="docutils literal notranslate"><span class="pre">PneumaticActuator</span></code><a class="headerlink" href="#pneumaticactuator" title="Link to this heading">¶</a></h3>
<p><strong>Inherits from:</strong> <code class="docutils literal notranslate"><span class="pre">ActuatorInterface</span></code></p>
<p>Pneumatic actuator implementation.</p>
<p>Provides pressure-based control for linear and rotary
pneumatic actuators with pressure feedback.</p>
<section id="id26">
<h4>Source Code<a class="headerlink" href="#id26" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="k">class</span><span class="w"> </span><span class="nc">PneumaticActuator</span><span class="p">(</span><span class="n">ActuatorInterface</span><span class="p">):</span>
<span class="linenos">  2</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  3</span><span class="sd">    Pneumatic actuator implementation.</span>
<span class="linenos">  4</span>
<span class="linenos">  5</span><span class="sd">    Provides pressure-based control for linear and rotary</span>
<span class="linenos">  6</span><span class="sd">    pneumatic actuators with pressure feedback.</span>
<span class="linenos">  7</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">  8</span>
<span class="linenos">  9</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">DeviceConfig</span><span class="p">):</span>
<span class="linenos"> 10</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize pneumatic actuator.&quot;&quot;&quot;</span>
<span class="linenos"> 11</span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="linenos"> 12</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_actuator_type</span> <span class="o">=</span> <span class="n">ActuatorType</span><span class="o">.</span><span class="n">PNEUMATIC</span>
<span class="linenos"> 13</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_max_pressure</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_pressure&#39;</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">)</span>  <span class="c1"># bar</span>
<span class="linenos"> 14</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_cylinder_diameter</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cylinder_diameter&#39;</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">)</span>  <span class="c1"># mm</span>
<span class="linenos"> 15</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_stroke_length</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">operational_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stroke_length&#39;</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">)</span>  <span class="c1"># mm</span>
<span class="linenos"> 16</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_pressure</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span>        <span class="c1"># Initialize pneumatic capabilities</span>
<span class="linenos"> 19</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_add_pneumatic_capabilities</span><span class="p">()</span>
<span class="linenos"> 20</span>
<span class="linenos"> 21</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 22</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize pneumatic actuator.&quot;&quot;&quot;</span>
<span class="linenos"> 23</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initializing pneumatic actuator </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos"> 24</span>
<span class="linenos"> 25</span>        <span class="c1"># Initialize pneumatic valves and pressure sensors (simulated)</span>
<span class="linenos"> 26</span>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
<span class="linenos"> 27</span>
<span class="linenos"> 28</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="linenos"> 29</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos"> 30</span>
<span class="linenos"> 31</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 32</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Shutdown pneumatic actuator.&quot;&quot;&quot;</span>
<span class="linenos"> 33</span>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_pressure</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>  <span class="c1"># Release pressure</span>
<span class="linenos"> 34</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos"> 35</span>
<span class="linenos"> 36</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">read_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos"> 37</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read pneumatic actuator data.&quot;&quot;&quot;</span>
<span class="linenos"> 38</span>        <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;position&quot;</span><span class="p">:</span>
<span class="linenos"> 39</span>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span><span class="p">}</span>
<span class="linenos"> 40</span>        <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;pressure&quot;</span><span class="p">:</span>
<span class="linenos"> 41</span>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;pressure&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_pressure</span><span class="p">}</span>
<span class="linenos"> 42</span>        <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="s2">&quot;force&quot;</span><span class="p">:</span>
<span class="linenos"> 43</span>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;force&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_force</span><span class="p">}</span>
<span class="linenos"> 44</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 45</span>            <span class="k">return</span> <span class="p">{</span>
<span class="linenos"> 46</span>                <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span><span class="p">,</span>
<span class="linenos"> 47</span>                <span class="s2">&quot;pressure&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_pressure</span><span class="p">,</span>
<span class="linenos"> 48</span>                <span class="s2">&quot;force&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_force</span><span class="p">,</span>
<span class="linenos"> 49</span>                <span class="s2">&quot;is_moving&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">is_moving</span>
<span class="linenos"> 50</span>            <span class="p">}</span>
<span class="linenos"> 51</span>
<span class="linenos"> 52</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">write_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 53</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write data to pneumatic actuator.&quot;&quot;&quot;</span>
<span class="linenos"> 54</span>        <span class="k">if</span> <span class="s2">&quot;pressure&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
<span class="linenos"> 55</span>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_pressure</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;pressure&quot;</span><span class="p">])</span>
<span class="linenos"> 56</span>        <span class="k">elif</span> <span class="s2">&quot;position&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
<span class="linenos"> 57</span>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_position</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">])</span>
<span class="linenos"> 58</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos"> 59</span>
<span class="linenos"> 60</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">self_test</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="linenos"> 61</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform pneumatic actuator self-test.&quot;&quot;&quot;</span>
<span class="linenos"> 62</span>        <span class="n">test_results</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">self_test</span><span class="p">()</span>
<span class="linenos"> 63</span>
<span class="linenos"> 64</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 65</span>            <span class="c1"># Test pressure control</span>
<span class="linenos"> 66</span>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_pressure</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>  <span class="c1"># 2 bar</span>
<span class="linenos"> 67</span>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="linenos"> 68</span>            <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;pressure_control&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_pressure</span> <span class="o">-</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.2</span>
<span class="linenos"> 69</span>
<span class="linenos"> 70</span>            <span class="c1"># Test position control</span>
<span class="linenos"> 71</span>            <span class="n">initial_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span>
<span class="linenos"> 72</span>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_position</span><span class="p">(</span><span class="mf">50.0</span><span class="p">)</span>  <span class="c1"># Move to middle</span>
<span class="linenos"> 73</span>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
<span class="linenos"> 74</span>            <span class="n">position_error</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="o">-</span> <span class="mf">50.0</span><span class="p">)</span>
<span class="linenos"> 75</span>            <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;position_control&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">position_error</span> <span class="o">&lt;</span> <span class="mf">5.0</span>
<span class="linenos"> 76</span>
<span class="linenos"> 77</span>            <span class="c1"># Return to initial state</span>
<span class="linenos"> 78</span>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_position</span><span class="p">(</span><span class="n">initial_position</span><span class="p">)</span>
<span class="linenos"> 79</span>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_pressure</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
<span class="linenos"> 80</span>
<span class="linenos"> 81</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos"> 82</span>            <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;pneumatic_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="linenos"> 83</span>            <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;overall_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;FAIL&#39;</span>
<span class="linenos"> 84</span>
<span class="linenos"> 85</span>        <span class="k">return</span> <span class="n">test_results</span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">move_to_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">velocity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos"> 88</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Move pneumatic actuator to position.&quot;&quot;&quot;</span>
<span class="linenos"> 89</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 90</span>            <span class="c1"># Calculate required pressure for position</span>
<span class="linenos"> 91</span>            <span class="n">pressure_ratio</span> <span class="o">=</span> <span class="n">position</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stroke_length</span>
<span class="linenos"> 92</span>            <span class="n">required_pressure</span> <span class="o">=</span> <span class="n">pressure_ratio</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_pressure</span>
<span class="linenos"> 93</span>
<span class="linenos"> 94</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">target_position</span> <span class="o">=</span> <span class="n">position</span>
<span class="linenos"> 95</span>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_pressure</span><span class="p">(</span><span class="n">required_pressure</span><span class="p">)</span>
<span class="linenos"> 96</span>
<span class="linenos"> 97</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos"> 98</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to move to position </span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos"> 99</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">100</span>
<span class="linenos">101</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pressure</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">102</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set pneumatic pressure.&quot;&quot;&quot;</span>
<span class="linenos">103</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">104</span>            <span class="k">if</span> <span class="n">pressure</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_pressure</span><span class="p">:</span>
<span class="linenos">105</span>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pressure </span><span class="si">{</span><span class="n">pressure</span><span class="si">}</span><span class="s2"> exceeds maximum </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_pressure</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">106</span>                <span class="n">pressure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_pressure</span>
<span class="linenos">107</span>
<span class="linenos">108</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_pressure</span> <span class="o">=</span> <span class="n">pressure</span>
<span class="linenos">109</span>
<span class="linenos">110</span>            <span class="c1"># Calculate position based on pressure</span>
<span class="linenos">111</span>            <span class="n">position_ratio</span> <span class="o">=</span> <span class="n">pressure</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_pressure</span>
<span class="linenos">112</span>            <span class="n">new_position</span> <span class="o">=</span> <span class="n">position_ratio</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stroke_length</span>
<span class="linenos">113</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_position</span> <span class="o">=</span> <span class="n">new_position</span>
<span class="linenos">114</span>
<span class="linenos">115</span>            <span class="c1"># Calculate force</span>
<span class="linenos">116</span>            <span class="n">cylinder_area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cylinder_diameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>  <span class="c1"># mm²</span>
<span class="linenos">117</span>            <span class="n">force</span> <span class="o">=</span> <span class="n">pressure</span> <span class="o">*</span> <span class="mi">100000</span> <span class="o">*</span> <span class="p">(</span><span class="n">cylinder_area</span> <span class="o">/</span> <span class="mi">1000000</span><span class="p">)</span>  <span class="c1"># Convert to Newtons</span>
<span class="linenos">118</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_current_status</span><span class="o">.</span><span class="n">current_force</span> <span class="o">=</span> <span class="n">force</span>
<span class="linenos">119</span>
<span class="linenos">120</span>            <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">121</span>
<span class="linenos">122</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">123</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to set pressure </span><span class="si">{</span><span class="n">pressure</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">124</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">125</span>
<span class="linenos">126</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">velocity</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">127</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set pneumatic velocity (flow rate control).&quot;&quot;&quot;</span>
<span class="linenos">128</span>        <span class="c1"># Pneumatic velocity control typically done through flow restrictors</span>
<span class="linenos">129</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Velocity control requires flow rate control valves&quot;</span><span class="p">)</span>
<span class="linenos">130</span>        <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">131</span>
<span class="linenos">132</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_force</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">133</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set pneumatic force.&quot;&quot;&quot;</span>
<span class="linenos">134</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">135</span>            <span class="c1"># Calculate required pressure for force</span>
<span class="linenos">136</span>            <span class="n">cylinder_area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cylinder_diameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>  <span class="c1"># mm²</span>
<span class="linenos">137</span>            <span class="n">required_pressure</span> <span class="o">=</span> <span class="n">force</span> <span class="o">/</span> <span class="p">(</span><span class="mi">100000</span> <span class="o">*</span> <span class="p">(</span><span class="n">cylinder_area</span> <span class="o">/</span> <span class="mi">1000000</span><span class="p">))</span>  <span class="c1"># bar</span>
<span class="linenos">138</span>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_pressure</span><span class="p">(</span><span class="n">required_pressure</span><span class="p">)</span>
<span class="linenos">139</span>
<span class="linenos">140</span>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">141</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to set force </span><span class="si">{</span><span class="n">force</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">142</span>            <span class="k">return</span> <span class="kc">False</span>
<span class="linenos">143</span>
<span class="linenos">144</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">145</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop pneumatic motion.&quot;&quot;&quot;</span>
<span class="linenos">146</span>        <span class="c1"># For pneumatic actuators, &quot;stop&quot; typically means hold current position</span>
<span class="linenos">147</span>        <span class="k">return</span> <span class="kc">True</span>
<span class="linenos">148</span>
<span class="linenos">149</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">home</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="linenos">150</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Move pneumatic actuator to home position.&quot;&quot;&quot;</span>
<span class="linenos">151</span>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to_position</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
<span class="linenos">152</span>
<span class="linenos">153</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_add_pneumatic_capabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">154</span><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add pneumatic actuator capabilities.&quot;&quot;&quot;</span>
<span class="linenos">155</span>        <span class="bp">self</span><span class="o">.</span><span class="n">add_capability</span><span class="p">(</span><span class="n">DeviceCapability</span><span class="p">(</span>
<span class="linenos">156</span>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;position&quot;</span><span class="p">,</span>
<span class="linenos">157</span>            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Pneumatic actuator position&quot;</span><span class="p">,</span>
<span class="linenos">158</span>            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
<span class="linenos">159</span>            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;mm&quot;</span><span class="p">,</span>
<span class="linenos">160</span>            <span class="n">range_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<span class="linenos">161</span>            <span class="n">range_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_stroke_length</span><span class="p">,</span>
<span class="linenos">162</span>            <span class="n">read_only</span><span class="o">=</span><span class="kc">False</span>
<span class="linenos">163</span>        <span class="p">))</span>
<span class="linenos">164</span>
<span class="linenos">165</span>        <span class="bp">self</span><span class="o">.</span><span class="n">add_capability</span><span class="p">(</span><span class="n">DeviceCapability</span><span class="p">(</span>
<span class="linenos">166</span>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pressure&quot;</span><span class="p">,</span>
<span class="linenos">167</span>            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Pneumatic pressure&quot;</span><span class="p">,</span>
<span class="linenos">168</span>            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
<span class="linenos">169</span>            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span>
<span class="linenos">170</span>            <span class="n">range_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<span class="linenos">171</span>            <span class="n">range_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_pressure</span><span class="p">,</span>
<span class="linenos">172</span>            <span class="n">read_only</span><span class="o">=</span><span class="kc">False</span>
<span class="linenos">173</span>        <span class="p">))</span>
<span class="linenos">174</span>
<span class="linenos">175</span>        <span class="c1"># Calculate maximum force</span>
<span class="linenos">176</span>        <span class="n">cylinder_area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cylinder_diameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>  <span class="c1"># mm²</span>
<span class="linenos">177</span>        <span class="n">max_force</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_pressure</span> <span class="o">*</span> <span class="mi">100000</span> <span class="o">*</span> <span class="p">(</span><span class="n">cylinder_area</span> <span class="o">/</span> <span class="mi">1000000</span><span class="p">)</span>  <span class="c1"># Newtons</span>
<span class="linenos">178</span>
<span class="linenos">179</span>        <span class="bp">self</span><span class="o">.</span><span class="n">add_capability</span><span class="p">(</span><span class="n">DeviceCapability</span><span class="p">(</span>
<span class="linenos">180</span>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;force&quot;</span><span class="p">,</span>
<span class="linenos">181</span>            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Pneumatic force&quot;</span><span class="p">,</span>
<span class="linenos">182</span>            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
<span class="linenos">183</span>            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;N&quot;</span><span class="p">,</span>
<span class="linenos">184</span>            <span class="n">range_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<span class="linenos">185</span>            <span class="n">range_max</span><span class="o">=</span><span class="n">max_force</span><span class="p">,</span>
<span class="linenos">186</span>            <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span>
<span class="linenos">187</span>        <span class="p">))</span>
</pre></div>
</div>
</section>
<section id="methods-13">
<h4>Methods (13)<a class="headerlink" href="#methods-13" title="Link to this heading">¶</a></h4>
<section id="id27">
<h5><code class="docutils literal notranslate"><span class="pre">__init__(self,</span> <span class="pre">config)</span></code><a class="headerlink" href="#id27" title="Link to this heading">¶</a></h5>
<p>Initialize pneumatic actuator.</p>
<p><a class="reference internal" href="#method-pneumaticactuator-__init__"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="id28">
<h5><code class="docutils literal notranslate"><span class="pre">initialize(self)</span></code><a class="headerlink" href="#id28" title="Link to this heading">¶</a></h5>
<p>Initialize pneumatic actuator.</p>
<p><a class="reference internal" href="#method-pneumaticactuator-initialize"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="id29">
<h5><code class="docutils literal notranslate"><span class="pre">shutdown(self)</span></code><a class="headerlink" href="#id29" title="Link to this heading">¶</a></h5>
<p>Shutdown pneumatic actuator.</p>
<p><a class="reference internal" href="#method-pneumaticactuator-shutdown"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="id30">
<h5><code class="docutils literal notranslate"><span class="pre">read_data(self,</span> <span class="pre">channel)</span></code><a class="headerlink" href="#id30" title="Link to this heading">¶</a></h5>
<p>Read pneumatic actuator data.</p>
<p><a class="reference internal" href="#method-pneumaticactuator-read_data"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="id31">
<h5><code class="docutils literal notranslate"><span class="pre">write_data(self,</span> <span class="pre">data)</span></code><a class="headerlink" href="#id31" title="Link to this heading">¶</a></h5>
<p>Write data to pneumatic actuator.</p>
<p><a class="reference internal" href="#method-pneumaticactuator-write_data"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="id32">
<h5><code class="docutils literal notranslate"><span class="pre">self_test(self)</span></code><a class="headerlink" href="#id32" title="Link to this heading">¶</a></h5>
<p>Perform pneumatic actuator self-test.</p>
<p><a class="reference internal" href="#method-pneumaticactuator-self_test"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="id33">
<h5><code class="docutils literal notranslate"><span class="pre">move_to_position(self,</span> <span class="pre">position,</span> <span class="pre">velocity)</span></code><a class="headerlink" href="#id33" title="Link to this heading">¶</a></h5>
<p>Move pneumatic actuator to position.</p>
<p><a class="reference internal" href="#method-pneumaticactuator-move_to_position"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="set-pressure-self-pressure">
<h5><code class="docutils literal notranslate"><span class="pre">set_pressure(self,</span> <span class="pre">pressure)</span></code><a class="headerlink" href="#set-pressure-self-pressure" title="Link to this heading">¶</a></h5>
<p>Set pneumatic pressure.</p>
<p><a class="reference internal" href="#method-pneumaticactuator-set_pressure"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="id34">
<h5><code class="docutils literal notranslate"><span class="pre">set_velocity(self,</span> <span class="pre">velocity)</span></code><a class="headerlink" href="#id34" title="Link to this heading">¶</a></h5>
<p>Set pneumatic velocity (flow rate control).</p>
<p><a class="reference internal" href="#method-pneumaticactuator-set_velocity"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="id35">
<h5><code class="docutils literal notranslate"><span class="pre">set_force(self,</span> <span class="pre">force)</span></code><a class="headerlink" href="#id35" title="Link to this heading">¶</a></h5>
<p>Set pneumatic force.</p>
<p><a class="reference internal" href="#method-pneumaticactuator-set_force"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="id36">
<h5><code class="docutils literal notranslate"><span class="pre">stop(self)</span></code><a class="headerlink" href="#id36" title="Link to this heading">¶</a></h5>
<p>Stop pneumatic motion.</p>
<p><a class="reference internal" href="#method-pneumaticactuator-stop"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="id37">
<h5><code class="docutils literal notranslate"><span class="pre">home(self)</span></code><a class="headerlink" href="#id37" title="Link to this heading">¶</a></h5>
<p>Move pneumatic actuator to home position.</p>
<p><a class="reference internal" href="#method-pneumaticactuator-home"><span class="xref myst">View full source →</span></a></p>
</section>
<section id="add-pneumatic-capabilities-self">
<h5><code class="docutils literal notranslate"><span class="pre">_add_pneumatic_capabilities(self)</span></code><a class="headerlink" href="#add-pneumatic-capabilities-self" title="Link to this heading">¶</a></h5>
<p>Add pneumatic actuator capabilities.</p>
<p><a class="reference internal" href="#method-pneumaticactuator-_add_pneumatic_capabilities"><span class="xref myst">View full source →</span></a></p>
</section>
</section>
</section>
</section>
<hr class="docutils" />
<section id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Link to this heading">¶</a></h2>
<p>This module imports:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">asyncio</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">time</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">numpy</span> <span class="pre">as</span> <span class="pre">np</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">abc</span> <span class="pre">import</span> <span class="pre">ABC,</span> <span class="pre">abstractmethod</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">dataclasses</span> <span class="pre">import</span> <span class="pre">dataclass,</span> <span class="pre">field</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">typing</span> <span class="pre">import</span> <span class="pre">Dict,</span> <span class="pre">Any,</span> <span class="pre">Optional,</span> <span class="pre">List,</span> <span class="pre">Tuple</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">enum</span> <span class="pre">import</span> <span class="pre">Enum</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">logging</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">.device_drivers</span> <span class="pre">import</span> <span class="pre">DeviceDriver,</span> <span class="pre">DeviceConfig,</span> <span class="pre">DeviceCapability,</span> <span class="pre">DeviceState</span></code></p></li>
</ul>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Research Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on Oct 08, 2025</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">interfaces.hardware.actuators</a><ul>
<li><a class="reference internal" href="#module-overview">Module Overview</a></li>
<li><a class="reference internal" href="#complete-source-code">Complete Source Code</a></li>
<li><a class="reference internal" href="#classes">Classes</a><ul>
<li><a class="reference internal" href="#actuatortype"><code class="docutils literal notranslate"><span class="pre">ActuatorType</span></code></a><ul>
<li><a class="reference internal" href="#source-code">Source Code</a></li>
</ul>
</li>
<li><a class="reference internal" href="#actuatormode"><code class="docutils literal notranslate"><span class="pre">ActuatorMode</span></code></a><ul>
<li><a class="reference internal" href="#id1">Source Code</a></li>
</ul>
</li>
<li><a class="reference internal" href="#actuatorcommand"><code class="docutils literal notranslate"><span class="pre">ActuatorCommand</span></code></a><ul>
<li><a class="reference internal" href="#id2">Source Code</a></li>
</ul>
</li>
<li><a class="reference internal" href="#actuatorstatus"><code class="docutils literal notranslate"><span class="pre">ActuatorStatus</span></code></a><ul>
<li><a class="reference internal" href="#id3">Source Code</a></li>
</ul>
</li>
<li><a class="reference internal" href="#actuatorlimits"><code class="docutils literal notranslate"><span class="pre">ActuatorLimits</span></code></a><ul>
<li><a class="reference internal" href="#id4">Source Code</a></li>
</ul>
</li>
<li><a class="reference internal" href="#actuatorinterface"><code class="docutils literal notranslate"><span class="pre">ActuatorInterface</span></code></a><ul>
<li><a class="reference internal" href="#id5">Source Code</a></li>
<li><a class="reference internal" href="#methods-18">Methods (18)</a><ul>
<li><a class="reference internal" href="#init-self-config"><code class="docutils literal notranslate"><span class="pre">__init__(self,</span> <span class="pre">config)</span></code></a></li>
<li><a class="reference internal" href="#actuator-type-self"><code class="docutils literal notranslate"><span class="pre">actuator_type(self)</span></code></a></li>
<li><a class="reference internal" href="#control-mode-self"><code class="docutils literal notranslate"><span class="pre">control_mode(self)</span></code></a></li>
<li><a class="reference internal" href="#current-status-self"><code class="docutils literal notranslate"><span class="pre">current_status(self)</span></code></a></li>
<li><a class="reference internal" href="#limits-self"><code class="docutils literal notranslate"><span class="pre">limits(self)</span></code></a></li>
<li><a class="reference internal" href="#move-to-position-self-position-velocity"><code class="docutils literal notranslate"><span class="pre">move_to_position(self,</span> <span class="pre">position,</span> <span class="pre">velocity)</span></code></a></li>
<li><a class="reference internal" href="#set-velocity-self-velocity"><code class="docutils literal notranslate"><span class="pre">set_velocity(self,</span> <span class="pre">velocity)</span></code></a></li>
<li><a class="reference internal" href="#set-force-self-force"><code class="docutils literal notranslate"><span class="pre">set_force(self,</span> <span class="pre">force)</span></code></a></li>
<li><a class="reference internal" href="#stop-self"><code class="docutils literal notranslate"><span class="pre">stop(self)</span></code></a></li>
<li><a class="reference internal" href="#home-self"><code class="docutils literal notranslate"><span class="pre">home(self)</span></code></a></li>
<li><a class="reference internal" href="#set-control-mode-self-mode"><code class="docutils literal notranslate"><span class="pre">set_control_mode(self,</span> <span class="pre">mode)</span></code></a></li>
<li><a class="reference internal" href="#set-limits-self-limits"><code class="docutils literal notranslate"><span class="pre">set_limits(self,</span> <span class="pre">limits)</span></code></a></li>
<li><a class="reference internal" href="#is-at-target-self-tolerance"><code class="docutils literal notranslate"><span class="pre">is_at_target(self,</span> <span class="pre">tolerance)</span></code></a></li>
<li><a class="reference internal" href="#wait-for-motion-complete-self-timeout"><code class="docutils literal notranslate"><span class="pre">wait_for_motion_complete(self,</span> <span class="pre">timeout)</span></code></a></li>
<li><a class="reference internal" href="#emergency-stop-self"><code class="docutils literal notranslate"><span class="pre">emergency_stop(self)</span></code></a></li>
<li><a class="reference internal" href="#clear-faults-self"><code class="docutils literal notranslate"><span class="pre">clear_faults(self)</span></code></a></li>
<li><a class="reference internal" href="#check-safety-limits-self-command"><code class="docutils literal notranslate"><span class="pre">_check_safety_limits(self,</span> <span class="pre">command)</span></code></a></li>
<li><a class="reference internal" href="#add-command-to-queue-self-command"><code class="docutils literal notranslate"><span class="pre">_add_command_to_queue(self,</span> <span class="pre">command)</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#servoactuator"><code class="docutils literal notranslate"><span class="pre">ServoActuator</span></code></a><ul>
<li><a class="reference internal" href="#id6">Source Code</a></li>
<li><a class="reference internal" href="#methods-15">Methods (15)</a><ul>
<li><a class="reference internal" href="#id7"><code class="docutils literal notranslate"><span class="pre">__init__(self,</span> <span class="pre">config)</span></code></a></li>
<li><a class="reference internal" href="#initialize-self"><code class="docutils literal notranslate"><span class="pre">initialize(self)</span></code></a></li>
<li><a class="reference internal" href="#shutdown-self"><code class="docutils literal notranslate"><span class="pre">shutdown(self)</span></code></a></li>
<li><a class="reference internal" href="#read-data-self-channel"><code class="docutils literal notranslate"><span class="pre">read_data(self,</span> <span class="pre">channel)</span></code></a></li>
<li><a class="reference internal" href="#write-data-self-data"><code class="docutils literal notranslate"><span class="pre">write_data(self,</span> <span class="pre">data)</span></code></a></li>
<li><a class="reference internal" href="#self-test-self"><code class="docutils literal notranslate"><span class="pre">self_test(self)</span></code></a></li>
<li><a class="reference internal" href="#id8"><code class="docutils literal notranslate"><span class="pre">move_to_position(self,</span> <span class="pre">position,</span> <span class="pre">velocity)</span></code></a></li>
<li><a class="reference internal" href="#id9"><code class="docutils literal notranslate"><span class="pre">set_velocity(self,</span> <span class="pre">velocity)</span></code></a></li>
<li><a class="reference internal" href="#id10"><code class="docutils literal notranslate"><span class="pre">set_force(self,</span> <span class="pre">force)</span></code></a></li>
<li><a class="reference internal" href="#id11"><code class="docutils literal notranslate"><span class="pre">stop(self)</span></code></a></li>
<li><a class="reference internal" href="#id12"><code class="docutils literal notranslate"><span class="pre">home(self)</span></code></a></li>
<li><a class="reference internal" href="#position-control-loop-self-target-position-max-velocity"><code class="docutils literal notranslate"><span class="pre">_position_control_loop(self,</span> <span class="pre">target_position,</span> <span class="pre">max_velocity)</span></code></a></li>
<li><a class="reference internal" href="#velocity-control-loop-self-target-velocity"><code class="docutils literal notranslate"><span class="pre">_velocity_control_loop(self,</span> <span class="pre">target_velocity)</span></code></a></li>
<li><a class="reference internal" href="#update-status-self"><code class="docutils literal notranslate"><span class="pre">_update_status(self)</span></code></a></li>
<li><a class="reference internal" href="#add-servo-capabilities-self"><code class="docutils literal notranslate"><span class="pre">_add_servo_capabilities(self)</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#steppermotor"><code class="docutils literal notranslate"><span class="pre">StepperMotor</span></code></a><ul>
<li><a class="reference internal" href="#id13">Source Code</a></li>
<li><a class="reference internal" href="#id14">Methods (15)</a><ul>
<li><a class="reference internal" href="#id15"><code class="docutils literal notranslate"><span class="pre">__init__(self,</span> <span class="pre">config)</span></code></a></li>
<li><a class="reference internal" href="#id16"><code class="docutils literal notranslate"><span class="pre">initialize(self)</span></code></a></li>
<li><a class="reference internal" href="#id17"><code class="docutils literal notranslate"><span class="pre">shutdown(self)</span></code></a></li>
<li><a class="reference internal" href="#id18"><code class="docutils literal notranslate"><span class="pre">read_data(self,</span> <span class="pre">channel)</span></code></a></li>
<li><a class="reference internal" href="#id19"><code class="docutils literal notranslate"><span class="pre">write_data(self,</span> <span class="pre">data)</span></code></a></li>
<li><a class="reference internal" href="#id20"><code class="docutils literal notranslate"><span class="pre">self_test(self)</span></code></a></li>
<li><a class="reference internal" href="#id21"><code class="docutils literal notranslate"><span class="pre">move_to_position(self,</span> <span class="pre">position,</span> <span class="pre">velocity)</span></code></a></li>
<li><a class="reference internal" href="#move-to-step-self-target-step"><code class="docutils literal notranslate"><span class="pre">move_to_step(self,</span> <span class="pre">target_step)</span></code></a></li>
<li><a class="reference internal" href="#move-steps-self-step-count"><code class="docutils literal notranslate"><span class="pre">move_steps(self,</span> <span class="pre">step_count)</span></code></a></li>
<li><a class="reference internal" href="#id22"><code class="docutils literal notranslate"><span class="pre">set_velocity(self,</span> <span class="pre">velocity)</span></code></a></li>
<li><a class="reference internal" href="#id23"><code class="docutils literal notranslate"><span class="pre">set_force(self,</span> <span class="pre">force)</span></code></a></li>
<li><a class="reference internal" href="#id24"><code class="docutils literal notranslate"><span class="pre">stop(self)</span></code></a></li>
<li><a class="reference internal" href="#id25"><code class="docutils literal notranslate"><span class="pre">home(self)</span></code></a></li>
<li><a class="reference internal" href="#step-control-loop-self-target-step"><code class="docutils literal notranslate"><span class="pre">_step_control_loop(self,</span> <span class="pre">target_step)</span></code></a></li>
<li><a class="reference internal" href="#add-stepper-capabilities-self"><code class="docutils literal notranslate"><span class="pre">_add_stepper_capabilities(self)</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#pneumaticactuator"><code class="docutils literal notranslate"><span class="pre">PneumaticActuator</span></code></a><ul>
<li><a class="reference internal" href="#id26">Source Code</a></li>
<li><a class="reference internal" href="#methods-13">Methods (13)</a><ul>
<li><a class="reference internal" href="#id27"><code class="docutils literal notranslate"><span class="pre">__init__(self,</span> <span class="pre">config)</span></code></a></li>
<li><a class="reference internal" href="#id28"><code class="docutils literal notranslate"><span class="pre">initialize(self)</span></code></a></li>
<li><a class="reference internal" href="#id29"><code class="docutils literal notranslate"><span class="pre">shutdown(self)</span></code></a></li>
<li><a class="reference internal" href="#id30"><code class="docutils literal notranslate"><span class="pre">read_data(self,</span> <span class="pre">channel)</span></code></a></li>
<li><a class="reference internal" href="#id31"><code class="docutils literal notranslate"><span class="pre">write_data(self,</span> <span class="pre">data)</span></code></a></li>
<li><a class="reference internal" href="#id32"><code class="docutils literal notranslate"><span class="pre">self_test(self)</span></code></a></li>
<li><a class="reference internal" href="#id33"><code class="docutils literal notranslate"><span class="pre">move_to_position(self,</span> <span class="pre">position,</span> <span class="pre">velocity)</span></code></a></li>
<li><a class="reference internal" href="#set-pressure-self-pressure"><code class="docutils literal notranslate"><span class="pre">set_pressure(self,</span> <span class="pre">pressure)</span></code></a></li>
<li><a class="reference internal" href="#id34"><code class="docutils literal notranslate"><span class="pre">set_velocity(self,</span> <span class="pre">velocity)</span></code></a></li>
<li><a class="reference internal" href="#id35"><code class="docutils literal notranslate"><span class="pre">set_force(self,</span> <span class="pre">force)</span></code></a></li>
<li><a class="reference internal" href="#id36"><code class="docutils literal notranslate"><span class="pre">stop(self)</span></code></a></li>
<li><a class="reference internal" href="#id37"><code class="docutils literal notranslate"><span class="pre">home(self)</span></code></a></li>
<li><a class="reference internal" href="#add-pneumatic-capabilities-self"><code class="docutils literal notranslate"><span class="pre">_add_pneumatic_capabilities(self)</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#dependencies">Dependencies</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=4ebf8126"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=08e7b316"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../../_static/back-to-top.js?v=840797bb"></script>
    <script src="../../_static/lazy-load.js?v=dc25293c"></script>
    <script src="../../_static/dark-mode.js?v=bf328970"></script>
    </body>
</html>