<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Swing-Up SMC Technical Guide" href="swing_up_smc_technical_guide.html" /><link rel="prev" title="Hybrid Adaptive Super-Twisting SMC Technical Guide" href="hybrid_smc_technical_guide.html" />

    <!-- Generated with Sphinx 7.4.7 and Furo 2024.08.06 -->
        <title>Model Predictive Control Technical Guide - DIP_SMC_PSO Documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5349f25f" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=f5a89ef9" />
    
    


<style>
  body {
    --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">DIP_SMC_PSO Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">DIP_SMC_PSO Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">📚 Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../README.html">Optimal Sliding Mode Control for a Double-Inverted Pendulum via PSO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../theory_overview.html">1. Theoretical Background â€” Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">3. System Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plant_model.html">1.x Plant Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hil_quickstart.html">Hardware-in-the-Loop (HIL) Quickstart Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../streamlit_dashboard_guide.html">Streamlit Dashboard User Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">🎮 Control Systems &amp; Optimization</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Controllers Module Documentation</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Controllers Module Documentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="classical_smc_technical_guide.html">Classical Sliding Mode Control Technical Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="adaptive_smc_technical_guide.html">Adaptive Sliding Mode Control Technical Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="sta_smc_technical_guide.html">Super-Twisting Sliding Mode Control Technical Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="hybrid_smc_technical_guide.html">Hybrid Adaptive Super-Twisting SMC Technical Guide</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Model Predictive Control Technical Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="swing_up_smc_technical_guide.html">Swing-Up SMC Technical Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="factory_system_guide.html">SMC Controller Factory System Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="control_primitives_reference.html">Control Primitives Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mathematical_foundations/smc_complete_theory.html">Complete Sliding Mode Control Mathematical Theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mathematical_foundations/controller_comparison_theory.html">SMC Controller Comparison Theory</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../reference/controllers/index.html">Controllers Module</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Controllers Module</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/adaptive_smc.html">controllers.adaptive_smc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/classic_smc.html">controllers.classic_smc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/factory.html">controllers.factory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/mpc_controller.html">controllers.mpc_controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/sta_smc.html">controllers.sta_smc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/swing_up_smc.html">controllers.swing_up_smc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/__init__.html">controllers.<strong>init</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/base_controller_interface.html">controllers.base.controller_interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/base_control_primitives.html">controllers.base.control_primitives</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/base___init__.html">controllers.base.<strong>init</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/factory_deprecation.html">controllers.factory.deprecation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/factory_fallback_configs.html">controllers.factory.fallback_configs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/factory_legacy_factory.html">controllers.factory.legacy_factory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/factory_optimization.html">controllers.factory.optimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/factory_pso_integration.html">controllers.factory.pso_integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/factory_smc_factory.html">controllers.factory.smc_factory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/factory_thread_safety.html">controllers.factory.thread_safety</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/factory___init__.html">controllers.factory.<strong>init</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/mpc_mpc_controller.html">controllers.mpc.mpc_controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/mpc___init__.html">controllers.mpc.<strong>init</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc_adaptive_smc.html">controllers.smc.adaptive_smc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc_classic_smc.html">controllers.smc.classic_smc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc_hybrid_adaptive_sta_smc.html">controllers.smc.hybrid_adaptive_sta_smc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc_sta_smc.html">controllers.smc.sta_smc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc___init__.html">controllers.smc.<strong>init</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/specialized_swing_up_smc.html">controllers.specialized.swing_up_smc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/specialized___init__.html">controllers.specialized.<strong>init</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/factory_core_protocols.html">controllers.factory.core.protocols</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/factory_core_registry.html">controllers.factory.core.registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/factory_core_threading.html">controllers.factory.core.threading</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/factory_core_validation.html">controllers.factory.core.validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/factory_core___init__.html">controllers.factory.core.<strong>init</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc_algorithms___init__.html">controllers.smc.algorithms.<strong>init</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc_core_equivalent_control.html">controllers.smc.core.equivalent_control</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc_core_gain_validation.html">controllers.smc.core.gain_validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc_core_sliding_surface.html">controllers.smc.core.sliding_surface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc_core_switching_functions.html">controllers.smc.core.switching_functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc_core___init__.html">controllers.smc.core.<strong>init</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc_algorithms_adaptive_adaptation_law.html">controllers.smc.algorithms.adaptive.adaptation_law</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc_algorithms_adaptive_config.html">controllers.smc.algorithms.adaptive.config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc_algorithms_adaptive_controller.html">controllers.smc.algorithms.adaptive.controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc_algorithms_adaptive_parameter_estimation.html">controllers.smc.algorithms.adaptive.parameter_estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc_algorithms_adaptive___init__.html">controllers.smc.algorithms.adaptive.<strong>init</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc_algorithms_classical_boundary_layer.html">controllers.smc.algorithms.classical.boundary_layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc_algorithms_classical_config.html">controllers.smc.algorithms.classical.config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc_algorithms_classical_controller.html">controllers.smc.algorithms.classical.controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc_algorithms_classical___init__.html">controllers.smc.algorithms.classical.<strong>init</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc_algorithms_hybrid_config.html">controllers.smc.algorithms.hybrid.config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc_algorithms_hybrid_controller.html">controllers.smc.algorithms.hybrid.controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc_algorithms_hybrid_switching_logic.html">controllers.smc.algorithms.hybrid.switching_logic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc_algorithms_hybrid___init__.html">controllers.smc.algorithms.hybrid.<strong>init</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc_algorithms_super_twisting_config.html">controllers.smc.algorithms.super_twisting.config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc_algorithms_super_twisting_controller.html">controllers.smc.algorithms.super_twisting.controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc_algorithms_super_twisting_twisting_algorithm.html">controllers.smc.algorithms.super_twisting.twisting_algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/controllers/smc_algorithms_super_twisting___init__.html">controllers.smc.algorithms.super_twisting.<strong>init</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../mathematical_foundations/index.html">Mathematical Foundations</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Mathematical Foundations</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../mathematical_foundations/smc_complete_theory.html">Complete Sliding Mode Control Mathematical Theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mathematical_foundations/controller_comparison_theory.html">SMC Controller Comparison Theory</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../plant/models_guide.html">Plant Models Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optimization_simulation/guide.html">Optimization &amp; Simulation Guide</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../reference/controllers/index.html">Controllers Module</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Controllers Module</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/adaptive_smc.html">controllers.adaptive_smc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/classic_smc.html">controllers.classic_smc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/factory.html">controllers.factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/mpc_controller.html">controllers.mpc_controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/sta_smc.html">controllers.sta_smc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/swing_up_smc.html">controllers.swing_up_smc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/__init__.html">controllers.<strong>init</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/base_controller_interface.html">controllers.base.controller_interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/base_control_primitives.html">controllers.base.control_primitives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/base___init__.html">controllers.base.<strong>init</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/factory_deprecation.html">controllers.factory.deprecation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/factory_fallback_configs.html">controllers.factory.fallback_configs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/factory_legacy_factory.html">controllers.factory.legacy_factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/factory_optimization.html">controllers.factory.optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/factory_pso_integration.html">controllers.factory.pso_integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/factory_smc_factory.html">controllers.factory.smc_factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/factory_thread_safety.html">controllers.factory.thread_safety</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/factory___init__.html">controllers.factory.<strong>init</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/mpc_mpc_controller.html">controllers.mpc.mpc_controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/mpc___init__.html">controllers.mpc.<strong>init</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc_adaptive_smc.html">controllers.smc.adaptive_smc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc_classic_smc.html">controllers.smc.classic_smc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc_hybrid_adaptive_sta_smc.html">controllers.smc.hybrid_adaptive_sta_smc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc_sta_smc.html">controllers.smc.sta_smc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc___init__.html">controllers.smc.<strong>init</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/specialized_swing_up_smc.html">controllers.specialized.swing_up_smc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/specialized___init__.html">controllers.specialized.<strong>init</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/factory_core_protocols.html">controllers.factory.core.protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/factory_core_registry.html">controllers.factory.core.registry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/factory_core_threading.html">controllers.factory.core.threading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/factory_core_validation.html">controllers.factory.core.validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/factory_core___init__.html">controllers.factory.core.<strong>init</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc_algorithms___init__.html">controllers.smc.algorithms.<strong>init</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc_core_equivalent_control.html">controllers.smc.core.equivalent_control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc_core_gain_validation.html">controllers.smc.core.gain_validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc_core_sliding_surface.html">controllers.smc.core.sliding_surface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc_core_switching_functions.html">controllers.smc.core.switching_functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc_core___init__.html">controllers.smc.core.<strong>init</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc_algorithms_adaptive_adaptation_law.html">controllers.smc.algorithms.adaptive.adaptation_law</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc_algorithms_adaptive_config.html">controllers.smc.algorithms.adaptive.config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc_algorithms_adaptive_controller.html">controllers.smc.algorithms.adaptive.controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc_algorithms_adaptive_parameter_estimation.html">controllers.smc.algorithms.adaptive.parameter_estimation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc_algorithms_adaptive___init__.html">controllers.smc.algorithms.adaptive.<strong>init</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc_algorithms_classical_boundary_layer.html">controllers.smc.algorithms.classical.boundary_layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc_algorithms_classical_config.html">controllers.smc.algorithms.classical.config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc_algorithms_classical_controller.html">controllers.smc.algorithms.classical.controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc_algorithms_classical___init__.html">controllers.smc.algorithms.classical.<strong>init</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc_algorithms_hybrid_config.html">controllers.smc.algorithms.hybrid.config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc_algorithms_hybrid_controller.html">controllers.smc.algorithms.hybrid.controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc_algorithms_hybrid_switching_logic.html">controllers.smc.algorithms.hybrid.switching_logic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc_algorithms_hybrid___init__.html">controllers.smc.algorithms.hybrid.<strong>init</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc_algorithms_super_twisting_config.html">controllers.smc.algorithms.super_twisting.config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc_algorithms_super_twisting_controller.html">controllers.smc.algorithms.super_twisting.controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc_algorithms_super_twisting_twisting_algorithm.html">controllers.smc.algorithms.super_twisting.twisting_algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/controllers/smc_algorithms_super_twisting___init__.html">controllers.smc.algorithms.super_twisting.<strong>init</strong></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../reference/optimizer/index.html">Optimizer Module</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Optimizer Module</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/optimizer/pso_optimizer.html">optimizer.pso_optimizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/optimizer/__init__.html">optimizer.<strong>init</strong></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../analysis_plan.html">5. Analysis &amp; Verification Plan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../benchmarks_methodology.html">Benchmarks &amp; Methodology</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">🧪 Development &amp; Testing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../TESTING.html">Testing Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../test_protocols.html">5.x Test Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use_cases.html">4. Use Cases &amp; Operating Modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../context.html">2. Application Context</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault_detection_guide.html">Fault Detection &amp; Isolation (FDI) Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">📊 Research &amp; Theory</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../presentation/index.html">Research Presentation Materials</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Research Presentation Materials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../presentation/introduction.html">Abstract</a></li>
<li class="toctree-l2"><a class="reference internal" href="../presentation/introduction.html#introduction-and-motivation">Introduction and Motivation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../presentation/introduction.html#the-double-inverted-pendulum-as-a-canonical-control-problem">The Double Inverted Pendulum as a Canonical Control Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../presentation/introduction.html#the-primary-control-objectives-and-challenges">The Primary Control Objectives and Challenges</a></li>
<li class="toctree-l2"><a class="reference internal" href="../presentation/introduction.html#sliding-mode-control-as-a-robust-solution">Sliding Mode Control as a Robust Solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../presentation/introduction.html#the-gain-tuning-dilemma-and-the-need-for-optimization">The Gain Tuning Dilemma and the Need for Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../presentation/introduction.html#particle-swarm-optimization-for-automated-design">Particle Swarm Optimization for Automated Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../presentation/introduction.html#synthesis-and-motivation">Synthesis and Motivation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../presentation/introduction.html#references">References</a></li>
<li class="toctree-l2"><a class="reference internal" href="../presentation/problem-statement.html">Problem Statement for Double‑Inverted Pendulum (DIP) Control with SMC and PSO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../presentation/previous-works.html">Previous Work Before the Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../presentation/system-modeling.html"><strong>A Comprehensive Technical Report on the Modeling and Configuration of a Cart‑Based Double Inverted Pendulum System</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../presentation/smc-theory.html">Sliding Mode Control for a Double‑Inverted Pendulum: Bridging Theory and Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../presentation/chattering-mitigation.html">Abstract</a></li>
<li class="toctree-l2"><a class="reference internal" href="../presentation/chattering-mitigation.html#introduction">1 Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../presentation/chattering-mitigation.html#system-modelling-and-problem-formulation">2 System Modelling and Problem Formulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../presentation/chattering-mitigation.html#simulation-methodology">3 Simulation Methodology</a></li>
<li class="toctree-l2"><a class="reference internal" href="../presentation/chattering-mitigation.html#classic-sliding-mode-control">4 Classic Sliding Mode Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../presentation/chattering-mitigation.html#chattering-mitigation-strategy-i-boundary-layer-method">5 Chattering Mitigation Strategy I: Boundary Layer Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="../presentation/chattering-mitigation.html#chattering-mitigation-strategy-ii-supertwisting-algorithm">6 Chattering Mitigation Strategy II: Super‑Twisting Algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../presentation/chattering-mitigation.html#chattering-mitigation-strategy-iii-adaptive-sliding-mode-control">7 Chattering Mitigation Strategy III: Adaptive Sliding Mode Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../presentation/chattering-mitigation.html#chattering-mitigation-strategy-iv-hybrid-adaptivesta">8 Chattering Mitigation Strategy IV: Hybrid Adaptive–STA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../presentation/chattering-mitigation.html#synthesis-and-comparative-analysis">9 Synthesis and Comparative Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../presentation/chattering-mitigation.html#references">References</a></li>
<li class="toctree-l2"><a class="reference internal" href="../presentation/pso-optimization.html"><strong>Comprehensive Simulation Analysis and Enhancements for the Double Inverted Pendulum Control System</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../presentation/simulation-setup.html">Particle Swarm Optimization for Sliding‑Mode Controller Tuning of a Double Inverted Pendulum</a></li>
<li class="toctree-l2"><a class="reference internal" href="../presentation/results-discussion.html">8 – Results and Discussion</a></li>
<li class="toctree-l2"><a class="reference internal" href="../presentation/results-discussion.html#references">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/introduction.html">Abstract</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/introduction.html#introduction-and-motivation">Introduction and Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/introduction.html#the-double-inverted-pendulum-as-a-canonical-control-problem">The Double Inverted Pendulum as a Canonical Control Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/introduction.html#the-primary-control-objectives-and-challenges">The Primary Control Objectives and Challenges</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/introduction.html#sliding-mode-control-as-a-robust-solution">Sliding Mode Control as a Robust Solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/introduction.html#the-gain-tuning-dilemma-and-the-need-for-optimization">The Gain Tuning Dilemma and the Need for Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/introduction.html#particle-swarm-optimization-for-automated-design">Particle Swarm Optimization for Automated Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/introduction.html#synthesis-and-motivation">Synthesis and Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/introduction.html#references">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/problem-statement.html">Problem Statement for Double‑Inverted Pendulum (DIP) Control with SMC and PSO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/previous-works.html">Previous Work Before the Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/system-modeling.html"><strong>A Comprehensive Technical Report on the Modeling and Configuration of a Cart‑Based Double Inverted Pendulum System</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/smc-theory.html">Sliding Mode Control for a Double‑Inverted Pendulum: Bridging Theory and Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/chattering-mitigation.html">Abstract</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/chattering-mitigation.html#introduction">1 Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/chattering-mitigation.html#system-modelling-and-problem-formulation">2 System Modelling and Problem Formulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/chattering-mitigation.html#simulation-methodology">3 Simulation Methodology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/chattering-mitigation.html#classic-sliding-mode-control">4 Classic Sliding Mode Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/chattering-mitigation.html#chattering-mitigation-strategy-i-boundary-layer-method">5 Chattering Mitigation Strategy I: Boundary Layer Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/chattering-mitigation.html#chattering-mitigation-strategy-ii-supertwisting-algorithm">6 Chattering Mitigation Strategy II: Super‑Twisting Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/chattering-mitigation.html#chattering-mitigation-strategy-iii-adaptive-sliding-mode-control">7 Chattering Mitigation Strategy III: Adaptive Sliding Mode Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/chattering-mitigation.html#chattering-mitigation-strategy-iv-hybrid-adaptivesta">8 Chattering Mitigation Strategy IV: Hybrid Adaptive–STA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/chattering-mitigation.html#synthesis-and-comparative-analysis">9 Synthesis and Comparative Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/chattering-mitigation.html#references">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/pso-optimization.html"><strong>Comprehensive Simulation Analysis and Enhancements for the Double Inverted Pendulum Control System</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/simulation-setup.html">Particle Swarm Optimization for Sliding‑Mode Controller Tuning of a Double Inverted Pendulum</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/results-discussion.html">8 – Results and Discussion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../presentation/results-discussion.html#references">References</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">📖 API Reference &amp; Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Reference Documentation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../examples/index.html">Examples</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Examples</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">Bibliography &amp; Academic References</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">🔧 Project Management</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributing – ResearchPlanSpec Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../RELEASE_CHECKLIST.html">Release Checklist</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CHANGELOG.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../symbols.html">Symbols &amp; Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../results_readme.html">Results &amp; Plots</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="https://github.com/theSadeQ/DIP_SMC_PSO/blob/main/docs/controllers/mpc_technical_guide.md?plain=true" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div><div class="edit-this-page">
  <a class="muted-link" href="https://github.com/theSadeQ/DIP_SMC_PSO/edit/main/docs/controllers/mpc_technical_guide.md" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <p>#==========================================================================================\<br />
#===================== docs/controllers/mpc_technical_guide.md ========================\<br />
#==========================================================================================\</p>
<section class="tex2jax_ignore mathjax_ignore" id="model-predictive-control-technical-guide">
<h1>Model Predictive Control Technical Guide<a class="headerlink" href="#model-predictive-control-technical-guide" title="Link to this heading">¶</a></h1>
<section id="double-inverted-pendulum-control-system">
<h2>Double-Inverted Pendulum Control System<a class="headerlink" href="#double-inverted-pendulum-control-system" title="Link to this heading">¶</a></h2>
<p><strong>Document Version</strong>: 1.0
<strong>Created</strong>: 2025-10-04
<strong>Classification</strong>: Technical Implementation Guide
<strong>Controller Type</strong>: MPCController</p>
</section>
<hr class="docutils" />
<section id="executive-summary">
<h2>Executive Summary<a class="headerlink" href="#executive-summary" title="Link to this heading">¶</a></h2>
<p>The Model Predictive Controller (MPC) represents an optimization-based control paradigm that provides optimal control actions by solving a constrained quadratic programming problem at each timestep. Unlike reactive SMC approaches, MPC leverages a predictive model to anticipate future system behavior and optimize a cost function over a finite horizon.</p>
<p><strong>Performance Summary</strong>:</p>
<ul class="simple">
<li><p><strong>Horizon Length</strong>: 20 steps (default, configurable)</p></li>
<li><p><strong>Optimization Method</strong>: Quadratic Programming (QP) via cvxpy</p></li>
<li><p><strong>Convergence Type</strong>: Optimal (within QP tolerance)</p></li>
<li><p><strong>Computational Cost</strong>: Highest among controllers (O(N³) per solve)</p></li>
<li><p><strong>Constraint Handling</strong>: Explicit state/input constraints</p></li>
<li><p><strong>Runtime Status</strong>: ✅ <strong>OPERATIONAL</strong> (fallback-protected)</p></li>
</ul>
<p><strong>Best Use Cases</strong>:</p>
<ul class="simple">
<li><p>Systems requiring explicit constraint satisfaction</p></li>
<li><p>Applications with computational resources for real-time optimization</p></li>
<li><p>Trajectory tracking with known references</p></li>
<li><p>Research and performance benchmarking against SMC</p></li>
</ul>
<p><strong>Key Advantages</strong>:</p>
<ul class="simple">
<li><p>Systematic handling of constraints (force, position, angles)</p></li>
<li><p>Optimal control sequence over prediction horizon</p></li>
<li><p>Natural framework for trajectory tracking</p></li>
<li><p>Principled trade-off between performance and control effort</p></li>
</ul>
<p><strong>Limitations</strong>:</p>
<ul class="simple">
<li><p>Requires linearization around current state (local optimality)</p></li>
<li><p>Higher computational cost than SMC</p></li>
<li><p>Dependent on cvxpy solver availability</p></li>
<li><p>Performance degrades far from equilibrium</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#mathematical-foundation">Mathematical Foundation</a></p></li>
<li><p><a class="reference internal" href="#algorithm-architecture">Algorithm Architecture</a></p></li>
<li><p><a class="reference internal" href="#implementation-details">Implementation Details</a></p></li>
<li><p><a class="reference internal" href="#parameter-configuration">Parameter Configuration</a></p></li>
<li><p><a class="reference internal" href="#integration-guide">Integration Guide</a></p></li>
<li><p><a class="reference internal" href="#performance-characteristics">Performance Characteristics</a></p></li>
<li><p><a class="reference internal" href="#troubleshooting">Troubleshooting</a></p></li>
<li><p><a class="reference internal" href="#references">References</a></p></li>
</ol>
</section>
<hr class="docutils" />
<section id="mathematical-foundation">
<h2>Mathematical Foundation<a class="headerlink" href="#mathematical-foundation" title="Link to this heading">¶</a></h2>
<section id="receding-horizon-control-principle">
<h3>1. Receding Horizon Control Principle<a class="headerlink" href="#receding-horizon-control-principle" title="Link to this heading">¶</a></h3>
<p>Model Predictive Control operates on the <strong>receding horizon</strong> principle:</p>
<ol class="arabic simple">
<li><p><strong>Predict</strong>: Simulate system evolution over horizon N</p></li>
<li><p><strong>Optimize</strong>: Solve for control sequence U = [u₀, u₁, …, u_{N-1}] minimizing cost</p></li>
<li><p><strong>Apply</strong>: Execute only first control u₀</p></li>
<li><p><strong>Recede</strong>: Shift horizon forward and repeat</p></li>
</ol>
<p><strong>Optimality Property</strong>: At each step, MPC computes the optimal control sequence subject to constraints, but only the first control action is applied. This continuous re-optimization provides feedback and robustness to disturbances.</p>
</section>
<section id="system-dynamics-model">
<h3>2. System Dynamics Model<a class="headerlink" href="#system-dynamics-model" title="Link to this heading">¶</a></h3>
<section id="continuous-time-nonlinear-dynamics">
<h4>2.1 Continuous-Time Nonlinear Dynamics<a class="headerlink" href="#continuous-time-nonlinear-dynamics" title="Link to this heading">¶</a></h4>
<p>The double-inverted pendulum is governed by:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ẋ</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>State Vector</strong> (n = 6):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">θ</span><span class="err">₁</span><span class="p">,</span> <span class="n">θ</span><span class="err">₂</span><span class="p">,</span> <span class="n">ẋ</span><span class="p">,</span> <span class="n">θ̇</span><span class="err">₁</span><span class="p">,</span> <span class="n">θ̇</span><span class="err">₂</span><span class="p">]</span><span class="n">ᵀ</span>
</pre></div>
</div>
<p><strong>Control Input</strong> (m = 1):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">u</span> <span class="o">=</span> <span class="n">F_cart</span>  <span class="p">(</span><span class="n">horizontal</span> <span class="n">force</span> <span class="n">on</span> <span class="n">cart</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="linearization-around-equilibrium">
<h4>2.2 Linearization Around Equilibrium<a class="headerlink" href="#linearization-around-equilibrium" title="Link to this heading">¶</a></h4>
<p>MPC uses <strong>local linearization</strong> for tractable optimization:</p>
<p><strong>Equilibrium Point</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x_eq</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">π</span><span class="p">,</span> <span class="n">π</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="n">ᵀ</span>  <span class="p">(</span><span class="n">upright</span> <span class="n">position</span><span class="p">)</span>
<span class="n">u_eq</span> <span class="o">=</span> <span class="mi">0</span>  <span class="p">(</span><span class="n">no</span> <span class="n">force</span> <span class="n">required</span> <span class="n">at</span> <span class="n">equilibrium</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Linear Approximation</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ẋ</span> <span class="err">≈</span> <span class="n">A</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_eq</span><span class="p">)</span> <span class="o">+</span> <span class="n">B</span><span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">u_eq</span><span class="p">)</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">x_eq</span><span class="p">,</span> <span class="n">u_eq</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Jacobian Matrices</strong> (computed numerically):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="err">∂</span><span class="n">f</span><span class="o">/</span><span class="err">∂</span><span class="n">x</span> <span class="o">|</span><span class="n">_</span><span class="p">(</span><span class="n">x_eq</span><span class="p">,</span> <span class="n">u_eq</span><span class="p">)</span>  <span class="err">∈</span> <span class="n">ℝⁿˣⁿ</span>
<span class="n">B</span> <span class="o">=</span> <span class="err">∂</span><span class="n">f</span><span class="o">/</span><span class="err">∂</span><span class="n">u</span> <span class="o">|</span><span class="n">_</span><span class="p">(</span><span class="n">x_eq</span><span class="p">,</span> <span class="n">u_eq</span><span class="p">)</span>  <span class="err">∈</span> <span class="n">ℝⁿˣᵐ</span>
</pre></div>
</div>
<p><strong>Numerical Linearization</strong> (central finite differences):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">δ</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">eps</span><span class="p">,</span> <span class="mf">1e-4</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="o">|</span><span class="n">x_eq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">|</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
    <span class="n">A</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">x_eq</span> <span class="o">+</span> <span class="n">δeᵢ</span><span class="p">,</span> <span class="n">u_eq</span><span class="p">)</span> <span class="o">-</span> <span class="n">f</span><span class="p">(</span><span class="n">x_eq</span> <span class="o">-</span> <span class="n">δeᵢ</span><span class="p">,</span> <span class="n">u_eq</span><span class="p">)]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="n">δ</span><span class="p">)</span>

<span class="n">δ_u</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">eps</span><span class="p">,</span> <span class="mf">1e-4</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="o">|</span><span class="n">u_eq</span><span class="o">|</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
<span class="n">B</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">x_eq</span><span class="p">,</span> <span class="n">u_eq</span> <span class="o">+</span> <span class="n">δ_u</span><span class="p">)</span> <span class="o">-</span> <span class="n">f</span><span class="p">(</span><span class="n">x_eq</span><span class="p">,</span> <span class="n">u_eq</span> <span class="o">-</span> <span class="n">δ_u</span><span class="p">)]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="n">δ_u</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Advantages of Central Differences</strong>:</p>
<ul class="simple">
<li><p>Second-order accurate: O(δ²) truncation error</p></li>
<li><p>Reduces numerical bias compared to forward/backward differences</p></li>
<li><p>Adaptive scaling prevents rounding errors for small state values</p></li>
</ul>
</section>
<section id="discretization">
<h4>2.3 Discretization<a class="headerlink" href="#discretization" title="Link to this heading">¶</a></h4>
<p>Convert continuous dynamics to discrete-time for MPC optimization:</p>
<p><strong>Discrete-Time Dynamics</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x_</span><span class="p">{</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">}</span> <span class="o">=</span> <span class="n">A_d</span> <span class="n">x_k</span> <span class="o">+</span> <span class="n">B_d</span> <span class="n">u_k</span>
</pre></div>
</div>
<p><strong>Two Methods Available</strong>:</p>
<ol class="arabic">
<li><p><strong>Forward Euler</strong> (simple, approximate):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">A_d</span> <span class="o">=</span> <span class="n">I</span> <span class="o">+</span> <span class="n">A_c</span> <span class="n">Δt</span>
<span class="n">B_d</span> <span class="o">=</span> <span class="n">B_c</span> <span class="n">Δt</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Valid for small timesteps (Δt &lt;&lt; 1/max(|λ(A_c)|))</p></li>
<li><p>First-order accurate</p></li>
</ul>
</li>
<li><p><strong>Zero-Order Hold</strong> (exact, default):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">A_d</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="n">A_c</span> <span class="n">Δt</span><span class="p">)</span>
<span class="n">B_d</span> <span class="o">=</span> <span class="err">∫₀</span><span class="o">^</span><span class="n">Δt</span> <span class="n">exp</span><span class="p">(</span><span class="n">A_c</span> <span class="n">τ</span><span class="p">)</span> <span class="n">dτ</span> <span class="err">·</span> <span class="n">B_c</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Exact discretization for linear systems</p></li>
<li><p>Computed via matrix exponential: exp([A_c, B_c; 0, 0] Δt)</p></li>
</ul>
</li>
</ol>
</section>
</section>
<section id="mpc-optimization-problem">
<h3>3. MPC Optimization Problem<a class="headerlink" href="#mpc-optimization-problem" title="Link to this heading">¶</a></h3>
<section id="quadratic-programming-formulation">
<h4>3.1 Quadratic Programming Formulation<a class="headerlink" href="#quadratic-programming-formulation" title="Link to this heading">¶</a></h4>
<p>At time t, given current state x₀, solve:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">minimize</span>    <span class="n">Σ_</span><span class="p">{</span><span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">}</span><span class="o">^</span><span class="p">{</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span> <span class="p">[</span><span class="o">||</span><span class="n">x_k</span> <span class="o">-</span> <span class="n">x_ref</span><span class="o">||</span><span class="err">²</span><span class="n">_Q</span> <span class="o">+</span> <span class="o">||</span><span class="n">u_k</span><span class="o">||</span><span class="err">²</span><span class="n">_R</span><span class="p">]</span> <span class="o">+</span> <span class="o">||</span><span class="n">x_N</span> <span class="o">-</span> <span class="n">x_ref</span><span class="o">||</span><span class="err">²</span><span class="n">_Q</span>
<span class="n">subject</span> <span class="n">to</span><span class="p">:</span>
    <span class="n">x_</span><span class="p">{</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">}</span> <span class="o">=</span> <span class="n">A_d</span> <span class="n">x_k</span> <span class="o">+</span> <span class="n">B_d</span> <span class="n">u_k</span><span class="p">,</span>  <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">N</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">x_0</span> <span class="o">=</span> <span class="n">x</span><span class="err">₀</span>  <span class="p">(</span><span class="n">initial</span> <span class="n">condition</span><span class="p">)</span>
    <span class="o">|</span><span class="n">u_k</span><span class="o">|</span> <span class="err">≤</span> <span class="n">u_max</span>  <span class="p">(</span><span class="n">force</span> <span class="n">limits</span><span class="p">)</span>
    <span class="o">|</span><span class="n">x_k</span><span class="o">|</span> <span class="err">≤</span> <span class="n">x_max</span>  <span class="p">(</span><span class="n">cart</span> <span class="n">position</span> <span class="n">bounds</span><span class="p">)</span>
    <span class="o">|</span><span class="n">θ</span><span class="err">₁</span><span class="n">_k</span> <span class="o">-</span> <span class="n">π</span><span class="o">|</span> <span class="err">≤</span> <span class="n">θ_max</span>  <span class="p">(</span><span class="n">angle</span> <span class="n">deviation</span> <span class="kn">from</span><span class="w"> </span><span class="nn">upright</span><span class="p">)</span>
    <span class="o">|</span><span class="n">θ</span><span class="err">₂</span><span class="n">_k</span> <span class="o">-</span> <span class="n">π</span><span class="o">|</span> <span class="err">≤</span> <span class="n">θ_max</span>
</pre></div>
</div>
<p><strong>Decision Variables</strong>:</p>
<ul class="simple">
<li><p><strong>X</strong> = [x₀, x₁, …, x_N] ∈ ℝⁿˣ⁽ᴺ⁺¹⁾ (predicted state trajectory)</p></li>
<li><p><strong>U</strong> = [u₀, u₁, …, u_{N-1}] ∈ ℝᵐˣᴺ (control sequence)</p></li>
</ul>
<p><strong>Cost Function Components</strong>:</p>
<ol class="arabic">
<li><p><strong>State Tracking Cost</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">J_state</span> <span class="o">=</span> <span class="n">Σ_</span><span class="p">{</span><span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">}</span><span class="o">^</span><span class="p">{</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span> <span class="p">(</span><span class="n">x_k</span> <span class="o">-</span> <span class="n">x_ref</span><span class="p">)</span><span class="n">ᵀ</span> <span class="n">Q</span> <span class="p">(</span><span class="n">x_k</span> <span class="o">-</span> <span class="n">x_ref</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Q</strong> = diag([q_x, q_θ, q_θ, q_ẋ, q_θ̇, q_θ̇])</p></li>
<li><p>Penalizes deviation from reference trajectory</p></li>
</ul>
</li>
<li><p><strong>Control Effort Cost</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">J_input</span> <span class="o">=</span> <span class="n">Σ_</span><span class="p">{</span><span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">}</span><span class="o">^</span><span class="p">{</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span> <span class="n">u_k</span><span class="err">²</span> <span class="n">R</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>R</strong> = r_u (scalar for single input)</p></li>
<li><p>Penalizes excessive control effort</p></li>
</ul>
</li>
<li><p><strong>Terminal Cost</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">J_terminal</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_N</span> <span class="o">-</span> <span class="n">x_ref</span><span class="p">)</span><span class="n">ᵀ</span> <span class="n">Q</span> <span class="p">(</span><span class="n">x_N</span> <span class="o">-</span> <span class="n">x_ref</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Ensures good final state at end of horizon</p></li>
<li><p>Same weight matrix Q as stage cost</p></li>
</ul>
</li>
</ol>
<p><strong>Total Cost</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">J</span> <span class="o">=</span> <span class="n">J_state</span> <span class="o">+</span> <span class="n">J_input</span> <span class="o">+</span> <span class="n">J_terminal</span>
</pre></div>
</div>
</section>
<section id="constraint-handling">
<h4>3.2 Constraint Handling<a class="headerlink" href="#constraint-handling" title="Link to this heading">¶</a></h4>
<p>MPC explicitly encodes physical and safety constraints:</p>
<p><strong>Input Constraints</strong> (actuator limits):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">F_max</span> <span class="err">≤</span> <span class="n">u_k</span> <span class="err">≤</span> <span class="n">F_max</span><span class="p">,</span>  <span class="err">∀</span><span class="n">k</span>
</pre></div>
</div>
<p><strong>State Constraints</strong>:</p>
<ul class="simple">
<li><p><strong>Cart Position</strong>: |x_k| ≤ x_max (default: 2.4 m)</p></li>
<li><p><strong>Angle Deviation</strong>: |θᵢ_k - π| ≤ θ_max (default: 0.5 rad ≈ 28.6°)</p></li>
</ul>
<p><strong>Constraint Tightening</strong>: For robust MPC, constraints can be tightened to account for linearization errors and disturbances.</p>
</section>
</section>
<section id="solution-method">
<h3>4. Solution Method<a class="headerlink" href="#solution-method" title="Link to this heading">¶</a></h3>
<section id="quadratic-programming-via-cvxpy">
<h4>4.1 Quadratic Programming via cvxpy<a class="headerlink" href="#quadratic-programming-via-cvxpy" title="Link to this heading">¶</a></h4>
<p>The MPC problem is a <strong>convex quadratic program</strong> (QP):</p>
<p><strong>Standard QP Form</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">minimize</span>    <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="n">zᵀ</span> <span class="n">P</span> <span class="n">z</span> <span class="o">+</span> <span class="n">qᵀ</span> <span class="n">z</span>
<span class="n">subject</span> <span class="n">to</span>  <span class="n">G</span> <span class="n">z</span> <span class="err">≤</span> <span class="n">h</span>  <span class="p">(</span><span class="n">inequality</span> <span class="n">constraints</span><span class="p">)</span>
            <span class="n">A</span> <span class="n">z</span> <span class="o">=</span> <span class="n">b</span>  <span class="p">(</span><span class="n">equality</span> <span class="n">constraints</span><span class="p">)</span>
</pre></div>
</div>
<p>where z = [X(:); U(:)] stacks all decision variables.</p>
<p><strong>Solver</strong>: OSQP (Operator Splitting Quadratic Program) preferred</p>
<ul class="simple">
<li><p>Warm start capability for faster convergence</p></li>
<li><p>Suitable for real-time embedded applications</p></li>
<li><p>Fallback to default cvxpy solver if OSQP unavailable</p></li>
</ul>
<p><strong>Warm Start Strategy</strong>:</p>
<ul class="simple">
<li><p>Cache previous optimal control sequence U*_{prev}</p></li>
<li><p>Initialize U_{current} = shift(U*_{prev}, 0)  (shift and append zero)</p></li>
<li><p>Significantly reduces solve time (5-10× speedup typical)</p></li>
</ul>
</section>
<section id="computational-complexity">
<h4>4.2 Computational Complexity<a class="headerlink" href="#computational-complexity" title="Link to this heading">¶</a></h4>
<p><strong>Per-Step Complexity</strong>:</p>
<ul class="simple">
<li><p><strong>QP Solve</strong>: O(N³) for interior-point methods, O(N) iterations for OSQP</p></li>
<li><p><strong>Linearization</strong>: O(n²) for Jacobian computation</p></li>
<li><p><strong>Total</strong>: Dominated by QP solve</p></li>
</ul>
<p><strong>Typical Solve Time</strong> (N=20, n=6, m=1):</p>
<ul class="simple">
<li><p>Cold start: 5-10 ms</p></li>
<li><p>Warm start: 1-3 ms</p></li>
<li><p>SMC comparison: 0.01-0.1 ms (10-100× faster)</p></li>
</ul>
<p><strong>Real-Time Feasibility</strong>:</p>
<ul class="simple">
<li><p>Suitable for control frequencies up to ~100 Hz (with warm start)</p></li>
<li><p>HIL applications may require shorter horizons (N=10) for &lt;10 ms latency</p></li>
</ul>
</section>
</section>
</section>
<hr class="docutils" />
<section id="algorithm-architecture">
<h2>Algorithm Architecture<a class="headerlink" href="#algorithm-architecture" title="Link to this heading">¶</a></h2>
<section id="mpc-controller-workflow">
<h3>1. MPC Controller Workflow<a class="headerlink" href="#mpc-controller-workflow" title="Link to this heading">¶</a></h3>
<div class="highlight-mermaid notranslate"><div class="highlight"><pre><span></span>graph TB
    A[Measure State x₀] --&gt; B{cvxpy Available?}
    B -- Yes --&gt; C[Linearize Around x₀]
    B -- No --&gt; H[Simple Feedback Fallback]
    C --&gt; D[Discretize: A_c, B_c → A_d, B_d]
    D --&gt; E[Setup QP: Variables X, U]
    E --&gt; F[Add Cost: Q, R weights]
    F --&gt; G[Add Constraints: u_max, x_max, θ_max]
    G --&gt; I{Solve QP}
    I -- Success --&gt; J[Extract u₀, Cache U*]
    I -- Failure --&gt; K[Safe Fallback: SMC or PD]
    J --&gt; L[Apply u₀, Update Last Output]
    K --&gt; L
    H --&gt; L
    L --&gt; M[Return Control u]
</pre></div>
</div>
</section>
<section id="key-components">
<h3>2. Key Components<a class="headerlink" href="#key-components" title="Link to this heading">¶</a></h3>
<section id="linearization-module">
<h4>2.1 Linearization Module<a class="headerlink" href="#linearization-module" title="Link to this heading">¶</a></h4>
<p><strong>Function</strong>: <code class="docutils literal notranslate"><span class="pre">_numeric_linearize_continuous(dyn,</span> <span class="pre">x_eq,</span> <span class="pre">u_eq)</span></code></p>
<p><strong>Method</strong>: Central finite differences with adaptive perturbations</p>
<p><strong>Implementation</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_numeric_linearize_continuous</span><span class="p">(</span><span class="n">dyn</span><span class="p">,</span> <span class="n">x_eq</span><span class="p">,</span> <span class="n">u_eq</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute Jacobian matrices A, B around (x_eq, u_eq).</span>

<span class="sd">    Returns:</span>
<span class="sd">        A: ∂f/∂x ∈ ℝⁿˣⁿ</span>
<span class="sd">        B: ∂f/∂u ∈ ℝⁿˣᵐ</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">x_eq</span><span class="o">.</span><span class="n">size</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">δ</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">eps</span><span class="p">,</span> <span class="mf">1e-4</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x_eq</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="mf">1.0</span><span class="p">))</span>
        <span class="n">δ</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">δ</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">)</span>  <span class="c1"># Prevent division by zero</span>

        <span class="n">f_plus</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="n">x_eq</span> <span class="o">+</span> <span class="n">δ</span><span class="o">*</span><span class="n">e_i</span><span class="p">,</span> <span class="n">u_eq</span><span class="p">)</span>
        <span class="n">f_minus</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="n">x_eq</span> <span class="o">-</span> <span class="n">δ</span><span class="o">*</span><span class="n">e_i</span><span class="p">,</span> <span class="n">u_eq</span><span class="p">)</span>
        <span class="n">A</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">f_plus</span> <span class="o">-</span> <span class="n">f_minus</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">δ</span><span class="p">)</span>

    <span class="n">δ_u</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">eps</span><span class="p">,</span> <span class="mf">1e-4</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">u_eq</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">))</span>
    <span class="n">δ_u</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">δ_u</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">)</span>

    <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">dyn</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="n">x_eq</span><span class="p">,</span> <span class="n">u_eq</span> <span class="o">+</span> <span class="n">δ_u</span><span class="p">)</span> <span class="o">-</span> <span class="n">dyn</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="n">x_eq</span><span class="p">,</span> <span class="n">u_eq</span> <span class="o">-</span> <span class="n">δ_u</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">δ_u</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span>
</pre></div>
</div>
<p><strong>Line-by-Line Breakdown</strong>:</p>
<ul class="simple">
<li><p><strong>Lines 113-116</strong>: Adaptive perturbation δ scales with state magnitude</p>
<ul>
<li><p>Prevents rounding errors for small states (δ = 1e-12 minimum)</p></li>
<li><p>Balances truncation vs rounding error</p></li>
</ul>
</li>
<li><p><strong>Lines 120-122</strong>: Central difference for A matrix columns</p>
<ul>
<li><p>O(δ²) accuracy vs O(δ) for forward differences</p></li>
</ul>
</li>
<li><p><strong>Lines 124-130</strong>: Input matrix B computed similarly</p></li>
</ul>
</section>
<section id="discretization-module">
<h4>2.2 Discretization Module<a class="headerlink" href="#discretization-module" title="Link to this heading">¶</a></h4>
<p><strong>Function</strong>: <code class="docutils literal notranslate"><span class="pre">_discretize_exact(A_c,</span> <span class="pre">B_c,</span> <span class="pre">dt)</span></code> (default)</p>
<p><strong>Zero-Order Hold Method</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_discretize_exact</span><span class="p">(</span><span class="n">A_c</span><span class="p">,</span> <span class="n">B_c</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exact ZOH discretization via matrix exponential.</span>

<span class="sd">    Theory:</span>
<span class="sd">        x(t+Δt) = exp(A_c Δt) x(t) + [∫₀^Δt exp(A_c τ) dτ] B_c u(t)</span>

<span class="sd">    Implementation:</span>
<span class="sd">        M = [A_c, B_c; 0, 0]</span>
<span class="sd">        exp(M Δt) = [A_d, B_d; 0, I]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">A_c</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">M</span><span class="p">[:</span><span class="n">n</span><span class="p">,</span> <span class="p">:</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">A_c</span>
    <span class="n">M</span><span class="p">[:</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">:]</span> <span class="o">=</span> <span class="n">B_c</span>

    <span class="n">M_exp</span> <span class="o">=</span> <span class="n">expm</span><span class="p">(</span><span class="n">M</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>  <span class="c1"># scipy.linalg.expm</span>

    <span class="n">A_d</span> <span class="o">=</span> <span class="n">M_exp</span><span class="p">[:</span><span class="n">n</span><span class="p">,</span> <span class="p">:</span><span class="n">n</span><span class="p">]</span>
    <span class="n">B_d</span> <span class="o">=</span> <span class="n">M_exp</span><span class="p">[:</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">A_d</span><span class="p">,</span> <span class="n">B_d</span>
</pre></div>
</div>
<p><strong>Mathematical Justification</strong>:</p>
<ul class="simple">
<li><p>Solution to linear ODE: x(t) = exp(At)x(0) + ∫exp(A(t-τ))Bu(τ)dτ</p></li>
<li><p>For piecewise-constant input (ZOH): u(τ) = u₀ on [0, Δt)</p></li>
<li><p>Integral evaluates to: [A⁻¹(exp(AΔt) - I)]B = A_d B_d</p></li>
</ul>
<p><strong>Alternative</strong>: Forward Euler discretization available via <code class="docutils literal notranslate"><span class="pre">use_exact_discretization=False</span></code></p>
</section>
<section id="qp-solver-integration-cvxpy">
<h4>2.3 QP Solver Integration (cvxpy)<a class="headerlink" href="#qp-solver-integration-cvxpy" title="Link to this heading">¶</a></h4>
<p><strong>Setup Phase</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Decision variables</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># State trajectory</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>    <span class="c1"># Control sequence</span>

<span class="c1"># Cost function</span>
<span class="n">Q</span> <span class="o">=</span> <span class="n">diag</span><span class="p">([</span><span class="n">q_x</span><span class="p">,</span> <span class="n">q_θ</span><span class="p">,</span> <span class="n">q_θ</span><span class="p">,</span> <span class="n">q_ẋ</span><span class="p">,</span> <span class="n">q_θ̇</span><span class="p">,</span> <span class="n">q_θ̇</span><span class="p">])</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">r_u</span>

<span class="n">obj</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">constraints</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">x</span><span class="err">₀</span><span class="p">]</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="c1"># Stage cost</span>
    <span class="n">e_k</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_ref</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span>
    <span class="n">obj</span> <span class="o">+=</span> <span class="n">cp</span><span class="o">.</span><span class="n">quad_form</span><span class="p">(</span><span class="n">e_k</span><span class="p">,</span> <span class="n">Q</span><span class="p">)</span> <span class="o">+</span> <span class="n">cp</span><span class="o">.</span><span class="n">quad_form</span><span class="p">(</span><span class="n">U</span><span class="p">[:,</span> <span class="n">k</span><span class="p">],</span> <span class="n">R</span><span class="p">)</span>

    <span class="c1"># Dynamics constraint</span>
    <span class="n">constraints</span> <span class="o">+=</span> <span class="p">[</span><span class="n">X</span><span class="p">[:,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">A_d</span> <span class="o">@</span> <span class="n">X</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">B_d</span> <span class="o">@</span> <span class="n">U</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]]</span>

    <span class="c1"># Input bounds</span>
    <span class="n">constraints</span> <span class="o">+=</span> <span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">max_force</span><span class="p">]</span>

    <span class="c1"># State bounds</span>
    <span class="n">constraints</span> <span class="o">+=</span> <span class="p">[</span>
        <span class="n">cp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">max_cart_pos</span><span class="p">,</span>
        <span class="n">cp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">π</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_theta_dev</span><span class="p">,</span>
        <span class="n">cp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">π</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_theta_dev</span>
    <span class="p">]</span>

<span class="c1"># Terminal cost</span>
<span class="n">e_N</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="n">N</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_ref</span><span class="p">[:,</span> <span class="n">N</span><span class="p">]</span>
<span class="n">obj</span> <span class="o">+=</span> <span class="n">cp</span><span class="o">.</span><span class="n">quad_form</span><span class="p">(</span><span class="n">e_N</span><span class="p">,</span> <span class="n">Q</span><span class="p">)</span>

<span class="n">problem</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Problem</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">Minimize</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="n">constraints</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Solve Phase</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Warm start with previous solution</span>
<span class="n">U</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">U_prev</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Solve (prefer OSQP)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="n">cp</span><span class="o">.</span><span class="n">OSQP</span><span class="p">,</span> <span class="n">warm_start</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="k">if</span> <span class="n">problem</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">OPTIMAL</span><span class="p">,</span> <span class="n">cp</span><span class="o">.</span><span class="n">OPTIMAL_INACCURATE</span><span class="p">]:</span>
    <span class="n">u_optimal</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">U_prev</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Cache for next step</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">u_optimal</span> <span class="o">=</span> <span class="n">safe_fallback</span><span class="p">(</span><span class="n">x</span><span class="err">₀</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Solver Status Handling</strong>:</p>
<ul class="simple">
<li><p><strong>OPTIMAL</strong>: Solution found within tolerance</p></li>
<li><p><strong>OPTIMAL_INACCURATE</strong>: Suboptimal but usable solution</p></li>
<li><p><strong>INFEASIBLE/UNBOUNDED</strong>: Use fallback controller</p></li>
<li><p><strong>SOLVER_ERROR</strong>: Linearization failure or numerical issues</p></li>
</ul>
</section>
<section id="fallback-controller-strategy">
<h4>2.4 Fallback Controller Strategy<a class="headerlink" href="#fallback-controller-strategy" title="Link to this heading">¶</a></h4>
<p>When QP fails or cvxpy unavailable:</p>
<p><strong>Hierarchy</strong>:</p>
<ol class="arabic">
<li><p><strong>ClassicalSMC</strong> (if available and gains provided)</p>
<ul class="simple">
<li><p>Full SMC control law with boundary layer</p></li>
<li><p>Uses configured or default gains: [6, 6, 12, 12, 60, 1.5]</p></li>
<li><p>Maintains controller state for consistency</p></li>
</ul>
</li>
<li><p><strong>Simple PD Control</strong> (last resort)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">θ_err</span> <span class="o">=</span> <span class="p">(</span><span class="n">θ</span><span class="err">₁</span> <span class="o">-</span> <span class="n">π</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">θ</span><span class="err">₂</span> <span class="o">-</span> <span class="n">π</span><span class="p">)</span>
<span class="n">θ̇_err</span> <span class="o">=</span> <span class="n">θ̇</span><span class="err">₁</span> <span class="o">+</span> <span class="n">θ̇</span><span class="err">₂</span>
<span class="n">u</span> <span class="o">=</span> <span class="o">-</span><span class="n">k_p</span> <span class="n">θ_err</span> <span class="o">-</span> <span class="n">k_d</span> <span class="n">θ̇_err</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Default gains: k_p = 20, k_d = 5</p></li>
<li><p>Angle-aware: regulates around upright (π)</p></li>
</ul>
</li>
</ol>
<p><strong>Fallback Logic</strong> (source: <code class="docutils literal notranslate"><span class="pre">mpc_controller.py:428-463</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_safe_fallback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="err">₀</span><span class="p">):</span>
    <span class="c1"># Prefer SMC if instantiated</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fallback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">u</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fallback</span><span class="o">.</span><span class="n">compute_control</span><span class="p">(</span><span class="n">x</span><span class="err">₀</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">clip</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="o">-</span><span class="n">max_force</span><span class="p">,</span> <span class="n">max_force</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># Degrade to PD</span>

    <span class="c1"># Conservative PD on angles</span>
    <span class="n">θ_err</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="err">₀</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">π</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="err">₀</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">π</span><span class="p">)</span>
    <span class="n">θ̇_err</span> <span class="o">=</span> <span class="n">x</span><span class="err">₀</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="err">₀</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">u</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_pd_kp</span> <span class="o">*</span> <span class="n">θ_err</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pd_kd</span> <span class="o">*</span> <span class="n">θ̇_err</span>
    <span class="k">return</span> <span class="n">clip</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="o">-</span><span class="n">max_force</span><span class="p">,</span> <span class="n">max_force</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="additional-features">
<h3>3. Additional Features<a class="headerlink" href="#additional-features" title="Link to this heading">¶</a></h3>
<section id="reference-trajectory-tracking">
<h4>3.1 Reference Trajectory Tracking<a class="headerlink" href="#reference-trajectory-tracking" title="Link to this heading">¶</a></h4>
<p><strong>Set Custom Reference</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">ref_fn</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Time-varying reference trajectory.&quot;&quot;&quot;</span>
    <span class="n">x_target</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">π</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>  <span class="c1"># Sinusoidal cart motion</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x_target</span><span class="p">,</span> <span class="n">π</span><span class="p">,</span> <span class="n">π</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="n">mpc</span><span class="o">.</span><span class="n">set_reference</span><span class="p">(</span><span class="n">ref_fn</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Default Reference</strong>: Upright equilibrium at current time</p>
</section>
<section id="slew-rate-limiting">
<h4>3.2 Slew Rate Limiting<a class="headerlink" href="#slew-rate-limiting" title="Link to this heading">¶</a></h4>
<p><strong>Purpose</strong>: Reduce chattering and mechanical jerk</p>
<p><strong>Implementation</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">max_du</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">du</span> <span class="o">=</span> <span class="n">clip</span><span class="p">(</span><span class="n">u_cmd</span> <span class="o">-</span> <span class="n">u_last</span><span class="p">,</span> <span class="o">-</span><span class="n">max_du</span><span class="p">,</span> <span class="n">max_du</span><span class="p">)</span>
    <span class="n">u_cmd</span> <span class="o">=</span> <span class="n">u_last</span> <span class="o">+</span> <span class="n">du</span>
</pre></div>
</div>
<p><strong>Effect</strong>: Limits Δu between timesteps, smoothing control signal</p>
</section>
</section>
</section>
<hr class="docutils" />
<section id="implementation-details">
<h2>Implementation Details<a class="headerlink" href="#implementation-details" title="Link to this heading">¶</a></h2>
<section id="full-source-code-structure">
<h3>1. Full Source Code Structure<a class="headerlink" href="#full-source-code-structure" title="Link to this heading">¶</a></h3>
<p><strong>File</strong>: <code class="docutils literal notranslate"><span class="pre">src/controllers/mpc/mpc_controller.py</span></code> (487 lines)</p>
<p><strong>Key Classes and Functions</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MPCWeights</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Cost function weights for MPC optimization.&quot;&quot;&quot;</span>
    <span class="n">q_x</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>          <span class="c1"># Cart position</span>
    <span class="n">q_theta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10.0</span>     <span class="c1"># Pendulum angles</span>
    <span class="n">q_xdot</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span>       <span class="c1"># Cart velocity</span>
    <span class="n">q_thetadot</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span>   <span class="c1"># Angular velocities</span>
    <span class="n">r_u</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-2</span>         <span class="c1"># Input effort</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MPCController</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Linear MPC for double-inverted pendulum.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dynamics_model</span><span class="p">:</span> <span class="n">DoubleInvertedPendulum</span><span class="p">,</span>
        <span class="n">horizon</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
        <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.02</span><span class="p">,</span>
        <span class="n">weights</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MPCWeights</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_force</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">20.0</span><span class="p">,</span>
        <span class="n">max_cart_pos</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.4</span><span class="p">,</span>
        <span class="n">max_theta_dev</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">use_exact_discretization</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">fallback_smc_gains</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fallback_pd_gains</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_du</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize MPC controller with configuration.&quot;&quot;&quot;</span>
        <span class="o">...</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">x</span><span class="err">₀</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Solve MPC QP and return optimal control.&quot;&quot;&quot;</span>
        <span class="o">...</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_safe_fallback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="err">₀</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fallback controller when QP fails.&quot;&quot;&quot;</span>
        <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="critical-code-sections">
<h3>2. Critical Code Sections<a class="headerlink" href="#critical-code-sections" title="Link to this heading">¶</a></h3>
<section id="linearization-lines-72-131">
<h4>2.1 Linearization (Lines 72-131)<a class="headerlink" href="#linearization-lines-72-131" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_numeric_linearize_continuous</span><span class="p">(</span><span class="n">dyn</span><span class="p">,</span> <span class="n">x_eq</span><span class="p">,</span> <span class="n">u_eq</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Central finite difference Jacobian computation.</span>

<span class="sd">    Key Innovation: Adaptive perturbation prevents numerical issues.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x_eq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x_eq</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">x_eq</span><span class="o">.</span><span class="n">size</span>
    <span class="n">f0</span> <span class="o">=</span> <span class="n">_call_f</span><span class="p">(</span><span class="n">dyn</span><span class="p">,</span> <span class="n">x_eq</span><span class="p">,</span> <span class="n">u_eq</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="c1"># Adaptive step: δ ∝ |x_eq[i]| with floor</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">eps</span><span class="p">,</span> <span class="mf">1e-4</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x_eq</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="mf">1.0</span><span class="p">))</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">)</span>  <span class="c1"># Critical: prevent division by zero</span>

        <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">dx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">delta</span>

        <span class="n">f_plus</span> <span class="o">=</span> <span class="n">_call_f</span><span class="p">(</span><span class="n">dyn</span><span class="p">,</span> <span class="n">x_eq</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">u_eq</span><span class="p">)</span>
        <span class="n">f_minus</span> <span class="o">=</span> <span class="n">_call_f</span><span class="p">(</span><span class="n">dyn</span><span class="p">,</span> <span class="n">x_eq</span> <span class="o">-</span> <span class="n">dx</span><span class="p">,</span> <span class="n">u_eq</span><span class="p">)</span>

        <span class="c1"># Central difference: O(δ²) accuracy</span>
        <span class="n">A</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">f_plus</span> <span class="o">-</span> <span class="n">f_minus</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">delta</span><span class="p">)</span>

    <span class="c1"># Input Jacobian B</span>
    <span class="n">du</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">eps</span><span class="p">,</span> <span class="mf">1e-4</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">u_eq</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">))</span>
    <span class="n">du</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">du</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">)</span>

    <span class="n">f_plus</span> <span class="o">=</span> <span class="n">_call_f</span><span class="p">(</span><span class="n">dyn</span><span class="p">,</span> <span class="n">x_eq</span><span class="p">,</span> <span class="n">u_eq</span> <span class="o">+</span> <span class="n">du</span><span class="p">)</span>
    <span class="n">f_minus</span> <span class="o">=</span> <span class="n">_call_f</span><span class="p">(</span><span class="n">dyn</span><span class="p">,</span> <span class="n">x_eq</span><span class="p">,</span> <span class="n">u_eq</span> <span class="o">-</span> <span class="n">du</span><span class="p">)</span>
    <span class="n">B</span> <span class="o">=</span> <span class="p">((</span><span class="n">f_plus</span> <span class="o">-</span> <span class="n">f_minus</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">du</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span>
</pre></div>
</div>
<p><strong>Line-by-Line Analysis</strong>:</p>
<ul class="simple">
<li><p><strong>Line 113</strong>: Adaptive perturbation scales with state magnitude</p>
<ul>
<li><p>Prevents underflow for small states</p></li>
<li><p>Prevents overflow for large states</p></li>
</ul>
</li>
<li><p><strong>Line 116</strong>: Critical validation (Issue #13 fix)</p>
<ul>
<li><p>Ensures δ ≥ 1e-12 to avoid division by zero</p></li>
<li><p>Maintains numerical stability across all state values</p></li>
</ul>
</li>
<li><p><strong>Lines 120-122</strong>: Central difference formula</p>
<ul>
<li><p>Second-order accurate: error ~ O(δ²)</p></li>
<li><p>Superior to forward difference: error ~ O(δ)</p></li>
</ul>
</li>
</ul>
</section>
<section id="discretization-lines-142-153">
<h4>2.2 Discretization (Lines 142-153)<a class="headerlink" href="#discretization-lines-142-153" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_discretize_exact</span><span class="p">(</span><span class="n">Ac</span><span class="p">,</span> <span class="n">Bc</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Zero-order hold discretization via matrix exponential.</span>

<span class="sd">    Mathematical Foundation:</span>
<span class="sd">        x(t+Δt) = exp(A Δt) x(t) + [∫₀^Δt exp(A τ) dτ] B u(t)</span>

<span class="sd">    Block Matrix Trick:</span>
<span class="sd">        exp([A, B; 0, 0] Δt) = [A_d, B_d; 0, I]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">Ac</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">M</span><span class="p">[:</span><span class="n">n</span><span class="p">,</span> <span class="p">:</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ac</span>          <span class="c1"># Top-left: A</span>
    <span class="n">M</span><span class="p">[:</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">:]</span> <span class="o">=</span> <span class="n">Bc</span>          <span class="c1"># Top-right: B</span>
    <span class="c1"># Bottom row remains zero</span>

    <span class="n">Md</span> <span class="o">=</span> <span class="n">expm</span><span class="p">(</span><span class="n">M</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>       <span class="c1"># scipy.linalg.expm</span>

    <span class="n">Ad</span> <span class="o">=</span> <span class="n">Md</span><span class="p">[:</span><span class="n">n</span><span class="p">,</span> <span class="p">:</span><span class="n">n</span><span class="p">]</span>         <span class="c1"># Extract A_d</span>
    <span class="n">Bd</span> <span class="o">=</span> <span class="n">Md</span><span class="p">[:</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Extract B_d</span>

    <span class="k">return</span> <span class="n">Ad</span><span class="p">,</span> <span class="n">Bd</span>
</pre></div>
</div>
<p><strong>Mathematical Derivation</strong>:</p>
<p>Starting from the continuous-time linear system:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ẋ</span> <span class="o">=</span> <span class="n">Ax</span> <span class="o">+</span> <span class="n">Bu</span>
</pre></div>
</div>
<p>The exact solution over [t, t+Δt] with constant input u is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="o">+</span><span class="n">Δt</span><span class="p">)</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="n">A</span> <span class="n">Δt</span><span class="p">)</span> <span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">A</span><span class="err">⁻¹</span><span class="p">(</span><span class="n">exp</span><span class="p">(</span><span class="n">A</span> <span class="n">Δt</span><span class="p">)</span> <span class="o">-</span> <span class="n">I</span><span class="p">)</span> <span class="n">B</span> <span class="n">u</span>
</pre></div>
</div>
<p>Using block matrix exponential:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">x</span><span class="p">(</span><span class="n">Δt</span><span class="p">)]</span>   <span class="p">[</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">]</span> <span class="p">[</span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>       <span class="p">[</span><span class="n">exp</span><span class="p">(</span><span class="n">A</span> <span class="n">Δt</span><span class="p">),</span>  <span class="err">∫₀</span><span class="o">^</span><span class="n">Δt</span> <span class="n">exp</span><span class="p">(</span><span class="n">Aτ</span><span class="p">)</span><span class="n">dτ</span> <span class="n">B</span><span class="p">]</span> <span class="p">[</span><span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>
<span class="p">[</span>  <span class="mi">1</span>  <span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="p">[</span> <span class="n">u</span>  <span class="p">]</span> <span class="n">Δt</span> <span class="o">=</span>  <span class="p">[</span>    <span class="mi">0</span><span class="p">,</span>              <span class="mi">1</span>         <span class="p">]</span> <span class="p">[</span> <span class="n">u</span>  <span class="p">]</span>
</pre></div>
</div>
<p>Thus: A_d = exp(A Δt), B_d = ∫₀^Δt exp(Aτ)dτ B</p>
</section>
<section id="qp-formulation-lines-362-396">
<h4>2.3 QP Formulation (Lines 362-396)<a class="headerlink" href="#qp-formulation-lines-362-396" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Decision variables</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># States: 6 × (N+1)</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">((</span><span class="n">nu</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>    <span class="c1"># Controls: 1 × N</span>

<span class="c1"># Cost matrices</span>
<span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">q_x</span><span class="p">,</span> <span class="n">w</span><span class="o">.</span><span class="n">q_theta</span><span class="p">,</span> <span class="n">w</span><span class="o">.</span><span class="n">q_theta</span><span class="p">,</span> <span class="n">w</span><span class="o">.</span><span class="n">q_xdot</span><span class="p">,</span> <span class="n">w</span><span class="o">.</span><span class="n">q_thetadot</span><span class="p">,</span> <span class="n">w</span><span class="o">.</span><span class="n">q_thetadot</span><span class="p">])</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">w</span><span class="o">.</span><span class="n">r_u</span><span class="p">]])</span>

<span class="c1"># Build cost function and constraints</span>
<span class="n">obj</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">cons</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">x0</span><span class="p">]</span>  <span class="c1"># Initial condition</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="c1"># Dynamics: x_{k+1} = A_d x_k + B_d u_k</span>
    <span class="n">cons</span> <span class="o">+=</span> <span class="p">[</span><span class="n">X</span><span class="p">[:,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">Ad</span> <span class="o">@</span> <span class="n">X</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">Bd</span> <span class="o">@</span> <span class="n">U</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]]</span>

    <span class="c1"># Input bounds: |u_k| ≤ u_max</span>
    <span class="n">cons</span> <span class="o">+=</span> <span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_force</span><span class="p">]</span>

    <span class="c1"># Stage cost: ||x_k - x_ref||²_Q + ||u_k||²_R</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">Xref</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span>
    <span class="n">obj</span> <span class="o">+=</span> <span class="n">cp</span><span class="o">.</span><span class="n">quad_form</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">Q</span><span class="p">)</span> <span class="o">+</span> <span class="n">cp</span><span class="o">.</span><span class="n">quad_form</span><span class="p">(</span><span class="n">U</span><span class="p">[:,</span> <span class="n">k</span><span class="p">],</span> <span class="n">R</span><span class="p">)</span>

    <span class="c1"># State constraints</span>
    <span class="n">cons</span> <span class="o">+=</span> <span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_cart_pos</span><span class="p">]</span>  <span class="c1"># Cart position</span>
    <span class="n">cons</span> <span class="o">+=</span> <span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_theta_dev</span><span class="p">]</span>  <span class="c1"># θ₁</span>
    <span class="n">cons</span> <span class="o">+=</span> <span class="p">[</span><span class="n">cp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_theta_dev</span><span class="p">]</span>  <span class="c1"># θ₂</span>

<span class="c1"># Terminal cost: ||x_N - x_ref||²_Q</span>
<span class="n">eN</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span> <span class="n">N</span><span class="p">]</span> <span class="o">-</span> <span class="n">Xref</span><span class="p">[:,</span> <span class="n">N</span><span class="p">]</span>
<span class="n">obj</span> <span class="o">+=</span> <span class="n">cp</span><span class="o">.</span><span class="n">quad_form</span><span class="p">(</span><span class="n">eN</span><span class="p">,</span> <span class="n">Q</span><span class="p">)</span>

<span class="c1"># Solve</span>
<span class="n">prob</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Problem</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">Minimize</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="n">cons</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="n">cp</span><span class="o">.</span><span class="n">OSQP</span><span class="p">,</span> <span class="n">warm_start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>cvxpy Constraint Syntax</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">X[:,</span> <span class="pre">0]</span> <span class="pre">==</span> <span class="pre">x0</span></code> → Equality constraint (initial condition)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cp.abs(U[0,</span> <span class="pre">k])</span> <span class="pre">&lt;=</span> <span class="pre">max_force</span></code> → Box constraint on input</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cp.quad_form(e,</span> <span class="pre">Q)</span></code> → Quadratic form eᵀQe (efficient)</p></li>
</ul>
</section>
<section id="solver-and-fallback-lines-407-463">
<h4>2.4 Solver and Fallback (Lines 407-463)<a class="headerlink" href="#solver-and-fallback-lines-407-463" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solve with warm start</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="n">cp</span><span class="o">.</span><span class="n">OSQP</span><span class="p">,</span> <span class="n">warm_start</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">warm_start</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Fallback solver</span>

<span class="c1"># Check status</span>
<span class="k">if</span> <span class="n">prob</span><span class="o">.</span><span class="n">status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">OPTIMAL</span><span class="p">,</span> <span class="n">cp</span><span class="o">.</span><span class="n">OPTIMAL_INACCURATE</span><span class="p">):</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;MPC failed (</span><span class="si">%s</span><span class="s2">), using fallback&quot;</span><span class="p">,</span> <span class="n">prob</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_fallback</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>

<span class="c1"># Extract and cache solution</span>
<span class="n">u0</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="bp">self</span><span class="o">.</span><span class="n">_U_prev</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Warm start next solve</span>

<span class="c1"># Apply slew rate limit if configured</span>
<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_du</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">du</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">u0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_u_out</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_du</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_du</span><span class="p">)</span>
    <span class="n">u0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_u_out</span> <span class="o">+</span> <span class="n">du</span>

<span class="bp">self</span><span class="o">.</span><span class="n">_last_u_out</span> <span class="o">=</span> <span class="n">u0</span>
<span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">max_force</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_force</span><span class="p">))</span>
</pre></div>
</div>
<p><strong>Solver Status Codes</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cp.OPTIMAL</span></code>: Converged to optimal solution</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cp.OPTIMAL_INACCURATE</span></code>: Suboptimal but usable</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cp.INFEASIBLE</span></code>: No feasible solution (constraints too tight)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cp.UNBOUNDED</span></code>: Objective unbounded (rare, indicates modeling error)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cp.SOLVER_ERROR</span></code>: Numerical issues in solver</p></li>
</ul>
<p><strong>Warm Start Benefit</strong>:</p>
<ul class="simple">
<li><p>Initial guess: U_prev (previous optimal sequence)</p></li>
<li><p>Reduces iterations: ~10× speedup typical</p></li>
<li><p>Critical for real-time performance</p></li>
</ul>
</section>
</section>
</section>
<hr class="docutils" />
<section id="parameter-configuration">
<h2>Parameter Configuration<a class="headerlink" href="#parameter-configuration" title="Link to this heading">¶</a></h2>
<section id="core-parameters">
<h3>1. Core Parameters<a class="headerlink" href="#core-parameters" title="Link to this heading">¶</a></h3>
<section id="horizon-length-n">
<h4>1.1 Horizon Length (N)<a class="headerlink" href="#horizon-length-n" title="Link to this heading">¶</a></h4>
<p><strong>Parameter</strong>: <code class="docutils literal notranslate"><span class="pre">horizon</span></code> (int, default=20)</p>
<p><strong>Effect</strong>:</p>
<ul class="simple">
<li><p><strong>Longer horizon</strong> (N=30-50):</p>
<ul>
<li><p>Better prediction of system evolution</p></li>
<li><p>Improved trajectory tracking</p></li>
<li><p>Higher computational cost (O(N³))</p></li>
<li><p>More conservative control</p></li>
</ul>
</li>
<li><p><strong>Shorter horizon</strong> (N=10-15):</p>
<ul>
<li><p>Faster solve time (real-time feasible)</p></li>
<li><p>More reactive, less anticipatory</p></li>
<li><p>Suitable for HIL applications</p></li>
</ul>
</li>
</ul>
<p><strong>Guideline</strong>: N ≥ settling time / dt</p>
<ul class="simple">
<li><p>For DIP settling ~2s, dt=0.02s: N ≥ 100 (impractical)</p></li>
<li><p>Typical range: N=10-20 balances performance and computation</p></li>
</ul>
</section>
<section id="sampling-time-dt">
<h4>1.2 Sampling Time (dt)<a class="headerlink" href="#sampling-time-dt" title="Link to this heading">¶</a></h4>
<p><strong>Parameter</strong>: <code class="docutils literal notranslate"><span class="pre">dt</span></code> (float, default=0.02 s)</p>
<p><strong>Considerations</strong>:</p>
<ul class="simple">
<li><p><strong>Smaller dt</strong> (0.01 s):</p>
<ul>
<li><p>Better prediction accuracy (linearization valid longer)</p></li>
<li><p>More QP variables (slower solve)</p></li>
<li><p>Higher control frequency</p></li>
</ul>
</li>
<li><p><strong>Larger dt</strong> (0.05 s):</p>
<ul>
<li><p>Faster solve (fewer variables)</p></li>
<li><p>Linearization errors accumulate</p></li>
<li><p>May miss fast dynamics</p></li>
</ul>
</li>
</ul>
<p><strong>Rule of Thumb</strong>: dt ≤ 1/(10 × f_fastest)</p>
<ul class="simple">
<li><p>For DIP: f_fastest ~5 Hz → dt ≤ 0.02 s ✓</p></li>
</ul>
</section>
<section id="cost-function-weights">
<h4>1.3 Cost Function Weights<a class="headerlink" href="#cost-function-weights" title="Link to this heading">¶</a></h4>
<p><strong>Parameters</strong>: <code class="docutils literal notranslate"><span class="pre">MPCWeights</span></code> dataclass</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MPCWeights</span><span class="p">:</span>
    <span class="n">q_x</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>          <span class="c1"># Cart position weight</span>
    <span class="n">q_theta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10.0</span>     <span class="c1"># Angle weight (each)</span>
    <span class="n">q_xdot</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span>       <span class="c1"># Velocity weight</span>
    <span class="n">q_thetadot</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span>   <span class="c1"># Angular velocity weight</span>
    <span class="n">r_u</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-2</span>         <span class="c1"># Input effort penalty</span>
</pre></div>
</div>
<p><strong>Tuning Guidelines</strong>:</p>
<ol class="arabic simple">
<li><p><strong>Relative Magnitudes</strong>:</p>
<ul class="simple">
<li><p>q_theta &gt;&gt; q_x: Prioritize pendulum stabilization over cart position</p></li>
<li><p>Default ratio: 10:1 (angles 10× more important than cart)</p></li>
</ul>
</li>
<li><p><strong>Input Penalty r_u</strong>:</p>
<ul class="simple">
<li><p><strong>Small r_u</strong> (1e-3): Aggressive control, high effort</p></li>
<li><p><strong>Large r_u</strong> (0.1): Smooth control, slower response</p></li>
<li><p>Typical: 1e-2 balances performance and effort</p></li>
</ul>
</li>
<li><p><strong>State vs Derivative Weights</strong>:</p>
<ul class="simple">
<li><p>q_theta &gt; q_thetadot: Position error more critical than velocity</p></li>
<li><p>Typical ratio: 10:0.5 (20:1)</p></li>
</ul>
</li>
</ol>
<p><strong>Physical Interpretation</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">J</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_ref</span><span class="p">)</span><span class="err">²</span> <span class="err">·</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">θ</span> <span class="o">-</span> <span class="n">π</span><span class="p">)</span><span class="err">²</span> <span class="err">·</span> <span class="mf">10.0</span> <span class="o">+</span> <span class="n">u</span><span class="err">²</span> <span class="err">·</span> <span class="mf">0.01</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Deviating 1 rad in θ costs same as 10 m in x</p></li>
<li><p>Input u² penalized at 1% of angle error</p></li>
</ul>
</section>
<section id="constraint-bounds">
<h4>1.4 Constraint Bounds<a class="headerlink" href="#constraint-bounds" title="Link to this heading">¶</a></h4>
<p><strong>Force Limit</strong>: <code class="docutils literal notranslate"><span class="pre">max_force</span></code> (float, default=20.0 N)</p>
<ul class="simple">
<li><p>Actuator saturation limit</p></li>
<li><p>Should match physical hardware</p></li>
</ul>
<p><strong>Cart Position</strong>: <code class="docutils literal notranslate"><span class="pre">max_cart_pos</span></code> (float, default=2.4 m)</p>
<ul class="simple">
<li><p>Track length constraint</p></li>
<li><p>Prevents cart from running off limits</p></li>
</ul>
<p><strong>Angle Deviation</strong>: <code class="docutils literal notranslate"><span class="pre">max_theta_dev</span></code> (float, default=0.5 rad ≈ 28.6°)</p>
<ul class="simple">
<li><p>Maximum deviation from upright (π)</p></li>
<li><p>Linearization validity region</p></li>
<li><p>Constraint: |θ - π| ≤ 0.5 rad</p></li>
</ul>
</section>
</section>
<section id="advanced-parameters">
<h3>2. Advanced Parameters<a class="headerlink" href="#advanced-parameters" title="Link to this heading">¶</a></h3>
<section id="discretization-method">
<h4>2.1 Discretization Method<a class="headerlink" href="#discretization-method" title="Link to this heading">¶</a></h4>
<p><strong>Parameter</strong>: <code class="docutils literal notranslate"><span class="pre">use_exact_discretization</span></code> (bool, default=True)</p>
<ul class="simple">
<li><p><strong>True</strong>: Zero-order hold (exact via matrix exponential)</p>
<ul>
<li><p>Higher accuracy</p></li>
<li><p>Slightly slower (expm computation)</p></li>
</ul>
</li>
<li><p><strong>False</strong>: Forward Euler approximation</p>
<ul>
<li><p>Faster (simple matrix ops)</p></li>
<li><p>Valid only for small dt</p></li>
</ul>
</li>
</ul>
<p><strong>When to Use Euler</strong>: dt &lt; 0.01 s and speed critical</p>
</section>
<section id="fallback-controllers">
<h4>2.2 Fallback Controllers<a class="headerlink" href="#fallback-controllers" title="Link to this heading">¶</a></h4>
<p><strong>ClassicalSMC Gains</strong>: <code class="docutils literal notranslate"><span class="pre">fallback_smc_gains</span></code> (Optional[List[float]])</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Custom SMC fallback</span>
<span class="n">mpc</span> <span class="o">=</span> <span class="n">MPCController</span><span class="p">(</span>
    <span class="n">dynamics</span><span class="p">,</span>
    <span class="n">fallback_smc_gains</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>  <span class="c1"># [k1,k2,λ1,λ2,K,kd]</span>
    <span class="n">fallback_boundary_layer</span><span class="o">=</span><span class="mf">0.01</span>
<span class="p">)</span>
</pre></div>
</div>
<p><strong>PD Gains</strong>: <code class="docutils literal notranslate"><span class="pre">fallback_pd_gains</span></code> (Optional[Tuple[float, float]])</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Custom PD fallback (if SMC unavailable)</span>
<span class="n">mpc</span> <span class="o">=</span> <span class="n">MPCController</span><span class="p">(</span>
    <span class="n">dynamics</span><span class="p">,</span>
    <span class="n">fallback_pd_gains</span><span class="o">=</span><span class="p">(</span><span class="mf">30.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>  <span class="c1"># (k_p, k_d)</span>
<span class="p">)</span>
</pre></div>
</div>
<p><strong>Default Fallbacks</strong>:</p>
<ul class="simple">
<li><p>SMC: [6, 6, 12, 12, 60, 1.5] (conservative)</p></li>
<li><p>PD: k_p=20, k_d=5</p></li>
</ul>
</section>
<section id="id1">
<h4>2.3 Slew Rate Limiting<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h4>
<p><strong>Parameter</strong>: <code class="docutils literal notranslate"><span class="pre">max_du</span></code> (Optional[float], default=None)</p>
<p><strong>Purpose</strong>: Limit control rate to reduce chattering and mechanical stress</p>
<p><strong>Effect</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">|</span><span class="n">u_k</span> <span class="o">-</span> <span class="n">u_</span><span class="p">{</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span><span class="o">|</span> <span class="err">≤</span> <span class="n">max_du</span>
</pre></div>
</div>
<p><strong>Typical Value</strong>: max_du = 10.0 N/step (for dt=0.02s → 500 N/s)</p>
</section>
</section>
<section id="configuration-examples">
<h3>3. Configuration Examples<a class="headerlink" href="#configuration-examples" title="Link to this heading">¶</a></h3>
<section id="high-performance-mpc">
<h4>3.1 High-Performance MPC<a class="headerlink" href="#high-performance-mpc" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">weights</span> <span class="o">=</span> <span class="n">MPCWeights</span><span class="p">(</span>
    <span class="n">q_x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>          <span class="c1"># Less emphasis on cart position</span>
    <span class="n">q_theta</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>     <span class="c1"># Strong angle penalty</span>
    <span class="n">q_xdot</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
    <span class="n">q_thetadot</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>   <span class="c1"># Higher damping</span>
    <span class="n">r_u</span><span class="o">=</span><span class="mf">5e-3</span>          <span class="c1"># Allow aggressive control</span>
<span class="p">)</span>

<span class="n">mpc</span> <span class="o">=</span> <span class="n">MPCController</span><span class="p">(</span>
    <span class="n">dynamics_model</span><span class="o">=</span><span class="n">dynamics</span><span class="p">,</span>
    <span class="n">horizon</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>                     <span class="c1"># Long horizon</span>
    <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>                        <span class="c1"># Fine timestep</span>
    <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span>
    <span class="n">max_force</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>                 <span class="c1"># Higher force limit</span>
    <span class="n">use_exact_discretization</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="real-time-optimized-mpc">
<h4>3.2 Real-Time Optimized MPC<a class="headerlink" href="#real-time-optimized-mpc" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">weights</span> <span class="o">=</span> <span class="n">MPCWeights</span><span class="p">(</span>
    <span class="n">q_theta</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
    <span class="n">r_u</span><span class="o">=</span><span class="mf">1e-2</span>
<span class="p">)</span>

<span class="n">mpc</span> <span class="o">=</span> <span class="n">MPCController</span><span class="p">(</span>
    <span class="n">dynamics_model</span><span class="o">=</span><span class="n">dynamics</span><span class="p">,</span>
    <span class="n">horizon</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>                     <span class="c1"># Shorter horizon</span>
    <span class="n">dt</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span>                        <span class="c1"># Standard timestep</span>
    <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span>
    <span class="n">max_force</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>
    <span class="n">use_exact_discretization</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="c1"># Faster Euler</span>
    <span class="n">max_du</span><span class="o">=</span><span class="mf">15.0</span>                     <span class="c1"># Slew rate limit</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="conservative-mpc-with-smc-fallback">
<h4>3.3 Conservative MPC with SMC Fallback<a class="headerlink" href="#conservative-mpc-with-smc-fallback" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mpc</span> <span class="o">=</span> <span class="n">MPCController</span><span class="p">(</span>
    <span class="n">dynamics_model</span><span class="o">=</span><span class="n">dynamics</span><span class="p">,</span>
    <span class="n">horizon</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span>
    <span class="n">max_theta_dev</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>              <span class="c1"># Tighter angle bounds</span>
    <span class="n">fallback_smc_gains</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="n">fallback_boundary_layer</span><span class="o">=</span><span class="mf">0.02</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>
<hr class="docutils" />
<section id="integration-guide">
<h2>Integration Guide<a class="headerlink" href="#integration-guide" title="Link to this heading">¶</a></h2>
<section id="basic-usage">
<h3>1. Basic Usage<a class="headerlink" href="#basic-usage" title="Link to this heading">¶</a></h3>
<section id="instantiation-and-setup">
<h4>1.1 Instantiation and Setup<a class="headerlink" href="#instantiation-and-setup" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">src.controllers.mpc</span><span class="w"> </span><span class="kn">import</span> <span class="n">MPCController</span><span class="p">,</span> <span class="n">MPCWeights</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.core.dynamics</span><span class="w"> </span><span class="kn">import</span> <span class="n">DoubleInvertedPendulum</span>

<span class="c1"># Load dynamics model</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">load_config</span><span class="p">(</span><span class="s2">&quot;config.yaml&quot;</span><span class="p">)</span>
<span class="n">dynamics</span> <span class="o">=</span> <span class="n">DoubleInvertedPendulum</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">physics</span><span class="p">)</span>

<span class="c1"># Configure MPC</span>
<span class="n">weights</span> <span class="o">=</span> <span class="n">MPCWeights</span><span class="p">(</span>
    <span class="n">q_x</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">q_theta</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
    <span class="n">q_xdot</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">q_thetadot</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">r_u</span><span class="o">=</span><span class="mf">1e-2</span>
<span class="p">)</span>

<span class="n">mpc</span> <span class="o">=</span> <span class="n">MPCController</span><span class="p">(</span>
    <span class="n">dynamics_model</span><span class="o">=</span><span class="n">dynamics</span><span class="p">,</span>
    <span class="n">horizon</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span>
    <span class="n">max_force</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>
    <span class="n">max_cart_pos</span><span class="o">=</span><span class="mf">2.4</span><span class="p">,</span>
    <span class="n">max_theta_dev</span><span class="o">=</span><span class="mf">0.5</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="control-loop-integration">
<h4>1.2 Control Loop Integration<a class="headerlink" href="#control-loop-integration" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simulation loop</span>
<span class="n">t</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.02</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>  <span class="c1"># Upright</span>

<span class="k">while</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mf">10.0</span><span class="p">:</span>
    <span class="c1"># Compute MPC control</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">mpc</span><span class="o">.</span><span class="n">compute_control</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="c1"># Apply to system</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">dynamics</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>

    <span class="c1"># Advance time</span>
    <span class="n">t</span> <span class="o">+=</span> <span class="n">dt</span>
</pre></div>
</div>
</section>
<section id="id2">
<h4>1.3 Reference Trajectory Tracking<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">reference_trajectory</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sinusoidal cart motion while keeping pendulum upright.&quot;&quot;&quot;</span>
    <span class="n">x_ref</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x_ref</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>

<span class="n">mpc</span><span class="o">.</span><span class="n">set_reference</span><span class="p">(</span><span class="n">reference_trajectory</span><span class="p">)</span>

<span class="c1"># Now MPC tracks this time-varying reference</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">mpc</span><span class="o">.</span><span class="n">compute_control</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">x_current</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="factory-integration">
<h3>2. Factory Integration<a class="headerlink" href="#factory-integration" title="Link to this heading">¶</a></h3>
<section id="using-controller-factory">
<h4>2.1 Using Controller Factory<a class="headerlink" href="#using-controller-factory" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">src.controllers.factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_controller</span>

<span class="c1"># Create MPC via factory (if supported)</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">load_config</span><span class="p">(</span><span class="s2">&quot;config.yaml&quot;</span><span class="p">)</span>

<span class="n">controller</span> <span class="o">=</span> <span class="n">create_controller</span><span class="p">(</span>
    <span class="s1">&#39;mpc_controller&#39;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
    <span class="c1"># MPC-specific parameters</span>
    <span class="n">horizon</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span>
    <span class="n">max_force</span><span class="o">=</span><span class="mf">20.0</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="direct-instantiation-recommended-for-mpc">
<h4>2.2 Direct Instantiation (Recommended for MPC)<a class="headerlink" href="#direct-instantiation-recommended-for-mpc" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Direct instantiation provides full parameter control</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.controllers.mpc.mpc_controller</span><span class="w"> </span><span class="kn">import</span> <span class="n">MPCController</span>

<span class="n">mpc</span> <span class="o">=</span> <span class="n">MPCController</span><span class="p">(</span>
    <span class="n">dynamics_model</span><span class="o">=</span><span class="n">dynamics</span><span class="p">,</span>
    <span class="n">horizon</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="n">MPCWeights</span><span class="p">(),</span>
    <span class="n">max_force</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>
    <span class="n">fallback_smc_gains</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="simulation-integration">
<h3>3. Simulation Integration<a class="headerlink" href="#simulation-integration" title="Link to this heading">¶</a></h3>
<section id="with-simulation-runner">
<h4>3.1 With Simulation Runner<a class="headerlink" href="#with-simulation-runner" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">src.core.simulation_runner</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimulationRunner</span>

<span class="c1"># Create MPC controller</span>
<span class="n">mpc</span> <span class="o">=</span> <span class="n">MPCController</span><span class="p">(</span><span class="n">dynamics</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>

<span class="c1"># Wrap for simulation runner interface</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mpc_wrapper</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adapt MPC to simulation runner interface.&quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;t&#39;</span> <span class="ow">in</span> <span class="n">state</span> <span class="k">else</span> <span class="mf">0.0</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">mpc</span><span class="o">.</span><span class="n">compute_control</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">state</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">u</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{}</span>  <span class="c1"># (control, state_vars, history)</span>

<span class="c1"># Run simulation</span>
<span class="n">runner</span> <span class="o">=</span> <span class="n">SimulationRunner</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="n">controller</span><span class="o">=</span><span class="n">mpc_wrapper</span><span class="p">,</span>
    <span class="n">dynamics</span><span class="o">=</span><span class="n">dynamics</span><span class="p">,</span>
    <span class="n">duration</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="mf">0.02</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="with-batch-simulation-not-recommended">
<h4>3.2 With Batch Simulation (Not Recommended)<a class="headerlink" href="#with-batch-simulation-not-recommended" title="Link to this heading">¶</a></h4>
<p><strong>Note</strong>: MPC is inherently sequential (each step requires QP solve). Batch/vectorized simulation offers no speedup.</p>
</section>
</section>
<section id="pso-integration-hyperparameter-tuning">
<h3>4. PSO Integration (Hyperparameter Tuning)<a class="headerlink" href="#pso-integration-hyperparameter-tuning" title="Link to this heading">¶</a></h3>
<p>While MPC itself doesn’t have “gains” like SMC, PSO can optimize:</p>
<ul class="simple">
<li><p>Cost function weights (Q, R)</p></li>
<li><p>Horizon length N</p></li>
<li><p>Constraint bounds</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">src.optimization.algorithms.pso_optimizer</span><span class="w"> </span><span class="kn">import</span> <span class="n">PSOTuner</span>

<span class="k">def</span><span class="w"> </span><span class="nf">mpc_factory_for_pso</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    params = [q_x, q_theta, q_xdot, q_thetadot, r_u, horizon]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">MPCWeights</span><span class="p">(</span>
        <span class="n">q_x</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">q_theta</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">q_xdot</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
        <span class="n">q_thetadot</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="n">r_u</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">MPCController</span><span class="p">(</span>
        <span class="n">dynamics_model</span><span class="o">=</span><span class="n">dynamics</span><span class="p">,</span>
        <span class="n">horizon</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>
        <span class="n">dt</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="n">weights</span>
    <span class="p">)</span>

<span class="c1"># PSO bounds</span>
<span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">),</span>    <span class="c1"># q_x</span>
    <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">),</span>    <span class="c1"># q_theta</span>
    <span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>    <span class="c1"># q_xdot</span>
    <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span>     <span class="c1"># q_thetadot</span>
    <span class="p">(</span><span class="mf">1e-3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>    <span class="c1"># r_u</span>
    <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>        <span class="c1"># horizon (integer)</span>
<span class="p">]</span>

<span class="n">tuner</span> <span class="o">=</span> <span class="n">PSOTuner</span><span class="p">(</span>
    <span class="n">controller_factory</span><span class="o">=</span><span class="n">mpc_factory_for_pso</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
    <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
    <span class="n">n_particles</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">max_iters</span><span class="o">=</span><span class="mi">50</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">tuner</span><span class="o">.</span><span class="n">optimise</span><span class="p">()</span>
<span class="n">optimal_params</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;best_pos&#39;</span><span class="p">]</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="performance-characteristics">
<h2>Performance Characteristics<a class="headerlink" href="#performance-characteristics" title="Link to this heading">¶</a></h2>
<section id="computational-performance">
<h3>1. Computational Performance<a class="headerlink" href="#computational-performance" title="Link to this heading">¶</a></h3>
<section id="solve-time-benchmarks">
<h4>1.1 Solve Time Benchmarks<a class="headerlink" href="#solve-time-benchmarks" title="Link to this heading">¶</a></h4>
<p><strong>Configuration</strong>: N=20, n=6, m=1, dt=0.02s</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Solver</p></th>
<th class="head"><p>Cold Start</p></th>
<th class="head"><p>Warm Start</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>OSQP</strong></p></td>
<td><p>8-12 ms</p></td>
<td><p>1-3 ms</p></td>
<td><p>Preferred for real-time</p></td>
</tr>
<tr class="row-odd"><td><p><strong>ECOS</strong></p></td>
<td><p>15-25 ms</p></td>
<td><p>5-8 ms</p></td>
<td><p>Interior-point method</p></td>
</tr>
<tr class="row-even"><td><p><strong>SCS</strong></p></td>
<td><p>20-30 ms</p></td>
<td><p>8-12 ms</p></td>
<td><p>Splitting conic solver</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Comparison to SMC</strong>:</p>
<ul class="simple">
<li><p>Classical SMC: 0.01-0.1 ms (10-100× faster)</p></li>
<li><p>Adaptive SMC: 0.05-0.2 ms (20-40× faster)</p></li>
<li><p>MPC computational overhead significant</p></li>
</ul>
</section>
<section id="scalability">
<h4>1.2 Scalability<a class="headerlink" href="#scalability" title="Link to this heading">¶</a></h4>
<p><strong>Horizon Length Impact</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">N</span><span class="o">=</span><span class="mi">10</span><span class="p">:</span>  <span class="o">~</span><span class="mi">2</span> <span class="n">ms</span>  <span class="p">(</span><span class="n">warm</span> <span class="n">start</span><span class="p">)</span>
<span class="n">N</span><span class="o">=</span><span class="mi">20</span><span class="p">:</span>  <span class="o">~</span><span class="mi">3</span> <span class="n">ms</span>
<span class="n">N</span><span class="o">=</span><span class="mi">30</span><span class="p">:</span>  <span class="o">~</span><span class="mi">6</span> <span class="n">ms</span>
<span class="n">N</span><span class="o">=</span><span class="mi">50</span><span class="p">:</span>  <span class="o">~</span><span class="mi">15</span> <span class="n">ms</span>
</pre></div>
</div>
<p><strong>Quadratic growth</strong>: Solve time ~ O(N²-N³) depending on solver</p>
</section>
<section id="real-time-feasibility">
<h4>1.3 Real-Time Feasibility<a class="headerlink" href="#real-time-feasibility" title="Link to this heading">¶</a></h4>
<p><strong>Control Frequencies</strong>:</p>
<ul class="simple">
<li><p><strong>100 Hz</strong> (10 ms): ✅ Feasible with warm start, N≤20</p></li>
<li><p><strong>50 Hz</strong> (20 ms): ✅ Comfortable, N≤30</p></li>
<li><p><strong>20 Hz</strong> (50 ms): ✅ Easy, N≤50</p></li>
<li><p><strong>10 Hz</strong> (100 ms): ✅ Trivial, any N</p></li>
</ul>
<p><strong>Recommendation</strong>: For real-time control at 50-100 Hz, use N=10-15 with OSQP and warm start.</p>
</section>
</section>
<section id="control-performance">
<h3>2. Control Performance<a class="headerlink" href="#control-performance" title="Link to this heading">¶</a></h3>
<section id="tracking-accuracy">
<h4>2.1 Tracking Accuracy<a class="headerlink" href="#tracking-accuracy" title="Link to this heading">¶</a></h4>
<p><strong>Step Response</strong> (upright → upright with cart shift):</p>
<ul class="simple">
<li><p><strong>Settling Time</strong>: 1.5-2.5 s (N=20, Q=[1,10,10,0.1,0.5,0.5], R=0.01)</p></li>
<li><p><strong>Overshoot</strong>: 5-15% (depends on cost weights)</p></li>
<li><p><strong>Steady-State Error</strong>: &lt;0.01 rad (constrained optimization)</p></li>
</ul>
<p><strong>Sinusoidal Tracking</strong> (0.5 Hz, 0.5 m amplitude):</p>
<ul class="simple">
<li><p><strong>Phase Lag</strong>: ~100-200 ms (depends on horizon)</p></li>
<li><p><strong>Amplitude Error</strong>: 10-20% (longer horizon → better tracking)</p></li>
</ul>
</section>
<section id="comparison-to-smc">
<h4>2.2 Comparison to SMC<a class="headerlink" href="#comparison-to-smc" title="Link to this heading">¶</a></h4>
<p><strong>Performance Matrix</strong>:</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Metric</p></th>
<th class="head"><p>MPC</p></th>
<th class="head"><p>Classical SMC</p></th>
<th class="head"><p>Super-Twisting SMC</p></th>
<th class="head"><p>Adaptive SMC</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Settling Time</strong></p></td>
<td><p>1.5-2.5 s</p></td>
<td><p>2.0-3.0 s</p></td>
<td><p>1.5-2.0 s</p></td>
<td><p>1.6-2.2 s</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Overshoot</strong></p></td>
<td><p>5-15%</p></td>
<td><p>10-20%</p></td>
<td><p>5-10%</p></td>
<td><p>8-15%</p></td>
</tr>
<tr class="row-even"><td><p><strong>Chattering</strong></p></td>
<td><p>None</p></td>
<td><p>Moderate</p></td>
<td><p>Very Low</p></td>
<td><p>Low</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Constraint Satisfaction</strong></p></td>
<td><p>Guaranteed</p></td>
<td><p>Approximate</p></td>
<td><p>Approximate</p></td>
<td><p>Approximate</p></td>
</tr>
<tr class="row-even"><td><p><strong>Compute Time</strong></p></td>
<td><p>1-10 ms</p></td>
<td><p>0.01-0.1 ms</p></td>
<td><p>0.05-0.2 ms</p></td>
<td><p>0.1-0.5 ms</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Robustness</strong></p></td>
<td><p>Local (linearization)</p></td>
<td><p>Global</p></td>
<td><p>Global</p></td>
<td><p>Global</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Key Insights</strong>:</p>
<ul class="simple">
<li><p>MPC: Best tracking, no chattering, but <strong>10-100× slower</strong></p></li>
<li><p>SMC: Faster, globally valid, but less optimal</p></li>
<li><p>MPC linearization limits robustness far from equilibrium</p></li>
</ul>
</section>
<section id="id3">
<h4>2.3 Constraint Handling<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h4>
<p><strong>MPC Advantage</strong>: Explicit constraint satisfaction</p>
<p><strong>Example</strong>: Force limit violation</p>
<ul class="simple">
<li><p><strong>MPC</strong>: QP constraints ensure |u| ≤ u_max exactly</p></li>
<li><p><strong>SMC</strong>: Saturation after control law (may violate during transients)</p></li>
</ul>
<p><strong>State Constraints</strong> (cart position, angle bounds):</p>
<ul class="simple">
<li><p>MPC: Predictive constraint satisfaction over horizon</p></li>
<li><p>SMC: Reactive, no preview</p></li>
</ul>
</section>
</section>
<section id="robustness-analysis">
<h3>3. Robustness Analysis<a class="headerlink" href="#robustness-analysis" title="Link to this heading">¶</a></h3>
<section id="linearization-validity">
<h4>3.1 Linearization Validity<a class="headerlink" href="#linearization-validity" title="Link to this heading">¶</a></h4>
<p><strong>Valid Region</strong>:</p>
<ul class="simple">
<li><p>Angles: |θ - π| &lt; 0.5 rad (≈28°)</p></li>
<li><p>Velocities: |θ̇| &lt; 2 rad/s</p></li>
</ul>
<p><strong>Beyond Validity</strong>:</p>
<ul class="simple">
<li><p>Linearization errors accumulate</p></li>
<li><p>Fallback controller engages (SMC or PD)</p></li>
<li><p>Performance degrades gracefully</p></li>
</ul>
</section>
<section id="disturbance-rejection">
<h4>3.2 Disturbance Rejection<a class="headerlink" href="#disturbance-rejection" title="Link to this heading">¶</a></h4>
<p><strong>Matched Disturbances</strong> (force on cart):</p>
<ul class="simple">
<li><p>MPC: Rejects via re-optimization (feedback)</p></li>
<li><p>SMC: Robust by design (discontinuous control)</p></li>
</ul>
<p><strong>Unmatched Disturbances</strong> (torque on pendulums):</p>
<ul class="simple">
<li><p>MPC: Linearization may not capture</p></li>
<li><p>SMC: More robust (sliding surface invariance)</p></li>
</ul>
<p><strong>Quantitative</strong> (10 N impulse disturbance):</p>
<ul class="simple">
<li><p>MPC: Recovery in 1.5-2.0 s</p></li>
<li><p>Classical SMC: Recovery in 2.0-3.0 s</p></li>
<li><p>Super-Twisting: Recovery in 1.2-1.8 s</p></li>
</ul>
</section>
<section id="model-mismatch">
<h4>3.3 Model Mismatch<a class="headerlink" href="#model-mismatch" title="Link to this heading">¶</a></h4>
<p><strong>Parameter Uncertainty</strong> (±20% mass, length):</p>
<ul class="simple">
<li><p>MPC: Degraded tracking (5-10% error increase)</p></li>
<li><p>Adaptive SMC: Adapts online, maintains performance</p></li>
</ul>
<p><strong>Unmodeled Dynamics</strong> (friction, flexibility):</p>
<ul class="simple">
<li><p>MPC: Linearization misses nonlinearities</p></li>
<li><p>SMC: Discontinuous control compensates</p></li>
</ul>
</section>
</section>
</section>
<hr class="docutils" />
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading">¶</a></h2>
<section id="common-issues-and-solutions">
<h3>1. Common Issues and Solutions<a class="headerlink" href="#common-issues-and-solutions" title="Link to this heading">¶</a></h3>
<section id="issue-1-qp-infeasibility">
<h4>Issue 1: QP Infeasibility<a class="headerlink" href="#issue-1-qp-infeasibility" title="Link to this heading">¶</a></h4>
<p><strong>Symptoms</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">prob.status</span> <span class="pre">==</span> <span class="pre">cp.INFEASIBLE</span></code></p></li>
<li><p>Fallback controller constantly engaged</p></li>
<li><p>Warnings: “MPC solve failed, using fallback”</p></li>
</ul>
<p><strong>Causes</strong>:</p>
<ol class="arabic simple">
<li><p><strong>Constraints Too Tight</strong>:</p>
<ul class="simple">
<li><p>Angle bounds too small for current state</p></li>
<li><p>Force limit insufficient for stabilization</p></li>
</ul>
</li>
<li><p><strong>Linearization Breakdown</strong>:</p>
<ul class="simple">
<li><p>State far from equilibrium (|θ| &gt; 0.5 rad)</p></li>
<li><p>Invalid linearization</p></li>
</ul>
</li>
</ol>
<p><strong>Solutions</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Relax angle constraints</span>
<span class="n">mpc</span> <span class="o">=</span> <span class="n">MPCController</span><span class="p">(</span>
    <span class="n">dynamics</span><span class="p">,</span>
    <span class="n">max_theta_dev</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>  <span class="c1"># Increase from 0.5</span>
    <span class="n">max_force</span><span class="o">=</span><span class="mf">30.0</span>      <span class="c1"># Increase force limit</span>
<span class="p">)</span>

<span class="c1"># Check state before solve</span>
<span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.4</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;State near linearization limits&quot;</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">mpc</span><span class="o">.</span><span class="n">_safe_fallback</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># Use fallback explicitly</span>
</pre></div>
</div>
</section>
<section id="issue-2-slow-solve-time">
<h4>Issue 2: Slow Solve Time<a class="headerlink" href="#issue-2-slow-solve-time" title="Link to this heading">¶</a></h4>
<p><strong>Symptoms</strong>:</p>
<ul class="simple">
<li><p>Solve time &gt;10 ms consistently</p></li>
<li><p>Control frequency limited</p></li>
<li><p>Real-time deadlines missed</p></li>
</ul>
<p><strong>Causes</strong>:</p>
<ol class="arabic simple">
<li><p><strong>Cold Start</strong>: No warm start initialization</p></li>
<li><p><strong>Long Horizon</strong>: N too large</p></li>
<li><p><strong>Solver Choice</strong>: Non-optimal solver</p></li>
</ol>
<p><strong>Solutions</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Ensure warm start enabled</span>
<span class="n">prob</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="n">cp</span><span class="o">.</span><span class="n">OSQP</span><span class="p">,</span> <span class="n">warm_start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># 2. Reduce horizon</span>
<span class="n">mpc</span> <span class="o">=</span> <span class="n">MPCController</span><span class="p">(</span><span class="n">dynamics</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>  <span class="c1"># Down from 20</span>

<span class="c1"># 3. Profile solvers</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">prob</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="n">cp</span><span class="o">.</span><span class="n">OSQP</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OSQP: </span><span class="si">{</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> ms&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="issue-3-chattering-in-control-signal">
<h4>Issue 3: Chattering in Control Signal<a class="headerlink" href="#issue-3-chattering-in-control-signal" title="Link to this heading">¶</a></h4>
<p><strong>Symptoms</strong>:</p>
<ul class="simple">
<li><p>High-frequency oscillations in u</p></li>
<li><p>Excessive control effort</p></li>
<li><p>Actuator stress</p></li>
</ul>
<p><strong>Causes</strong>:</p>
<ol class="arabic simple">
<li><p><strong>No Slew Rate Limit</strong>: Abrupt control changes</p></li>
<li><p><strong>Small Input Penalty</strong>: r_u too low</p></li>
<li><p><strong>Solver Numerical Issues</strong>: OPTIMAL_INACCURATE status</p></li>
</ol>
<p><strong>Solutions</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Add slew rate limit</span>
<span class="n">mpc</span> <span class="o">=</span> <span class="n">MPCController</span><span class="p">(</span><span class="n">dynamics</span><span class="p">,</span> <span class="n">max_du</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>  <span class="c1"># 10 N/step</span>

<span class="c1"># 2. Increase input penalty</span>
<span class="n">weights</span> <span class="o">=</span> <span class="n">MPCWeights</span><span class="p">(</span><span class="n">r_u</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>  <span class="c1"># Up from 0.01</span>

<span class="c1"># 3. Tighten solver tolerance</span>
<span class="n">prob</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="n">cp</span><span class="o">.</span><span class="n">OSQP</span><span class="p">,</span> <span class="n">eps_abs</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">eps_rel</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="issue-4-cvxpy-not-available">
<h4>Issue 4: cvxpy Not Available<a class="headerlink" href="#issue-4-cvxpy-not-available" title="Link to this heading">¶</a></h4>
<p><strong>Symptoms</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">is</span> <span class="pre">None</span></code></p></li>
<li><p>Fallback to simple feedback</p></li>
<li><p>Warnings: “cvxpy unavailable, using simple control”</p></li>
</ul>
<p><strong>Solutions</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Install cvxpy</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">cvxpy</span>

<span class="c1"># 2. Verify installation</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cvxpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cp</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">installed_solvers</span><span class="p">())</span>  <span class="c1"># Should include OSQP, ECOS, SCS</span>

<span class="c1"># 3. If installation fails, MPC degrades gracefully</span>
<span class="n">mpc</span> <span class="o">=</span> <span class="n">MPCController</span><span class="p">(</span>
    <span class="n">dynamics</span><span class="p">,</span>
    <span class="n">fallback_smc_gains</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
    <span class="n">fallback_boundary_layer</span><span class="o">=</span><span class="mf">0.01</span>
<span class="p">)</span>
<span class="c1"># Will use SMC when cvxpy unavailable</span>
</pre></div>
</div>
</section>
</section>
<section id="performance-optimization">
<h3>2. Performance Optimization<a class="headerlink" href="#performance-optimization" title="Link to this heading">¶</a></h3>
<section id="speed-optimization-checklist">
<h4>2.1 Speed Optimization Checklist<a class="headerlink" href="#speed-optimization-checklist" title="Link to this heading">¶</a></h4>
<ul class="contains-task-list simple">
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Enable warm start: <code class="docutils literal notranslate"><span class="pre">warm_start=True</span></code></p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Use OSQP solver: <code class="docutils literal notranslate"><span class="pre">solver=cp.OSQP</span></code></p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Reduce horizon: N ≤ 15 for real-time</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Cache previous solution: <code class="docutils literal notranslate"><span class="pre">U.value</span> <span class="pre">=</span> <span class="pre">U_prev</span></code></p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Disable verbose output: <code class="docutils literal notranslate"><span class="pre">verbose=False</span></code></p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Profile solver performance: measure solve time</p></li>
</ul>
</section>
<section id="accuracy-optimization-checklist">
<h4>2.2 Accuracy Optimization Checklist<a class="headerlink" href="#accuracy-optimization-checklist" title="Link to this heading">¶</a></h4>
<ul class="contains-task-list simple">
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Use exact discretization: <code class="docutils literal notranslate"><span class="pre">use_exact_discretization=True</span></code></p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Fine timestep: dt ≤ 0.02 s</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Tight solver tolerances: <code class="docutils literal notranslate"><span class="pre">eps_abs=1e-6,</span> <span class="pre">eps_rel=1e-6</span></code></p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Validate linearization region: |θ - π| &lt; 0.5</p></li>
<li class="task-list-item"><p><input class="task-list-item-checkbox" disabled="disabled" type="checkbox"> Tune cost weights for desired behavior</p></li>
</ul>
</section>
<section id="diagnostic-tools">
<h4>2.3 Diagnostic Tools<a class="headerlink" href="#diagnostic-tools" title="Link to this heading">¶</a></h4>
<p><strong>Solver Status Check</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">status</span> <span class="o">=</span> <span class="n">prob</span><span class="o">.</span><span class="n">status</span>
<span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="n">cp</span><span class="o">.</span><span class="n">OPTIMAL</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MPC status: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Objective value: </span><span class="si">{</span><span class="n">prob</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Constraint violations: </span><span class="si">{</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">violation</span><span class="p">()</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">prob</span><span class="o">.</span><span class="n">constraints</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Linearization Validity</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">check_linearization</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x_eq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])):</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x_eq</span>
    <span class="n">angle_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">err</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">angle_err</span> <span class="o">&gt;</span> <span class="mf">0.4</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Large angle error: </span><span class="si">{</span><span class="n">angle_err</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> rad&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">angle_err</span> <span class="o">&lt;</span> <span class="mf">0.5</span>
</pre></div>
</div>
<p><strong>Warm Start Effectiveness</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compare cold vs warm start</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">prob</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="n">cp</span><span class="o">.</span><span class="n">OSQP</span><span class="p">,</span> <span class="n">warm_start</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">t_cold</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>

<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">prob</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="n">cp</span><span class="o">.</span><span class="n">OSQP</span><span class="p">,</span> <span class="n">warm_start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">t_warm</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Speedup: </span><span class="si">{</span><span class="n">t_cold</span><span class="o">/</span><span class="n">t_warm</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">×&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>
<hr class="docutils" />
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading">¶</a></h2>
<section id="model-predictive-control-theory">
<h3>1. Model Predictive Control Theory<a class="headerlink" href="#model-predictive-control-theory" title="Link to this heading">¶</a></h3>
<p><strong>Foundational Texts</strong>:</p>
<ul class="simple">
<li><p>Maciejowski, J.M. “Predictive Control with Constraints” (2002)</p></li>
<li><p>Rawlings, J.B., Mayne, D.Q. “Model Predictive Control: Theory and Design” (2009)</p></li>
<li><p>Borrelli, F., Bemporad, A., Morari, M. “Predictive Control for Linear and Hybrid Systems” (2017)</p></li>
</ul>
<p><strong>Key Papers</strong>:</p>
<ul class="simple">
<li><p>Mayne, D.Q. et al. “Constrained model predictive control: Stability and optimality” (2000)</p></li>
<li><p>Qin, S.J., Badgwell, T.A. “A survey of industrial model predictive control technology” (2003)</p></li>
</ul>
</section>
<section id="numerical-methods">
<h3>2. Numerical Methods<a class="headerlink" href="#numerical-methods" title="Link to this heading">¶</a></h3>
<p><strong>Linearization and Discretization</strong>:</p>
<ul class="simple">
<li><p>Hairer, E., Nørsett, S.P., Wanner, G. “Solving Ordinary Differential Equations I” (1993)</p></li>
<li><p>Moler, C., Van Loan, C. “Nineteen Dubious Ways to Compute the Exponential of a Matrix” (2003)</p></li>
</ul>
<p><strong>Quadratic Programming</strong>:</p>
<ul class="simple">
<li><p>Nocedal, J., Wright, S.J. “Numerical Optimization” (2nd ed., 2006)</p></li>
<li><p>Stellato, B. et al. “OSQP: An operator splitting solver for quadratic programs” (2020)</p></li>
</ul>
</section>
<section id="cvxpy-documentation">
<h3>3. cvxpy Documentation<a class="headerlink" href="#cvxpy-documentation" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>Diamond, S., Boyd, S. “CVXPY: A Python-Embedded Modeling Language for Convex Optimization” (2016)</p></li>
<li><p><a class="reference external" href="https://www.cvxpy.org/">cvxpy.org</a> - Official documentation</p></li>
<li><p><a class="reference external" href="https://osqp.org/">OSQP Documentation</a> - Solver reference</p></li>
</ul>
</section>
<section id="implementation-references">
<h3>4. Implementation References<a class="headerlink" href="#implementation-references" title="Link to this heading">¶</a></h3>
<p><strong>Related Guides</strong>:</p>
<ul class="simple">
<li><p><a class="reference internal" href="classical_smc_technical_guide.html"><span class="std std-doc">Classical SMC Technical Guide</span></a> - Fallback controller</p></li>
<li><p><a class="reference internal" href="../plant/models_guide.html"><span class="std std-doc">Plant Models Guide</span></a> - Dynamics models</p></li>
<li><p><a class="reference internal" href="../optimization_simulation/guide.html"><span class="std std-doc">Optimization &amp; Simulation Guide</span></a> - Integration methods</p></li>
</ul>
<p><strong>API Reference</strong>:</p>
<ul class="simple">
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">src.controllers.mpc.mpc_controller.MPCController</span></code> - Full API documentation</p></li>
<li><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">src.controllers.mpc.mpc_controller.MPCWeights</span></code> - Cost function configuration</p></li>
</ul>
<hr class="docutils" />
<p><strong>Documentation Version:</strong> 1.0 (Week 4 Complete)
<strong>Last Updated:</strong> 2025-10-04
<strong>Coverage:</strong> Linear MPC with QP optimization, numerical linearization, constraint handling, fallback strategies</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="swing_up_smc_technical_guide.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Swing-Up SMC Technical Guide</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="hybrid_smc_technical_guide.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Hybrid Adaptive Super-Twisting SMC Technical Guide</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Research Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on Oct 04, 2025</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Model Predictive Control Technical Guide</a><ul>
<li><a class="reference internal" href="#double-inverted-pendulum-control-system">Double-Inverted Pendulum Control System</a></li>
<li><a class="reference internal" href="#executive-summary">Executive Summary</a></li>
<li><a class="reference internal" href="#table-of-contents">Table of Contents</a></li>
<li><a class="reference internal" href="#mathematical-foundation">Mathematical Foundation</a><ul>
<li><a class="reference internal" href="#receding-horizon-control-principle">1. Receding Horizon Control Principle</a></li>
<li><a class="reference internal" href="#system-dynamics-model">2. System Dynamics Model</a><ul>
<li><a class="reference internal" href="#continuous-time-nonlinear-dynamics">2.1 Continuous-Time Nonlinear Dynamics</a></li>
<li><a class="reference internal" href="#linearization-around-equilibrium">2.2 Linearization Around Equilibrium</a></li>
<li><a class="reference internal" href="#discretization">2.3 Discretization</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mpc-optimization-problem">3. MPC Optimization Problem</a><ul>
<li><a class="reference internal" href="#quadratic-programming-formulation">3.1 Quadratic Programming Formulation</a></li>
<li><a class="reference internal" href="#constraint-handling">3.2 Constraint Handling</a></li>
</ul>
</li>
<li><a class="reference internal" href="#solution-method">4. Solution Method</a><ul>
<li><a class="reference internal" href="#quadratic-programming-via-cvxpy">4.1 Quadratic Programming via cvxpy</a></li>
<li><a class="reference internal" href="#computational-complexity">4.2 Computational Complexity</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#algorithm-architecture">Algorithm Architecture</a><ul>
<li><a class="reference internal" href="#mpc-controller-workflow">1. MPC Controller Workflow</a></li>
<li><a class="reference internal" href="#key-components">2. Key Components</a><ul>
<li><a class="reference internal" href="#linearization-module">2.1 Linearization Module</a></li>
<li><a class="reference internal" href="#discretization-module">2.2 Discretization Module</a></li>
<li><a class="reference internal" href="#qp-solver-integration-cvxpy">2.3 QP Solver Integration (cvxpy)</a></li>
<li><a class="reference internal" href="#fallback-controller-strategy">2.4 Fallback Controller Strategy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#additional-features">3. Additional Features</a><ul>
<li><a class="reference internal" href="#reference-trajectory-tracking">3.1 Reference Trajectory Tracking</a></li>
<li><a class="reference internal" href="#slew-rate-limiting">3.2 Slew Rate Limiting</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#implementation-details">Implementation Details</a><ul>
<li><a class="reference internal" href="#full-source-code-structure">1. Full Source Code Structure</a></li>
<li><a class="reference internal" href="#critical-code-sections">2. Critical Code Sections</a><ul>
<li><a class="reference internal" href="#linearization-lines-72-131">2.1 Linearization (Lines 72-131)</a></li>
<li><a class="reference internal" href="#discretization-lines-142-153">2.2 Discretization (Lines 142-153)</a></li>
<li><a class="reference internal" href="#qp-formulation-lines-362-396">2.3 QP Formulation (Lines 362-396)</a></li>
<li><a class="reference internal" href="#solver-and-fallback-lines-407-463">2.4 Solver and Fallback (Lines 407-463)</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#parameter-configuration">Parameter Configuration</a><ul>
<li><a class="reference internal" href="#core-parameters">1. Core Parameters</a><ul>
<li><a class="reference internal" href="#horizon-length-n">1.1 Horizon Length (N)</a></li>
<li><a class="reference internal" href="#sampling-time-dt">1.2 Sampling Time (dt)</a></li>
<li><a class="reference internal" href="#cost-function-weights">1.3 Cost Function Weights</a></li>
<li><a class="reference internal" href="#constraint-bounds">1.4 Constraint Bounds</a></li>
</ul>
</li>
<li><a class="reference internal" href="#advanced-parameters">2. Advanced Parameters</a><ul>
<li><a class="reference internal" href="#discretization-method">2.1 Discretization Method</a></li>
<li><a class="reference internal" href="#fallback-controllers">2.2 Fallback Controllers</a></li>
<li><a class="reference internal" href="#id1">2.3 Slew Rate Limiting</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuration-examples">3. Configuration Examples</a><ul>
<li><a class="reference internal" href="#high-performance-mpc">3.1 High-Performance MPC</a></li>
<li><a class="reference internal" href="#real-time-optimized-mpc">3.2 Real-Time Optimized MPC</a></li>
<li><a class="reference internal" href="#conservative-mpc-with-smc-fallback">3.3 Conservative MPC with SMC Fallback</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#integration-guide">Integration Guide</a><ul>
<li><a class="reference internal" href="#basic-usage">1. Basic Usage</a><ul>
<li><a class="reference internal" href="#instantiation-and-setup">1.1 Instantiation and Setup</a></li>
<li><a class="reference internal" href="#control-loop-integration">1.2 Control Loop Integration</a></li>
<li><a class="reference internal" href="#id2">1.3 Reference Trajectory Tracking</a></li>
</ul>
</li>
<li><a class="reference internal" href="#factory-integration">2. Factory Integration</a><ul>
<li><a class="reference internal" href="#using-controller-factory">2.1 Using Controller Factory</a></li>
<li><a class="reference internal" href="#direct-instantiation-recommended-for-mpc">2.2 Direct Instantiation (Recommended for MPC)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#simulation-integration">3. Simulation Integration</a><ul>
<li><a class="reference internal" href="#with-simulation-runner">3.1 With Simulation Runner</a></li>
<li><a class="reference internal" href="#with-batch-simulation-not-recommended">3.2 With Batch Simulation (Not Recommended)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pso-integration-hyperparameter-tuning">4. PSO Integration (Hyperparameter Tuning)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#performance-characteristics">Performance Characteristics</a><ul>
<li><a class="reference internal" href="#computational-performance">1. Computational Performance</a><ul>
<li><a class="reference internal" href="#solve-time-benchmarks">1.1 Solve Time Benchmarks</a></li>
<li><a class="reference internal" href="#scalability">1.2 Scalability</a></li>
<li><a class="reference internal" href="#real-time-feasibility">1.3 Real-Time Feasibility</a></li>
</ul>
</li>
<li><a class="reference internal" href="#control-performance">2. Control Performance</a><ul>
<li><a class="reference internal" href="#tracking-accuracy">2.1 Tracking Accuracy</a></li>
<li><a class="reference internal" href="#comparison-to-smc">2.2 Comparison to SMC</a></li>
<li><a class="reference internal" href="#id3">2.3 Constraint Handling</a></li>
</ul>
</li>
<li><a class="reference internal" href="#robustness-analysis">3. Robustness Analysis</a><ul>
<li><a class="reference internal" href="#linearization-validity">3.1 Linearization Validity</a></li>
<li><a class="reference internal" href="#disturbance-rejection">3.2 Disturbance Rejection</a></li>
<li><a class="reference internal" href="#model-mismatch">3.3 Model Mismatch</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li><a class="reference internal" href="#common-issues-and-solutions">1. Common Issues and Solutions</a><ul>
<li><a class="reference internal" href="#issue-1-qp-infeasibility">Issue 1: QP Infeasibility</a></li>
<li><a class="reference internal" href="#issue-2-slow-solve-time">Issue 2: Slow Solve Time</a></li>
<li><a class="reference internal" href="#issue-3-chattering-in-control-signal">Issue 3: Chattering in Control Signal</a></li>
<li><a class="reference internal" href="#issue-4-cvxpy-not-available">Issue 4: cvxpy Not Available</a></li>
</ul>
</li>
<li><a class="reference internal" href="#performance-optimization">2. Performance Optimization</a><ul>
<li><a class="reference internal" href="#speed-optimization-checklist">2.1 Speed Optimization Checklist</a></li>
<li><a class="reference internal" href="#accuracy-optimization-checklist">2.2 Accuracy Optimization Checklist</a></li>
<li><a class="reference internal" href="#diagnostic-tools">2.3 Diagnostic Tools</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#references">References</a><ul>
<li><a class="reference internal" href="#model-predictive-control-theory">1. Model Predictive Control Theory</a></li>
<li><a class="reference internal" href="#numerical-methods">2. Numerical Methods</a></li>
<li><a class="reference internal" href="#cvxpy-documentation">3. cvxpy Documentation</a></li>
<li><a class="reference internal" href="#implementation-references">4. Implementation References</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=4ebf8126"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=08e7b316"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../_static/back-to-top.js?v=840797bb"></script>
    <script src="../_static/lazy-load.js?v=dc25293c"></script>
    <script src="../_static/dark-mode.js?v=bf328970"></script>
    </body>
</html>