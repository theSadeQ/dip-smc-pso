<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
.chartjs-container {
    margin: 1.5em auto;
    padding: 1em;
    background: #f8f9fa;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.chart-note {
    text-align: center;
    color: #6c757d;
    font-size: 0.9em;
    margin-top: 0.5em;
}
</style>
<link rel="index" title="Index" href="genindex.html"><link rel="search" title="Search" href="search.html">

    <!-- Generated with Sphinx 8.2.3 and Furo 2025.09.25 -->
        <title>Quick Diagnosis ### Diagnostic Checklist When encountering factory issues, run this quick diagnostic sequence: ```python - DIP_SMC_PSO Documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5349f25f" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=8dab3a3b" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=8a7e329d" />
    
    


<style>
  body {
    --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">DIP_SMC_PSO Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <span class="sidebar-brand-text">DIP_SMC_PSO Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">üìö Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="README.html">Optimal Sliding Mode Control for a Double-Inverted Pendulum via PSO  ## How to validate a ResearchPlan JSON Run the validator locally: ```bash</a></li>
<li class="toctree-l1"><a class="reference internal" href="theory_overview.html">Theory Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">3. System Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="plant_model.html">1.x Plant Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="hil_quickstart.html">Hardware-in-the-Loop (HIL) Quickstart Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="streamlit_dashboard_guide.html">Streamlit Dashboard User Guide</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="https://github.com/theSadeQ/DIP_SMC_PSO/blob/main/docs/factory_integration_troubleshooting_guide.md?plain=true" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div><div class="edit-this-page">
  <a class="muted-link" href="https://github.com/theSadeQ/DIP_SMC_PSO/edit/main/docs/factory_integration_troubleshooting_guide.md" rel="edit" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <p>#==========================================================================================\<br />
#================ docs/factory_integration_troubleshooting_guide.md ==================\<br />
#==========================================================================================\ # Factory Integration Troubleshooting Guide ## Overview This troubleshooting guide addresses common issues encountered when using the Enterprise Controller Factory system in the DIP SMC-PSO project. The guide provides systematic diagnostic procedures, root cause analysis, and proven approaches for factory integration problems. ## Table of Contents 1. <a class="reference internal" href="#quick-diagnosis"><span class="xref myst">Quick Diagnosis</span></a>
2. <a class="reference internal" href="#controller-creation-issues"><span class="xref myst">Controller Creation Issues</span></a>
3. <a class="reference internal" href="#pso-integration-problems"><span class="xref myst">PSO Integration Problems</span></a>
4. <a class="reference internal" href="#configuration-issues"><span class="xref myst">Configuration Issues</span></a>
5. <a class="reference internal" href="#performance-problems"><span class="xref myst">Performance Problems</span></a>
6. <a class="reference internal" href="#import-and-dependency-issues"><span class="xref myst">Import and Dependency Issues</span></a>
7. <a class="reference internal" href="#thread-safety-issues"><span class="xref myst">Thread Safety Issues</span></a>
8. <a class="reference internal" href="#validation-failures"><span class="xref myst">Validation Failures</span></a>
9. <a class="reference internal" href="#debugging-tools-and-techniques"><span class="xref myst">Debugging Tools and Techniques</span></a>
10. <a class="reference internal" href="#prevention-strategies"><span class="xref myst">Prevention Strategies</span></a></p>
<hr class="docutils" />
<section id="quick-diagnosis-diagnostic-checklist-when-encountering-factory-issues-run-this-quick-diagnostic-sequence-python">
<h1>Quick Diagnosis ### Diagnostic Checklist When encountering factory issues, run this quick diagnostic sequence: ```python<a class="headerlink" href="#quick-diagnosis-diagnostic-checklist-when-encountering-factory-issues-run-this-quick-diagnostic-sequence-python" title="Link to this heading">¬∂</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="example-metadata">
<h1>example-metadata:<a class="headerlink" href="#example-metadata" title="Link to this heading">¬∂</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="runnable-false-usr-bin-env-python3">
<h1>runnable: false #!/usr/bin/env python3<a class="headerlink" href="#runnable-false-usr-bin-env-python3" title="Link to this heading">¬∂</a></h1>
<p>‚Äú‚Äù‚ÄùFactory integration quick diagnostic tool.‚Äù‚Äù‚Äù import logging
import traceback
from src.controllers.factory import ( list_available_controllers, list_all_controllers, create_controller, get_default_gains
) def quick_diagnosis(): ‚Äú‚Äù‚ÄùRun quick diagnostic checks for factory integration.‚Äù‚Äù‚Äù print(‚Äú=== Factory Integration Diagnostic ===\n‚Äù) # 1. Check available controllers print(‚Äú1. Checking available controllers‚Ä¶‚Äù) try: available = list_available_controllers() all_controllers = list_all_controllers() unavailable = set(all_controllers) - set(available) print(f‚Äù ‚úÖ Available: {available}‚Äù) if unavailable: print(f‚Äù ‚ö†Ô∏è Unavailable: {unavailable}‚Äù) print() except Exception as e: print(f‚Äù ‚ùå Controller listing failed: {e}‚Äù) return False # 2. Test basic controller creation print(‚Äú2. Testing basic controller creation‚Ä¶‚Äù) for controller_type in available: try: controller = create_controller(controller_type) print(f‚Äù ‚úÖ {controller_type}: Created successfully‚Äù) except Exception as e: print(f‚Äù ‚ùå {controller_type}: {e}‚Äù) print() # 3. Test gain access print(‚Äú3. Testing default gains access‚Ä¶‚Äù) for controller_type in available: try: gains = get_default_gains(controller_type) print(f‚Äù ‚úÖ {controller_type}: {len(gains)} gains‚Äù) except Exception as e: print(f‚Äù ‚ùå {controller_type}: {e}‚Äù) print() # 4. Test PSO integration print(‚Äú4. Testing PSO integration‚Ä¶‚Äù) try: from src.controllers.factory import create_pso_controller_factory, SMCType factory = create_pso_controller_factory(SMCType.CLASSICAL) test_gains = [20.0, 15.0, 12.0, 8.0, 35.0, 5.0] controller = factory(test_gains) print(f‚Äù ‚úÖ PSO factory: Working‚Äù) except Exception as e: print(f‚Äù ‚ùå PSO factory: {e}‚Äù) print() # 5. Test configuration integration print(‚Äú5. Testing configuration integration‚Ä¶‚Äù) try: from src.config import load_config config = load_config(‚Äúconfig.yaml‚Äù) controller = create_controller(‚Äòclassical_smc‚Äô, config=config) print(f‚Äù ‚úÖ Configuration: Working‚Äù) except Exception as e: print(f‚Äù ‚ùå Configuration: {e}‚Äù) print() print(‚Äú=== Diagnostic Complete ===‚Äù) return True if <strong>name</strong> == ‚Äú<strong>main</strong>‚Äù: quick_diagnosis()</p>
<div class="highlight-### notranslate"><div class="highlight"><pre><span></span>|---------|--------------|-----------|
| `ValueError: Unknown controller type` | Typo in controller name | Check `list_available_controllers()` |
| `ImportError: MPC controller missing` | Optional dependencies not installed | Install dependencies or use different controller |
| `ValueError: requires N gains, got M` | Wrong number of gains | Check `get_default_gains(controller_type)` |
| `RuntimeError: Lock timeout` | Thread contention | Reduce concurrent factory calls |
| `ConfigValueError: parameter invalid` | Invalid configuration values | Validate configuration parameters |

---

## Controller Creation Issues ### Issue 1: Unknown Controller Type #### Symptoms
</pre></div>
</div>
<p>ValueError: Unknown controller type ‚Äòclassical‚Äô. Available: [‚Äòclassical_smc‚Äô, ‚Äòsta_smc‚Äô, ‚Äòadaptive_smc‚Äô, ‚Äòhybrid_adaptive_sta_smc‚Äô]</p>
<div class="highlight-#### notranslate"><div class="highlight"><pre><span></span>1. **Incorrect controller name**: Using abbreviated or incorrect names
2. **Typos**: Misspelling in controller type string
3. **Case sensitivity**: Using wrong case for controller names
4. **Outdated code**: Using deprecated controller names #### approaches **Solution 1: Check Available Controllers**
```python

from src.controllers.factory import list_available_controllers # Check what&#39;s actually available
available = list_available_controllers()
print(f&quot;Available controllers: {available}&quot;) # Use correct names
controller = create_controller(&#39;classical_smc&#39;) # ‚úÖ Correct
# controller = create_controller(&#39;classical&#39;) # ‚ùå Incorrect

``` **Solution 2: Use Controller Aliases**
```python
# example-metadata:

# runnable: false # These aliases are supported for backward compatibility

valid_names = { &#39;classical_smc&#39;: [&#39;classical_smc&#39;, &#39;classic_smc&#39;, &#39;smc_classical&#39;, &#39;smc_v1&#39;], &#39;sta_smc&#39;: [&#39;sta_smc&#39;, &#39;super_twisting&#39;, &#39;sta&#39;], &#39;adaptive_smc&#39;: [&#39;adaptive_smc&#39;, &#39;adaptive&#39;], &#39;hybrid_adaptive_sta_smc&#39;: [&#39;hybrid_adaptive_sta_smc&#39;, &#39;hybrid&#39;, &#39;hybrid_sta&#39;]
} # Use any valid name
controller = create_controller(&#39;classic_smc&#39;) # ‚úÖ Alias works
controller = create_controller(&#39;super_twisting&#39;) # ‚úÖ Alias works
``` **Solution 3: Defensive Programming**
```python
# example-metadata:

# runnable: false def safe_create_controller(preferred_types, **kwargs): &quot;&quot;&quot;Create controller with fallback options.&quot;&quot;&quot; available = list_available_controllers() for controller_type in preferred_types: if controller_type in available: try: return create_controller(controller_type, **kwargs) except Exception as e: print(f&quot;Failed to create {controller_type}: {e}&quot;) continue raise RuntimeError(f&quot;None of {preferred_types} could be created. Available: {available}&quot;) # Usage with fallbacks

controller = safe_create_controller([&#39;classical_smc&#39;, &#39;adaptive_smc&#39;])
``` ### Issue 2: Controller Class Not Available #### Symptoms
</pre></div>
</div>
<p>ImportError: Controller class for mpc_controller is not available
ImportError: MPC controller missing optional dependency</p>
<div class="highlight-#### notranslate"><div class="highlight"><pre><span></span>1. **Missing optional dependencies**: MPC controller requires additional packages
2. **Import failures**: Module import errors
3. **Installation issues**: Incomplete package installation #### approaches **Solution 1: Check Dependencies**
```python

def check_controller_dependencies(): &quot;&quot;&quot;Check which controllers are available and why others aren&#39;t.&quot;&quot;&quot; from src.controllers.factory import CONTROLLER_REGISTRY for controller_type, info in CONTROLLER_REGISTRY.items(): if info[&#39;class&#39;] is None: print(f&quot;‚ùå {controller_type}: Class not available&quot;) if controller_type == &#39;mpc_controller&#39;: print(&quot; Reason: Optional MPC dependencies not installed&quot;) print(&quot; Solution: pip install control-systems-toolkit&quot;) else: print(f&quot;‚úÖ {controller_type}: Available&quot;) check_controller_dependencies()
``` **Solution 2: Install Missing Dependencies**
```bash
# For MPC controller

pip install control-systems-toolkit
pip install cvxopt # If using optimization-based MPC # Verify installation
python -c &quot;from src.controllers.mpc.controller import MPCController; print(&#39;MPC available&#39;)&quot;
``` **Solution 3: Dynamic Controller Availability**
```python
# example-metadata:

# runnable: false def create_controller_with_fallback(preferred_type, fallback_type, **kwargs): &quot;&quot;&quot;Create controller with automatic fallback.&quot;&quot;&quot; try: return create_controller(preferred_type, **kwargs) except ImportError: print(f&quot;Warning: {preferred_type} not available, using {fallback_type}&quot;) return create_controller(fallback_type, **kwargs) # Example: Try MPC, fallback to classical SMC

controller = create_controller_with_fallback( &#39;mpc_controller&#39;, &#39;classical_smc&#39;, gains=[20, 15, 12, 8, 35, 5]
)
``` ### Issue 3: Configuration Creation Failures #### Symptoms
</pre></div>
</div>
<p>Warning: Could not create full config, using minimal config
TypeError: <strong>init</strong>() got an unexpected keyword argument ‚Äòinvalid_param‚Äô</p>
<div class="highlight-#### notranslate"><div class="highlight"><pre><span></span>1. **Invalid parameters**: Passing unsupported parameters to configuration classes
2. **Type mismatches**: Wrong parameter types
3. **Missing required parameters**: Not providing all required configuration values #### approaches **Solution 1: Parameter Validation**
```python

def validate_controller_parameters(controller_type, **params): &quot;&quot;&quot;Validate parameters before controller creation.&quot;&quot;&quot; from src.controllers.factory import CONTROLLER_REGISTRY controller_info = CONTROLLER_REGISTRY[controller_type] required_params = controller_info[&#39;required_params&#39;] # Check required parameters missing = set(required_params) - set(params.keys()) if missing: print(f&quot;Missing required parameters: {missing}&quot;) return False # Controller-specific validation if controller_type == &#39;classical_smc&#39;: if &#39;gains&#39; in params and len(params[&#39;gains&#39;]) != 6: print(&quot;Classical SMC requires exactly 6 gains&quot;) return False if &#39;boundary_layer&#39; in params and params[&#39;boundary_layer&#39;] &lt;= 0: print(&quot;Boundary layer must be positive&quot;) return False elif controller_type == &#39;mpc_controller&#39;: if &#39;horizon&#39; in params and (not isinstance(params[&#39;horizon&#39;], int) or params[&#39;horizon&#39;] &lt; 1): print(&quot;MPC horizon must be positive integer&quot;) return False return True # Usage
params = {&#39;gains&#39;: [20, 15, 12, 8, 35, 5], &#39;max_force&#39;: 150.0, &#39;boundary_layer&#39;: 0.02}
if validate_controller_parameters(&#39;classical_smc&#39;, **params): controller = create_controller(&#39;classical_smc&#39;, **params)
``` **Solution 2: Graceful Parameter Handling**
```python

def create_controller_robust(controller_type, **kwargs): &quot;&quot;&quot;Create controller with robust parameter handling.&quot;&quot;&quot; try: # Try with provided parameters return create_controller(controller_type, **kwargs) except TypeError as e: if &quot;unexpected keyword argument&quot; in str(e): # Extract parameter name from error import re match = re.search(r&quot;&#39;(\w+)&#39;&quot;, str(e)) if match: invalid_param = match.group(1) print(f&quot;Removing invalid parameter: {invalid_param}&quot;) # Remove invalid parameter and retry filtered_kwargs = {k: v for k, v in kwargs.items() if k != invalid_param} return create_controller(controller_type, **filtered_kwargs) raise # Re-raise if we can&#39;t handle it # Usage
controller = create_controller_robust( &#39;classical_smc&#39;, gains=[20, 15, 12, 8, 35, 5], invalid_param=&#39;will_be_removed&#39; # This will be filtered out
)
</pre></div>
</div>
<hr class="docutils" />
<section id="pso-integration-problems-issue-1-pso-factory-creation-failures-symptoms">
<h2>PSO Integration Problems ### Issue 1: PSO Factory Creation Failures #### Symptoms<a class="headerlink" href="#pso-integration-problems-issue-1-pso-factory-creation-failures-symptoms" title="Link to this heading">¬∂</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="ne">AttributeError</span><span class="p">:</span> <span class="s1">&#39;function&#39;</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s1">&#39;n_gains&#39;</span>
<span class="ne">TypeError</span><span class="p">:</span> <span class="n">create_pso_controller_factory</span><span class="p">()</span> <span class="n">missing</span> <span class="n">required</span> <span class="n">argument</span>
<span class="err">```</span> <span class="c1">#### Root Causes</span>
<span class="mf">1.</span> <span class="o">**</span><span class="n">Missing</span> <span class="n">PSO</span> <span class="n">attributes</span><span class="o">**</span><span class="p">:</span> <span class="n">Factory</span> <span class="n">function</span> <span class="n">doesn</span><span class="s1">&#39;t have required PSO metadata</span>
<span class="mf">2.</span> <span class="o">**</span><span class="n">Incorrect</span> <span class="n">factory</span> <span class="n">usage</span><span class="o">**</span><span class="p">:</span> <span class="n">Not</span> <span class="n">using</span> <span class="n">PSO</span><span class="o">-</span><span class="n">specific</span> <span class="n">factory</span> <span class="n">functions</span>
<span class="mf">3.</span> <span class="o">**</span><span class="n">Parameter</span> <span class="n">mismatches</span><span class="o">**</span><span class="p">:</span> <span class="n">Wrong</span> <span class="n">parameters</span> <span class="k">for</span> <span class="n">PSO</span> <span class="n">integration</span> <span class="c1">#### approaches **Solution 1: Verify PSO Factory Attributes**</span>
<span class="err">```</span><span class="n">python</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">src.controllers.factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_pso_controller_factory</span><span class="p">,</span> <span class="n">SMCType</span> <span class="k">def</span><span class="w"> </span><span class="nf">verify_pso_factory</span><span class="p">(</span><span class="n">smc_type</span><span class="p">):</span> <span class="s2">&quot;&quot;&quot;Verify PSO factory has required attributes.&quot;&quot;&quot;</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">create_pso_controller_factory</span><span class="p">(</span><span class="n">smc_type</span><span class="p">)</span> <span class="n">required_attributes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;n_gains&#39;</span><span class="p">,</span> <span class="s1">&#39;controller_type&#39;</span><span class="p">,</span> <span class="s1">&#39;max_force&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">required_attributes</span><span class="p">:</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">factory</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå Missing attribute: </span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="kc">False</span> <span class="k">else</span><span class="p">:</span> <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">factory</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úÖ </span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="kc">True</span> <span class="c1"># Test factory</span>
<span class="k">if</span> <span class="n">verify_pso_factory</span><span class="p">(</span><span class="n">SMCType</span><span class="o">.</span><span class="n">CLASSICAL</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PSO factory is properly configured&quot;</span><span class="p">)</span>
<span class="err">```</span> <span class="o">**</span><span class="n">Solution</span> <span class="mi">2</span><span class="p">:</span> <span class="n">Debug</span> <span class="n">Factory</span> <span class="n">Creation</span><span class="o">**</span>
<span class="err">```</span><span class="n">python</span>
<span class="c1"># example-metadata:</span>

<span class="c1"># runnable: false def debug_pso_factory_creation(smc_type): &quot;&quot;&quot;Debug PSO factory creation step by step.&quot;&quot;&quot; print(f&quot;Creating PSO factory for {smc_type.value}...&quot;) try: # Step 1: Check controller availability from src.controllers.factory import list_available_controllers available = list_available_controllers() if smc_type.value not in available: print(f&quot;‚ùå Controller {smc_type.value} not available&quot;) return None # Step 2: Create factory factory = create_pso_controller_factory(smc_type) print(f&quot;‚úÖ Factory created successfully&quot;) # Step 3: Test factory attributes print(f&quot; n_gains: {factory.n_gains}&quot;) print(f&quot; controller_type: {factory.controller_type}&quot;) print(f&quot; max_force: {factory.max_force}&quot;) # Step 4: Test factory function from src.controllers.factory import get_default_gains test_gains = get_default_gains(smc_type.value) controller = factory(test_gains) print(f&quot;‚úÖ Factory function works&quot;) return factory except Exception as e: print(f&quot;‚ùå Factory creation failed: {e}&quot;) import traceback traceback.print_exc() return None # Debug factory creation</span>

<span class="n">factory</span> <span class="o">=</span> <span class="n">debug_pso_factory_creation</span><span class="p">(</span><span class="n">SMCType</span><span class="o">.</span><span class="n">CLASSICAL</span><span class="p">)</span>
<span class="err">```</span> <span class="c1">### Issue 2: Gain Validation Failures #### Symptoms</span>
</pre></div>
</div>
<p>All PSO particles marked as invalid
validate_smc_gains returns False for valid-looking gains</p>
<div class="highlight-#### notranslate"><div class="highlight"><pre><span></span>1. **Incorrect gain bounds**: Using bounds that don&#39;t match controller requirements
2. **Type issues**: Passing wrong data types to validation
3. **Numerical precision**: Floating-point precision causing validation failures #### approaches **Solution 1: Debug Gain Validation**
```python

from src.controllers.factory import validate_smc_gains, get_gain_bounds_for_pso, SMCType
import numpy as np def debug_gain_validation(smc_type, gains): &quot;&quot;&quot;Debug gain validation step by step.&quot;&quot;&quot; print(f&quot;Validating gains for {smc_type.value}: {gains}&quot;) # Step 1: Check gain count from src.controllers.factory import get_expected_gain_count expected_count = get_expected_gain_count(smc_type) actual_count = len(gains) print(f&quot;Gain count: expected {expected_count}, got {actual_count}&quot;) if actual_count != expected_count: print(f&quot;‚ùå Wrong gain count&quot;) return False # Step 2: Check gain types for i, gain in enumerate(gains): if not isinstance(gain, (int, float)): print(f&quot;‚ùå Gain {i} has wrong type: {type(gain)}&quot;) return False if not np.isfinite(gain): print(f&quot;‚ùå Gain {i} is not finite: {gain}&quot;) return False if gain &lt;= 0: print(f&quot;‚ùå Gain {i} is not positive: {gain}&quot;) return False print(&quot;‚úÖ All validation checks passed&quot;) # Step 3: Check against bounds lower_bounds, upper_bounds = get_gain_bounds_for_pso(smc_type) for i, (gain, lower, upper) in enumerate(zip(gains, lower_bounds, upper_bounds)): if not (lower &lt;= gain &lt;= upper): print(f&quot;‚ö†Ô∏è Gain {i} outside recommended bounds: {gain} not in [{lower}, {upper}]&quot;) return True # Test validation
test_gains = [20.0, 15.0, 12.0, 8.0, 35.0, 5.0]
debug_gain_validation(SMCType.CLASSICAL, test_gains)
``` **Solution 2: Fix Common Validation Issues**
```python

def fix_common_gain_issues(gains, smc_type): &quot;&quot;&quot;Fix common gain validation issues.&quot;&quot;&quot; import numpy as np # Convert to list if numpy array if isinstance(gains, np.ndarray): gains = gains.tolist() # Ensure all gains are float gains = [float(g) for g in gains] # Clamp to valid range for i, gain in enumerate(gains): if not np.isfinite(gain): gains[i] = 1.0 # Default for invalid values elif gain &lt;= 0: gains[i] = 0.1 # Minimum positive value elif gain &gt; 1000: gains[i] = 100.0 # Maximum reasonable value # Ensure correct count expected_count = get_expected_gain_count(smc_type) if len(gains) &lt; expected_count: # Pad with defaults default_gains = get_default_gains(smc_type.value) gains.extend(default_gains[len(gains):]) elif len(gains) &gt; expected_count: # Truncate gains = gains[:expected_count] return gains # Usage in PSO fitness function
def robust_fitness_function(gains): &quot;&quot;&quot;PSO fitness function with gain fixing.&quot;&quot;&quot; # Fix common issues fixed_gains = fix_common_gain_issues(gains, SMCType.CLASSICAL) # Validate if not validate_smc_gains(SMCType.CLASSICAL, fixed_gains): return float(&#39;inf&#39;) # Create controller factory = create_pso_controller_factory(SMCType.CLASSICAL) controller = factory(fixed_gains) # Evaluate performance return evaluate_controller_performance(controller)
``` ### Issue 3: PSO Performance Problems #### Symptoms
</pre></div>
</div>
<p>PSO optimization extremely slow
High memory usage during PSO
PSO doesn‚Äôt converge</p>
<div class="highlight-#### notranslate"><div class="highlight"><pre><span></span>1. **Factory recreation overhead**: Creating factory in fitness function
2. **Memory leaks**: Not properly cleaning up controllers
3. **Inefficient evaluation**: Complex performance evaluation
4. **Poor PSO parameters**: Suboptimal PSO configuration #### approaches **Solution 1: Optimize PSO Performance**
```python

class OptimizedPSOWorkflow: &quot;&quot;&quot;Optimized PSO workflow for maximum performance.&quot;&quot;&quot; def __init__(self, smc_type, config): self.smc_type = smc_type self.config = config # Create factory once (expensive operation) self.factory = create_pso_controller_factory(smc_type, plant_config=config) # Pre-compute test scenarios self.test_scenarios = self._generate_test_scenarios() # Performance monitoring self.evaluation_count = 0 self.evaluation_times = [] def _generate_test_scenarios(self): &quot;&quot;&quot;Pre-generate test scenarios for consistent evaluation.&quot;&quot;&quot; import numpy as np scenarios = [] # Standard test points test_states = [ np.array([0.1, 0.05, 0.0, 0.0, 0.0, 0.0]), # Small angle np.array([0.3, 0.2, 0.0, 0.0, 0.0, 0.0]), # Medium angle np.array([0.0, 0.0, 0.1, 0.0, 0.0, 0.0]), # Cart displacement ] for state in test_states: scenarios.append({ &#39;initial_state&#39;: state, &#39;simulation_time&#39;: 2.0, &#39;target_state&#39;: np.zeros(6) }) return scenarios def fast_fitness_function(self, gains): &quot;&quot;&quot;Optimized fitness function for PSO.&quot;&quot;&quot; import time start_time = time.time() try: # Quick validation if not validate_smc_gains(self.smc_type, gains): return float(&#39;inf&#39;) # Create controller (fast operation with pre-created factory) controller = self.factory(gains) # Fast performance evaluation total_cost = 0.0 for scenario in self.test_scenarios: # Simplified simulation state = scenario[&#39;initial_state&#39;].copy() cost = 0.0 for _ in range(10): # Short simulation steps control_output = controller.compute_control(state, 0.0, {}) control_value = control_output.u if hasattr(control_output, &#39;u&#39;) else control_output # Simple cost computation state_cost = np.sum(state[:4]**2) # Position and angle errors control_cost = 0.1 * control_value**2 cost += state_cost + control_cost # Simple state update (for speed) state += 0.01 * np.random.randn(6) * 0.1 # Simplified dynamics total_cost += cost # Performance monitoring self.evaluation_count += 1 elapsed = time.time() - start_time self.evaluation_times.append(elapsed) if self.evaluation_count % 100 == 0: avg_time = np.mean(self.evaluation_times[-100:]) print(f&quot;Evaluation {self.evaluation_count}: {avg_time:.4f}s avg&quot;) return total_cost except Exception as e: return float(&#39;inf&#39;) def run_optimization(self): &quot;&quot;&quot;Run optimized PSO.&quot;&quot;&quot; from src.optimization.algorithms.pso_optimizer import PSOTuner # Optimized PSO parameters pso_config = { &#39;n_particles&#39;: 20, # Smaller swarm for speed &#39;max_iter&#39;: 50, # Fewer iterations &#39;w&#39;: 0.9, &#39;c1&#39;: 2.0, &#39;c2&#39;: 2.0, &#39;early_stopping&#39;: True, &#39;patience&#39;: 10 } tuner = PSOTuner( controller_factory=self.fast_fitness_function, config=self.config, **pso_config ) return tuner.optimize() # Usage
optimizer = OptimizedPSOWorkflow(SMCType.CLASSICAL, config)
best_gains, best_fitness = optimizer.run_optimization()
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="configuration-issues-issue-1-configuration-parameter-conflicts-symptoms">
<h2>Configuration Issues ### Issue 1: Configuration Parameter Conflicts #### Symptoms<a class="headerlink" href="#configuration-issues-issue-1-configuration-parameter-conflicts-symptoms" title="Link to this heading">¬∂</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="ne">Warning</span><span class="p">:</span> <span class="n">Could</span> <span class="ow">not</span> <span class="n">extract</span> <span class="n">controller</span> <span class="n">parameters</span>
<span class="n">Configuration</span> <span class="n">parameter</span> <span class="s1">&#39;gains&#39;</span> <span class="n">overridden</span> <span class="n">by</span> <span class="n">explicit</span> <span class="n">parameter</span>
<span class="n">Inconsistent</span> <span class="n">parameter</span> <span class="n">values</span> <span class="n">between</span> <span class="n">config</span> <span class="n">sources</span>
<span class="err">```</span> <span class="c1">#### Root Causes</span>
<span class="mf">1.</span> <span class="o">**</span><span class="n">Multiple</span> <span class="n">configuration</span> <span class="n">sources</span><span class="o">**</span><span class="p">:</span> <span class="n">Conflicting</span> <span class="n">values</span> <span class="kn">from</span><span class="w"> </span><span class="nn">different</span> <span class="n">sources</span>
<span class="mf">2.</span> <span class="o">**</span><span class="n">Parameter</span> <span class="n">priority</span> <span class="n">confusion</span><span class="o">**</span><span class="p">:</span> <span class="n">Not</span> <span class="n">understanding</span> <span class="n">resolution</span> <span class="n">order</span>
<span class="mf">3.</span> <span class="o">**</span><span class="n">Deprecated</span> <span class="n">parameters</span><span class="o">**</span><span class="p">:</span> <span class="n">Using</span> <span class="n">old</span> <span class="n">parameter</span> <span class="n">names</span> <span class="c1">#### approaches **Solution 1: Configuration Priority Debugging**</span>
<span class="err">```</span><span class="n">python</span>

<span class="k">def</span><span class="w"> </span><span class="nf">debug_configuration_priority</span><span class="p">(</span><span class="n">controller_type</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gains</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="s2">&quot;&quot;&quot;Debug configuration parameter resolution.&quot;&quot;&quot;</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Configuration priority debug for </span><span class="si">{</span><span class="n">controller_type</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parameters provided:&quot;</span><span class="p">)</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; gains: </span><span class="si">{</span><span class="n">gains</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; config: </span><span class="si">{</span><span class="n">config</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="kc">None</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; kwargs: </span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="nb">print</span><span class="p">()</span> <span class="c1"># Priority 1: Explicit gains if gains is not None: print(f&quot;‚úÖ Priority 1 - Explicit gains: {gains}&quot;) final_gains = gains else: # Priority 2: Configuration object config_gains = None if config is not None: try: # Try different config structures if hasattr(config, &#39;controllers&#39;) and controller_type in config.controllers: controller_config = config.controllers[controller_type] if hasattr(controller_config, &#39;gains&#39;): config_gains = controller_config.gains print(f&quot;‚úÖ Priority 2 - Config gains: {config_gains}&quot;) except Exception as e: print(f&quot;‚ùå Config extraction failed: {e}&quot;) if config_gains is not None: final_gains = config_gains else: # Priority 3: Registry defaults from src.controllers.factory import get_default_gains default_gains = get_default_gains(controller_type) print(f&quot;‚úÖ Priority 3 - Default gains: {default_gains}&quot;) final_gains = default_gains print(f&quot;\nFinal gains: {final_gains}&quot;) return final_gains # Test configuration priority</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_config</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">load_config</span><span class="p">(</span><span class="s2">&quot;config.yaml&quot;</span><span class="p">)</span> <span class="n">gains</span> <span class="o">=</span> <span class="n">debug_configuration_priority</span><span class="p">(</span> <span class="s1">&#39;classical_smc&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span> <span class="n">gains</span><span class="o">=</span><span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="c1"># Should override config</span>
<span class="p">)</span>
<span class="err">```</span> <span class="o">**</span><span class="n">Solution</span> <span class="mi">2</span><span class="p">:</span> <span class="n">Configuration</span> <span class="n">Validation</span> <span class="ow">and</span> <span class="n">Cleanup</span><span class="o">**</span>
<span class="err">```</span><span class="n">python</span>
<span class="c1"># example-metadata:</span>

<span class="c1"># runnable: false def validate_and_clean_config(controller_type, config): &quot;&quot;&quot;Validate and clean configuration object.&quot;&quot;&quot; cleaned_config = {} warnings = [] # Extract controller-specific configuration try: if hasattr(config, &#39;controllers&#39;) and controller_type in config.controllers: controller_config = config.controllers[controller_type] # Handle different config types if hasattr(controller_config, &#39;model_dump&#39;): # Pydantic model cleaned_config = controller_config.model_dump() elif isinstance(controller_config, dict): # Dictionary cleaned_config = controller_config.copy() else: # Object with attributes cleaned_config = { attr: getattr(controller_config, attr) for attr in dir(controller_config) if not attr.startswith(&#39;_&#39;) and not callable(getattr(controller_config, attr)) } except Exception as e: warnings.append(f&quot;Config extraction failed: {e}&quot;) # Validate parameters if &#39;gains&#39; in cleaned_config: gains = cleaned_config[&#39;gains&#39;] if not isinstance(gains, (list, tuple)) or len(gains) == 0: warnings.append(&quot;Invalid gains format&quot;) del cleaned_config[&#39;gains&#39;] if &#39;max_force&#39; in cleaned_config: if not isinstance(cleaned_config[&#39;max_force&#39;], (int, float)) or cleaned_config[&#39;max_force&#39;] &lt;= 0: warnings.append(&quot;Invalid max_force value&quot;) cleaned_config[&#39;max_force&#39;] = 150.0 # Default # Handle deprecated parameters deprecated_mappings = { &#39;use_equivalent&#39;: &#39;enable_equivalent_control&#39;, &#39;k_gain&#39;: &#39;switching_gain&#39;, &#39;lambda_gains&#39;: &#39;surface_gains&#39; } for old_param, new_param in deprecated_mappings.items(): if old_param in cleaned_config: cleaned_config[new_param] = cleaned_config.pop(old_param) warnings.append(f&quot;Deprecated parameter &#39;{old_param}&#39; migrated to &#39;{new_param}&#39;&quot;) if warnings: print(&quot;Configuration warnings:&quot;) for warning in warnings: print(f&quot; ‚ö†Ô∏è {warning}&quot;) return cleaned_config # Usage</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">load_config</span><span class="p">(</span><span class="s2">&quot;config.yaml&quot;</span><span class="p">)</span>
<span class="n">cleaned</span> <span class="o">=</span> <span class="n">validate_and_clean_config</span><span class="p">(</span><span class="s1">&#39;classical_smc&#39;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
<span class="n">controller</span> <span class="o">=</span> <span class="n">create_controller</span><span class="p">(</span><span class="s1">&#39;classical_smc&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">cleaned</span><span class="p">)</span>
<span class="err">```</span> <span class="c1">### Issue 2: YAML Configuration Errors #### Symptoms</span>
</pre></div>
</div>
<p>yaml.scanner.ScannerError: mapping values are not allowed here
KeyError: ‚Äòcontrollers‚Äô not found in configuration
Pydantic validation error for configuration</p>
<div class="highlight-#### notranslate"><div class="highlight"><pre><span></span>1. **YAML syntax errors**: Invalid YAML formatting
2. **Missing configuration sections**: Required sections not present
3. **Type mismatches**: Wrong data types in configuration #### approaches **Solution 1: Configuration Validation Tool**
```python

def validate_yaml_configuration(config_path): &quot;&quot;&quot;Validate YAML configuration file.&quot;&quot;&quot; import yaml from pathlib import Path print(f&quot;Validating configuration: {config_path}&quot;) # Check file exists if not Path(config_path).exists(): print(f&quot;‚ùå Configuration file not found: {config_path}&quot;) return False # Check YAML syntax try: with open(config_path, &#39;r&#39;) as f: config_data = yaml.safe_load(f) print(&quot;‚úÖ YAML syntax valid&quot;) except yaml.YAMLError as e: print(f&quot;‚ùå YAML syntax error: {e}&quot;) return False # Check required sections required_sections = [&#39;controllers&#39;, &#39;physics&#39;, &#39;simulation&#39;] for section in required_sections: if section not in config_data: print(f&quot;‚ö†Ô∏è Missing section: {section}&quot;) else: print(f&quot;‚úÖ Section found: {section}&quot;) # Check controller configurations if &#39;controllers&#39; in config_data: controllers = config_data[&#39;controllers&#39;] for controller_type, controller_config in controllers.items(): print(f&quot;\nValidating {controller_type}:&quot;) # Check gains if &#39;gains&#39; in controller_config: gains = controller_config[&#39;gains&#39;] if not isinstance(gains, list): print(f&quot; ‚ùå gains must be a list, got {type(gains)}&quot;) elif len(gains) == 0: print(f&quot; ‚ùå gains list is empty&quot;) else: print(f&quot; ‚úÖ gains: {len(gains)} values&quot;) # Check numeric parameters numeric_params = [&#39;max_force&#39;, &#39;dt&#39;, &#39;boundary_layer&#39;] for param in numeric_params: if param in controller_config: value = controller_config[param] if not isinstance(value, (int, float)): print(f&quot; ‚ùå {param} must be numeric, got {type(value)}&quot;) elif value &lt;= 0: print(f&quot; ‚ùå {param} must be positive, got {value}&quot;) else: print(f&quot; ‚úÖ {param}: {value}&quot;) return True # Validate configuration
validate_yaml_configuration(&quot;config.yaml&quot;)
``` **Solution 2: Configuration Fix Tool**
```python

def fix_configuration_file(config_path, backup=True): &quot;&quot;&quot;Fix common configuration file issues.&quot;&quot;&quot; import yaml import shutil from pathlib import Path config_file = Path(config_path) if backup: backup_file = config_file.with_suffix(&#39;.yaml.backup&#39;) shutil.copy2(config_file, backup_file) print(f&quot;Created backup: {backup_file}&quot;) # Load current configuration with open(config_file, &#39;r&#39;) as f: config_data = yaml.safe_load(f) fixes_applied = [] # Fix 1: Ensure required sections exist required_sections = { &#39;controllers&#39;: {}, &#39;physics&#39;: { &#39;m1&#39;: 0.5, &#39;m2&#39;: 0.5, &#39;M&#39;: 2.0, &#39;l1&#39;: 0.5, &#39;l2&#39;: 0.5, &#39;b1&#39;: 0.1, &#39;b2&#39;: 0.1, &#39;I1&#39;: 0.1, &#39;I2&#39;: 0.1 }, &#39;simulation&#39;: { &#39;duration&#39;: 5.0, &#39;dt&#39;: 0.001 } } for section, defaults in required_sections.items(): if section not in config_data: config_data[section] = defaults fixes_applied.append(f&quot;Added missing section: {section}&quot;) # Fix 2: Ensure controller defaults controller_defaults = { &#39;classical_smc&#39;: { &#39;gains&#39;: [20.0, 15.0, 12.0, 8.0, 35.0, 5.0], &#39;max_force&#39;: 150.0, &#39;boundary_layer&#39;: 0.02, &#39;dt&#39;: 0.001 }, &#39;adaptive_smc&#39;: { &#39;gains&#39;: [25.0, 18.0, 15.0, 10.0, 4.0], &#39;max_force&#39;: 150.0, &#39;dt&#39;: 0.001 }, &#39;sta_smc&#39;: { &#39;gains&#39;: [25.0, 15.0, 20.0, 12.0, 8.0, 6.0], &#39;max_force&#39;: 150.0, &#39;dt&#39;: 0.001 } } for controller_type, defaults in controller_defaults.items(): if controller_type not in config_data[&#39;controllers&#39;]: config_data[&#39;controllers&#39;][controller_type] = defaults fixes_applied.append(f&quot;Added controller defaults: {controller_type}&quot;) else: # Fix missing parameters controller_config = config_data[&#39;controllers&#39;][controller_type] for param, default_value in defaults.items(): if param not in controller_config: controller_config[param] = default_value fixes_applied.append(f&quot;Added missing parameter {controller_type}.{param}&quot;) # Fix 3: Validate and fix data types for controller_type, controller_config in config_data[&#39;controllers&#39;].items(): if &#39;gains&#39; in controller_config: gains = controller_config[&#39;gains&#39;] if not isinstance(gains, list): # Try to convert to list try: controller_config[&#39;gains&#39;] = list(gains) fixes_applied.append(f&quot;Converted {controller_type}.gains to list&quot;) except: controller_config[&#39;gains&#39;] = controller_defaults.get(controller_type, {}).get(&#39;gains&#39;, [1.0]) fixes_applied.append(f&quot;Reset invalid {controller_type}.gains&quot;) # Write fixed configuration with open(config_file, &#39;w&#39;) as f: yaml.dump(config_data, f, default_flow_style=False, sort_keys=False) if fixes_applied: print(&quot;Fixes applied:&quot;) for fix in fixes_applied: print(f&quot; ‚úÖ {fix}&quot;) else: print(&quot;No fixes needed&quot;) return len(fixes_applied) &gt; 0 # Fix configuration file
fix_configuration_file(&quot;config.yaml&quot;)
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="performance-problems-issue-1-slow-controller-creation-symptoms">
<h2>Performance Problems ### Issue 1: Slow Controller Creation #### Symptoms<a class="headerlink" href="#performance-problems-issue-1-slow-controller-creation-symptoms" title="Link to this heading">¬∂</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">Controller</span> <span class="n">creation</span> <span class="n">takes</span> <span class="o">&gt;</span><span class="mi">1</span> <span class="n">second</span>
<span class="n">High</span> <span class="n">CPU</span> <span class="n">usage</span> <span class="n">during</span> <span class="n">factory</span> <span class="n">operations</span>
<span class="n">Memory</span> <span class="n">usage</span> <span class="n">grows</span> <span class="k">with</span> <span class="n">each</span> <span class="n">controller</span> <span class="n">creation</span>
<span class="err">```</span> <span class="c1">#### Root Causes</span>
<span class="mf">1.</span> <span class="o">**</span><span class="n">Configuration</span> <span class="n">overhead</span><span class="o">**</span><span class="p">:</span> <span class="n">Complex</span> <span class="n">configuration</span> <span class="n">processing</span>
<span class="mf">2.</span> <span class="o">**</span><span class="n">Import</span> <span class="n">delays</span><span class="o">**</span><span class="p">:</span> <span class="n">Slow</span> <span class="n">module</span> <span class="n">imports</span>
<span class="mf">3.</span> <span class="o">**</span><span class="n">Memory</span> <span class="n">allocation</span><span class="o">**</span><span class="p">:</span> <span class="n">Large</span> <span class="nb">object</span> <span class="n">creation</span>
<span class="mf">4.</span> <span class="o">**</span><span class="n">Thread</span> <span class="n">contention</span><span class="o">**</span><span class="p">:</span> <span class="n">Multiple</span> <span class="n">threads</span> <span class="n">creating</span> <span class="n">controllers</span> <span class="c1">#### approaches **Solution 1: Performance Profiling**</span>
<span class="err">```</span><span class="n">python</span>

<span class="k">def</span><span class="w"> </span><span class="nf">profile_controller_creation</span><span class="p">(</span><span class="n">controller_type</span><span class="p">,</span> <span class="n">n_iterations</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span> <span class="s2">&quot;&quot;&quot;Profile controller creation performance.&quot;&quot;&quot;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">time</span> <span class="kn">import</span><span class="w"> </span><span class="nn">psutil</span> <span class="kn">import</span><span class="w"> </span><span class="nn">os</span> <span class="n">process</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span> <span class="c1"># Warmup controller = create_controller(controller_type) # Measure performance times = [] memory_usage = [] for i in range(n_iterations): # Measure memory before mem_before = process.memory_info().rss / 1024 / 1024 # MB # Time controller creation start_time = time.time() controller = create_controller(controller_type) end_time = time.time() # Measure memory after mem_after = process.memory_info().rss / 1024 / 1024 # MB times.append(end_time - start_time) memory_usage.append(mem_after - mem_before) # Cleanup del controller # Analysis import numpy as np print(f&quot;Performance Profile for {controller_type}:&quot;) print(f&quot; Iterations: {n_iterations}&quot;) print(f&quot; Average time: {np.mean(times):.4f}s&quot;) print(f&quot; Std deviation: {np.std(times):.4f}s&quot;) print(f&quot; Min time: {np.min(times):.4f}s&quot;) print(f&quot; Max time: {np.max(times):.4f}s&quot;) print(f&quot; Average memory per creation: {np.mean(memory_usage):.2f}MB&quot;) # Performance thresholds if np.mean(times) &gt; 0.1: print(&quot;‚ö†Ô∏è Controller creation is slow (&gt;0.1s)&quot;) if np.mean(memory_usage) &gt; 10: print(&quot;‚ö†Ô∏è High memory usage per controller (&gt;10MB)&quot;) return { &#39;mean_time&#39;: np.mean(times), &#39;std_time&#39;: np.std(times), &#39;mean_memory&#39;: np.mean(memory_usage) } # Profile different controllers</span>
<span class="k">for</span> <span class="n">controller_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;classical_smc&#39;</span><span class="p">,</span> <span class="s1">&#39;adaptive_smc&#39;</span><span class="p">,</span> <span class="s1">&#39;sta_smc&#39;</span><span class="p">]:</span> <span class="k">try</span><span class="p">:</span> <span class="n">profile_controller_creation</span><span class="p">(</span><span class="n">controller_type</span><span class="p">)</span> <span class="nb">print</span><span class="p">()</span> <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Profiling failed for </span><span class="si">{</span><span class="n">controller_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="err">```</span> <span class="o">**</span><span class="n">Solution</span> <span class="mi">2</span><span class="p">:</span> <span class="n">Performance</span> <span class="n">Optimization</span><span class="o">**</span>
<span class="err">```</span><span class="n">python</span>
<span class="c1"># example-metadata:</span>

<span class="c1"># runnable: false class OptimizedControllerFactory: &quot;&quot;&quot;Optimized controller factory with caching and pooling.&quot;&quot;&quot; def __init__(self): self._config_cache = {} self._controller_pool = {} self._pool_size = 10 def _get_cached_config(self, controller_type, config_key): &quot;&quot;&quot;Get cached configuration to avoid repeated processing.&quot;&quot;&quot; cache_key = (controller_type, config_key) if cache_key not in self._config_cache: # Create and cache configuration if config_key is None: # Use defaults from src.controllers.factory import get_default_gains gains = get_default_gains(controller_type) config_obj = self._create_minimal_config(controller_type, gains) else: # Process provided configuration config_obj = self._process_config(controller_type, config_key) self._config_cache[cache_key] = config_obj return self._config_cache[cache_key] def _create_minimal_config(self, controller_type, gains): &quot;&quot;&quot;Create minimal configuration object.&quot;&quot;&quot; from src.controllers.factory import CONTROLLER_REGISTRY controller_info = CONTROLLER_REGISTRY[controller_type] config_class = controller_info[&#39;config_class&#39;] # Minimal required parameters if controller_type == &#39;classical_smc&#39;: return config_class( gains=gains, max_force=150.0, boundary_layer=0.02, dt=0.001 ) elif controller_type == &#39;adaptive_smc&#39;: return config_class( gains=gains, max_force=150.0, dt=0.001 ) # ... other controller types def create_optimized_controller(self, controller_type, gains=None, config=None): &quot;&quot;&quot;Create controller with optimization.&quot;&quot;&quot; # Use pooling for identical configurations pool_key = (controller_type, tuple(gains) if gains else None) if pool_key in self._controller_pool: # Reuse existing controller controller = self._controller_pool[pool_key] controller.reset() # Reset state return controller # Create new controller if gains is not None: controller = create_controller(controller_type, gains=gains) else: controller = create_controller(controller_type, config=config) # Add to pool if space available if len(self._controller_pool) &lt; self._pool_size: self._controller_pool[pool_key] = controller return controller def clear_cache(self): &quot;&quot;&quot;Clear all caches to free memory.&quot;&quot;&quot; self._config_cache.clear() self._controller_pool.clear() # Usage</span>

<span class="n">factory</span> <span class="o">=</span> <span class="n">OptimizedControllerFactory</span><span class="p">()</span> <span class="c1"># Create controllers efficiently</span>
<span class="n">controllers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span> <span class="n">gains</span> <span class="o">=</span> <span class="p">[</span><span class="mf">20.0</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">35.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">]</span> <span class="n">controller</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">create_optimized_controller</span><span class="p">(</span><span class="s1">&#39;classical_smc&#39;</span><span class="p">,</span> <span class="n">gains</span><span class="o">=</span><span class="n">gains</span><span class="p">)</span> <span class="n">controllers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span> <span class="c1"># Cleanup</span>
<span class="n">factory</span><span class="o">.</span><span class="n">clear_cache</span><span class="p">()</span>
<span class="err">```</span> <span class="c1">### Issue 2: Memory Leaks #### Symptoms</span>
</pre></div>
</div>
<p>Memory usage continuously grows
‚ÄúOut of memory‚Äù errors during long PSO runs
Python process not releasing memory</p>
<div class="highlight-#### notranslate"><div class="highlight"><pre><span></span>1. **Controller references**: Not properly releasing controller objects
2. **Configuration caching**: Unlimited cache growth
3. **Circular references**: Python garbage collection issues #### approaches **Solution 1: Memory Monitoring**
```python

class MemoryMonitor: &quot;&quot;&quot;Monitor memory usage during controller operations.&quot;&quot;&quot; def __init__(self): import psutil import os self.process = psutil.Process(os.getpid()) self.baseline_memory = self.get_memory_usage() self.peak_memory = self.baseline_memory self.measurements = [] def get_memory_usage(self): &quot;&quot;&quot;Get current memory usage in MB.&quot;&quot;&quot; return self.process.memory_info().rss / 1024 / 1024 def record_measurement(self, operation_name): &quot;&quot;&quot;Record memory measurement.&quot;&quot;&quot; current_memory = self.get_memory_usage() self.peak_memory = max(self.peak_memory, current_memory) measurement = { &#39;operation&#39;: operation_name, &#39;memory_mb&#39;: current_memory, &#39;delta_mb&#39;: current_memory - self.baseline_memory } self.measurements.append(measurement) if measurement[&#39;delta_mb&#39;] &gt; 100: # Alert if &gt;100MB growth print(f&quot;‚ö†Ô∏è Memory alert: {operation_name} - {current_memory:.1f}MB (+{measurement[&#39;delta_mb&#39;]:.1f}MB)&quot;) def print_summary(self): &quot;&quot;&quot;Print memory usage summary.&quot;&quot;&quot; current_memory = self.get_memory_usage() total_growth = current_memory - self.baseline_memory print(f&quot;Memory Usage Summary:&quot;) print(f&quot; Baseline: {self.baseline_memory:.1f}MB&quot;) print(f&quot; Current: {current_memory:.1f}MB&quot;) print(f&quot; Peak: {self.peak_memory:.1f}MB&quot;) print(f&quot; Total growth: {total_growth:.1f}MB&quot;) if total_growth &gt; 50: print(&quot;‚ö†Ô∏è Significant memory growth detected&quot;) # Usage with memory monitoring
monitor = MemoryMonitor() # Monitor PSO operation
factory = create_pso_controller_factory(SMCType.CLASSICAL)
monitor.record_measurement(&quot;Factory creation&quot;) for i in range(1000): gains = np.random.uniform(1, 50, 6) controller = factory(gains) if i % 100 == 0: monitor.record_measurement(f&quot;Iteration {i}&quot;) # Explicit cleanup del controller monitor.record_measurement(&quot;PSO complete&quot;)
monitor.print_summary()
``` **Solution 2: Explicit Memory Management**
```python
# example-metadata:

# runnable: false import gc

import weakref class ManagedControllerFactory: &quot;&quot;&quot;Controller factory with explicit memory management.&quot;&quot;&quot; def __init__(self): self._weak_references = set() self._creation_count = 0 self._cleanup_threshold = 100 def create_managed_controller(self, controller_type, **kwargs): &quot;&quot;&quot;Create controller with memory management.&quot;&quot;&quot; # Create controller controller = create_controller(controller_type, **kwargs) # Add weak reference for tracking weak_ref = weakref.ref(controller, self._on_controller_deleted) self._weak_references.add(weak_ref) self._creation_count += 1 # Periodic cleanup if self._creation_count % self._cleanup_threshold == 0: self._perform_cleanup() return controller def _on_controller_deleted(self, weak_ref): &quot;&quot;&quot;Callback when controller is garbage collected.&quot;&quot;&quot; self._weak_references.discard(weak_ref) def _perform_cleanup(self): &quot;&quot;&quot;Perform explicit cleanup.&quot;&quot;&quot; # Remove dead weak references dead_refs = set() for ref in self._weak_references: if ref() is None: dead_refs.add(ref) self._weak_references -= dead_refs # Force garbage collection gc.collect() print(f&quot;Cleanup: {len(self._weak_references)} controllers active, &quot; f&quot;{self._creation_count} total created&quot;) def get_active_controller_count(self): &quot;&quot;&quot;Get number of active controllers.&quot;&quot;&quot; return len([ref for ref in self._weak_references if ref() is not None]) def force_cleanup(self): &quot;&quot;&quot;Force immediate cleanup.&quot;&quot;&quot; self._perform_cleanup() # Usage with managed factory
managed_factory = ManagedControllerFactory() # PSO with memory management
def managed_pso_fitness(gains): &quot;&quot;&quot;PSO fitness function with memory management.&quot;&quot;&quot; controller = managed_factory.create_managed_controller(&#39;classical_smc&#39;, gains=gains) try: # Evaluate controller performance = evaluate_controller_performance(controller) return performance[&#39;total_cost&#39;] finally: # Explicit cleanup del controller # Periodic forced cleanup if managed_factory._creation_count % 50 == 0: managed_factory.force_cleanup() # Run PSO with memory management
# ... PSO optimization code

</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="import-and-dependency-issues-issue-1-missing-module-imports-symptoms">
<h2>Import and Dependency Issues ### Issue 1: Missing Module Imports #### Symptoms<a class="headerlink" href="#import-and-dependency-issues-issue-1-missing-module-imports-symptoms" title="Link to this heading">¬∂</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="ne">ImportError</span><span class="p">:</span> <span class="n">No</span> <span class="n">module</span> <span class="n">named</span> <span class="s1">&#39;src.controllers.factory&#39;</span>
<span class="ne">ModuleNotFoundError</span><span class="p">:</span> <span class="n">No</span> <span class="n">module</span> <span class="n">named</span> <span class="s1">&#39;control&#39;</span>
<span class="ne">ImportError</span><span class="p">:</span> <span class="n">cannot</span> <span class="kn">import</span><span class="w"> </span><span class="nn">name</span> <span class="s1">&#39;MPCController&#39;</span>
<span class="err">```</span> <span class="c1">#### Root Causes</span>
<span class="mf">1.</span> <span class="o">**</span><span class="n">Python</span> <span class="n">path</span> <span class="n">issues</span><span class="o">**</span><span class="p">:</span> <span class="err">`</span><span class="n">src</span><span class="err">`</span> <span class="n">directory</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Python</span> <span class="n">path</span>
<span class="mf">2.</span> <span class="o">**</span><span class="n">Missing</span> <span class="n">dependencies</span><span class="o">**</span><span class="p">:</span> <span class="n">Required</span> <span class="n">packages</span> <span class="ow">not</span> <span class="n">installed</span>
<span class="mf">3.</span> <span class="o">**</span><span class="n">Circular</span> <span class="n">imports</span><span class="o">**</span><span class="p">:</span> <span class="n">Import</span> <span class="n">dependency</span> <span class="n">cycles</span>
<span class="mf">4.</span> <span class="o">**</span><span class="n">Optional</span> <span class="n">dependencies</span><span class="o">**</span><span class="p">:</span> <span class="n">Missing</span> <span class="n">optional</span> <span class="n">packages</span> <span class="c1">#### approaches **Solution 1: Python Path Management**</span>
<span class="err">```</span><span class="n">python</span>

<span class="k">def</span><span class="w"> </span><span class="nf">fix_python_path</span><span class="p">():</span> <span class="s2">&quot;&quot;&quot;Fix Python path for project imports.&quot;&quot;&quot;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span> <span class="kn">import</span><span class="w"> </span><span class="nn">os</span> <span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span> <span class="c1"># Get project root directory current_dir = Path(__file__).resolve().parent project_root = current_dir # Find project root by looking for key files while project_root.parent != project_root: if (project_root / &#39;src&#39;).exists() and (project_root / &#39;config.yaml&#39;).exists(): break project_root = project_root.parent # Add to Python path if str(project_root) not in sys.path: sys.path.insert(0, str(project_root)) print(f&quot;Added to Python path: {project_root}&quot;) # Verify imports work try: from src.controllers.factory import create_controller print(&quot;‚úÖ Factory imports working&quot;) return True except ImportError as e: print(f&quot;‚ùå Import still failing: {e}&quot;) return False # Fix path before imports</span>
<span class="n">fix_python_path</span><span class="p">()</span>
<span class="err">```</span> <span class="o">**</span><span class="n">Solution</span> <span class="mi">2</span><span class="p">:</span> <span class="n">Dependency</span> <span class="n">Checker</span><span class="o">**</span>
<span class="err">```</span><span class="n">python</span>
<span class="c1"># example-metadata:</span>

<span class="c1"># runnable: false def check_dependencies(): &quot;&quot;&quot;Check all project dependencies.&quot;&quot;&quot; required_packages = { &#39;numpy&#39;: &#39;pip install numpy&#39;, &#39;scipy&#39;: &#39;pip install scipy&#39;, &#39;matplotlib&#39;: &#39;pip install matplotlib&#39;, &#39;pydantic&#39;: &#39;pip install pydantic&#39;, &#39;yaml&#39;: &#39;pip install pyyaml&#39;, &#39;numba&#39;: &#39;pip install numba&#39; } optional_packages = { &#39;control&#39;: &#39;pip install control-systems-toolkit (for MPC)&#39;, &#39;cvxopt&#39;: &#39;pip install cvxopt (for optimization-based MPC)&#39;, &#39;streamlit&#39;: &#39;pip install streamlit (for web interface)&#39; } print(&quot;Checking required dependencies:&quot;) missing_required = [] for package, install_cmd in required_packages.items(): try: __import__(package) print(f&quot; ‚úÖ {package}&quot;) except ImportError: print(f&quot; ‚ùå {package} - {install_cmd}&quot;) missing_required.append((package, install_cmd)) print(&quot;\nChecking optional dependencies:&quot;) missing_optional = [] for package, install_cmd in optional_packages.items(): try: __import__(package) print(f&quot; ‚úÖ {package}&quot;) except ImportError: print(f&quot; ‚ö†Ô∏è {package} - {install_cmd}&quot;) missing_optional.append((package, install_cmd)) # Installation script if missing_required: print(&quot;\nTo install missing required packages:&quot;) for package, install_cmd in missing_required: print(f&quot; {install_cmd}&quot;) if missing_optional: print(&quot;\nTo install missing optional packages:&quot;) for package, install_cmd in missing_optional: print(f&quot; {install_cmd}&quot;) return len(missing_required) == 0 # Check dependencies</span>

<span class="n">check_dependencies</span><span class="p">()</span>
<span class="err">```</span> <span class="o">**</span><span class="n">Solution</span> <span class="mi">3</span><span class="p">:</span> <span class="n">Import</span> <span class="n">Debugging</span><span class="o">**</span>
<span class="err">```</span><span class="n">python</span>
<span class="c1"># example-metadata:</span>

<span class="c1"># runnable: false def debug_import_issues(): &quot;&quot;&quot;Debug specific import issues.&quot;&quot;&quot; import sys print(f&quot;Python version: {sys.version}&quot;) print(f&quot;Python path: {sys.path[:3]}...&quot;) # Show first 3 entries # Test specific imports import_tests = [ (&#39;src&#39;, &#39;Basic src module&#39;), (&#39;src.controllers&#39;, &#39;Controllers module&#39;), (&#39;src.controllers.factory&#39;, &#39;Factory module&#39;), (&#39;src.config&#39;, &#39;Config module&#39;), (&#39;src.optimization.algorithms.pso_optimizer&#39;, &#39;PSO optimizer&#39;) ] for module_name, description in import_tests: try: module = __import__(module_name, fromlist=[&#39;&#39;]) print(f&quot;‚úÖ {description}: {module}&quot;) except ImportError as e: print(f&quot;‚ùå {description}: {e}&quot;) # Try to give specific help if &#39;src&#39; in module_name: print(&quot; Try: sys.path.insert(0, &#39;/path/to/project/root&#39;)&quot;) elif &#39;mpc&#39; in module_name.lower(): print(&quot; Try: pip install control-systems-toolkit&quot;) debug_import_issues()</span>

</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="thread-safety-issues-issue-1-factory-lock-timeouts-symptoms">
<h2>Thread Safety Issues ### Issue 1: Factory Lock Timeouts #### Symptoms<a class="headerlink" href="#thread-safety-issues-issue-1-factory-lock-timeouts-symptoms" title="Link to this heading">¬∂</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="ne">RuntimeError</span><span class="p">:</span> <span class="n">Lock</span> <span class="n">timeout</span> <span class="n">exceeded</span> <span class="p">(</span><span class="mf">10.0</span><span class="n">s</span><span class="p">)</span>
<span class="n">Deadlock</span> <span class="n">detected</span> <span class="ow">in</span> <span class="n">factory</span> <span class="n">operations</span>
<span class="n">Concurrent</span> <span class="n">controller</span> <span class="n">creation</span> <span class="n">hanging</span>
<span class="err">```</span> <span class="c1">#### Root Causes</span>
<span class="mf">1.</span> <span class="o">**</span><span class="n">Excessive</span> <span class="n">concurrency</span><span class="o">**</span><span class="p">:</span> <span class="n">Too</span> <span class="n">many</span> <span class="n">threads</span> <span class="n">creating</span> <span class="n">controllers</span>
<span class="mf">2.</span> <span class="o">**</span><span class="n">Long</span><span class="o">-</span><span class="n">running</span> <span class="n">operations</span><span class="o">**</span><span class="p">:</span> <span class="n">Slow</span> <span class="n">operations</span> <span class="n">holding</span> <span class="n">locks</span>
<span class="mf">3.</span> <span class="o">**</span><span class="n">Nested</span> <span class="n">locking</span><span class="o">**</span><span class="p">:</span> <span class="n">Deadlock</span> <span class="kn">from</span><span class="w"> </span><span class="nn">recursive</span> <span class="n">calls</span>
<span class="mf">4.</span> <span class="o">**</span><span class="n">Resource</span> <span class="n">contention</span><span class="o">**</span><span class="p">:</span> <span class="n">Limited</span> <span class="n">system</span> <span class="n">resources</span> <span class="c1">#### approaches **Solution 1: Reduce Factory Contention**</span>
<span class="err">```</span><span class="n">python</span>
<span class="c1"># example-metadata:</span>

<span class="c1"># runnable: false import threading</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">concurrent.futures</span><span class="w"> </span><span class="kn">import</span> <span class="n">ThreadPoolExecutor</span><span class="p">,</span> <span class="n">as_completed</span> <span class="k">def</span><span class="w"> </span><span class="nf">parallel_controller_creation_safe</span><span class="p">(</span><span class="n">controller_configs</span><span class="p">):</span> <span class="s2">&quot;&quot;&quot;Safe parallel controller creation with reduced contention.&quot;&quot;&quot;</span> <span class="c1"># Strategy 1: Batch creation to reduce lock contention batch_size = 4 # Limit concurrent factory calls results = [] def create_controller_batch(config_batch): &quot;&quot;&quot;Create a batch of controllers.&quot;&quot;&quot; batch_results = [] for config in config_batch: try: controller = create_controller(**config) batch_results.append((&#39;success&#39;, controller)) except Exception as e: batch_results.append((&#39;error&#39;, str(e))) return batch_results # Split configs into batches batches = [ controller_configs[i:i+batch_size] for i in range(0, len(controller_configs), batch_size) ] # Process batches sequentially to avoid lock contention for batch in batches: batch_results = create_controller_batch(batch) results.extend(batch_results) return results # Usage</span>
<span class="n">configs</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span><span class="s1">&#39;controller_type&#39;</span><span class="p">:</span> <span class="s1">&#39;classical_smc&#39;</span><span class="p">,</span> <span class="s1">&#39;gains&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">5</span><span class="p">]},</span> <span class="p">{</span><span class="s1">&#39;controller_type&#39;</span><span class="p">:</span> <span class="s1">&#39;adaptive_smc&#39;</span><span class="p">,</span> <span class="s1">&#39;gains&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">]},</span> <span class="c1"># ... more configs</span>
<span class="p">]</span> <span class="n">results</span> <span class="o">=</span> <span class="n">parallel_controller_creation_safe</span><span class="p">(</span><span class="n">configs</span><span class="p">)</span>
<span class="err">```</span> <span class="o">**</span><span class="n">Solution</span> <span class="mi">2</span><span class="p">:</span> <span class="n">Lock</span><span class="o">-</span><span class="n">Free</span> <span class="n">Factory</span> <span class="n">Operations</span><span class="o">**</span>
<span class="err">```</span><span class="n">python</span>
<span class="c1"># example-metadata:</span>

<span class="c1"># runnable: false class LockFreeControllerCache: &quot;&quot;&quot;Lock-free controller cache using pre-created controllers.&quot;&quot;&quot; def __init__(self): self._controller_cache = {} self._cache_lock = threading.RLock() self._initialized = False def initialize_cache(self, preload_configs): &quot;&quot;&quot;Pre-create controllers to avoid runtime factory calls.&quot;&quot;&quot; if self._initialized: return print(&quot;Initializing controller cache...&quot;) # Create controllers sequentially during initialization for config in preload_configs: try: controller = create_controller(**config) cache_key = self._make_cache_key(config) self._controller_cache[cache_key] = controller print(f&quot;Cached: {config[&#39;controller_type&#39;]}&quot;) except Exception as e: print(f&quot;Failed to cache {config}: {e}&quot;) self._initialized = True print(f&quot;Cache initialized with {len(self._controller_cache)} controllers&quot;) def _make_cache_key(self, config): &quot;&quot;&quot;Create cache key from configuration.&quot;&quot;&quot; key_parts = [config[&#39;controller_type&#39;]] if &#39;gains&#39; in config: key_parts.extend([f&quot;{g:.3f}&quot; for g in config[&#39;gains&#39;]]) return tuple(key_parts) def get_controller(self, config): &quot;&quot;&quot;Get controller from cache (thread-safe read).&quot;&quot;&quot; cache_key = self._make_cache_key(config) if cache_key in self._controller_cache: # Clone controller to avoid shared state issues cached_controller = self._controller_cache[cache_key] return self._clone_controller(cached_controller, config) else: # Fallback to factory (with lock) return create_controller(**config) def _clone_controller(self, cached_controller, config): &quot;&quot;&quot;Create a new controller with same configuration.&quot;&quot;&quot; # Reset cached controller state cached_controller.reset() return cached_controller # Initialize cache at startup</span>

<span class="n">cache</span> <span class="o">=</span> <span class="n">LockFreeControllerCache</span><span class="p">()</span> <span class="c1"># Pre-define common configurations</span>
<span class="n">common_configs</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span><span class="s1">&#39;controller_type&#39;</span><span class="p">:</span> <span class="s1">&#39;classical_smc&#39;</span><span class="p">,</span> <span class="s1">&#39;gains&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">5</span><span class="p">]},</span> <span class="p">{</span><span class="s1">&#39;controller_type&#39;</span><span class="p">:</span> <span class="s1">&#39;adaptive_smc&#39;</span><span class="p">,</span> <span class="s1">&#39;gains&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">]},</span> <span class="p">{</span><span class="s1">&#39;controller_type&#39;</span><span class="p">:</span> <span class="s1">&#39;sta_smc&#39;</span><span class="p">,</span> <span class="s1">&#39;gains&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">]},</span>
<span class="p">]</span> <span class="n">cache</span><span class="o">.</span><span class="n">initialize_cache</span><span class="p">(</span><span class="n">common_configs</span><span class="p">)</span> <span class="c1"># Use cache in PSO (thread-safe)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">thread_safe_fitness_function</span><span class="p">(</span><span class="n">gains</span><span class="p">):</span> <span class="s2">&quot;&quot;&quot;PSO fitness function using cached controllers.&quot;&quot;&quot;</span> <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;controller_type&#39;</span><span class="p">:</span> <span class="s1">&#39;classical_smc&#39;</span><span class="p">,</span> <span class="s1">&#39;gains&#39;</span><span class="p">:</span> <span class="n">gains</span><span class="p">}</span> <span class="n">controller</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get_controller</span><span class="p">(</span><span class="n">config</span><span class="p">)</span> <span class="k">return</span> <span class="n">evaluate_controller_performance</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
<span class="err">```</span> <span class="c1">### Issue 2: Shared State Problems #### Symptoms</span>
</pre></div>
</div>
<p>Controllers interfering with each other
Unexpected state changes between calls
Race conditions in control computation</p>
<div class="highlight-#### notranslate"><div class="highlight"><pre><span></span>1. **Shared mutable state**: Controllers sharing mutable objects
2. **Singleton patterns**: Global state being modified
3. **Static variables**: Class-level shared state #### approaches **Solution 1: Controller State Isolation**
```python
# example-metadata:

# runnable: false class IsolatedControllerWrapper: &quot;&quot;&quot;Wrapper to ensure controller state isolation.&quot;&quot;&quot; def __init__(self, controller): self._controller = controller self._state_lock = threading.RLock() self._initial_state = self._capture_state() def _capture_state(self): &quot;&quot;&quot;Capture controller&#39;s initial state.&quot;&quot;&quot; state = {} # Capture gains if hasattr(self._controller, &#39;gains&#39;): state[&#39;gains&#39;] = self._controller.gains.copy() # Capture configuration if hasattr(self._controller, &#39;config&#39;): state[&#39;config&#39;] = self._controller.config # Controller-specific state if hasattr(self._controller, &#39;_adaptive_gains&#39;): state[&#39;adaptive_gains&#39;] = self._controller._adaptive_gains.copy() return state def reset_state(self): &quot;&quot;&quot;Reset controller to initial state.&quot;&quot;&quot; with self._state_lock: # Reset gains if &#39;gains&#39; in self._initial_state: self._controller.gains = self._initial_state[&#39;gains&#39;].copy() # Reset adaptive state if hasattr(self._controller, &#39;_adaptive_gains&#39;) and &#39;adaptive_gains&#39; in self._initial_state: self._controller._adaptive_gains = self._initial_state[&#39;adaptive_gains&#39;].copy() # Call controller&#39;s reset method if hasattr(self._controller, &#39;reset&#39;): self._controller.reset() def compute_control(self, state, last_control=0.0, history=None): &quot;&quot;&quot;Thread-safe control computation.&quot;&quot;&quot; with self._state_lock: # Ensure clean state if history is None: history = {} # Compute control result = self._controller.compute_control(state, last_control, history) return result def __getattr__(self, name): &quot;&quot;&quot;Delegate other attributes to wrapped controller.&quot;&quot;&quot; return getattr(self._controller, name) # Usage with thread safety

def create_isolated_controller(controller_type, **kwargs): &quot;&quot;&quot;Create controller with state isolation.&quot;&quot;&quot; base_controller = create_controller(controller_type, **kwargs) return IsolatedControllerWrapper(base_controller) # PSO with isolated controllers
def isolated_fitness_function(gains): &quot;&quot;&quot;PSO fitness function with isolated controllers.&quot;&quot;&quot; controller = create_isolated_controller(&#39;classical_smc&#39;, gains=gains) try: performance = evaluate_controller_performance(controller) return performance[&#39;total_cost&#39;] finally: # Ensure clean state for next use controller.reset_state()
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="debugging-tools-and-techniques-debugging-suite-python">
<h2>Debugging Tools and Techniques ### Debugging Suite ```python<a class="headerlink" href="#debugging-tools-and-techniques-debugging-suite-python" title="Link to this heading">¬∂</a></h2>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1>example-metadata:<a class="headerlink" href="#id1" title="Link to this heading">¬∂</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="id2">
<h1>runnable: false #!/usr/bin/env python3<a class="headerlink" href="#id2" title="Link to this heading">¬∂</a></h1>
<p>‚Äú‚Äù‚Äùfactory debugging suite.‚Äù‚Äù‚Äù import logging
import traceback
import time
import json
from pathlib import Path class FactoryDebugger: ‚Äú‚Äù‚Äùdebugging tools for factory integration.‚Äù‚Äù‚Äù def <strong>init</strong>(self, log_file=‚Äôfactory_debug.log‚Äô): self.log_file = log_file self._setup_logging() self.debug_data = {} def _setup_logging(self): ‚Äú‚Äù‚ÄùSetup detailed logging.‚Äù‚Äù‚Äù logging.basicConfig( level=logging.DEBUG, format=‚Äô%(asctime)s - %(name)s - %(levelname)s - %(message)s‚Äô, handlers=[ logging.FileHandler(self.log_file), logging.StreamHandler() ] ) self.logger = logging.getLogger(‚ÄòFactoryDebugger‚Äô) def debug_controller_creation(self, controller_type, **kwargs): ‚Äú‚Äù‚ÄùDebug controller creation step by step.‚Äù‚Äù‚Äù debug_info = { ‚Äòtimestamp‚Äô: time.time(), ‚Äòcontroller_type‚Äô: controller_type, ‚Äòkwargs‚Äô: kwargs, ‚Äòsteps‚Äô: [], ‚Äòerrors‚Äô: [], ‚Äòsuccess‚Äô: False } try: # Step 1: Check controller availability step1 = self._debug_step_availability(controller_type) debug_info[‚Äòsteps‚Äô].append(step1) if not step1[‚Äòsuccess‚Äô]: return debug_info # Step 2: Parameter resolution step2 = self._debug_step_parameters(controller_type, kwargs) debug_info[‚Äòsteps‚Äô].append(step2) # Step 3: Configuration creation step3 = self._debug_step_configuration(controller_type, step2[‚Äòresolved_params‚Äô]) debug_info[‚Äòsteps‚Äô].append(step3) # Step 4: Controller instantiation step4 = self.<em>debug_step_instantiation(controller_type, step3[‚Äòconfig‚Äô]) debug_info[‚Äòsteps‚Äô].append(step4) if step4[‚Äòsuccess‚Äô]: debug_info[‚Äòsuccess‚Äô] = True debug_info[‚Äòcontroller‚Äô] = step4[‚Äòcontroller‚Äô] except Exception as e: debug_info[‚Äòerrors‚Äô].append({ ‚Äòtype‚Äô: type(e).<strong>name</strong>, ‚Äòmessage‚Äô: str(e), ‚Äòtraceback‚Äô: traceback.format_exc() }) # Store debug data self.debug_data[f‚Äù{controller_type}</em>{time.time()}‚Äù] = debug_info return debug_info def _debug_step_availability(self, controller_type): ‚Äú‚Äù‚ÄùDebug controller availability.‚Äù‚Äù‚Äù step = {‚Äòname‚Äô: ‚Äòavailability_check‚Äô, ‚Äòsuccess‚Äô: False} try: from src.controllers.factory import list_available_controllers, CONTROLLER_REGISTRY available = list_available_controllers() step[‚Äòavailable_controllers‚Äô] = available step[‚Äòcontroller_in_registry‚Äô] = controller_type in CONTROLLER_REGISTRY step[‚Äòcontroller_available‚Äô] = controller_type in available if controller_type in available: controller_info = CONTROLLER_REGISTRY[controller_type] step[‚Äòcontroller_info‚Äô] = { ‚Äòclass_available‚Äô: controller_info[‚Äòclass‚Äô] is not None, ‚Äòdescription‚Äô: controller_info[‚Äòdescription‚Äô], ‚Äògain_count‚Äô: controller_info[‚Äògain_count‚Äô] } step[‚Äòsuccess‚Äô] = True else: step[‚Äòerror‚Äô] = f‚ÄùController {controller_type} not available‚Äù except Exception as e: step[‚Äòerror‚Äô] = str(e) return step def _debug_step_parameters(self, controller_type, kwargs): ‚Äú‚Äù‚ÄùDebug parameter resolution.‚Äù‚Äù‚Äù step = {‚Äòname‚Äô: ‚Äòparameter_resolution‚Äô, ‚Äòsuccess‚Äô: False} try: # Analyze provided parameters step[‚Äòprovided_params‚Äô] = list(kwargs.keys()) step[‚Äògains_provided‚Äô] = ‚Äògains‚Äô in kwargs step[‚Äòconfig_provided‚Äô] = ‚Äòconfig‚Äô in kwargs # Check gains if provided if ‚Äògains‚Äô in kwargs: gains = kwargs[‚Äògains‚Äô] step[‚Äògains_analysis‚Äô] = { ‚Äòtype‚Äô: type(gains).<strong>name</strong>, ‚Äòlength‚Äô: len(gains) if hasattr(gains, ‚Äò<strong>len</strong>‚Äô) else ‚ÄòN/A‚Äô, ‚Äòall_numeric‚Äô: all(isinstance(g, (int, float)) for g in gains) if hasattr(gains, ‚Äò<strong>iter</strong>‚Äô) else False } # Resolve final parameters from src.controllers.factory import get_default_gains if ‚Äògains‚Äô not in kwargs: default_gains = get_default_gains(controller_type) step[‚Äòusing_default_gains‚Äô] = True step[‚Äòdefault_gains‚Äô] = default_gains resolved_gains = default_gains else: resolved_gains = kwargs[‚Äògains‚Äô] step[‚Äòresolved_params‚Äô] = kwargs.copy() step[‚Äòresolved_params‚Äô][‚Äògains‚Äô] = resolved_gains step[‚Äòsuccess‚Äô] = True except Exception as e: step[‚Äòerror‚Äô] = str(e) return step def _debug_step_configuration(self, controller_type, params): ‚Äú‚Äù‚ÄùDebug configuration creation.‚Äù‚Äù‚Äù step = {‚Äòname‚Äô: ‚Äòconfiguration_creation‚Äô, ‚Äòsuccess‚Äô: False} try: from src.controllers.factory import CONTROLLER_REGISTRY controller_info = CONTROLLER_REGISTRY[controller_type] config_class = controller_info[‚Äòconfig_class‚Äô] step[‚Äòconfig_class‚Äô] = config_class.<strong>name</strong> step[‚Äòrequired_params‚Äô] = controller_info[‚Äòrequired_params‚Äô] # Try to create configuration if controller_type == ‚Äòclassical_smc‚Äô: config = config_class( gains=params[‚Äògains‚Äô], max_force=params.get(‚Äòmax_force‚Äô, 150.0), boundary_layer=params.get(‚Äòboundary_layer‚Äô, 0.02), dt=params.get(‚Äòdt‚Äô, 0.001) ) elif controller_type == ‚Äòadaptive_smc‚Äô: config = config_class( gains=params[‚Äògains‚Äô], max_force=params.get(‚Äòmax_force‚Äô, 150.0), dt=params.get(‚Äòdt‚Äô, 0.001) ) # ‚Ä¶ other controller types else: # Generic creation config = config_class(**params) step[‚Äòconfig‚Äô] = config step[‚Äòsuccess‚Äô] = True except Exception as e: step[‚Äòerror‚Äô] = str(e) step[‚Äòtraceback‚Äô] = traceback.format_exc() return step def _debug_step_instantiation(self, controller_type, config): ‚Äú‚Äù‚ÄùDebug controller instantiation.‚Äù‚Äù‚Äù step = {‚Äòname‚Äô: ‚Äòcontroller_instantiation‚Äô, ‚Äòsuccess‚Äô: False} try: from src.controllers.factory import CONTROLLER_REGISTRY controller_info = CONTROLLER_REGISTRY[controller_type] controller_class = controller_info[‚Äòclass‚Äô] step[‚Äòcontroller_class‚Äô] = controller_class.<strong>name</strong> # Create controller controller = controller_class(config) # Verify controller interface step[‚Äòhas_compute_control‚Äô] = hasattr(controller, ‚Äòcompute_control‚Äô) step[‚Äòhas_reset‚Äô] = hasattr(controller, ‚Äòreset‚Äô) step[‚Äòhas_gains‚Äô] = hasattr(controller, ‚Äògains‚Äô) if hasattr(controller, ‚Äògains‚Äô): step[‚Äòcontroller_gains‚Äô] = controller.gains step[‚Äòcontroller‚Äô] = controller step[‚Äòsuccess‚Äô] = True except Exception as e: step[‚Äòerror‚Äô] = str(e) step[‚Äòtraceback‚Äô] = traceback.format_exc() return step def generate_debug_report(self, output_file=‚Äôdebug_report.json‚Äô): ‚Äú‚Äù‚ÄùGenerate debug report.‚Äù‚Äù‚Äù report = { ‚Äòtimestamp‚Äô: time.time(), ‚Äòtotal_debug_sessions‚Äô: len(self.debug_data), ‚Äòsessions‚Äô: self.debug_data } with open(output_file, ‚Äòw‚Äô) as f: json.dump(report, f, indent=2, default=str) print(f‚ÄùDebug report saved to: {output_file}‚Äù) return report # Usage
debugger = FactoryDebugger() # Debug controller creation
debug_info = debugger.debug_controller_creation( ‚Äòclassical_smc‚Äô, gains=[20, 15, 12, 8, 35, 5]
) if debug_info[‚Äòsuccess‚Äô]: print(‚Äù‚úÖ Controller creation successful‚Äù)
else: print(‚Äù‚ùå Controller creation failed‚Äù) for error in debug_info[‚Äòerrors‚Äô]: print(f‚ÄùError: {error[‚Äòmessage‚Äô]}‚Äù) # Generate report
debugger.generate_debug_report()</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="o">---</span>

<span class="c1">## Prevention Strategies ### Best Practices for Robust Factory Integration ```python</span>

<span class="c1">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;Best practices for robust factory integration.&quot;&quot;&quot;</span> <span class="k">class</span><span class="w"> </span><span class="nc">RobustFactoryIntegration</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;Demonstrates best practices for factory integration.&quot;&quot;&quot;</span> <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory_cache</span> <span class="o">=</span> <span class="p">{}</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation_cache</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_controller_robust</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="s2">&quot;&quot;&quot;Create controller with robustness patterns.&quot;&quot;&quot;</span> <span class="c1"># 1. Input validation if not self._validate_inputs(controller_type, kwargs): raise ValueError(&quot;Invalid inputs&quot;) # 2. Pre-creation checks if not self._pre_creation_checks(controller_type): raise ImportError(f&quot;Controller {controller_type} not available&quot;) # 3. Safe creation with fallbacks try: return self._create_with_fallbacks(controller_type, kwargs) except Exception as e: self._log_creation_failure(controller_type, kwargs, e) raise def _validate_inputs(self, controller_type, kwargs): &quot;&quot;&quot;Validate inputs before creation.&quot;&quot;&quot; # Check controller type if not isinstance(controller_type, str) or not controller_type.strip(): return False # Check gains if provided if &#39;gains&#39; in kwargs: gains = kwargs[&#39;gains&#39;] if not isinstance(gains, (list, tuple)): return False if not all(isinstance(g, (int, float)) for g in gains): return False if not all(g &gt; 0 for g in gains): return False return True def _pre_creation_checks(self, controller_type): &quot;&quot;&quot;Perform pre-creation availability checks.&quot;&quot;&quot; try: from src.controllers.factory import list_available_controllers available = list_available_controllers() return controller_type in available except Exception: return False def _create_with_fallbacks(self, controller_type, kwargs): &quot;&quot;&quot;Create controller with fallback strategies.&quot;&quot;&quot; strategies = [ self._strategy_direct_creation, self._strategy_minimal_config, self._strategy_default_parameters ] last_exception = None for strategy in strategies: try: return strategy(controller_type, kwargs) except Exception as e: last_exception = e continue # All strategies failed raise last_exception def _strategy_direct_creation(self, controller_type, kwargs): &quot;&quot;&quot;Strategy 1: Direct creation with provided parameters.&quot;&quot;&quot; from src.controllers.factory import create_controller return create_controller(controller_type, **kwargs) def _strategy_minimal_config(self, controller_type, kwargs): &quot;&quot;&quot;Strategy 2: Minimal configuration creation.&quot;&quot;&quot; # Use only essential parameters essential_params = {} if &#39;gains&#39; in kwargs: essential_params[&#39;gains&#39;] = kwargs[&#39;gains&#39;] # Add required defaults if controller_type == &#39;classical_smc&#39;: essential_params.update({ &#39;max_force&#39;: 150.0, &#39;boundary_layer&#39;: 0.02, &#39;dt&#39;: 0.001 }) elif controller_type == &#39;adaptive_smc&#39;: essential_params.update({ &#39;max_force&#39;: 150.0, &#39;dt&#39;: 0.001 }) from src.controllers.factory import create_controller return create_controller(controller_type, **essential_params) def _strategy_default_parameters(self, controller_type, kwargs): &quot;&quot;&quot;Strategy 3: Use all default parameters.&quot;&quot;&quot; from src.controllers.factory import create_controller return create_controller(controller_type) def _log_creation_failure(self, controller_type, kwargs, exception): &quot;&quot;&quot;Log creation failure for debugging.&quot;&quot;&quot; import logging logger = logging.getLogger(__name__) logger.error(f&quot;Controller creation failed:&quot;) logger.error(f&quot; Type: {controller_type}&quot;) logger.error(f&quot; Parameters: {kwargs}&quot;) logger.error(f&quot; Exception: {exception}&quot;) # Validation patterns</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FactoryValidationPatterns</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;Common validation patterns for factory integration.&quot;&quot;&quot;</span> <span class="nd">@staticmethod</span> <span class="k">def</span><span class="w"> </span><span class="nf">validate_controller_type</span><span class="p">(</span><span class="n">controller_type</span><span class="p">):</span> <span class="s2">&quot;&quot;&quot;Validate controller type string.&quot;&quot;&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">controller_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Controller type must be string&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">controller_type</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Controller type cannot be empty&quot;</span><span class="p">)</span> <span class="c1"># Normalize return controller_type.strip().lower() @staticmethod def validate_gains(gains, expected_count=None): &quot;&quot;&quot;Validate gain array.&quot;&quot;&quot; if gains is None: return True # Allow None for default gains # Convert numpy arrays if hasattr(gains, &#39;tolist&#39;): gains = gains.tolist() if not isinstance(gains, (list, tuple)): raise TypeError(&quot;Gains must be list or tuple&quot;) if len(gains) == 0: raise ValueError(&quot;Gains cannot be empty&quot;) # Check types if not all(isinstance(g, (int, float)) for g in gains): raise TypeError(&quot;All gains must be numeric&quot;) # Check finite values import numpy as np if not all(np.isfinite(g) for g in gains): raise ValueError(&quot;All gains must be finite&quot;) # Check positivity if not all(g &gt; 0 for g in gains): raise ValueError(&quot;All gains must be positive&quot;) # Check count if specified if expected_count is not None and len(gains) != expected_count: raise ValueError(f&quot;Expected {expected_count} gains, got {len(gains)}&quot;) return True @staticmethod def validate_configuration(config, controller_type): &quot;&quot;&quot;Validate configuration object.&quot;&quot;&quot; if config is None: return True # Allow None for default config # Check for required attributes based on controller type if controller_type == &#39;classical_smc&#39;: required_attrs = [&#39;max_force&#39;, &#39;boundary_layer&#39;] for attr in required_attrs: if hasattr(config, attr): value = getattr(config, attr) if not isinstance(value, (int, float)) or value &lt;= 0: raise ValueError(f&quot;Invalid {attr}: {value}&quot;) return True # Testing patterns</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FactoryTestingPatterns</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;Testing patterns for factory integration.&quot;&quot;&quot;</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_all_controllers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="s2">&quot;&quot;&quot;Test all available controllers.&quot;&quot;&quot;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">src.controllers.factory</span><span class="w"> </span><span class="kn">import</span> <span class="n">list_available_controllers</span> <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span> <span class="n">available</span> <span class="o">=</span> <span class="n">list_available_controllers</span><span class="p">()</span> <span class="k">for</span> <span class="n">controller_type</span> <span class="ow">in</span> <span class="n">available</span><span class="p">:</span> <span class="k">try</span><span class="p">:</span> <span class="c1"># Test with defaults controller = create_controller(controller_type) results[controller_type] = {&#39;default&#39;: &#39;success&#39;} # Test with custom gains from src.controllers.factory import get_default_gains custom_gains = [g * 1.1 for g in get_default_gains(controller_type)] controller = create_controller(controller_type, gains=custom_gains) results[controller_type][&#39;custom_gains&#39;] = &#39;success&#39; except Exception as e: results[controller_type] = {&#39;error&#39;: str(e)} return results def stress_test_factory(self, n_iterations=1000): &quot;&quot;&quot;Stress test factory with many creations.&quot;&quot;&quot; import time start_time = time.time() errors = [] for i in range(n_iterations): try: controller = create_controller(&#39;classical_smc&#39;) del controller # Explicit cleanup except Exception as e: errors.append((i, str(e))) end_time = time.time() return { &#39;total_time&#39;: end_time - start_time, &#39;avg_time_per_creation&#39;: (end_time - start_time) / n_iterations, &#39;errors&#39;: errors, &#39;success_rate&#39;: (n_iterations - len(errors)) / n_iterations } # Usage examples</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span> <span class="c1"># Robust factory integration robust_factory = RobustFactoryIntegration() try: controller = robust_factory.create_controller_robust( &#39;classical_smc&#39;, gains=[20, 15, 12, 8, 35, 5] ) print(&quot;‚úÖ Robust controller creation successful&quot;) except Exception as e: print(f&quot;‚ùå Robust controller creation failed: {e}&quot;) # Validation patterns try: FactoryValidationPatterns.validate_gains([20, 15, 12, 8, 35, 5], expected_count=6) print(&quot;‚úÖ Gain validation passed&quot;) except Exception as e: print(f&quot;‚ùå Gain validation failed: {e}&quot;) # Testing patterns tester = FactoryTestingPatterns() test_results = tester.test_all_controllers() print(f&quot;Controller test results: {test_results}&quot;)</span>
</pre></div>
</div>
<hr class="docutils" />
<p>This troubleshooting guide provides systematic approaches to diagnosing and resolving factory integration issues. Each section includes detailed diagnostic procedures, root cause analysis, and proven approaches with practical code examples. The guide emphasizes prevention through robust programming practices and testing strategies.</p>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Research Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on Oct 10, 2025</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=4ebf8126"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=46bd48cc"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=08e7b316"></script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script src="_static/back-to-top.js?v=840797bb"></script>
    <script src="_static/lazy-load.js?v=dc25293c"></script>
    <script src="_static/dark-mode.js?v=bf328970"></script>
    </body>
</html>