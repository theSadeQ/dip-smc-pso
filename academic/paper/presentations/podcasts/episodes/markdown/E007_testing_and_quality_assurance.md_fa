# E007: تست و تضمین کیفیت

**بخش:** زیرساخت و ابزارها  
**زمان:** 15-20 دقیقه

---

## شروع

**سارا**: چند تست برای اعتبارسنجی 105 هزار خط کد لازم است؟  
**الکس**: 4,563 تست. اما مهم کمیت نیست، کیفیت پوشش رفتارهای حیاتی است.

---

## مسئله تست

سه سؤال اصلی:
1. چه چیزی ارزش تست دارد؟
2. چه زمانی کافی است؟
3. آیا رفتار پایدار را می‌سنجیم یا جزئیات شکننده را؟

---

## مقیاس تست‌ها

- **واحدی**: 3,678 (81%)
- **یکپارچه**: 681 (15%)
- **سیستمی**: 182 (4%)
- **مرورگر**: 22 (0.5%)

این همان «هرم تست» است: تست‌های سریع زیاد، تست‌های کند کم.

---

## استاندارد پوشش

- پوشش کلی: **حداقل 85٪**
- ماژول‌های بحرانی: **حداقل 95٪**
- ماژول‌های ایمنی: **100٪**

علت: ریسک بالا در اشباع، اعتبارسنجی، پایش، تکرارپذیری.

---

## تست‌های مبتنی بر خاصیت (Hypothesis)

به‌جای یک ورودی، یک «خاصیت» تعریف می‌شود:  
مثال: هر ورودی بزرگ‌تر از حد، باید دقیقا به حد اشباع شود.

ویژگی‌ها:
- تولید خودکار ورودی‌های تصادفی
- کشف لبه‌های پنهان
- استرس‌تست خودکار

---

## کمپین پوشش (Dec 20-21, 2025)

16.5 ساعت، 668 تست جدید، دو باگ بحرانی کشف شد:
- ناسازگاری API در factory
- نشت حافظه در Adaptive SMC (با weakref حل شد)

---

## زمان اجرای تست‌ها

کل سوئیت: **45 ثانیه**  
چرا مهم است؟ چرخه بازخورد سریع برای توسعه‌دهنده.

---

## دروازه‌های کیفیت

**تحقیق‌محور**: عبور کرده  
**تولیدمحور**: نیازمند CI/CD صنعتی و اعتبارسنجی سخت‌افزاری

---

## مدیریت حافظه

اجرای 10,000 شبیه‌سازی پشت‌سرهم  
معیار: رشد حافظه باید ≈ صفر باشد.

---

## ایمنی نخی (Thread Safety)

شبیه‌سازی موازی با ThreadPoolExecutor  
هدف: نبود race condition و نتایج نادرست.

---

## اشکال‌زدایی تست‌ها

1. پیام خطا را بخوانید  
2. خروجی verbose  
3. اجرای debugger  
4. لاگ یا print موقت

---

## تست رگرسیون

هر باگ → یک تست رگرسیون  
هدف: بازگشت باگ غیرممکن شود.

---

## تست عملکرد

pytest-benchmark برای مسیرهای حیاتی:  
اگر سرعت افت کند، تست شکست می‌خورد.

---

## CI (GitHub Actions)

لینت، نوع‌سنجی، تست‌ها، مستندسازی، تست مرورگر، و گزارش پوشش در چند دقیقه.

---

## معمای پوشش 2.86%

ابزار پوشش فقط فایل‌های واردشده را می‌سنجد.  
بررسی دستی نشان داد پوشش واقعی ≈ 89٪ است.

---

## جمع‌بندی

- 4,563 تست برای 105k خط کد  
- هرم تست + پوشش لایه‌ای  
- Hypothesis برای خاصیت‌ها  
- کیفیت تحقیق‌محور، نه تولیدمحور  
- حافظه و thread safety اعتبارسنجی شده‌اند

---

## قسمت بعدی

**E008: خروجی‌های پژوهشی و انتشار**

---

## منابع

- مخزن: `https://github.com/theSadeQ/dip-smc-pso.git`
- تست‌ها: `tests/`
- استانداردها: `.ai_workspace/config/testing_standards.md`
