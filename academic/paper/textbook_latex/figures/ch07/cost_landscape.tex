% PSO Cost Function Landscape (2D Slice)
% TikZ diagram for Chapter 7 - Particle trajectories on cost surface

\begin{tikzpicture}[scale=1.0]

    % Axes
    \draw[->, thick] (0, 0) -- (8, 0) node[right] {$\lambda_1$ (gain 1)};
    \draw[->, thick] (0, 0) -- (0, 6) node[above] {$\lambda_2$ (gain 2)};

    % Grid
    \draw[gray!20, very thin] (0, 0) grid (7.5, 5.5);

    % Contour lines (cost function level sets)
    \draw[blue!40, thick] (4, 3) ellipse (3cm and 2cm);
    \draw[blue!50, thick] (4, 3) ellipse (2.3cm and 1.5cm);
    \draw[blue!60, thick] (4, 3) ellipse (1.6cm and 1cm);
    \draw[blue!70, thick] (4, 3) ellipse (1cm and 0.6cm);
    \draw[blue!80, thick] (4, 3) ellipse (0.5cm and 0.3cm);

    % Global optimum (center)
    \fill[green!70!black] (4, 3) circle (0.12) node[below right, black] {$\lambda^*$};
    \node[green!70!black, above] at (4, 3.5) {\small Global Minimum};

    % Local minima (suboptimal)
    \fill[orange!80] (1.5, 1.5) circle (0.08);
    \node[orange!80, below] at (1.5, 1.3) {\small Local Min};
    \draw[orange!40, thick] (1.5, 1.5) ellipse (0.6cm and 0.4cm);

    \fill[orange!80] (6.5, 4.5) circle (0.08);
    \node[orange!80, above] at (6.5, 4.7) {\small Local Min};
    \draw[orange!40, thick] (6.5, 4.5) ellipse (0.5cm and 0.35cm);

    % Particle trajectories (3 particles converging to global optimum)
    % Particle 1 (from top left)
    \draw[red, very thick, ->, decoration={markings, mark=at position 0.3 with {\arrow{>}}, mark=at position 0.7 with {\arrow{>}}}, postaction={decorate}]
        (0.5, 5) .. controls (1.5, 4.5) and (2.5, 3.8) .. (4, 3);
    \fill[red] (0.5, 5) circle (0.06);
    \node[red, left] at (0.5, 5) {\tiny $p_1(0)$};

    % Particle 2 (from bottom right)
    \draw[purple, very thick, ->, decoration={markings, mark=at position 0.3 with {\arrow{>}}, mark=at position 0.7 with {\arrow{>}}}, postaction={decorate}]
        (7, 1) .. controls (6, 1.8) and (5, 2.5) .. (4, 3);
    \fill[purple] (7, 1) circle (0.06);
    \node[purple, right] at (7, 1) {\tiny $p_2(0)$};

    % Particle 3 (from middle right, passes near local minimum)
    \draw[cyan!80!black, very thick, ->, decoration={markings, mark=at position 0.2 with {\arrow{>}}, mark=at position 0.5 with {\arrow{>}}, mark=at position 0.8 with {\arrow{>}}}, postaction={decorate}]
        (7.5, 4.5) .. controls (6.8, 4.4) and (6.2, 4.2) .. (5.5, 3.8) .. controls (5, 3.5) and (4.5, 3.2) .. (4, 3);
    \fill[cyan!80!black] (7.5, 4.5) circle (0.06);
    \node[cyan!80!black, right] at (7.5, 4.5) {\tiny $p_3(0)$};
    % Near-miss annotation
    \draw[<-, thick, cyan!80!black] (6.5, 4.5) -- (7, 5.2)
        node[right, align=left] {\small Avoids local\\minimum via\\social term};

    % Cost contour labels
    \node[blue!70, font=\tiny] at (5.2, 3.5) {$J=1$};
    \node[blue!70, font=\tiny] at (5.8, 4.2) {$J=2$};
    \node[blue!70, font=\tiny] at (6.5, 5) {$J=3$};

    % Swarm behavior annotations
    \draw[<-, thick, red] (1.5, 4) -- (0.5, 3.5)
        node[left, align=right] {\small Cognitive term:\\move toward\\personal best};

    \draw[<-, thick, purple] (5.5, 2) -- (6.5, 1.5)
        node[right, align=left] {\small Social term:\\move toward\\global best};

    % Tick marks
    \foreach \x in {0, 5, 10, 15, 20}
        \draw ({\x/2.5}, -0.1) -- ({\x/2.5}, 0.1) node[below, yshift=-2mm, font=\tiny] {$\x$};
    \foreach \y in {0, 5, 10, 15}
        \draw (-0.1, {\y/2.5}) -- (0.1, {\y/2.5}) node[left, xshift=-2mm, font=\tiny] {$\y$};

    % Algorithm parameters box
    \node[draw, thick, fill=yellow!10, align=left, font=\scriptsize] at (2, -1.2) {
        \textbf{PSO Parameters:}\\
        Swarm size: 30 particles\\
        $w = 0.7$ (inertia), $c_1 = c_2 = 1.5$ (cognitive/social)\\
        Search space: $\lambda_i \in [0, 20]$
    };

\end{tikzpicture}
